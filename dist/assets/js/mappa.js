var $r=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);import"./modulepreload-polyfill-B5Qt9EMX.js";import{l as Mr,p as Ir}from"./dataParser-MdtaU4cT.js";import{i as Tr}from"./initMap-BJKCVE25.js";var ti=$r((B,R)=>{var ir=typeof global=="object"&&global&&global.Object===Object&&global,Fr=typeof self=="object"&&self&&self.Object===Object&&self,Z=ir||Fr||Function("return this")(),H=Z.Symbol,sr=Object.prototype,Nr=sr.hasOwnProperty,Pr=sr.toString,yt=H?H.toStringTag:void 0,Lr=Object.prototype.toString,Dr="[object Null]",qr="[object Undefined]",ve=H?H.toStringTag:void 0;function wt(t){return t==null?t===void 0?qr:Dr:ve&&ve in Object(t)?function(e){var r=Nr.call(e,yt),o=e[yt];try{e[yt]=void 0;var n=!0}catch{}var s=Pr.call(e);return n&&(r?e[yt]=o:delete e[yt]),s}(t):function(e){return Lr.call(e)}(t)}function tt(t){return t!=null&&typeof t=="object"}var Vr="[object Symbol]";function pt(t){return typeof t=="symbol"||tt(t)&&wt(t)==Vr}function ft(t,e){for(var r=-1,o=t==null?0:t.length,n=Array(o);++r<o;)n[r]=e(t[r],r,t);return n}var D=Array.isArray,Wr=1/0,ye=H?H.prototype:void 0,be=ye?ye.toString:void 0;function ar(t){if(typeof t=="string")return t;if(D(t))return ft(t,ar)+"";if(pt(t))return be?be.call(t):"";var e=t+"";return e=="0"&&1/t==-Wr?"-0":e}function it(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}function Dt(t){return t}var Br="[object AsyncFunction]",Rr="[object Function]",Ur="[object GeneratorFunction]",Hr="[object Proxy]";function cr(t){if(!it(t))return!1;var e=wt(t);return e==Rr||e==Ur||e==Br||e==Hr}var _e,Bt=Z["__core-js_shared__"],je=(_e=/[^.]+$/.exec(Bt&&Bt.keys&&Bt.keys.IE_PROTO||""))?"Symbol(src)_1."+_e:"",Jr=Function.prototype.toString;function st(t){if(t!=null){try{return Jr.call(t)}catch{}try{return t+""}catch{}}return""}var Gr=/^\[object .+?Constructor\]$/,Zr=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function at(t,e){var r=function(o,n){return o==null?void 0:o[n]}(t,e);return function(o){return!(!it(o)||(n=o,je&&je in n))&&(cr(o)?Zr:Gr).test(st(o));var n}(r)?r:void 0}var Se,Rt,Ut,Qt=at(Z,"WeakMap"),xe=Object.create,Yr=function(){function t(){}return function(e){if(!it(e))return{};if(xe)return xe(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}(),Qr=Date.now,Xr=function(){try{var t=at(Object,"defineProperty");return t({},"",{}),t}catch{}}(),Nt=Xr,Kr=Nt?function(t,e){return Nt(t,"toString",{configurable:!0,enumerable:!1,value:(r=e,function(){return r}),writable:!0});var r}:Dt,tn=(Se=Kr,Rt=0,Ut=0,function(){var t=Qr(),e=16-(t-Ut);if(Ut=t,e>0){if(++Rt>=800)return arguments[0]}else Rt=0;return Se.apply(void 0,arguments)});function en(t){return t!=t}function rn(t,e){return!(t==null||!t.length)&&function(r,o,n){return o==o?function(s,a,h){for(var u=-1,d=s.length;++u<d;)if(s[u]===a)return u;return-1}(r,o):function(s,a,h,u){for(var d=s.length,l=-1;++l<d;)if(a(s[l],l,s))return l;return-1}(r,en)}(t,e)>-1}var nn=9007199254740991,on=/^(?:0|[1-9]\d*)$/;function ae(t,e){var r=typeof t;return!!(e=e??nn)&&(r=="number"||r!="symbol"&&on.test(t))&&t>-1&&t%1==0&&t<e}function ce(t,e,r){e=="__proto__"&&Nt?Nt(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function qt(t,e){return t===e||t!=t&&e!=e}var sn=Object.prototype.hasOwnProperty;function ur(t,e,r){var o=t[e];sn.call(t,e)&&qt(o,r)&&(r!==void 0||e in t)||ce(t,e,r)}function zt(t,e,r,o){var n=!r;r||(r={});for(var s=-1,a=e.length;++s<a;){var h=e[s],u=void 0;u===void 0&&(u=t[h]),n?ce(r,h,u):ur(r,h,u)}return r}var Oe=Math.max;function lr(t,e){return tn(function(r,o,n){return o=Oe(o===void 0?r.length-1:o,0),function(){for(var s=arguments,a=-1,h=Oe(s.length-o,0),u=Array(h);++a<h;)u[a]=s[o+a];a=-1;for(var d=Array(o+1);++a<o;)d[a]=s[a];return d[o]=n(u),function(l,w,g){switch(g.length){case 0:return l.call(w);case 1:return l.call(w,g[0]);case 2:return l.call(w,g[0],g[1]);case 3:return l.call(w,g[0],g[1],g[2])}return l.apply(w,g)}(r,this,d)}}(t,e,Dt),t+"")}var an=9007199254740991;function ue(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=an}function mt(t){return t!=null&&ue(t.length)&&!cr(t)}function Ee(t,e,r){if(!it(r))return!1;var o=typeof e;return!!(o=="number"?mt(r)&&ae(e,r.length):o=="string"&&e in r)&&qt(r[e],t)}var cn=Object.prototype;function le(t){var e=t&&t.constructor;return t===(typeof e=="function"&&e.prototype||cn)}function ke(t){return tt(t)&&wt(t)=="[object Arguments]"}var hr=Object.prototype,un=hr.hasOwnProperty,ln=hr.propertyIsEnumerable,he=ke(function(){return arguments}())?ke:function(t){return tt(t)&&un.call(t,"callee")&&!ln.call(t,"callee")},dr=typeof B=="object"&&B&&!B.nodeType&&B,Ae=dr&&typeof R=="object"&&R&&!R.nodeType&&R,ze=Ae&&Ae.exports===dr?Z.Buffer:void 0,Pt=(ze?ze.isBuffer:void 0)||function(){return!1},T={};function Vt(t){return function(e){return t(e)}}T["[object Float32Array]"]=T["[object Float64Array]"]=T["[object Int8Array]"]=T["[object Int16Array]"]=T["[object Int32Array]"]=T["[object Uint8Array]"]=T["[object Uint8ClampedArray]"]=T["[object Uint16Array]"]=T["[object Uint32Array]"]=!0,T["[object Arguments]"]=T["[object Array]"]=T["[object ArrayBuffer]"]=T["[object Boolean]"]=T["[object DataView]"]=T["[object Date]"]=T["[object Error]"]=T["[object Function]"]=T["[object Map]"]=T["[object Number]"]=T["[object Object]"]=T["[object RegExp]"]=T["[object Set]"]=T["[object String]"]=T["[object WeakMap]"]=!1;var fr=typeof B=="object"&&B&&!B.nodeType&&B,_t=fr&&typeof R=="object"&&R&&!R.nodeType&&R,Ht=_t&&_t.exports===fr&&ir.process,gt=function(){try{return _t&&_t.require&&_t.require("util").types||Ht&&Ht.binding&&Ht.binding("util")}catch{}}(),Ce=gt&&gt.isTypedArray,pr=Ce?Vt(Ce):function(t){return tt(t)&&ue(t.length)&&!!T[wt(t)]},hn=Object.prototype.hasOwnProperty;function gr(t,e){var r=D(t),o=!r&&he(t),n=!r&&!o&&Pt(t),s=!r&&!o&&!n&&pr(t),a=r||o||n||s,h=a?function(l,w){for(var g=-1,y=Array(l);++g<l;)y[g]=w(g);return y}(t.length,String):[],u=h.length;for(var d in t)!e&&!hn.call(t,d)||a&&(d=="length"||n&&(d=="offset"||d=="parent")||s&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||ae(d,u))||h.push(d);return h}function wr(t,e){return function(r){return t(e(r))}}var dn=wr(Object.keys,Object),fn=Object.prototype.hasOwnProperty;function Ot(t){return mt(t)?gr(t):function(e){if(!le(e))return dn(e);var r=[];for(var o in Object(e))fn.call(e,o)&&o!="constructor"&&r.push(o);return r}(t)}var pn=Object.prototype.hasOwnProperty;function gn(t){return mt(t)?gr(t,!0):function(e){if(!it(e))return function(s){var a=[];if(s!=null)for(var h in Object(s))a.push(h);return a}(e);var r=le(e),o=[];for(var n in e)(n!="constructor"||!r&&pn.call(e,n))&&o.push(n);return o}(t)}var wn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mn=/^\w*$/;function Xt(t,e){if(D(t))return!1;var r=typeof t;return!(r!="number"&&r!="symbol"&&r!="boolean"&&t!=null&&!pt(t))||mn.test(t)||!wn.test(t)||e!=null&&t in Object(e)}var bt=at(Object,"create"),vn=Object.prototype.hasOwnProperty,yn=Object.prototype.hasOwnProperty;function ot(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}function Ct(t,e){for(var r=t.length;r--;)if(qt(t[r][0],e))return r;return-1}ot.prototype.clear=function(){this.__data__=bt?bt(null):{},this.size=0},ot.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ot.prototype.get=function(t){var e=this.__data__;if(bt){var r=e[t];return r==="__lodash_hash_undefined__"?void 0:r}return vn.call(e,t)?e[t]:void 0},ot.prototype.has=function(t){var e=this.__data__;return bt?e[t]!==void 0:yn.call(e,t)},ot.prototype.set=function(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=bt&&e===void 0?"__lodash_hash_undefined__":e,this};var bn=Array.prototype.splice;function K(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}K.prototype.clear=function(){this.__data__=[],this.size=0},K.prototype.delete=function(t){var e=this.__data__,r=Ct(e,t);return!(r<0||(r==e.length-1?e.pop():bn.call(e,r,1),--this.size,0))},K.prototype.get=function(t){var e=this.__data__,r=Ct(e,t);return r<0?void 0:e[r][1]},K.prototype.has=function(t){return Ct(this.__data__,t)>-1},K.prototype.set=function(t,e){var r=this.__data__,o=Ct(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this};var St=at(Z,"Map");function $t(t,e){var r,o,n=t.__data__;return((o=typeof(r=e))=="string"||o=="number"||o=="symbol"||o=="boolean"?r!=="__proto__":r===null)?n[typeof e=="string"?"string":"hash"]:n.map}function X(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}function de(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var r=function(){var o=arguments,n=e?e.apply(this,o):o[0],s=r.cache;if(s.has(n))return s.get(n);var a=t.apply(this,o);return r.cache=s.set(n,a)||s,a};return r.cache=new(de.Cache||X),r}X.prototype.clear=function(){this.size=0,this.__data__={hash:new ot,map:new(St||K),string:new ot}},X.prototype.delete=function(t){var e=$t(this,t).delete(t);return this.size-=e?1:0,e},X.prototype.get=function(t){return $t(this,t).get(t)},X.prototype.has=function(t){return $t(this,t).has(t)},X.prototype.set=function(t,e){var r=$t(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this},de.Cache=X;var Jt,Gt,_n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,jn=/\\(\\)?/g,Sn=(Jt=de(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(_n,function(r,o,n,s){e.push(n?s.replace(jn,"$1"):o||r)}),e},function(t){return Gt.size===500&&Gt.clear(),t}),Gt=Jt.cache,Jt);function mr(t,e){return D(t)?t:Xt(t,e)?[t]:Sn(function(r){return r==null?"":ar(r)}(t))}var xn=1/0;function Tt(t){if(typeof t=="string"||pt(t))return t;var e=t+"";return e=="0"&&1/t==-xn?"-0":e}function Kt(t,e){for(var r=0,o=(e=mr(e,t)).length;t!=null&&r<o;)t=t[Tt(e[r++])];return r&&r==o?t:void 0}function fe(t,e){for(var r=-1,o=e.length,n=t.length;++r<o;)t[n+r]=e[r];return t}var $e=H?H.isConcatSpreadable:void 0;function On(t){return D(t)||he(t)||!!($e&&t&&t[$e])}function En(t,e,r,o,n){var s=-1,a=t.length;for(r||(r=On),n||(n=[]);++s<a;){var h=t[s];r(h)?fe(n,h):n[n.length]=h}return n}var vr=wr(Object.getPrototypeOf,Object);function G(t){var e=this.__data__=new K(t);this.size=e.size}G.prototype.clear=function(){this.__data__=new K,this.size=0},G.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},G.prototype.get=function(t){return this.__data__.get(t)},G.prototype.has=function(t){return this.__data__.has(t)},G.prototype.set=function(t,e){var r=this.__data__;if(r instanceof K){var o=r.__data__;if(!St||o.length<199)return o.push([t,e]),this.size=++r.size,this;r=this.__data__=new X(o)}return r.set(t,e),this.size=r.size,this};var yr=typeof B=="object"&&B&&!B.nodeType&&B,Me=yr&&typeof R=="object"&&R&&!R.nodeType&&R,Ie=Me&&Me.exports===yr?Z.Buffer:void 0,Te=Ie?Ie.allocUnsafe:void 0;function br(){return[]}var kn=Object.prototype.propertyIsEnumerable,Fe=Object.getOwnPropertySymbols,An=Fe?function(t){return t==null?[]:(t=Object(t),function(e,r){for(var o=-1,n=e==null?0:e.length,s=0,a=[];++o<n;){var h=e[o];kn.call(t,h)&&(a[s++]=h)}return a}(Fe(t)))}:br,pe=An,zn=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)fe(e,pe(t)),t=vr(t);return e}:br;function Cn(t,e,r){var o=e(t);return D(t)?o:fe(o,r(t))}function te(t){return Cn(t,Ot,pe)}var ee=at(Z,"DataView"),re=at(Z,"Promise"),ne=at(Z,"Set"),Ne="[object Map]",Pe="[object Promise]",Le="[object Set]",De="[object WeakMap]",qe="[object DataView]",$n=st(ee),Mn=st(St),In=st(re),Tn=st(ne),Fn=st(Qt),nt=wt;(ee&&nt(new ee(new ArrayBuffer(1)))!=qe||St&&nt(new St)!=Ne||re&&nt(re.resolve())!=Pe||ne&&nt(new ne)!=Le||Qt&&nt(new Qt)!=De)&&(nt=function(t){var e=wt(t),r=e=="[object Object]"?t.constructor:void 0,o=r?st(r):"";if(o)switch(o){case $n:return qe;case Mn:return Ne;case In:return Pe;case Tn:return Le;case Fn:return De}return e});var xt=nt,Nn=Object.prototype.hasOwnProperty,Lt=Z.Uint8Array;function Pn(t){var e=new t.constructor(t.byteLength);return new Lt(e).set(new Lt(t)),e}var Ln=/\w*$/,Ve=H?H.prototype:void 0,We=Ve?Ve.valueOf:void 0,Dn="[object Boolean]",qn="[object Date]",Vn="[object Map]",Wn="[object Number]",Bn="[object RegExp]",Rn="[object Set]",Un="[object String]",Hn="[object Symbol]",Jn="[object ArrayBuffer]",Gn="[object DataView]",Zn="[object Float32Array]",Yn="[object Float64Array]",Qn="[object Int8Array]",Xn="[object Int16Array]",Kn="[object Int32Array]",to="[object Uint8Array]",eo="[object Uint8ClampedArray]",ro="[object Uint16Array]",no="[object Uint32Array]",Be=gt&&gt.isMap,oo=Be?Vt(Be):function(t){return tt(t)&&xt(t)=="[object Map]"},Re=gt&&gt.isSet,io=Re?Vt(Re):function(t){return tt(t)&&xt(t)=="[object Set]"},so=1,ao=2,_r="[object Arguments]",jr="[object Function]",co="[object GeneratorFunction]",Sr="[object Object]",I={};function Ft(t,e,r,o,n,s){var a,h=e&so,u=e&ao;if(a!==void 0)return a;if(!it(t))return t;var d=D(t);if(d){if(a=function(f){var m=f.length,j=new f.constructor(m);return m&&typeof f[0]=="string"&&Nn.call(f,"index")&&(j.index=f.index,j.input=f.input),j}(t),!h)return function(f,m){var j=-1,x=f.length;for(m||(m=Array(x));++j<x;)m[j]=f[j];return m}(t,a)}else{var l=xt(t),w=l==jr||l==co;if(Pt(t))return function(f,m){var j=f.length,x=Te?Te(j):new f.constructor(j);return f.copy(x),x}(t);if(l==Sr||l==_r||w&&!n){if(a=w?{}:function(f){return typeof f.constructor!="function"||le(f)?{}:Yr(vr(f))}(t),!h)return u?function(f,m){return zt(f,zn(f),m)}(t,function(f,m){return f&&zt(m,gn(m),f)}(a,t)):function(f,m){return zt(f,pe(f),m)}(t,function(f,m){return f&&zt(m,Ot(m),f)}(a,t))}else{if(!I[l])return n?t:{};a=function(f,m,j){var x,z,F=f.constructor;switch(m){case Jn:return Pn(f);case Dn:case qn:return new F(+f);case Gn:return function(k,N){var S=k.buffer;return new k.constructor(S,k.byteOffset,k.byteLength)}(f);case Zn:case Yn:case Qn:case Xn:case Kn:case to:case eo:case ro:case no:return function(k,N){var S=k.buffer;return new k.constructor(S,k.byteOffset,k.length)}(f);case Vn:return new F;case Wn:case Un:return new F(f);case Bn:return(z=new(x=f).constructor(x.source,Ln.exec(x))).lastIndex=x.lastIndex,z;case Rn:return new F;case Hn:return We?Object(We.call(f)):{}}}(t,l)}}s||(s=new G);var g=s.get(t);if(g)return g;s.set(t,a),io(t)?t.forEach(function(f){a.add(Ft(f,e,r,f,t,s))}):oo(t)&&t.forEach(function(f,m){a.set(m,Ft(f,e,r,m,t,s))});var y=d?void 0:te(t);return function(f,m){for(var j=-1,x=f==null?0:f.length;++j<x&&m(f[j],j)!==!1;);}(y||t,function(f,m){y&&(f=t[m=f]),ur(a,m,Ft(f,e,r,m,t,s))}),a}function Zt(t){return Ft(t,4)}function jt(t){var e=-1,r=t==null?0:t.length;for(this.__data__=new X;++e<r;)this.add(t[e])}function uo(t,e){for(var r=-1,o=t==null?0:t.length;++r<o;)if(e(t[r],r,t))return!0;return!1}function oe(t,e){return t.has(e)}I[_r]=I["[object Array]"]=I["[object ArrayBuffer]"]=I["[object DataView]"]=I["[object Boolean]"]=I["[object Date]"]=I["[object Float32Array]"]=I["[object Float64Array]"]=I["[object Int8Array]"]=I["[object Int16Array]"]=I["[object Int32Array]"]=I["[object Map]"]=I["[object Number]"]=I[Sr]=I["[object RegExp]"]=I["[object Set]"]=I["[object String]"]=I["[object Symbol]"]=I["[object Uint8Array]"]=I["[object Uint8ClampedArray]"]=I["[object Uint16Array]"]=I["[object Uint32Array]"]=!0,I["[object Error]"]=I[jr]=I["[object WeakMap]"]=!1,jt.prototype.add=jt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},jt.prototype.has=function(t){return this.__data__.has(t)};var lo=1,ho=2;function Ue(t,e,r,o,n,s){var a=r&lo,h=t.length,u=e.length;if(h!=u&&!(a&&u>h))return!1;var d=s.get(t),l=s.get(e);if(d&&l)return d==e&&l==t;var w=-1,g=!0,y=r&ho?new jt:void 0;for(s.set(t,e),s.set(e,t);++w<h;){var f=t[w],m=e[w];if(o)var j=a?o(m,f,w,e,t,s):o(f,m,w,t,e,s);if(j!==void 0){if(j)continue;g=!1;break}if(y){if(!uo(e,function(x,z){if(!oe(y,z)&&(f===x||n(f,x,r,o,s)))return y.push(z)})){g=!1;break}}else if(f!==m&&!n(f,m,r,o,s)){g=!1;break}}return s.delete(t),s.delete(e),g}function fo(t){var e=-1,r=Array(t.size);return t.forEach(function(o,n){r[++e]=[n,o]}),r}function po(t){var e=-1,r=Array(t.size);return t.forEach(function(o){r[++e]=o}),r}var go=1,wo=2,mo="[object Boolean]",vo="[object Date]",yo="[object Error]",bo="[object Map]",_o="[object Number]",jo="[object RegExp]",So="[object Set]",xo="[object String]",Oo="[object Symbol]",Eo="[object ArrayBuffer]",ko="[object DataView]",He=H?H.prototype:void 0,Yt=He?He.valueOf:void 0,Ao=1,zo=Object.prototype.hasOwnProperty,Co=1,Je="[object Arguments]",Ge="[object Array]",Mt="[object Object]",Ze=Object.prototype.hasOwnProperty;function ie(t,e,r,o,n){return t===e||(t==null||e==null||!tt(t)&&!tt(e)?t!=t&&e!=e:function(s,a,h,u,d,l){var w=D(s),g=D(a),y=w?Ge:xt(s),f=g?Ge:xt(a),m=(y=y==Je?Mt:y)==Mt,j=(f=f==Je?Mt:f)==Mt,x=y==f;if(x&&Pt(s)){if(!Pt(a))return!1;w=!0,m=!1}if(x&&!m)return l||(l=new G),w||pr(s)?Ue(s,a,h,u,d,l):function(S,E,P,q,et,V,U){switch(P){case ko:if(S.byteLength!=E.byteLength||S.byteOffset!=E.byteOffset)return!1;S=S.buffer,E=E.buffer;case Eo:return!(S.byteLength!=E.byteLength||!V(new Lt(S),new Lt(E)));case mo:case vo:case _o:return qt(+S,+E);case yo:return S.name==E.name&&S.message==E.message;case jo:case xo:return S==E+"";case bo:var J=fo;case So:if(J||(J=po),S.size!=E.size&&!(q&go))return!1;var Y=U.get(S);if(Y)return Y==E;q|=wo,U.set(S,E);var Q=Ue(J(S),J(E),q,et,V,U);return U.delete(S),Q;case Oo:if(Yt)return Yt.call(S)==Yt.call(E)}return!1}(s,a,y,h,u,d,l);if(!(h&Co)){var z=m&&Ze.call(s,"__wrapped__"),F=j&&Ze.call(a,"__wrapped__");if(z||F){var k=z?s.value():s,N=F?a.value():a;return l||(l=new G),d(k,N,h,u,l)}}return!!x&&(l||(l=new G),function(S,E,P,q,et,V){var U=P&Ao,J=te(S),Y=J.length;if(Y!=te(E).length&&!U)return!1;for(var Q=Y;Q--;){var p=J[Q];if(!(U?p in E:zo.call(E,p)))return!1}var i=V.get(S),c=V.get(E);if(i&&c)return i==E&&c==S;var v=!0;V.set(S,E),V.set(E,S);for(var b=U;++Q<Y;){var _=S[p=J[Q]],O=E[p];if(q)var $=U?q(O,_,p,E,S,V):q(_,O,p,S,E,V);if(!($===void 0?_===O||et(_,O,P,q,V):$)){v=!1;break}b||(b=p=="constructor")}if(v&&!b){var L=S.constructor,M=E.constructor;L==M||!("constructor"in S)||!("constructor"in E)||typeof L=="function"&&L instanceof L&&typeof M=="function"&&M instanceof M||(v=!1)}return V.delete(S),V.delete(E),v}(s,a,h,u,d,l))}(t,e,r,o,ie,n))}var $o=1,Mo=2;function Ye(t){return t==t&&!it(t)}function Qe(t,e){return function(r){return r!=null&&r[t]===e&&(e!==void 0||t in Object(r))}}function Io(t,e){return t!=null&&e in Object(t)}var To=1,Fo=2;function ct(t){return typeof t=="function"?t:t==null?Dt:typeof t=="object"?D(t)?function(s,a){return Xt(s)&&Ye(a)?Qe(Tt(s),a):function(h){var u=function(d,l,w){var g=d==null?void 0:Kt(d,l);return g===void 0?void 0:g}(h,s);return u===void 0&&u===a?function(d,l){return d!=null&&function(w,g,y){for(var f=-1,m=(g=mr(g,w)).length,j=!1;++f<m;){var x=Tt(g[f]);if(!(j=w!=null&&y(w,x)))break;w=w[x]}return j||++f!=m?j:!!(m=w==null?0:w.length)&&ue(m)&&ae(x,m)&&(D(w)||he(w))}(d,l,Io)}(h,s):ie(a,u,To|Fo)}}(t[0],t[1]):(n=function(s){for(var a=Ot(s),h=a.length;h--;){var u=a[h],d=s[u];a[h]=[u,d,Ye(d)]}return a}(o=t),n.length==1&&n[0][2]?Qe(n[0][0],n[0][1]):function(s){return s===o||function(a,h,u,d){var l=u.length,w=l;if(a==null)return!w;for(a=Object(a);l--;){var g=u[l];if(g[2]?g[1]!==a[g[0]]:!(g[0]in a))return!1}for(;++l<w;){var y=(g=u[l])[0],f=a[y],m=g[1];if(g[2]){if(f===void 0&&!(y in a))return!1}else{var j=new G;if(!ie(m,f,$o|Mo,void 0,j))return!1}}return!0}(s,0,n)}):Xt(e=t)?(r=Tt(e),function(s){return s==null?void 0:s[r]}):function(s){return function(a){return Kt(a,s)}}(e);var e,r,o,n}var No=function(t,e,r){for(var o=-1,n=Object(t),s=r(t),a=s.length;a--;){var h=s[++o];if(e(n[h],h,n)===!1)break}return t};function xr(t,e){return t&&No(t,e,Ot)}var Xe,Po=(Xe=xr,function(t,e){if(t==null)return t;if(!mt(t))return Xe(t,e);for(var r=t.length,o=-1,n=Object(t);++o<r&&e(n[o],o,n)!==!1;);return t});function Or(t,e){var r=-1,o=mt(t)?Array(t.length):[];return Po(t,function(n,s,a){o[++r]=e(n,s,a)}),o}function Lo(t,e){return t>e}var Do=Math.min;function qo(t){return function(e){return tt(e)&&mt(e)}(t)?t:[]}var Vo=lr(function(t){var e=ft(t,qo);return e.length&&e[0]===t[0]?function(r,o,n){for(var s=rn,a=r[0].length,h=r.length,u=h,d=Array(h),l=1/0,w=[];u--;){var g=r[u];l=Do(g.length,l),d[u]=a>=120&&g.length>=120?new jt(u&&g):void 0}g=r[0];var y=-1,f=d[0];t:for(;++y<a&&w.length<l;){var m=g[y],j=m;if(m=m!==0?m:0,!(f?oe(f,j):s(w,j,n))){for(u=h;--u;){var x=d[u];if(!(x?oe(x,j):s(r[u],j,n)))continue t}f&&f.push(j),w.push(m)}}return w}(e):[]}),Wo=Vo;function Bo(t,e){return t<e}function C(t,e){var r={};return e=ct(e),xr(t,function(o,n,s){ce(r,n,e(o,n,s))}),r}function Er(t,e,r){for(var o=-1,n=t.length;++o<n;){var s=t[o],a=e(s);if(a!=null&&(h===void 0?a==a&&!pt(a):r(a,h)))var h=a,u=s}return u}function Ro(t,e){return t&&t.length?Er(t,ct(e),Lo):void 0}function kr(t,e){for(var r,o=-1,n=t.length;++o<n;){var s=e(t[o]);s!==void 0&&(r=r===void 0?s:r+s)}return r}function Uo(t,e){return function(r,o){var n=r==null?0:r.length;return n?kr(r,o)/n:NaN}(t,ct(e))}function Ho(t,e){if(t!==e){var r=t!==void 0,o=t===null,n=t==t,s=pt(t),a=e!==void 0,h=e===null,u=e==e,d=pt(e);if(!h&&!d&&!s&&t>e||s&&a&&u&&!h&&!d||o&&a&&u||!r&&u||!n)return 1;if(!o&&!s&&!d&&t<e||d&&r&&n&&!o&&!s||h&&r&&n||!a&&n||!u)return-1}return 0}function Ar(t,e,r){e=e.length?ft(e,function(n){return D(n)?function(s){return Kt(s,n.length===1?n[0]:n)}:n}):[Dt];var o=-1;return e=ft(e,Vt(ct)),function(n,s){var a=n.length;for(n.sort(function(h,u){return function(d,l,w){for(var g=-1,y=d.criteria,f=l.criteria,m=y.length,j=w.length;++g<m;){var x=Ho(y[g],f[g]);if(x)return g>=j?x:x*(w[g]=="desc"?-1:1)}return d.index-l.index}(h,u,r)});a--;)n[a]=n[a].value;return n}(Or(t,function(n,s,a){return{criteria:ft(e,function(h){return h(n)}),index:++o,value:n}}))}function ge(t,e,r,o){return t==null?[]:(D(e)||(e=e==null?[]:[e]),D(r=r)||(r=r==null?[]:[r]),Ar(t,e,r))}var Jo=lr(function(t,e){if(t==null)return[];var r=e.length;return r>1&&Ee(t,e[0],e[1])?e=[]:r>2&&Ee(e[0],e[1],e[2])&&(e=[e[0]]),Ar(t,En(e),[])});function Go(t,e){return t&&t.length?kr(t,ct(e)):0}function A(t){if(this.words=[],t)if(Symbol&&Symbol.iterator&&t[Symbol.iterator]!==void 0){const e=t[Symbol.iterator]();let r=e.next();for(;!r.done;)this.add(r.value),r=e.next()}else for(let e=0;e<t.length;e++)this.add(t[e])}A.fromWords=function(t){const e=Object.create(A.prototype);return e.words=t,e},A.prototype.add=function(t){this.resize(t),this.words[t>>>5]|=1<<t},A.prototype.flip=function(t){this.resize(t),this.words[t>>>5]^=1<<t},A.prototype.clear=function(){this.words.length=0},A.prototype.remove=function(t){this.resize(t),this.words[t>>>5]&=~(1<<t)},A.prototype.isEmpty=function(t){const e=this.words.length;for(let r=0;r<e;r++)if(this.words[r]!==0)return!1;return!0},A.prototype.has=function(t){return(this.words[t>>>5]&1<<t)!=0},A.prototype.checkedAdd=function(t){this.resize(t);const e=this.words[t>>>5],r=e|1<<t;return this.words[t>>>5]=r,(r^e)>>>t},A.prototype.trim=function(t){let e=this.words.length;for(;e>0&&this.words[e-1]===0;)e--;this.words.length=e},A.prototype.resize=function(t){const e=t+32>>>5;for(let r=this.words.length;r<e;r++)this.words[r]=0},A.prototype.hammingWeight=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},A.prototype.hammingWeight4=function(t,e,r,o){return 16843009*((t=(t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)+(e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)+(r=(r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)+(o=(o=(858993459&(o-=o>>>1&1431655765))+(o>>>2&858993459))+(o>>>4)&252645135))>>>24},A.prototype.size=function(){let t=0;const e=this.words.length,r=this.words;for(let o=0;o<e;o++)t+=this.hammingWeight(r[o]);return t},A.prototype.array=function(){const t=new Array(this.size());let e=0;const r=this.words.length;for(let o=0;o<r;++o){let n=this.words[o];for(;n!=0;){const s=n&-n;t[e++]=(o<<5)+this.hammingWeight(s-1|0),n^=s}}return t},A.prototype.forEach=function(t){const e=this.words.length;for(let r=0;r<e;++r){let o=this.words[r];for(;o!=0;){const n=o&-o;t((r<<5)+this.hammingWeight(n-1|0)),o^=n}}},A.prototype[Symbol.iterator]=function(){const t=this.words.length;let e=0,r=this.words[e],o=this.hammingWeight,n=this.words;return{[Symbol.iterator](){return this},next(){for(;e<t;){if(r!==0){const s=r&-r,a=(e<<5)+o(s-1|0);return r^=s,{done:!1,value:a}}e++,e<t&&(r=n[e])}return{done:!0,value:void 0}}}},A.prototype.clone=function(){const t=Object.create(A.prototype);return t.words=this.words.slice(),t},A.prototype.intersects=function(t){const e=Math.min(this.words.length,t.words.length);for(let r=0;r<e;++r)if(this.words[r]&t.words[r])return!0;return!1},A.prototype.intersection=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(;r+7<e;r+=8)this.words[r]&=t.words[r],this.words[r+1]&=t.words[r+1],this.words[r+2]&=t.words[r+2],this.words[r+3]&=t.words[r+3],this.words[r+4]&=t.words[r+4],this.words[r+5]&=t.words[r+5],this.words[r+6]&=t.words[r+6],this.words[r+7]&=t.words[r+7];for(;r<e;++r)this.words[r]&=t.words[r];const o=this.words.length;for(r=e;r<o;++r)this.words[r]=0;return this},A.prototype.intersection_size=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(let o=0;o<e;++o)r+=this.hammingWeight(this.words[o]&t.words[o]);return r},A.prototype.new_intersection=function(t){const e=Object.create(A.prototype),r=Math.min(this.words.length,t.words.length);e.words=new Array(r);let o=0;for(;o+7<r;o+=8)e.words[o]=this.words[o]&t.words[o],e.words[o+1]=this.words[o+1]&t.words[o+1],e.words[o+2]=this.words[o+2]&t.words[o+2],e.words[o+3]=this.words[o+3]&t.words[o+3],e.words[o+4]=this.words[o+4]&t.words[o+4],e.words[o+5]=this.words[o+5]&t.words[o+5],e.words[o+6]=this.words[o+6]&t.words[o+6],e.words[o+7]=this.words[o+7]&t.words[o+7];for(;o<r;++o)e.words[o]=this.words[o]&t.words[o];return e},A.prototype.equals=function(t){const e=Math.min(this.words.length,t.words.length);for(let r=0;r<e;++r)if(this.words[r]!=t.words[r])return!1;if(this.words.length<t.words.length){const r=t.words.length;for(let o=this.words.length;o<r;++o)if(t.words[o]!=0)return!1}else if(t.words.length<this.words.length){const r=this.words.length;for(let o=t.words.length;o<r;++o)if(this.words[o]!=0)return!1}return!0},A.prototype.difference=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(;r+7<e;r+=8)this.words[r]&=~t.words[r],this.words[r+1]&=~t.words[r+1],this.words[r+2]&=~t.words[r+2],this.words[r+3]&=~t.words[r+3],this.words[r+4]&=~t.words[r+4],this.words[r+5]&=~t.words[r+5],this.words[r+6]&=~t.words[r+6],this.words[r+7]&=~t.words[r+7];for(;r<e;++r)this.words[r]&=~t.words[r];return this},A.prototype.new_difference=function(t){return this.clone().difference(t)},A.prototype.difference2=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(;r+7<e;r+=8)t.words[r]=this.words[r]&~t.words[r],t.words[r+1]=this.words[r+1]&~t.words[r+1],t.words[r+2]=this.words[r+2]&~t.words[r+2],t.words[r+3]=this.words[r+3]&~t.words[r+3],t.words[r+4]=this.words[r+4]&~t.words[r+4],t.words[r+5]=this.words[r+5]&~t.words[r+5],t.words[r+6]=this.words[r+6]&~t.words[r+6],t.words[r+7]=this.words[r+7]&~t.words[r+7];for(;r<e;++r)t.words[r]=this.words[r]&~t.words[r];for(r=this.words.length-1;r>=e;--r)t.words[r]=this.words[r];return t.words.length=this.words.length,t},A.prototype.difference_size=function(t){const e=Math.min(this.words.length,t.words.length);let r=0,o=0;for(;o<e;++o)r+=this.hammingWeight(this.words[o]&~t.words[o]);const n=this.words.length;for(;o<n;++o)r+=this.hammingWeight(this.words[o]);return r},A.prototype.change=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(;r+7<e;r+=8)this.words[r]^=t.words[r],this.words[r+1]^=t.words[r+1],this.words[r+2]^=t.words[r+2],this.words[r+3]^=t.words[r+3],this.words[r+4]^=t.words[r+4],this.words[r+5]^=t.words[r+5],this.words[r+6]^=t.words[r+6],this.words[r+7]^=t.words[r+7];for(;r<e;++r)this.words[r]^=t.words[r];for(r=t.words.length-1;r>=e;--r)this.words[r]=t.words[r];return this},A.prototype.new_change=function(t){const e=Object.create(A.prototype),r=Math.max(this.words.length,t.words.length);e.words=new Array(r);const o=Math.min(this.words.length,t.words.length);let n=0;for(;n+7<o;n+=8)e.words[n]=this.words[n]^t.words[n],e.words[n+1]=this.words[n+1]^t.words[n+1],e.words[n+2]=this.words[n+2]^t.words[n+2],e.words[n+3]=this.words[n+3]^t.words[n+3],e.words[n+4]=this.words[n+4]^t.words[n+4],e.words[n+5]=this.words[n+5]^t.words[n+5],e.words[n+6]=this.words[n+6]^t.words[n+6],e.words[n+7]=this.words[n+7]^t.words[n+7];for(;n<o;++n)e.words[n]=this.words[n]^t.words[n];const s=this.words.length;for(n=o;n<s;++n)e.words[n]=this.words[n];const a=t.words.length;for(n=o;n<a;++n)e.words[n]=t.words[n];return e},A.prototype.change_size=function(t){const e=Math.min(this.words.length,t.words.length);let r=0,o=0;for(;o<e;++o)r+=this.hammingWeight(this.words[o]^t.words[o]);const n=this.words.length>t.words.length?this:t,s=n.words.length;for(;o<s;++o)r+=this.hammingWeight(n.words[o]);return r},A.prototype.toString=function(){return"{"+this.array().join(",")+"}"},A.prototype.union=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(;r+7<e;r+=8)this.words[r]|=t.words[r],this.words[r+1]|=t.words[r+1],this.words[r+2]|=t.words[r+2],this.words[r+3]|=t.words[r+3],this.words[r+4]|=t.words[r+4],this.words[r+5]|=t.words[r+5],this.words[r+6]|=t.words[r+6],this.words[r+7]|=t.words[r+7];for(;r<e;++r)this.words[r]|=t.words[r];if(this.words.length<t.words.length){this.resize((t.words.length<<5)-1);const o=t.words.length;for(let n=e;n<o;++n)this.words[n]=t.words[n]}return this},A.prototype.new_union=function(t){const e=Object.create(A.prototype),r=Math.max(this.words.length,t.words.length);e.words=new Array(r);const o=Math.min(this.words.length,t.words.length);let n=0;for(;n+7<o;n+=8)e.words[n]=this.words[n]|t.words[n],e.words[n+1]=this.words[n+1]|t.words[n+1],e.words[n+2]=this.words[n+2]|t.words[n+2],e.words[n+3]=this.words[n+3]|t.words[n+3],e.words[n+4]=this.words[n+4]|t.words[n+4],e.words[n+5]=this.words[n+5]|t.words[n+5],e.words[n+6]=this.words[n+6]|t.words[n+6],e.words[n+7]=this.words[n+7]|t.words[n+7];for(;n<o;++n)e.words[n]=this.words[n]|t.words[n];const s=this.words.length;for(n=o;n<s;++n)e.words[n]=this.words[n];const a=t.words.length;for(n=o;n<a;++n)e.words[n]=t.words[n];return e},A.prototype.union_size=function(t){const e=Math.min(this.words.length,t.words.length);let r=0;for(let o=0;o<e;++o)r+=this.hammingWeight(this.words[o]|t.words[o]);if(this.words.length<t.words.length){const o=t.words.length;for(let n=this.words.length;n<o;++n)r+=this.hammingWeight(0|t.words[n])}else{const o=this.words.length;for(let n=t.words.length;n<o;++n)r+=this.hammingWeight(0|this.words[n])}return r};var W=A;function se(){return se=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},se.apply(this,arguments)}function Zo(t,e){var r=[];return t.forEach(function(o){e.forEach(function(n){r.push(o.concat(n))})}),r}function zr(t){return!!~t.search(/\(|\)/)}function Ke(t,e){for(var r=e.split(" "+t+" "),o=[],n=[],s=0;s<r.length;s++)if(zr(r[s])||n.length>0){n.push(r[s]);var a=""+n;(a.match(/\(/g)||[]).length===(a.match(/\)/g)||[]).length&&(o.push(n.join(" "+t+" ")),n=[])}else o.push(r[s]);return o}var Yo=function t(e){return function(o){for(var n=o[0],s=1;s<o.length;s++)n=n.concat(o[s]);return n}(Ke("OR",(r=e=function(o){if(o.charAt(0)==="("){for(var n=0,s=0;s<o.length;s++)if(o.charAt(s)==="("?n++:o.charAt(s)===")"&&n--,n===0)return s!==o.length-1?o:o.substring(1,o.length-1)}return o}(e),e=r.replace(/[\s]+/g," "))).map(function(o){for(var n=Ke("AND",o),s=[],a=[],h=0;h<n.length;h++)zr(n[h])?s.push(t(n[h])):a.push(n[h]);return s.push([a]),function(u){for(var d=[[]],l=0;l<u.length;l++)d=Zo(d,u[l]);return d}(s)}));var r};const tr=function(t){try{return structuredClone(t)}catch{try{return JSON.parse(JSON.stringify(t))}catch{return t}}},er=function(t,e){let r=new W([]),o=0;return C(e,function(n,s){n.forEach(a=>{++o,r=r.new_union(t[s][a]||new W([]))})}),o===0?null:r},Qo=function(t,e,r){let o=1;return C(t.bits_data_temp,(n,s)=>{let a,h,u,d,l,w,g;r[s]&&(a=r[s].order,h=r[s].sort,u=r[s].size,d=r[s].title,l=r[s].show_facet_stats||!1,w=r[s].chosen_filters_on_top!==!1,g=r[s].hide_zero_doc_count||!1);let y,f,m,j,x=Object.entries(n).map(k=>{let N=[];e&&e.filters&&e.filters[s]&&(N=e.filters[s]);const S=k[1].array().length;if(!g||S!==0||N.indexOf(k[0])!==-1)return{key:k[0],doc_count:S,selected:N.indexOf(k[0])!==-1}}).filter(Boolean);var z,F;return D(h)?(y=h||["key"],f=a||["asc"]):(h==="term"||h==="key"?(y=["key"],f=[a||"asc"]):(y=["doc_count","key"],f=[a||"desc","asc"]),w&&(y.unshift("selected"),f.unshift("desc"))),x=ge(x,y,f),x=x.slice(0,u||10),l&&(m=[],Object.entries(n).forEach(k=>{if(isNaN(k[0]))throw new Error("You cant use chars to calculate the facet_stats.");k[1].array().length>0&&k[1].forEach(()=>{m.push(parseInt(k[0]))})}),j={min:(z=m,z&&z.length?Er(z,ct(void 0),Bo):void 0),max:Ro(m),avg:Uo(m),sum:Go(m)}),se({name:s,title:d||(F=s,F.replace(/^[\s_]+|[\s_]+$/g,"").replace(/[_\s]+/g," ").replace(/^[a-z]/,function(k){return k.toUpperCase()})),position:o++,buckets:x},l&&{facet_stats:j})})};function rr(t,e,r,o,n){e=e||Object.create(null);const s=parseInt(e.per_page||12),a=parseInt(e.page||1),h=e.is_all_filtered_items||!1;if(r.native_search_enabled===!1&&(e.query||e.filter))throw new Error('"query" and "filter" options are not working once native search is disabled');let u=0;const d=new Date().getTime();let l,w,g,y=n.bits_ids();if(e._ids)l=new W(e._ids),w=e._ids;else if(e.ids)w=n.internal_ids_from_ids_map(e.ids),l=new W(w);else if(o&&(e.query||e.filter)){const S=new Date().getTime();w=o.search(e.query,e.filter),u=new Date().getTime()-S,l=new W(w)}let f=new Date().getTime();const m=n.search(e,{query_ids:l});f=new Date().getTime()-f,l&&(y=l),m.ids&&(y=y.new_intersection(m.ids)),m.not_ids&&(y=y.new_difference(m.not_ids));let j=y.array(),x=j.map(S=>n.get_item(S)),z=!1;const F=new Date().getTime();let k=0;e.sort?x=function(S,E,P){return P&&P[E]&&(E=P[E]),E.field?ge(S,E.field,E.order||"asc"):S}(x,e.sort,r.sortings):w&&(j=w.filter(S=>y.has(S)),x=j.slice((a-1)*s,a*s).map(S=>n.get_item(S)),z=!0),z||(g=h?x:null,x=x.slice((a-1)*s,a*s)),k=new Date().getTime()-F;const N=new Date().getTime()-d;return{pagination:{per_page:s,page:a,total:j.length},timings:{total:N,facets:f,search:u,sorting:k},data:{items:x,allFilteredItems:g,aggregations:Qo(m,e,r.aggregations)}}}var It=function(t){var e={exports:{}};return function(r,o){(function(){var n,s,a,h,u,d,l,w,g,y,f,m,j,x,z,F,k,N,S,E,P,q,et,V,U,J,Y,Q,p=function(i){var c=new p.Index;return c.pipeline.add(p.trimmer,p.stopWordFilter,p.stemmer),i&&i.call(c,c),c};p.version="1.0.0",p.utils={},p.utils.warn=function(i){return function(c){i.console&&console.warn&&console.warn(c)}}(this),p.utils.asString=function(i){return i==null?"":i.toString()},p.EventEmitter=function(){this.events={}},p.EventEmitter.prototype.addListener=function(){var i=Array.prototype.slice.call(arguments),c=i.pop(),v=i;if(typeof c!="function")throw new TypeError("last argument must be a function");v.forEach(function(b){this.hasHandler(b)||(this.events[b]=[]),this.events[b].push(c)},this)},p.EventEmitter.prototype.removeListener=function(i,c){if(this.hasHandler(i)){var v=this.events[i].indexOf(c);this.events[i].splice(v,1),this.events[i].length||delete this.events[i]}},p.EventEmitter.prototype.emit=function(i){if(this.hasHandler(i)){var c=Array.prototype.slice.call(arguments,1);this.events[i].forEach(function(v){v.apply(void 0,c)})}},p.EventEmitter.prototype.hasHandler=function(i){return i in this.events},p.tokenizer=function(i){return arguments.length&&i!=null&&i!=null?Array.isArray(i)?i.map(function(c){return p.utils.asString(c).toLowerCase()}):i.toString().trim().toLowerCase().split(p.tokenizer.separator):[]},p.tokenizer.separator=/[\s\-]+/,p.tokenizer.load=function(i){var c=this.registeredFunctions[i];if(!c)throw new Error("Cannot load un-registered function: "+i);return c},p.tokenizer.label="default",p.tokenizer.registeredFunctions={default:p.tokenizer},p.tokenizer.registerFunction=function(i,c){c in this.registeredFunctions&&p.utils.warn("Overwriting existing tokenizer: "+c),i.label=c,this.registeredFunctions[c]=i},p.Pipeline=function(){this._stack=[]},p.Pipeline.registeredFunctions={},p.Pipeline.registerFunction=function(i,c){c in this.registeredFunctions&&p.utils.warn("Overwriting existing registered function: "+c),i.label=c,p.Pipeline.registeredFunctions[i.label]=i},p.Pipeline.warnIfFunctionNotRegistered=function(i){i.label&&i.label in this.registeredFunctions||p.utils.warn(`Function is not registered with pipeline. This may cause problems when serialising the index.
`,i)},p.Pipeline.load=function(i){var c=new p.Pipeline;return i.forEach(function(v){var b=p.Pipeline.registeredFunctions[v];if(!b)throw new Error("Cannot load un-registered function: "+v);c.add(b)}),c},p.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(i){p.Pipeline.warnIfFunctionNotRegistered(i),this._stack.push(i)},this)},p.Pipeline.prototype.after=function(i,c){p.Pipeline.warnIfFunctionNotRegistered(c);var v=this._stack.indexOf(i);if(v==-1)throw new Error("Cannot find existingFn");this._stack.splice(v+=1,0,c)},p.Pipeline.prototype.before=function(i,c){p.Pipeline.warnIfFunctionNotRegistered(c);var v=this._stack.indexOf(i);if(v==-1)throw new Error("Cannot find existingFn");this._stack.splice(v,0,c)},p.Pipeline.prototype.remove=function(i){var c=this._stack.indexOf(i);c!=-1&&this._stack.splice(c,1)},p.Pipeline.prototype.run=function(i){for(var c=[],v=i.length,b=this._stack.length,_=0;_<v;_++){for(var O=i[_],$=0;$<b&&(O=this._stack[$](O,_,i))!==void 0&&O!=="";$++);O!==void 0&&O!==""&&c.push(O)}return c},p.Pipeline.prototype.reset=function(){this._stack=[]},p.Pipeline.prototype.toJSON=function(){return this._stack.map(function(i){return p.Pipeline.warnIfFunctionNotRegistered(i),i.label})},p.Vector=function(){this._magnitude=null,this.list=void 0,this.length=0},p.Vector.Node=function(i,c,v){this.idx=i,this.val=c,this.next=v},p.Vector.prototype.insert=function(i,c){this._magnitude=void 0;var v=this.list;if(!v)return this.list=new p.Vector.Node(i,c,v),this.length++;if(i<v.idx)return this.list=new p.Vector.Node(i,c,v),this.length++;for(var b=v,_=v.next;_!=null;){if(i<_.idx)return b.next=new p.Vector.Node(i,c,_),this.length++;b=_,_=_.next}return b.next=new p.Vector.Node(i,c,_),this.length++},p.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var i,c=this.list,v=0;c;)v+=(i=c.val)*i,c=c.next;return this._magnitude=Math.sqrt(v)},p.Vector.prototype.dot=function(i){for(var c=this.list,v=i.list,b=0;c&&v;)c.idx<v.idx?c=c.next:(c.idx>v.idx||(b+=c.val*v.val,c=c.next),v=v.next);return b},p.Vector.prototype.similarity=function(i){return this.dot(i)/(this.magnitude()*i.magnitude())},p.SortedSet=function(){this.length=0,this.elements=[]},p.SortedSet.load=function(i){var c=new this;return c.elements=i,c.length=i.length,c},p.SortedSet.prototype.add=function(){var i,c;for(i=0;i<arguments.length;i++)~this.indexOf(c=arguments[i])||this.elements.splice(this.locationFor(c),0,c);this.length=this.elements.length},p.SortedSet.prototype.toArray=function(){return this.elements.slice()},p.SortedSet.prototype.map=function(i,c){return this.elements.map(i,c)},p.SortedSet.prototype.forEach=function(i,c){return this.elements.forEach(i,c)},p.SortedSet.prototype.indexOf=function(i){for(var c=0,v=this.elements.length,b=v-c,_=c+Math.floor(b/2),O=this.elements[_];b>1;){if(O===i)return _;O<i&&(c=_),O>i&&(v=_),b=v-c,_=c+Math.floor(b/2),O=this.elements[_]}return O===i?_:-1},p.SortedSet.prototype.locationFor=function(i){for(var c=0,v=this.elements.length,b=v-c,_=c+Math.floor(b/2),O=this.elements[_];b>1;)O<i&&(c=_),O>i&&(v=_),b=v-c,_=c+Math.floor(b/2),O=this.elements[_];return O>i?_:O<i?_+1:void 0},p.SortedSet.prototype.intersect=function(i){for(var c=new p.SortedSet,v=0,b=0,_=this.length,O=i.length,$=this.elements,L=i.elements;!(v>_-1||b>O-1);)$[v]!==L[b]?$[v]<L[b]?v++:$[v]>L[b]&&b++:(c.add($[v]),v++,b++);return c},p.SortedSet.prototype.clone=function(){var i=new p.SortedSet;return i.elements=this.toArray(),i.length=i.elements.length,i},p.SortedSet.prototype.union=function(i){var c,v,b;this.length>=i.length?(c=this,v=i):(c=i,v=this),b=c.clone();for(var _=0,O=v.toArray();_<O.length;_++)b.add(O[_]);return b},p.SortedSet.prototype.toJSON=function(){return this.toArray()},p.Index=function(){this._fields=[],this._ref="id",this.pipeline=new p.Pipeline,this.documentStore=new p.Store,this.tokenStore=new p.TokenStore,this.corpusTokens=new p.SortedSet,this.eventEmitter=new p.EventEmitter,this.tokenizerFn=p.tokenizer,this._idfCache={},this.on("add","remove","update",(function(){this._idfCache={}}).bind(this))},p.Index.prototype.on=function(){var i=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,i)},p.Index.prototype.off=function(i,c){return this.eventEmitter.removeListener(i,c)},p.Index.load=function(i){i.version!==p.version&&p.utils.warn("version mismatch: current "+p.version+" importing "+i.version);var c=new this;return c._fields=i.fields,c._ref=i.ref,c.tokenizer(p.tokenizer.load(i.tokenizer)),c.documentStore=p.Store.load(i.documentStore),c.tokenStore=p.TokenStore.load(i.tokenStore),c.corpusTokens=p.SortedSet.load(i.corpusTokens),c.pipeline=p.Pipeline.load(i.pipeline),c},p.Index.prototype.field=function(i,c){return this._fields.push({name:i,boost:(c=c||{}).boost||1}),this},p.Index.prototype.ref=function(i){return this._ref=i,this},p.Index.prototype.tokenizer=function(i){return i.label&&i.label in p.tokenizer.registeredFunctions||p.utils.warn("Function is not a registered tokenizer. This may cause problems when serialising the index"),this.tokenizerFn=i,this},p.Index.prototype.add=function(i,c){var v={},b=new p.SortedSet,_=i[this._ref];c=c===void 0||c,this._fields.forEach(function(kt){var ht=this.pipeline.run(this.tokenizerFn(i[kt.name]));v[kt.name]=ht;for(var dt=0;dt<ht.length;dt++){var At=ht[dt];b.add(At),this.corpusTokens.add(At)}},this),this.documentStore.set(_,b);for(var O=0;O<b.length;O++){for(var $=b.elements[O],L=0,M=0;M<this._fields.length;M++){var ut=this._fields[M],Et=v[ut.name],vt=Et.length;if(vt){for(var rt=0,lt=0;lt<vt;lt++)Et[lt]===$&&rt++;L+=rt/vt*ut.boost}}this.tokenStore.add($,{ref:_,tf:L})}c&&this.eventEmitter.emit("add",i,this)},p.Index.prototype.remove=function(i,c){var v=i[this._ref];if(c=c===void 0||c,this.documentStore.has(v)){var b=this.documentStore.get(v);this.documentStore.remove(v),b.forEach(function(_){this.tokenStore.remove(_,v)},this),c&&this.eventEmitter.emit("remove",i,this)}},p.Index.prototype.update=function(i,c){c=c===void 0||c,this.remove(i,!1),this.add(i,!1),c&&this.eventEmitter.emit("update",i,this)},p.Index.prototype.idf=function(i){var c="@"+i;if(Object.prototype.hasOwnProperty.call(this._idfCache,c))return this._idfCache[c];var v=this.tokenStore.count(i),b=1;return v>0&&(b=1+Math.log(this.documentStore.length/v)),this._idfCache[c]=b},p.Index.prototype.search=function(i){var c=this.pipeline.run(this.tokenizerFn(i)),v=new p.Vector,b=[],_=this._fields.reduce(function(O,$){return O+$.boost},0);return c.some(function(O){return this.tokenStore.has(O)},this)?(c.forEach(function(O,$,L){var M=1/L.length*this._fields.length*_,ut=this,Et=this.tokenStore.expand(O).reduce(function(vt,rt){var lt=ut.corpusTokens.indexOf(rt),kt=ut.idf(rt),ht=1,dt=new p.SortedSet;if(rt!==O){var At=Math.max(3,rt.length-O.length);ht=1/Math.log(At)}lt>-1&&v.insert(lt,M*kt*ht);for(var we=ut.tokenStore.get(rt),me=Object.keys(we),Cr=me.length,Wt=0;Wt<Cr;Wt++)dt.add(we[me[Wt]].ref);return vt.union(dt)},new p.SortedSet);b.push(Et)},this),b.reduce(function(O,$){return O.intersect($)}).map(function(O){return{ref:O,score:v.similarity(this.documentVector(O))}},this).sort(function(O,$){return $.score-O.score})):[]},p.Index.prototype.documentVector=function(i){for(var c=this.documentStore.get(i),v=c.length,b=new p.Vector,_=0;_<v;_++){var O=c.elements[_],$=this.tokenStore.get(O)[i].tf,L=this.idf(O);b.insert(this.corpusTokens.indexOf(O),$*L)}return b},p.Index.prototype.toJSON=function(){return{version:p.version,fields:this._fields,ref:this._ref,tokenizer:this.tokenizerFn.label,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},p.Index.prototype.use=function(i){var c=Array.prototype.slice.call(arguments,1);c.unshift(this),i.apply(this,c)},p.Store=function(){this.store={},this.length=0},p.Store.load=function(i){var c=new this;return c.length=i.length,c.store=Object.keys(i.store).reduce(function(v,b){return v[b]=p.SortedSet.load(i.store[b]),v},{}),c},p.Store.prototype.set=function(i,c){this.has(i)||this.length++,this.store[i]=c},p.Store.prototype.get=function(i){return this.store[i]},p.Store.prototype.has=function(i){return i in this.store},p.Store.prototype.remove=function(i){this.has(i)&&(delete this.store[i],this.length--)},p.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},p.stemmer=(n={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},s={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},d="^("+(h="[^aeiou][^aeiouy]*")+")?"+(u=(a="[aeiouy]")+"[aeiou]*")+h+"("+u+")?$",l="^("+h+")?"+u+h+u+h,w="^("+h+")?"+a,g=new RegExp("^("+h+")?"+u+h),y=new RegExp(l),f=new RegExp(d),m=new RegExp(w),j=/^(.+?)(ss|i)es$/,x=/^(.+?)([^s])s$/,z=/^(.+?)eed$/,F=/^(.+?)(ed|ing)$/,k=/.$/,N=/(at|bl|iz)$/,S=new RegExp("([^aeiouylsz])\\1$"),E=new RegExp("^"+h+a+"[^aeiouwxy]$"),P=/^(.+?[^aeiou])y$/,q=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,et=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,V=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,U=/^(.+?)(s|t)(ion)$/,J=/^(.+?)e$/,Y=/ll$/,Q=new RegExp("^"+h+a+"[^aeiouwxy]$"),function(i){var c,v,b,_,O,$,L;if(i.length<3)return i;if((b=i.substr(0,1))=="y"&&(i=b.toUpperCase()+i.substr(1)),O=x,(_=j).test(i)?i=i.replace(_,"$1$2"):O.test(i)&&(i=i.replace(O,"$1$2")),O=F,(_=z).test(i)){var M=_.exec(i);(_=g).test(M[1])&&(i=i.replace(_=k,""))}else O.test(i)&&(M=O.exec(i),(O=m).test(c=M[1])&&($=S,L=E,(O=N).test(i=c)?i+="e":$.test(i)?i=i.replace(_=k,""):L.test(i)&&(i+="e")));return(_=P).test(i)&&(i=(c=(M=_.exec(i))[1])+"i"),(_=q).test(i)&&(v=(M=_.exec(i))[2],(_=g).test(c=M[1])&&(i=c+n[v])),(_=et).test(i)&&(v=(M=_.exec(i))[2],(_=g).test(c=M[1])&&(i=c+s[v])),O=U,(_=V).test(i)?(M=_.exec(i),(_=y).test(c=M[1])&&(i=c)):O.test(i)&&(M=O.exec(i),(O=y).test(c=M[1]+M[2])&&(i=c)),(_=J).test(i)&&(M=_.exec(i),O=f,$=Q,((_=y).test(c=M[1])||O.test(c)&&!$.test(c))&&(i=c)),O=y,(_=Y).test(i)&&O.test(i)&&(i=i.replace(_=k,"")),b=="y"&&(i=b.toLowerCase()+i.substr(1)),i}),p.Pipeline.registerFunction(p.stemmer,"stemmer"),p.generateStopWordFilter=function(i){var c=i.reduce(function(v,b){return v[b]=b,v},{});return function(v){if(v&&c[v]!==v)return v}},p.stopWordFilter=p.generateStopWordFilter(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]),p.Pipeline.registerFunction(p.stopWordFilter,"stopWordFilter"),p.trimmer=function(i){return i.replace(/^\W+/,"").replace(/\W+$/,"")},p.Pipeline.registerFunction(p.trimmer,"trimmer"),p.TokenStore=function(){this.root={docs:{}},this.length=0},p.TokenStore.load=function(i){var c=new this;return c.root=i.root,c.length=i.length,c},p.TokenStore.prototype.add=function(i,c,v){v=v||this.root;var b=i.charAt(0),_=i.slice(1);return b in v||(v[b]={docs:{}}),_.length===0?(v[b].docs[c.ref]=c,void(this.length+=1)):this.add(_,c,v[b])},p.TokenStore.prototype.has=function(i){if(!i)return!1;for(var c=this.root,v=0;v<i.length;v++){if(!c[i.charAt(v)])return!1;c=c[i.charAt(v)]}return!0},p.TokenStore.prototype.getNode=function(i){if(!i)return{};for(var c=this.root,v=0;v<i.length;v++){if(!c[i.charAt(v)])return{};c=c[i.charAt(v)]}return c},p.TokenStore.prototype.get=function(i,c){return this.getNode(i,c).docs||{}},p.TokenStore.prototype.count=function(i,c){return Object.keys(this.get(i,c)).length},p.TokenStore.prototype.remove=function(i,c){if(i){for(var v=this.root,b=0;b<i.length;b++){if(!(i.charAt(b)in v))return;v=v[i.charAt(b)]}delete v.docs[c]}},p.TokenStore.prototype.expand=function(i,c){var v=this.getNode(i);return c=c||[],Object.keys(v.docs||{}).length&&c.push(i),Object.keys(v).forEach(function(b){b!=="docs"&&c.concat(this.expand(i+b,c))},this),c},p.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}},r.exports=p})()}(e),e.exports}();class nr{constructor(e,r){this.store=new Map,this.idx=It(function(){this.field("name",{boost:10}),((r==null?void 0:r.searchableFields)||[]).forEach(n=>this.field(n)),this.ref("_id"),r!=null&&r.isExactSearch&&(this.pipeline.remove(It.stemmer),this.pipeline.remove(It.stopWordFilter)),r!=null&&r.removeStopWordFilter&&this.pipeline.remove(It.stopWordFilter)});let o=1;(e||[]).map(n=>{n._id=o,++o,this.idx.add(n),this.store.set(n._id,n)})}search_full(e,r){return this.search(e,r).map(o=>this.store.get(o))}search(e,r){return r instanceof Function?(e?this.idx.search(e).map(o=>this.store.get(o.ref)):[...this.store.values()]).filter(r).map(o=>o._id):e?this.idx.search(e).map(o=>o.ref):[...this.store.keys()]}}class or{constructor(e,r){(r=r||Object.create(null)).aggregations=r.aggregations||Object.create(null),this._items=e,this.config=r.aggregations,this.facets=function(a,h){h=h||[];const u={data:Object.create(null),bits_data:Object.create(null),bits_data_temp:Object.create(null)};let d=1;return h.forEach(l=>{u.data[l]=Object.create(null)}),a&&a.map(l=>(l._id||(l._id=d,++d),l)),a&&a.map(l=>(h.forEach(w=>{if(l){if(Array.isArray(l[w]))l[w].forEach(g=>{l[w]&&(u.data[w][g]||(u.data[w][g]=[]),u.data[w][g].push(parseInt(l._id)))});else if(l[w]!==void 0){const g=l[w];u.data[w][g]||(u.data[w][g]=[]),u.data[w][g].push(parseInt(l._id))}}}),l)),u.data=C(u.data,function(l,w){return u.bits_data[w]||(u.bits_data[w]=Object.create(null),u.bits_data_temp[w]=Object.create(null)),C(l,function(g,y){const f=Jo(g);return u.bits_data[w][y]=new W(f),f})}),u}(e,Ot(r.aggregations)),this._items_map=Object.create(null),this._ids=[];let o=1;var n,s;s=a=>{this._ids.push(o),this._items_map[o]=a,a._id=o,++o},(D(n=e)?ft:Or)(n,ct(s)),this.ids_map=Object.create(null),e&&e.forEach(a=>{const h=r.custom_id_field||"id";a[h]&&a._id&&(this.ids_map[a[h]]=a._id)}),this._bits_ids=new W(this._ids)}items(){return this._items}bits_ids(e){return e?new W(e):this._bits_ids}internal_ids_from_ids_map(e){return e.map(r=>this.ids_map[r])}index(){return this.facets}get_item(e){return this._items_map[e]}search(e,r){const o=this.config;r=r||Object.create(null);const n=Zt(this.facets);let s;n.not_ids=er(n.bits_data,e.not_filters);const a=function(h,u){const d=[];return C(h.filters,function(l,w){if(l&&l.length)if(u[w].conjunction!==!1)C(l,function(g){d.push([w,g])});else{const g=[];C(l,function(y){g.push([w,y])}),d.push(g)}}),C(h.not_filters,function(l,w){l&&l.length&&C(l,function(g){d.push([w,"-",g])})}),d}(e,o);return s=function(h,u){const d=Zt(h);let l;u=u||[],C(d.bits_data,function(g,y){C(d.bits_data[y],function(f,m){d.bits_data_temp[y][m]=d.bits_data[y][m]})}),d.is_temp_copied=!0;const w=function(g,y){const f=Object.create(null);return C(y,function(m){if(Array.isArray(m[0])){let j=new W([]);C(m,function(x){const z=x[0];j=j.new_union(g.bits_data[z][x[1]]||new W([])),f[z]=j})}}),f}(h,u);return C(u,function(g){if(!Array.isArray(g[0])){const y=g[0],f=g[1];l=l&&d.bits_data_temp[y][f]?d.bits_data_temp[y][f].new_intersection(l):l&&!d.bits_data_temp[y][f]?new W([]):d.bits_data_temp[y][f]}}),l&&C(d.bits_data_temp,function(g,y){C(d.bits_data_temp[y],function(f,m){d.bits_data_temp[y][m]=d.bits_data_temp[y][m].new_intersection(l)})}),C(u,function(g){if(g.length===3&&g[1]==="-"){const y=d.bits_data_temp[g[0]][g[2]].clone();C(d.bits_data_temp,function(f,m){C(d.bits_data_temp[m],function(j,x){d.bits_data_temp[m][x]=d.bits_data_temp[m][x].new_difference(y)})})}}),C(d.bits_data_temp,function(g,y){C(d.bits_data_temp[y],function(f,m){C(w,function(j,x){x!==y&&(d.bits_data_temp[y][m]=d.bits_data_temp[y][m].new_intersection(j))})})}),d}(this.facets,a),e.filters_query&&(s=function(h,u){const d=Zt(h);d.is_temp_copied||C(d.bits_data,function(w,g){C(d.bits_data[g],function(y,f){d.bits_data_temp[g][f]=d.bits_data[g][f]})});let l=null;return C(u,function(w){let g=null;C(w,function(y){const f=y[0],m=y[1];if(!d.bits_data_temp[f])throw new Error("Panic. The key does not exist in facets lists.");g=g&&d.bits_data_temp[f][m]?d.bits_data_temp[f][m].new_intersection(g):g&&!d.bits_data_temp[f][m]?new W([]):d.bits_data_temp[f][m]}),l=(l||new W([])).new_union(g||new W([]))}),l!==null&&C(d.bits_data_temp,function(w,g){C(d.bits_data_temp[g],function(y,f){d.bits_data_temp[g][f]=d.bits_data_temp[g][f].new_intersection(l)})}),d}(s,Yo(e.filters_query).map(h=>Array.isArray(h)?h.map(u=>Array.isArray(u)?u.map(d=>d):u.split(":")):h.split(":")))),n.bits_data_temp=s.bits_data_temp,C(n.bits_data_temp,function(h,u){C(n.bits_data_temp[u],function(d,l){r.query_ids&&(n.bits_data_temp[u][l]=r.query_ids.new_intersection(n.bits_data_temp[u][l])),r.test&&(n.data[u][l]=n.bits_data_temp[u][l].array())})}),n.ids=e.filters_query?function(h){let u=new W([]);return C(h,function(d,l){C(h[l],function(w,g){u=u.new_union(h[l][g])})}),u}(n.bits_data_temp):er(n.bits_data_temp,e.filters),n}}function Xo(t,e){let r;(e=e||Object.create(null)).native_search_enabled!==!1&&(r=new nr(t,e));let o=new or(t,e);return{search:function(n){return(n=n||Object.create(null)).aggregations=function(s,a){return C(tr(s),(h,u)=>{h.field||(h.field=u);let d=[];a.filters&&a.filters[u]&&(d=a.filters[u]),h.filters=d;let l=[];return a.not_filters&&a.not_filters[u]&&(l=a.not_filters[u]),a.exclude_filters&&a.exclude_filters[u]&&(l=a.exclude_filters[u]),h.not_filters=l,h})}(e.aggregations,n),rr(0,n,e,r,o)},similar:function(n,s){return function(a,h,u){const d=u.per_page||10,l=u.minimum||0,w=u.page||1;let g;for(let m=0;m<a.length;++m)if(a[m].id==h){g=a[m];break}if(!u.field)throw new Error("Please define field in options");const y=u.field;let f=[];for(let m=0;m<a.length;++m)if(a[m].id!==h){const j=Wo(g[y],a[m][y]);j.length>=l&&(f.push(a[m]),f[f.length-1].intersection_length=j.length)}return f=ge(f,["intersection_length"],["desc"]),{pagination:{per_page:d,page:w,total:f.length},data:{items:f.slice((w-1)*d,w*d)}}}(t,n,s)},aggregation:function(n){return function(s,a,h,u,d){const l=a.per_page||10,w=a.page||1;if(a.name&&(!h.aggregations||!h.aggregations[a.name]))throw new Error('Please define aggregation "'.concat(a.name,'" in config'));const g=tr(a);if(g.page=1,g.per_page=0,!a.name)throw new Error("field name is required");h.aggregations[a.name].size=1e4;const y=rr(0,g,h,u,d).data.aggregations[a.name].buckets;return{pagination:{per_page:l,page:w,total:y.length},data:{buckets:y.slice((w-1)*l,w*l)}}}(0,n,e,r,o)},reindex:function(n){r=new nr(t=n,e),o=new or(t,e)}}}class Ko{constructor(){this.loadConfiguration=Mr.bind(this),this.config=null,this.searchEngine=null,this.state={query:"",filters:{},sort:"",bounds:null},this.loaderElement=document.getElementById("loader-container"),this.initialize()}hideLoader(){this.loaderElement&&this.loaderElement.classList.add("loader-hidden")}async initialize(){try{this.config=await this.loadConfiguration();const e=await Ir();this.config.searchConfig.per_page=e.length,this.searchEngine=Xo(e,this.config),console.log("Search engine initialized with data:",e.length,"items"),this.state.sort=this.config.searchConfig.defaultSort;const r={};for(const[n,s]of Object.entries(this.config.aggregations))r[n]=[];this.state.filters=r;const o=Tr(this.config);this.map=o.map,this.markers=o.markers,this.renderMarkers=o.renderMarkers,this.bindEvents(),await this.fetchAggregations(),await this.performSearch(),this.hideLoader()}catch(e){console.error("Initialization error:",e),this.hideLoader()}}bindEvents(){this.setupSearchInput(),this.setupSortSelect(),this.map.on("moveend",()=>this.performSearch())}setupSearchInput(){const e=document.getElementById("search-input");if(!e){console.error("Search input element not found");return}const r=this.debounce(()=>{this.state.query=e.value,this.performSearch()},this.config.searchConfig.debounceTime||300);e.addEventListener("input",r)}setupSortSelect(){const e=document.getElementById("sort-select");if(!e||!this.config.searchConfig.sortOptions){console.error("Sort select element not found or sort options not configured");return}e.innerHTML=this.config.searchConfig.sortOptions.map(r=>`<option value="${r.value}">${r.label}</option>`).join(""),e.addEventListener("change",r=>{this.state.sort=r.target.value,this.performSearch()})}async fetchAggregations(){if(!this.searchEngine){console.error("Search engine not initialized");return}const e=this.searchEngine.search({query:this.state.query||"",filters:this.state.filters}),r={};for(const o in e.data.aggregations)e.data.aggregations.hasOwnProperty(o)&&(r[o]=e.data.aggregations[o].buckets);this.renderFacets(r)}renderFacets(e){if(!e||!this.config.aggregations){console.error("No aggregations data or configuration available.");return}const r=document.getElementById("facets-container"),o={};Object.keys(this.config.aggregations).forEach(n=>{const s=document.getElementById(`${n}-facet`);s&&(o[n]=Array.from(s.querySelectorAll("input:checked")).map(a=>a.value))}),r.innerHTML="",Object.entries(this.config.aggregations).forEach(([n,s])=>{const a=document.createElement("div");a.className="facet-group mb-4 p-4 bg-white rounded-lg shadow",a.id=`${n}-facet`;const h=document.createElement("h3");if(h.className="text-lg font-semibold mb-2",h.textContent=s.title||n,a.appendChild(h),s.type==="range"){const u=document.createElement("div");u.className="facet-slider my-4";const l=(e[n]||[]).map(S=>{const E=parseInt(S.key,10);return isNaN(E)?null:{value:E,count:S.doc_count||0}}).filter(S=>S!==null),w=l.map(S=>S.value),g=Math.min(...w),y=Math.max(...w);u.innerHTML=`
    <label class="sr-only">Value range</label>
    <div class="relative">
      <div id="${n}-chart" class="w-full h-24 mb-2"></div>
    </div>
    <div id="${n}-slider" class="mt-2"></div>
    <div class="mt-5">
      <div class="text-sm font-medium mb-2">Custom range:</div>
      <div class="flex space-x-4">
        <div class="flex-1">
          <input id="${n}-min-input" type="number"
                 class="py-2 px-3 block w-full border rounded-md text-sm focus:ring focus:ring-blue-500 focus:outline-none dark:bg-gray-800 dark:text-gray-300"
                 value="${g}">
        </div>
        <div class="flex-1">
          <input id="${n}-max-input" type="number"
                 class="py-2 px-3 block w-full border rounded-md text-sm focus:ring focus:ring-blue-500 focus:outline-none dark:bg-gray-800 dark:text-gray-300"
                 value="${y}">
        </div>
      </div>
    </div>
  `,a.appendChild(u);const f=u.querySelector(`#${n}-chart`),m=u.querySelector(`#${n}-slider`),j=u.querySelector(`#${n}-min-input`),x=u.querySelector(`#${n}-max-input`);this.renderBarChart(f,l,g,y);const z=this.state.filters[n];let F,k;!z||z.length===0?(F=g,k=y):(F=z[0],k=z[1]),noUiSlider.create(m,{start:[F,k],connect:!0,step:1,range:{min:g,max:y},format:{to:S=>Math.round(S),from:S=>parseInt(S,10)}}),m.noUiSlider.on("update",S=>{j.value=Math.round(Number(S[0])),x.value=Math.round(Number(S[1]))}),m.noUiSlider.on("change",S=>{const[E,P]=S.map(q=>Math.round(Number(q)));!isNaN(E)&&!isNaN(P)&&(this.state.filters[n]=[E,P],this.performSearch(),this.fetchAggregations(),this.updateChartHighlight(f,l,E,P))});const N=this.debounce(S=>{const E=S.target===j,P=parseInt(S.target.value,10),[q,et]=m.noUiSlider.get().map(Number);isNaN(P)||m.noUiSlider.set([E?P:q,E?et:P])},200);j.addEventListener("input",N),x.addEventListener("input",N),this.updateChartHighlight(f,l,F,k)}else if(s.type==="taxonomy"){let u=function(f){let m=f.selfCount||0;return Object.values(f.children).forEach(j=>{m+=u(j)}),f.docCount=m,m},d=function(f,m=[],j=0){let x='<ul class="taxonomy-list" style="margin-left: '+j*20+'px;">';return Object.entries(f).forEach(([z,F])=>{var E;if(z==="children"||z==="docCount"||z==="selfCount")return;const k=[...m,z],N=k.join(" > "),S=Object.keys(F.children).length>0;x+=`
              <li class="taxonomy-item">
                <div class="taxonomy-row">
                  ${S?`<span class="toggle-btn" data-path="${N}">▶</span>`:'<span class="toggle-placeholder"></span>'}
                  <label>
                    <input type="checkbox" 
                           value="${N}" 
                           data-facet-type="${n}"
                           ${(E=o[n])!=null&&E.includes(N)?"checked":""}>
                    <span>${z} (${F.docCount})</span>
                  </label>
                </div>
                ${S?`<div class="children" data-parent="${N}" style="display: none;">
                    ${d(F.children,k,j+1)}
                  </div>`:""}
              </li>
            `}),x+"</ul>"};const l=document.createElement("div");l.className="taxonomy-container";const w={};(e[n]||[]).forEach(f=>{const m=f.key.split(" > ");let j=w;m.forEach((x,z)=>{j[x]||(j[x]={children:{},docCount:0,selfCount:0}),z===m.length-1&&(j[x].selfCount=f.doc_count),j=j[x].children})}),Object.values(w).forEach(f=>{u(f)});const y=document.createElement("style");y.textContent=`
          .taxonomy-list {
            list-style: none;
            padding: 0;
          }
          .taxonomy-item {
            margin: 5px 0;
          }
          .taxonomy-row {
            display: flex;
            align-items: center;
            gap: 5px;
          }
          .toggle-btn {
            cursor: pointer;
            width: 20px;
            user-select: none;
          }
          .toggle-placeholder {
            width: 20px;
          }
          .children {
            margin-left: 20px;
          }
        `,document.head.appendChild(y),l.innerHTML=d(w),l.addEventListener("click",f=>{if(f.target.classList.contains("toggle-btn")){const m=f.target.dataset.path,j=l.querySelector(`[data-parent="${m}"]`);if(j){const x=j.style.display==="none";j.style.display=x?"block":"none",f.target.textContent=x?"▼":"▶"}}}),a.appendChild(l)}else{const u=document.createElement("div");u.className="facet-options space-y-2",(e[n]||[]).forEach(l=>{var f;const w=document.createElement("label");w.className="cursor-pointer block",w.style.display="block";const g=document.createElement("input");g.type="checkbox",g.value=l.key,g.className="form-checkbox mr-2",g.dataset.facetType=n,(f=o[n])!=null&&f.includes(l.key)&&(g.checked=!0);const y=document.createElement("span");y.textContent=`${l.key} (${l.doc_count})`,y.className="text-sm",w.appendChild(g),w.appendChild(y),u.appendChild(w)}),a.appendChild(u)}r.appendChild(a)}),this.addFacetEventListeners()}renderBarChart(e,r,o,n){e.innerHTML="";const s=Math.max(...r.map(d=>d.count)),a=document.createElement("div");a.className="flex items-end w-full h-full relative",e.appendChild(a),[...r].sort((d,l)=>d.value-l.value).forEach(d=>{const l=s>0?d.count/s*100:0,w=document.createElement("div");w.className="flex-1 mx-px",w.style.height=`${l}%`,w.style.backgroundColor="#b0c4de",w.dataset.value=d.value,w.dataset.count=d.count,w.title=`Value: ${d.value}, Count: ${d.count}`,a.appendChild(w)});const u=document.createElement("div");u.className="absolute top-0 h-full pointer-events-none",u.style.backgroundColor="rgba(66, 153, 225, 0.3)",u.id=`${e.id}-highlight`,e.appendChild(u)}updateChartHighlight(e,r,o,n){const s=e.querySelector(`#${e.id}-highlight`);if(!s)return;const a=r[r.length-1].value-r[0].value;if(a<=0)return;const h=(o-r[0].value)/a*100,u=(n-o)/a*100;s.style.left=`${h}%`,s.style.width=`${u}%`}onFacetChange(e){const{value:r,checked:o}=e.target,n=e.target.dataset.facetType;o?(this.state.filters[n]||(this.state.filters[n]=[]),this.state.filters[n].push(r)):this.state.filters[n]=this.state.filters[n].filter(s=>s!==r),this.performSearch(),this.fetchAggregations()}handleSliderChange(e,r){const o=e.target.value;this.state.filters[r]=[o],this.performSearch(),this.fetchAggregations()}addFacetEventListeners(){if(!this.config.aggregations){console.error("Aggregations configuration not found");return}Object.keys(this.config.aggregations).forEach(e=>{const r=document.getElementById(`${e}-facet`);r&&r.querySelectorAll("input").forEach(o=>{o.addEventListener("change",this.onFacetChange.bind(this))})})}performSearch(){if(!this.searchEngine){console.error("Search engine not initialized");return}const{filters:e}=this.state,r={},o={},n={};Object.entries(e).forEach(([h,u])=>{if(!u||u.length===0)return;const d=this.config.aggregations[h];if(d)switch(d.type){case"range":o[h]=u;break;case"taxonomy":n[h]=u;break;default:r[h]=u}});const s=this.searchEngine.search({query:this.state.query||"",filters:r,sort:this.state.sort||"title_asc",per_page:526,filter:h=>{for(const[u,d]of Object.entries(o))if(d.length===2){const[l,w]=d,g=new Date(h[u]).getTime();if(!(g>=l&&g<=w))return!1}for(const[u,d]of Object.entries(n)){if(!h[u])return!1;const l=h[u];if(!d.some(g=>l===g||l.startsWith(g+" > ")))return!1}return!0}});s.data.items.filter(h=>h.lat_long&&h.lat_long.length>0).map(h=>{const u=h.lat_long[0],[d,l]=u.split(",");return[parseFloat(d),parseFloat(l)]}),this.renderMarkers(s.data.items),this.updateResultsList(s.data.items);const a={};for(const h in s.data.aggregations)s.data.aggregations.hasOwnProperty(h)&&(a[h]=s.data.aggregations[h].buckets);this.renderFacets(a)}focusOnMap(e,r,o=15){if(!this.map){console.error("Map not initialized");return}try{this.map.setView([parseFloat(e),parseFloat(r)],o),console.log(`Map focused on coordinates: ${e}, ${r} with zoom level: ${o}`)}catch(n){console.error("Error focusing map on coordinates:",n),console.log("Map object:",this.map),console.log("Available methods:",Object.getOwnPropertyNames(this.map).filter(s=>typeof this.map[s]=="function"))}}updateResultsList(e){const r=document.getElementById("results");if(!r){console.error("Results container not found");return}r.innerHTML=e.map(n=>{const a=(Array.isArray(n["Spazi geografici"])?n["Spazi geografici"]:[]).map((h,u)=>{let d=[];if(Array.isArray(n.lat_long)&&n.lat_long.length>0){const g=n.lat_long[u];if(g&&typeof g=="string"){const y=g.split(",");y.length===2&&(d=[y[0].trim(),y[1].trim()])}}const l=d[0],w=d[1];return l&&w?`
        <button class="focus-map-btn mr-2 px-2 py-1 text-sm bg-gray-100 rounded" 
                data-space="${encodeURIComponent(h)}" 
                data-lat="${l}" 
                data-lng="${w}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4 inline mr-1">
            <path fill-rule="evenodd" d="m7.539 14.841.003.003.002.002a.755.755 0 0 0 .912 0l.002-.002.003-.003.012-.009a5.57 5.57 0 0 0 .19-.153 15.588 15.588 0 0 0 2.046-2.082c1.101-1.362 2.291-3.342 2.291-5.597A5 5 0 0 0 3 7c0 2.255 1.19 4.235 2.292 5.597a15.591 15.591 0 0 0 2.046 2.082 8.916 8.916 0 0 0 .189.153l.012.01ZM8 8.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" clip-rule="evenodd" />
          </svg>
          ${h}
        </button>
      `:`
        <button class="focus-map-btn mr-2 px-2 py-1 text-sm bg-gray-100 rounded" 
                data-space="${encodeURIComponent(h)}" >
          ${h}
        </button>
      `}).join("");return`
      <div class="p-4 bg-white rounded-lg shadow">
        <h3 class="font-semibold flex items-center">${n.Titolo}, ${n.Autore} (${n.Anno})
          <a href="../pages/record.html?scheda=${encodeURIComponent(n.Titolo)}">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 0 0 3 8.25v10.5A2.25 2.25 0 0 0 5.25 21h10.5A2.25 2.25 0 0 0 18 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25" />
            </svg>
          </a>
        </h3>
        <div class="mt-2">
          <div class="flex flex-wrap items-center">
            ${a}
          </div>
        </div>
      </div>
    `}).join("");const o=this;document.querySelectorAll(".focus-map-btn").forEach(n=>{n.addEventListener("click",function(){const s=this.getAttribute("data-lat"),a=this.getAttribute("data-lng");s&&a?o.focusOnMap(s,a,8):console.warn("Coordinate non disponibili per questa opera")})})}debounce(e,r){let o;return function(){clearTimeout(o),o=setTimeout(()=>e.apply(this,arguments),r)}}}document.addEventListener("DOMContentLoaded",()=>{new Ko})});export default ti();
