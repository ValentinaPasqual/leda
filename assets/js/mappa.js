var si=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);import{l as oi,U as ai,a as li}from"./universalFooter-BH0r178q.js";import{p as ci}from"./dataParser-7VK0E9mz.js";import{i as ui}from"./initMap-SJMGpn5m.js";import{F as di,P as hi,D as fi,a as pi,R as ut,N as Sr,M as gi}from"./modalRenderer-Cg3dEo6B.js";import"./_commonjsHelpers-BosuxZz1.js";var Ra=si((fe,pe)=>{var vn=typeof global=="object"&&global&&global.Object===Object&&global,mi=typeof self=="object"&&self&&self.Object===Object&&self,_e=vn||mi||Function("return this")(),me=_e.Symbol,wn=Object.prototype,vi=wn.hasOwnProperty,wi=wn.toString,Ze=me?me.toStringTag:void 0,yi=Object.prototype.toString,bi="[object Null]",xi="[object Undefined]",Cr=me?me.toStringTag:void 0;function Ge(r){return r==null?r===void 0?xi:bi:Cr&&Cr in Object(r)?function(e){var t=vi.call(e,Ze),n=e[Ze];try{e[Ze]=void 0;var i=!0}catch{}var s=wi.call(e);return i&&(t?e[Ze]=n:delete e[Ze]),s}(r):function(e){return yi.call(e)}(r)}function Me(r){return r!=null&&typeof r=="object"}var _i="[object Symbol]";function qe(r){return typeof r=="symbol"||Me(r)&&Ge(r)==_i}function He(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}var se=Array.isArray,Er=me?me.prototype:void 0,Mr=Er?Er.toString:void 0;function yn(r){if(typeof r=="string")return r;if(se(r))return He(r,yn)+"";if(qe(r))return Mr?Mr.call(r):"";var e=r+"";return e=="0"&&1/r==-1/0?"-0":e}function ze(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function St(r){return r}var Si="[object AsyncFunction]",Ci="[object Function]",Ei="[object GeneratorFunction]",Mi="[object Proxy]";function bn(r){if(!ze(r))return!1;var e=Ge(r);return e==Ci||e==Ei||e==Si||e==Mi}var kr,Rt=_e["__core-js_shared__"],Ar=(kr=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||""))?"Symbol(src)_1."+kr:"",ki=Function.prototype.toString;function $e(r){if(r!=null){try{return ki.call(r)}catch{}try{return r+""}catch{}}return""}var Ai=/^\[object .+?Constructor\]$/,ji=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Te(r,e){var t=function(n,i){return n==null?void 0:n[i]}(r,e);return function(n){return!(!ze(n)||(i=n,Ar&&Ar in i))&&(bn(n)?ji:Ai).test($e(n));var i}(t)?t:void 0}var jr,zt,$t,Ht=Te(_e,"WeakMap"),Lr=Object.create,Li=function(){function r(){}return function(e){if(!ze(e))return{};if(Lr)return Lr(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),Oi=Date.now,Fi=function(){try{var r=Te(Object,"defineProperty");return r({},"",{}),r}catch{}}(),yt=Fi,Ii=yt?function(r,e){return yt(r,"toString",{configurable:!0,enumerable:!1,value:(t=e,function(){return t}),writable:!0});var t}:St,Pi=(jr=Ii,zt=0,$t=0,function(){var r=Oi(),e=16-(r-$t);if($t=r,e>0){if(++zt>=800)return arguments[0]}else zt=0;return jr.apply(void 0,arguments)});function Ni(r){return r!=r}function Ri(r,e){return!(r==null||!r.length)&&function(t,n,i){return n==n?function(s,o,a){for(var c=-1,d=s.length;++c<d;)if(s[c]===o)return c;return-1}(t,n):function(s,o,a,c){for(var d=s.length,f=-1;++f<d;)if(o(s[f],f,s))return f;return-1}(t,Ni)}(r,e)>-1}var zi=9007199254740991,$i=/^(?:0|[1-9]\d*)$/;function rr(r,e){var t=typeof r;return!!(e=e??zi)&&(t=="number"||t!="symbol"&&$i.test(r))&&r>-1&&r%1==0&&r<e}function nr(r,e,t){e=="__proto__"&&yt?yt(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}function Ct(r,e){return r===e||r!=r&&e!=e}var Ti=Object.prototype.hasOwnProperty;function xn(r,e,t){var n=r[e];Ti.call(r,e)&&Ct(n,t)&&(t!==void 0||e in r)||nr(r,e,t)}function dt(r,e,t,n){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=r[a]),i?nr(t,a,c):xn(t,a,c)}return t}var Or=Math.max;function _n(r,e){return Pi(function(t,n,i){return n=Or(n===void 0?t.length-1:n,0),function(){for(var s=arguments,o=-1,a=Or(s.length-n,0),c=Array(a);++o<a;)c[o]=s[n+o];o=-1;for(var d=Array(n+1);++o<n;)d[o]=s[o];return d[n]=i(c),function(f,v,w){switch(w.length){case 0:return f.call(v);case 1:return f.call(v,w[0]);case 2:return f.call(v,w[0],w[1]);case 3:return f.call(v,w[0],w[1],w[2])}return f.apply(v,w)}(t,this,d)}}(r,e,St),r+"")}var Di=9007199254740991;function ir(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Di}function Je(r){return r!=null&&ir(r.length)&&!bn(r)}function Fr(r,e,t){if(!ze(t))return!1;var n=typeof e;return!!(n=="number"?Je(t)&&rr(e,t.length):n=="string"&&e in t)&&Ct(t[e],r)}var Bi=Object.prototype;function sr(r){var e=r&&r.constructor;return r===(typeof e=="function"&&e.prototype||Bi)}function Ir(r){return Me(r)&&Ge(r)=="[object Arguments]"}var Sn=Object.prototype,Ui=Sn.hasOwnProperty,Vi=Sn.propertyIsEnumerable,or=Ir(function(){return arguments}())?Ir:function(r){return Me(r)&&Ui.call(r,"callee")&&!Vi.call(r,"callee")},Cn=typeof fe=="object"&&fe&&!fe.nodeType&&fe,Pr=Cn&&typeof pe=="object"&&pe&&!pe.nodeType&&pe,Nr=Pr&&Pr.exports===Cn?_e.Buffer:void 0,bt=(Nr?Nr.isBuffer:void 0)||function(){return!1},W={};function Et(r){return function(e){return r(e)}}W["[object Float32Array]"]=W["[object Float64Array]"]=W["[object Int8Array]"]=W["[object Int16Array]"]=W["[object Int32Array]"]=W["[object Uint8Array]"]=W["[object Uint8ClampedArray]"]=W["[object Uint16Array]"]=W["[object Uint32Array]"]=!0,W["[object Arguments]"]=W["[object Array]"]=W["[object ArrayBuffer]"]=W["[object Boolean]"]=W["[object DataView]"]=W["[object Date]"]=W["[object Error]"]=W["[object Function]"]=W["[object Map]"]=W["[object Number]"]=W["[object Object]"]=W["[object RegExp]"]=W["[object Set]"]=W["[object String]"]=W["[object WeakMap]"]=!1;var En=typeof fe=="object"&&fe&&!fe.nodeType&&fe,et=En&&typeof pe=="object"&&pe&&!pe.nodeType&&pe,Tt=et&&et.exports===En&&vn.process,We=function(){try{return et&&et.require&&et.require("util").types||Tt&&Tt.binding&&Tt.binding("util")}catch{}}(),Rr=We&&We.isTypedArray,Mn=Rr?Et(Rr):function(r){return Me(r)&&ir(r.length)&&!!W[Ge(r)]},Hi=Object.prototype.hasOwnProperty;function kn(r,e){var t=se(r),n=!t&&or(r),i=!t&&!n&&bt(r),s=!t&&!n&&!i&&Mn(r),o=t||n||i||s,a=o?function(f,v){for(var w=-1,h=Array(f);++w<f;)h[w]=v(w);return h}(r.length,String):[],c=a.length;for(var d in r)!e&&!Hi.call(r,d)||o&&(d=="length"||i&&(d=="offset"||d=="parent")||s&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||rr(d,c))||a.push(d);return a}function An(r,e){return function(t){return r(e(t))}}var qi=An(Object.keys,Object),Wi=Object.prototype.hasOwnProperty;function st(r){return Je(r)?kn(r):function(e){if(!sr(e))return qi(e);var t=[];for(var n in Object(e))Wi.call(e,n)&&n!="constructor"&&t.push(n);return t}(r)}var Gi=Object.prototype.hasOwnProperty;function Ji(r){return Je(r)?kn(r,!0):function(e){if(!ze(e))return function(s){var o=[];if(s!=null)for(var a in Object(s))o.push(a);return o}(e);var t=sr(e),n=[];for(var i in e)(i!="constructor"||!t&&Gi.call(e,i))&&n.push(i);return n}(r)}var Qi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Xi=/^\w*$/;function qt(r,e){if(se(r))return!1;var t=typeof r;return!(t!="number"&&t!="symbol"&&t!="boolean"&&r!=null&&!qe(r))||Xi.test(r)||!Qi.test(r)||e!=null&&r in Object(e)}var Ke=Te(Object,"create"),Yi=Object.prototype.hasOwnProperty,Zi=Object.prototype.hasOwnProperty;function Ne(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function ht(r,e){for(var t=r.length;t--;)if(Ct(r[t][0],e))return t;return-1}Ne.prototype.clear=function(){this.__data__=Ke?Ke(null):{},this.size=0},Ne.prototype.delete=function(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e},Ne.prototype.get=function(r){var e=this.__data__;if(Ke){var t=e[r];return t==="__lodash_hash_undefined__"?void 0:t}return Yi.call(e,r)?e[r]:void 0},Ne.prototype.has=function(r){var e=this.__data__;return Ke?e[r]!==void 0:Zi.call(e,r)},Ne.prototype.set=function(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Ke&&e===void 0?"__lodash_hash_undefined__":e,this};var Ki=Array.prototype.splice;function Ee(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Ee.prototype.clear=function(){this.__data__=[],this.size=0},Ee.prototype.delete=function(r){var e=this.__data__,t=ht(e,r);return!(t<0||(t==e.length-1?e.pop():Ki.call(e,t,1),--this.size,0))},Ee.prototype.get=function(r){var e=this.__data__,t=ht(e,r);return t<0?void 0:e[t][1]},Ee.prototype.has=function(r){return ht(this.__data__,r)>-1},Ee.prototype.set=function(r,e){var t=this.__data__,n=ht(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this};var rt=Te(_e,"Map");function ft(r,e){var t,n,i=r.__data__;return((n=typeof(t=e))=="string"||n=="number"||n=="symbol"||n=="boolean"?t!=="__proto__":t===null)?i[typeof e=="string"?"string":"hash"]:i.map}function Ce(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function ar(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var t=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=t.cache;if(s.has(i))return s.get(i);var o=r.apply(this,n);return t.cache=s.set(i,o)||s,o};return t.cache=new(ar.Cache||Ce),t}Ce.prototype.clear=function(){this.size=0,this.__data__={hash:new Ne,map:new(rt||Ee),string:new Ne}},Ce.prototype.delete=function(r){var e=ft(this,r).delete(r);return this.size-=e?1:0,e},Ce.prototype.get=function(r){return ft(this,r).get(r)},Ce.prototype.has=function(r){return ft(this,r).has(r)},Ce.prototype.set=function(r,e){var t=ft(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this},ar.Cache=Ce;var Dt,Bt,es=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ts=/\\(\\)?/g,rs=(Dt=ar(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(es,function(t,n,i,s){e.push(i?s.replace(ts,"$1"):n||t)}),e},function(r){return Bt.size===500&&Bt.clear(),r}),Bt=Dt.cache,Dt);function jn(r,e){return se(r)?r:qt(r,e)?[r]:rs(function(t){return t==null?"":yn(t)}(r))}function mt(r){if(typeof r=="string"||qe(r))return r;var e=r+"";return e=="0"&&1/r==-1/0?"-0":e}function Wt(r,e){for(var t=0,n=(e=jn(e,r)).length;r!=null&&t<n;)r=r[mt(e[t++])];return t&&t==n?r:void 0}function lr(r,e){for(var t=-1,n=e.length,i=r.length;++t<n;)r[i+t]=e[t];return r}var zr=me?me.isConcatSpreadable:void 0;function ns(r){return se(r)||or(r)||!!(zr&&r&&r[zr])}function is(r,e,t,n,i){var s=-1,o=r.length;for(t||(t=ns),i||(i=[]);++s<o;){var a=r[s];t(a)?lr(i,a):i[i.length]=a}return i}var Ln=An(Object.getPrototypeOf,Object);function xe(r){var e=this.__data__=new Ee(r);this.size=e.size}xe.prototype.clear=function(){this.__data__=new Ee,this.size=0},xe.prototype.delete=function(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t},xe.prototype.get=function(r){return this.__data__.get(r)},xe.prototype.has=function(r){return this.__data__.has(r)},xe.prototype.set=function(r,e){var t=this.__data__;if(t instanceof Ee){var n=t.__data__;if(!rt||n.length<199)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new Ce(n)}return t.set(r,e),this.size=t.size,this};var On=typeof fe=="object"&&fe&&!fe.nodeType&&fe,$r=On&&typeof pe=="object"&&pe&&!pe.nodeType&&pe,Tr=$r&&$r.exports===On?_e.Buffer:void 0,Dr=Tr?Tr.allocUnsafe:void 0;function Fn(){return[]}var ss=Object.prototype.propertyIsEnumerable,Br=Object.getOwnPropertySymbols,os=Br?function(r){return r==null?[]:(r=Object(r),function(e,t){for(var n=-1,i=e==null?0:e.length,s=0,o=[];++n<i;){var a=e[n];ss.call(r,a)&&(o[s++]=a)}return o}(Br(r)))}:Fn,cr=os,as=Object.getOwnPropertySymbols?function(r){for(var e=[];r;)lr(e,cr(r)),r=Ln(r);return e}:Fn;function ls(r,e,t){var n=e(r);return se(r)?n:lr(n,t(r))}function Gt(r){return ls(r,st,cr)}var Jt=Te(_e,"DataView"),Qt=Te(_e,"Promise"),Xt=Te(_e,"Set"),Ur="[object Map]",Vr="[object Promise]",Hr="[object Set]",qr="[object WeakMap]",Wr="[object DataView]",cs=$e(Jt),us=$e(rt),ds=$e(Qt),hs=$e(Xt),fs=$e(Ht),Pe=Ge;(Jt&&Pe(new Jt(new ArrayBuffer(1)))!=Wr||rt&&Pe(new rt)!=Ur||Qt&&Pe(Qt.resolve())!=Vr||Xt&&Pe(new Xt)!=Hr||Ht&&Pe(new Ht)!=qr)&&(Pe=function(r){var e=Ge(r),t=e=="[object Object]"?r.constructor:void 0,n=t?$e(t):"";if(n)switch(n){case cs:return Wr;case us:return Ur;case ds:return Vr;case hs:return Hr;case fs:return qr}return e});var nt=Pe,ps=Object.prototype.hasOwnProperty,xt=_e.Uint8Array;function gs(r){var e=new r.constructor(r.byteLength);return new xt(e).set(new xt(r)),e}var ms=/\w*$/,Gr=me?me.prototype:void 0,Jr=Gr?Gr.valueOf:void 0,vs="[object Boolean]",ws="[object Date]",ys="[object Map]",bs="[object Number]",xs="[object RegExp]",_s="[object Set]",Ss="[object String]",Cs="[object Symbol]",Es="[object ArrayBuffer]",Ms="[object DataView]",ks="[object Float32Array]",As="[object Float64Array]",js="[object Int8Array]",Ls="[object Int16Array]",Os="[object Int32Array]",Fs="[object Uint8Array]",Is="[object Uint8ClampedArray]",Ps="[object Uint16Array]",Ns="[object Uint32Array]",Qr=We&&We.isMap,Rs=Qr?Et(Qr):function(r){return Me(r)&&nt(r)=="[object Map]"},Xr=We&&We.isSet,zs=Xr?Et(Xr):function(r){return Me(r)&&nt(r)=="[object Set]"},$s=2,In="[object Arguments]",Pn="[object Function]",Ts="[object GeneratorFunction]",Nn="[object Object]",q={};function vt(r,e,t,n,i,s){var o,a=e&$s;if(o!==void 0)return o;if(!ze(r))return r;var c=se(r);if(c)return o=function(h){var b=h.length,x=new h.constructor(b);return b&&typeof h[0]=="string"&&ps.call(h,"index")&&(x.index=h.index,x.input=h.input),x}(r),function(h,b){var x=-1,C=h.length;for(b||(b=Array(C));++x<C;)b[x]=h[x];return b}(r,o);var d=nt(r),f=d==Pn||d==Ts;if(bt(r))return function(h,b){var x=h.length,C=Dr?Dr(x):new h.constructor(x);return h.copy(C),C}(r);if(d==Nn||d==In||f&&!i)return o=f?{}:function(h){return typeof h.constructor!="function"||sr(h)?{}:Li(Ln(h))}(r),a?function(h,b){return dt(h,as(h),b)}(r,function(h,b){return h&&dt(b,Ji(b),h)}(o,r)):function(h,b){return dt(h,cr(h),b)}(r,function(h,b){return h&&dt(b,st(b),h)}(o,r));if(!q[d])return i?r:{};o=function(h,b,x){var C,O,N=h.constructor;switch(b){case Es:return gs(h);case vs:case ws:return new N(+h);case Ms:return function($,z){var G=$.buffer;return new $.constructor(G,$.byteOffset,$.byteLength)}(h);case ks:case As:case js:case Ls:case Os:case Fs:case Is:case Ps:case Ns:return function($,z){var G=$.buffer;return new $.constructor(G,$.byteOffset,$.length)}(h);case ys:return new N;case bs:case Ss:return new N(h);case xs:return(O=new(C=h).constructor(C.source,ms.exec(C))).lastIndex=C.lastIndex,O;case _s:return new N;case Cs:return Jr?Object(Jr.call(h)):{}}}(r,d),s||(s=new xe);var v=s.get(r);if(v)return v;s.set(r,o),zs(r)?r.forEach(function(h){o.add(vt(h,e,t,h,r,s))}):Rs(r)&&r.forEach(function(h,b){o.set(b,vt(h,e,t,b,r,s))});var w=c?void 0:Gt(r);return function(h,b){for(var x=-1,C=h==null?0:h.length;++x<C&&b(h[x],x)!==!1;);}(w||r,function(h,b){w&&(h=r[b=h]),xn(o,b,vt(h,e,t,b,r,s))}),o}function Ut(r){return vt(r,4)}function tt(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new Ce;++e<t;)this.add(r[e])}function Ds(r,e){for(var t=-1,n=r==null?0:r.length;++t<n;)if(e(r[t],t,r))return!0;return!1}function Yt(r,e){return r.has(e)}q[In]=q["[object Array]"]=q["[object ArrayBuffer]"]=q["[object DataView]"]=q["[object Boolean]"]=q["[object Date]"]=q["[object Float32Array]"]=q["[object Float64Array]"]=q["[object Int8Array]"]=q["[object Int16Array]"]=q["[object Int32Array]"]=q["[object Map]"]=q["[object Number]"]=q[Nn]=q["[object RegExp]"]=q["[object Set]"]=q["[object String]"]=q["[object Symbol]"]=q["[object Uint8Array]"]=q["[object Uint8ClampedArray]"]=q["[object Uint16Array]"]=q["[object Uint32Array]"]=!0,q["[object Error]"]=q[Pn]=q["[object WeakMap]"]=!1,tt.prototype.add=tt.prototype.push=function(r){return this.__data__.set(r,"__lodash_hash_undefined__"),this},tt.prototype.has=function(r){return this.__data__.has(r)};var Bs=1,Us=2;function Yr(r,e,t,n,i,s){var o=t&Bs,a=r.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var d=s.get(r),f=s.get(e);if(d&&f)return d==e&&f==r;var v=-1,w=!0,h=t&Us?new tt:void 0;for(s.set(r,e),s.set(e,r);++v<a;){var b=r[v],x=e[v];if(n)var C=o?n(x,b,v,e,r,s):n(b,x,v,r,e,s);if(C!==void 0){if(C)continue;w=!1;break}if(h){if(!Ds(e,function(O,N){if(!Yt(h,N)&&(b===O||i(b,O,t,n,s)))return h.push(N)})){w=!1;break}}else if(b!==x&&!i(b,x,t,n,s)){w=!1;break}}return s.delete(r),s.delete(e),w}function Vs(r){var e=-1,t=Array(r.size);return r.forEach(function(n,i){t[++e]=[i,n]}),t}function Hs(r){var e=-1,t=Array(r.size);return r.forEach(function(n){t[++e]=n}),t}var qs=1,Ws=2,Gs="[object Boolean]",Js="[object Date]",Qs="[object Error]",Xs="[object Map]",Ys="[object Number]",Zs="[object RegExp]",Ks="[object Set]",eo="[object String]",to="[object Symbol]",ro="[object ArrayBuffer]",no="[object DataView]",Zr=me?me.prototype:void 0,Vt=Zr?Zr.valueOf:void 0,io=1,so=Object.prototype.hasOwnProperty,oo=1,Kr="[object Arguments]",en="[object Array]",pt="[object Object]",tn=Object.prototype.hasOwnProperty;function Zt(r,e,t,n,i){return r===e||(r==null||e==null||!Me(r)&&!Me(e)?r!=r&&e!=e:function(s,o,a,c,d,f){var v=se(s),w=se(o),h=v?en:nt(s),b=w?en:nt(o),x=(h=h==Kr?pt:h)==pt,C=(b=b==Kr?pt:b)==pt,O=h==b;if(O&&bt(s)){if(!bt(o))return!1;v=!0,x=!1}if(O&&!x)return f||(f=new xe),v||Mn(s)?Yr(s,o,a,c,d,f):function(F,P,X,ce,we,te,le){switch(X){case no:if(F.byteLength!=P.byteLength||F.byteOffset!=P.byteOffset)return!1;F=F.buffer,P=P.buffer;case ro:return!(F.byteLength!=P.byteLength||!te(new xt(F),new xt(P)));case Gs:case Js:case Ys:return Ct(+F,+P);case Qs:return F.name==P.name&&F.message==P.message;case Zs:case eo:return F==P+"";case Xs:var ue=Vs;case Ks:if(ue||(ue=Hs),F.size!=P.size&&!(ce&qs))return!1;var ge=le.get(F);if(ge)return ge==P;ce|=Ws,le.set(F,P);var de=Yr(ue(F),ue(P),ce,we,te,le);return le.delete(F),de;case to:if(Vt)return Vt.call(F)==Vt.call(P)}return!1}(s,o,h,a,c,d,f);if(!(a&oo)){var N=x&&tn.call(s,"__wrapped__"),$=C&&tn.call(o,"__wrapped__");if(N||$){var z=N?s.value():s,G=$?o.value():o;return f||(f=new xe),d(z,G,a,c,f)}}return!!O&&(f||(f=new xe),function(F,P,X,ce,we,te){var le=X&io,ue=Gt(F),ge=ue.length;if(ge!=Gt(P).length&&!le)return!1;for(var de=ge;de--;){var y=ue[de];if(!(le?y in P:so.call(P,y)))return!1}var l=te.get(F),p=te.get(P);if(l&&p)return l==P&&p==F;var _=!0;te.set(F,P),te.set(P,F);for(var E=le;++de<ge;){var A=F[y=ue[de]],j=P[y];if(ce)var D=le?ce(j,A,y,P,F,te):ce(A,j,y,F,P,te);if(!(D===void 0?A===j||we(A,j,X,ce,te):D)){_=!1;break}E||(E=y=="constructor")}if(_&&!E){var Z=F.constructor,B=P.constructor;Z==B||!("constructor"in F)||!("constructor"in P)||typeof Z=="function"&&Z instanceof Z&&typeof B=="function"&&B instanceof B||(_=!1)}return te.delete(F),te.delete(P),_}(s,o,a,c,d,f))}(r,e,t,n,Zt,i))}var ao=1,lo=2;function rn(r){return r==r&&!ze(r)}function nn(r,e){return function(t){return t!=null&&t[r]===e&&(e!==void 0||r in Object(t))}}function co(r,e){return r!=null&&e in Object(r)}var uo=1,ho=2;function De(r){return typeof r=="function"?r:r==null?St:typeof r=="object"?se(r)?function(s,o){return qt(s)&&rn(o)?nn(mt(s),o):function(a){var c=function(d,f,v){var w=d==null?void 0:Wt(d,f);return w===void 0?void 0:w}(a,s);return c===void 0&&c===o?function(d,f){return d!=null&&function(v,w,h){for(var b=-1,x=(w=jn(w,v)).length,C=!1;++b<x;){var O=mt(w[b]);if(!(C=v!=null&&h(v,O)))break;v=v[O]}return C||++b!=x?C:!!(x=v==null?0:v.length)&&ir(x)&&rr(O,x)&&(se(v)||or(v))}(d,f,co)}(a,s):Zt(o,c,uo|ho)}}(r[0],r[1]):(i=function(s){for(var o=st(s),a=o.length;a--;){var c=o[a],d=s[c];o[a]=[c,d,rn(d)]}return o}(n=r),i.length==1&&i[0][2]?nn(i[0][0],i[0][1]):function(s){return s===n||function(o,a,c,d){var f=c.length,v=f;if(o==null)return!v;for(o=Object(o);f--;){var w=c[f];if(w[2]?w[1]!==o[w[0]]:!(w[0]in o))return!1}for(;++f<v;){var h=(w=c[f])[0],b=o[h],x=w[1];if(w[2]){if(b===void 0&&!(h in o))return!1}else{var C=new xe;if(!Zt(x,b,ao|lo,void 0,C))return!1}}return!0}(s,0,i)}):qt(e=r)?(t=mt(e),function(s){return s==null?void 0:s[t]}):function(s){return function(o){return Wt(o,s)}}(e);var e,t,n,i}var fo=function(r,e,t){for(var n=-1,i=Object(r),s=t(r),o=s.length;o--;){var a=s[++n];if(e(i[a],a,i)===!1)break}return r};function Rn(r,e){return r&&fo(r,e,st)}var sn,po=(sn=Rn,function(r,e){if(r==null)return r;if(!Je(r))return sn(r,e);for(var t=r.length,n=-1,i=Object(r);++n<t&&e(i[n],n,i)!==!1;);return r});function zn(r,e){var t=-1,n=Je(r)?Array(r.length):[];return po(r,function(i,s,o){n[++t]=e(i,s,o)}),n}function go(r,e){return r>e}var mo=Math.min;function vo(r){return function(e){return Me(e)&&Je(e)}(r)?r:[]}var wo=_n(function(r){var e=He(r,vo);return e.length&&e[0]===r[0]?function(t,n,i){for(var s=Ri,o=t[0].length,a=t.length,c=a,d=Array(a),f=1/0,v=[];c--;){var w=t[c];f=mo(w.length,f),d[c]=o>=120&&w.length>=120?new tt(c&&w):void 0}w=t[0];var h=-1,b=d[0];e:for(;++h<o&&v.length<f;){var x=w[h],C=x;if(x=x!==0?x:0,!(b?Yt(b,C):s(v,C,i))){for(c=a;--c;){var O=d[c];if(!(O?Yt(O,C):s(t[c],C,i)))continue e}b&&b.push(C),v.push(x)}}return v}(e):[]}),yo=wo;function bo(r,e){return r<e}function T(r,e){var t={};return e=De(e),Rn(r,function(n,i,s){nr(t,i,e(n,i,s))}),t}function $n(r,e,t){for(var n=-1,i=r.length;++n<i;){var s=r[n],o=e(s);if(o!=null&&(a===void 0?o==o&&!qe(o):t(o,a)))var a=o,c=s}return c}function xo(r,e){return r&&r.length?$n(r,De(e),go):void 0}function Tn(r,e){for(var t,n=-1,i=r.length;++n<i;){var s=e(r[n]);s!==void 0&&(t=t===void 0?s:t+s)}return t}function _o(r,e){return function(t,n){var i=t==null?0:t.length;return i?Tn(t,n)/i:NaN}(r,De(e))}function So(r,e){if(r!==e){var t=r!==void 0,n=r===null,i=r==r,s=qe(r),o=e!==void 0,a=e===null,c=e==e,d=qe(e);if(!a&&!d&&!s&&r>e||s&&o&&c&&!a&&!d||n&&o&&c||!t&&c||!i)return 1;if(!n&&!s&&!d&&r<e||d&&t&&i&&!n&&!s||a&&t&&i||!o&&i||!c)return-1}return 0}function Dn(r,e,t){e=e.length?He(e,function(i){return se(i)?function(s){return Wt(s,i.length===1?i[0]:i)}:i}):[St];var n=-1;return e=He(e,Et(De)),function(i,s){var o=i.length;for(i.sort(function(a,c){return function(d,f,v){for(var w=-1,h=d.criteria,b=f.criteria,x=h.length,C=v.length;++w<x;){var O=So(h[w],b[w]);if(O)return w>=C?O:O*(v[w]=="desc"?-1:1)}return d.index-f.index}(a,c,t)});o--;)i[o]=i[o].value;return i}(zn(r,function(i,s,o){return{criteria:He(e,function(a){return a(i)}),index:++n,value:i}}))}function ur(r,e,t,n){return r==null?[]:(se(e)||(e=e==null?[]:[e]),se(t=t)||(t=t==null?[]:[t]),Dn(r,e,t))}var Co=_n(function(r,e){if(r==null)return[];var t=e.length;return t>1&&Fr(r,e[0],e[1])?e=[]:t>2&&Fr(e[0],e[1],e[2])&&(e=[e[0]]),Dn(r,is(e),[])});function Eo(r,e){return r&&r.length?Tn(r,De(e)):0}function R(r){if(this.words=[],r)if(Symbol&&Symbol.iterator&&r[Symbol.iterator]!==void 0){const e=r[Symbol.iterator]();let t=e.next();for(;!t.done;)this.add(t.value),t=e.next()}else for(let e=0;e<r.length;e++)this.add(r[e])}R.fromWords=function(r){const e=Object.create(R.prototype);return e.words=r,e},R.prototype.add=function(r){this.resize(r),this.words[r>>>5]|=1<<r},R.prototype.flip=function(r){this.resize(r),this.words[r>>>5]^=1<<r},R.prototype.clear=function(){this.words.length=0},R.prototype.remove=function(r){this.resize(r),this.words[r>>>5]&=~(1<<r)},R.prototype.isEmpty=function(r){const e=this.words.length;for(let t=0;t<e;t++)if(this.words[t]!==0)return!1;return!0},R.prototype.has=function(r){return(this.words[r>>>5]&1<<r)!=0},R.prototype.checkedAdd=function(r){this.resize(r);const e=this.words[r>>>5],t=e|1<<r;return this.words[r>>>5]=t,(t^e)>>>r},R.prototype.trim=function(r){let e=this.words.length;for(;e>0&&this.words[e-1]===0;)e--;this.words.length=e},R.prototype.resize=function(r){const e=r+32>>>5;for(let t=this.words.length;t<e;t++)this.words[t]=0},R.prototype.hammingWeight=function(r){return 16843009*((r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)>>>24},R.prototype.hammingWeight4=function(r,e,t,n){return 16843009*((r=(r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)+(e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)+(t=(t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)+(n=(n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135))>>>24},R.prototype.size=function(){let r=0;const e=this.words.length,t=this.words;for(let n=0;n<e;n++)r+=this.hammingWeight(t[n]);return r},R.prototype.array=function(){const r=new Array(this.size());let e=0;const t=this.words.length;for(let n=0;n<t;++n){let i=this.words[n];for(;i!=0;){const s=i&-i;r[e++]=(n<<5)+this.hammingWeight(s-1|0),i^=s}}return r},R.prototype.forEach=function(r){const e=this.words.length;for(let t=0;t<e;++t){let n=this.words[t];for(;n!=0;){const i=n&-n;r((t<<5)+this.hammingWeight(i-1|0)),n^=i}}},R.prototype[Symbol.iterator]=function(){const r=this.words.length;let e=0,t=this.words[e],n=this.hammingWeight,i=this.words;return{[Symbol.iterator](){return this},next(){for(;e<r;){if(t!==0){const s=t&-t,o=(e<<5)+n(s-1|0);return t^=s,{done:!1,value:o}}e++,e<r&&(t=i[e])}return{done:!0,value:void 0}}}},R.prototype.clone=function(){const r=Object.create(R.prototype);return r.words=this.words.slice(),r},R.prototype.intersects=function(r){const e=Math.min(this.words.length,r.words.length);for(let t=0;t<e;++t)if(this.words[t]&r.words[t])return!0;return!1},R.prototype.intersection=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]&=r.words[t],this.words[t+1]&=r.words[t+1],this.words[t+2]&=r.words[t+2],this.words[t+3]&=r.words[t+3],this.words[t+4]&=r.words[t+4],this.words[t+5]&=r.words[t+5],this.words[t+6]&=r.words[t+6],this.words[t+7]&=r.words[t+7];for(;t<e;++t)this.words[t]&=r.words[t];const n=this.words.length;for(t=e;t<n;++t)this.words[t]=0;return this},R.prototype.intersection_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(let n=0;n<e;++n)t+=this.hammingWeight(this.words[n]&r.words[n]);return t},R.prototype.new_intersection=function(r){const e=Object.create(R.prototype),t=Math.min(this.words.length,r.words.length);e.words=new Array(t);let n=0;for(;n+7<t;n+=8)e.words[n]=this.words[n]&r.words[n],e.words[n+1]=this.words[n+1]&r.words[n+1],e.words[n+2]=this.words[n+2]&r.words[n+2],e.words[n+3]=this.words[n+3]&r.words[n+3],e.words[n+4]=this.words[n+4]&r.words[n+4],e.words[n+5]=this.words[n+5]&r.words[n+5],e.words[n+6]=this.words[n+6]&r.words[n+6],e.words[n+7]=this.words[n+7]&r.words[n+7];for(;n<t;++n)e.words[n]=this.words[n]&r.words[n];return e},R.prototype.equals=function(r){const e=Math.min(this.words.length,r.words.length);for(let t=0;t<e;++t)if(this.words[t]!=r.words[t])return!1;if(this.words.length<r.words.length){const t=r.words.length;for(let n=this.words.length;n<t;++n)if(r.words[n]!=0)return!1}else if(r.words.length<this.words.length){const t=this.words.length;for(let n=r.words.length;n<t;++n)if(this.words[n]!=0)return!1}return!0},R.prototype.difference=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]&=~r.words[t],this.words[t+1]&=~r.words[t+1],this.words[t+2]&=~r.words[t+2],this.words[t+3]&=~r.words[t+3],this.words[t+4]&=~r.words[t+4],this.words[t+5]&=~r.words[t+5],this.words[t+6]&=~r.words[t+6],this.words[t+7]&=~r.words[t+7];for(;t<e;++t)this.words[t]&=~r.words[t];return this},R.prototype.new_difference=function(r){return this.clone().difference(r)},R.prototype.difference2=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)r.words[t]=this.words[t]&~r.words[t],r.words[t+1]=this.words[t+1]&~r.words[t+1],r.words[t+2]=this.words[t+2]&~r.words[t+2],r.words[t+3]=this.words[t+3]&~r.words[t+3],r.words[t+4]=this.words[t+4]&~r.words[t+4],r.words[t+5]=this.words[t+5]&~r.words[t+5],r.words[t+6]=this.words[t+6]&~r.words[t+6],r.words[t+7]=this.words[t+7]&~r.words[t+7];for(;t<e;++t)r.words[t]=this.words[t]&~r.words[t];for(t=this.words.length-1;t>=e;--t)r.words[t]=this.words[t];return r.words.length=this.words.length,r},R.prototype.difference_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0,n=0;for(;n<e;++n)t+=this.hammingWeight(this.words[n]&~r.words[n]);const i=this.words.length;for(;n<i;++n)t+=this.hammingWeight(this.words[n]);return t},R.prototype.change=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]^=r.words[t],this.words[t+1]^=r.words[t+1],this.words[t+2]^=r.words[t+2],this.words[t+3]^=r.words[t+3],this.words[t+4]^=r.words[t+4],this.words[t+5]^=r.words[t+5],this.words[t+6]^=r.words[t+6],this.words[t+7]^=r.words[t+7];for(;t<e;++t)this.words[t]^=r.words[t];for(t=r.words.length-1;t>=e;--t)this.words[t]=r.words[t];return this},R.prototype.new_change=function(r){const e=Object.create(R.prototype),t=Math.max(this.words.length,r.words.length);e.words=new Array(t);const n=Math.min(this.words.length,r.words.length);let i=0;for(;i+7<n;i+=8)e.words[i]=this.words[i]^r.words[i],e.words[i+1]=this.words[i+1]^r.words[i+1],e.words[i+2]=this.words[i+2]^r.words[i+2],e.words[i+3]=this.words[i+3]^r.words[i+3],e.words[i+4]=this.words[i+4]^r.words[i+4],e.words[i+5]=this.words[i+5]^r.words[i+5],e.words[i+6]=this.words[i+6]^r.words[i+6],e.words[i+7]=this.words[i+7]^r.words[i+7];for(;i<n;++i)e.words[i]=this.words[i]^r.words[i];const s=this.words.length;for(i=n;i<s;++i)e.words[i]=this.words[i];const o=r.words.length;for(i=n;i<o;++i)e.words[i]=r.words[i];return e},R.prototype.change_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0,n=0;for(;n<e;++n)t+=this.hammingWeight(this.words[n]^r.words[n]);const i=this.words.length>r.words.length?this:r,s=i.words.length;for(;n<s;++n)t+=this.hammingWeight(i.words[n]);return t},R.prototype.toString=function(){return"{"+this.array().join(",")+"}"},R.prototype.union=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]|=r.words[t],this.words[t+1]|=r.words[t+1],this.words[t+2]|=r.words[t+2],this.words[t+3]|=r.words[t+3],this.words[t+4]|=r.words[t+4],this.words[t+5]|=r.words[t+5],this.words[t+6]|=r.words[t+6],this.words[t+7]|=r.words[t+7];for(;t<e;++t)this.words[t]|=r.words[t];if(this.words.length<r.words.length){this.resize((r.words.length<<5)-1);const n=r.words.length;for(let i=e;i<n;++i)this.words[i]=r.words[i]}return this},R.prototype.new_union=function(r){const e=Object.create(R.prototype),t=Math.max(this.words.length,r.words.length);e.words=new Array(t);const n=Math.min(this.words.length,r.words.length);let i=0;for(;i+7<n;i+=8)e.words[i]=this.words[i]|r.words[i],e.words[i+1]=this.words[i+1]|r.words[i+1],e.words[i+2]=this.words[i+2]|r.words[i+2],e.words[i+3]=this.words[i+3]|r.words[i+3],e.words[i+4]=this.words[i+4]|r.words[i+4],e.words[i+5]=this.words[i+5]|r.words[i+5],e.words[i+6]=this.words[i+6]|r.words[i+6],e.words[i+7]=this.words[i+7]|r.words[i+7];for(;i<n;++i)e.words[i]=this.words[i]|r.words[i];const s=this.words.length;for(i=n;i<s;++i)e.words[i]=this.words[i];const o=r.words.length;for(i=n;i<o;++i)e.words[i]=r.words[i];return e},R.prototype.union_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(let n=0;n<e;++n)t+=this.hammingWeight(this.words[n]|r.words[n]);if(this.words.length<r.words.length){const n=r.words.length;for(let i=this.words.length;i<n;++i)t+=this.hammingWeight(0|r.words[i])}else{const n=this.words.length;for(let i=r.words.length;i<n;++i)t+=this.hammingWeight(0|this.words[i])}return t};var ae=R;function Kt(){return Kt=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Kt.apply(this,arguments)}function Mo(r,e){var t=[];return r.forEach(function(n){e.forEach(function(i){t.push(n.concat(i))})}),t}function Bn(r){return!!~r.search(/\(|\)/)}function on(r,e){for(var t=e.split(" "+r+" "),n=[],i=[],s=0;s<t.length;s++)if(Bn(t[s])||i.length>0){i.push(t[s]);var o=""+i;(o.match(/\(/g)||[]).length===(o.match(/\)/g)||[]).length&&(n.push(i.join(" "+r+" ")),i=[])}else n.push(t[s]);return n}var ko=function r(e){return function(n){for(var i=n[0],s=1;s<n.length;s++)i=i.concat(n[s]);return i}(on("OR",(t=e=function(n){if(n.charAt(0)==="("){for(var i=0,s=0;s<n.length;s++)if(n.charAt(s)==="("?i++:n.charAt(s)===")"&&i--,i===0)return s!==n.length-1?n:n.substring(1,n.length-1)}return n}(e),e=t.replace(/[\s]+/g," "))).map(function(n){for(var i=on("AND",n),s=[],o=[],a=0;a<i.length;a++)Bn(i[a])?s.push(r(i[a])):o.push(i[a]);return s.push([o]),function(c){for(var d=[[]],f=0;f<c.length;f++)d=Mo(d,c[f]);return d}(s)}));var t};const an=function(r){try{return structuredClone(r)}catch{try{return JSON.parse(JSON.stringify(r))}catch{return r}}},ln=function(r,e){let t=new ae([]),n=0;return T(e,function(i,s){i.forEach(o=>{++n,t=t.new_union(r[s][o]||new ae([]))})}),n===0?null:t},Ao=function(r,e,t){let n=1;return T(r.bits_data_temp,(i,s)=>{let o,a,c,d,f,v,w;t[s]&&(o=t[s].order,a=t[s].sort,c=t[s].size,d=t[s].title,f=t[s].show_facet_stats||!1,v=t[s].chosen_filters_on_top!==!1,w=t[s].hide_zero_doc_count||!1);let h,b,x,C,O=Object.entries(i).map(z=>{let G=[];e&&e.filters&&e.filters[s]&&(G=e.filters[s]);const F=z[1].array().length;if(!w||F!==0||G.indexOf(z[0])!==-1)return{key:z[0],doc_count:F,selected:G.indexOf(z[0])!==-1}}).filter(Boolean);var N,$;return se(a)?(h=a||["key"],b=o||["asc"]):(a==="term"||a==="key"?(h=["key"],b=[o||"asc"]):(h=["doc_count","key"],b=[o||"desc","asc"]),v&&(h.unshift("selected"),b.unshift("desc"))),O=ur(O,h,b),O=O.slice(0,c||10),f&&(x=[],Object.entries(i).forEach(z=>{if(isNaN(z[0]))throw new Error("You cant use chars to calculate the facet_stats.");z[1].array().length>0&&z[1].forEach(()=>{x.push(parseInt(z[0]))})}),C={min:(N=x,N&&N.length?$n(N,De(void 0),bo):void 0),max:xo(x),avg:_o(x),sum:Eo(x)}),Kt({name:s,title:d||($=s,$.replace(/^[\s_]+|[\s_]+$/g,"").replace(/[_\s]+/g," ").replace(/^[a-z]/,function(z){return z.toUpperCase()})),position:n++,buckets:O},f&&{facet_stats:C})})};function cn(r,e,t,n,i){e=e||Object.create(null);const s=parseInt(e.per_page||12),o=parseInt(e.page||1),a=e.is_all_filtered_items||!1;if(t.native_search_enabled===!1&&(e.query||e.filter))throw new Error('"query" and "filter" options are not working once native search is disabled');let c=0;const d=new Date().getTime();let f,v,w,h=i.bits_ids();if(e._ids)f=new ae(e._ids),v=e._ids;else if(e.ids)v=i.internal_ids_from_ids_map(e.ids),f=new ae(v);else if(n&&(e.query||e.filter)){const F=new Date().getTime();v=n.search(e.query,e.filter),c=new Date().getTime()-F,f=new ae(v)}let b=new Date().getTime();const x=i.search(e,{query_ids:f});b=new Date().getTime()-b,f&&(h=f),x.ids&&(h=h.new_intersection(x.ids)),x.not_ids&&(h=h.new_difference(x.not_ids));let C=h.array(),O=C.map(F=>i.get_item(F)),N=!1;const $=new Date().getTime();let z=0;e.sort?O=function(F,P,X){return X&&X[P]&&(P=X[P]),P.field?ur(F,P.field,P.order||"asc"):F}(O,e.sort,t.sortings):v&&(C=v.filter(F=>h.has(F)),O=C.slice((o-1)*s,o*s).map(F=>i.get_item(F)),N=!0),N||(w=a?O:null,O=O.slice((o-1)*s,o*s)),z=new Date().getTime()-$;const G=new Date().getTime()-d;return{pagination:{per_page:s,page:o,total:C.length},timings:{total:G,facets:b,search:c,sorting:z},data:{items:O,allFilteredItems:w,aggregations:Ao(x,e,t.aggregations)}}}var gt=function(r){var e={exports:{}};return function(t,n){(function(){var i,s,o,a,c,d,f,v,w,h,b,x,C,O,N,$,z,G,F,P,X,ce,we,te,le,ue,ge,de,y=function(l){var p=new y.Index;return p.pipeline.add(y.trimmer,y.stopWordFilter,y.stemmer),l&&l.call(p,p),p};y.version="1.0.0",y.utils={},y.utils.warn=function(l){return function(p){l.console&&console.warn&&console.warn(p)}}(this),y.utils.asString=function(l){return l==null?"":l.toString()},y.EventEmitter=function(){this.events={}},y.EventEmitter.prototype.addListener=function(){var l=Array.prototype.slice.call(arguments),p=l.pop(),_=l;if(typeof p!="function")throw new TypeError("last argument must be a function");_.forEach(function(E){this.hasHandler(E)||(this.events[E]=[]),this.events[E].push(p)},this)},y.EventEmitter.prototype.removeListener=function(l,p){if(this.hasHandler(l)){var _=this.events[l].indexOf(p);this.events[l].splice(_,1),this.events[l].length||delete this.events[l]}},y.EventEmitter.prototype.emit=function(l){if(this.hasHandler(l)){var p=Array.prototype.slice.call(arguments,1);this.events[l].forEach(function(_){_.apply(void 0,p)})}},y.EventEmitter.prototype.hasHandler=function(l){return l in this.events},y.tokenizer=function(l){return arguments.length&&l!=null&&l!=null?Array.isArray(l)?l.map(function(p){return y.utils.asString(p).toLowerCase()}):l.toString().trim().toLowerCase().split(y.tokenizer.separator):[]},y.tokenizer.separator=/[\s\-]+/,y.tokenizer.load=function(l){var p=this.registeredFunctions[l];if(!p)throw new Error("Cannot load un-registered function: "+l);return p},y.tokenizer.label="default",y.tokenizer.registeredFunctions={default:y.tokenizer},y.tokenizer.registerFunction=function(l,p){p in this.registeredFunctions&&y.utils.warn("Overwriting existing tokenizer: "+p),l.label=p,this.registeredFunctions[p]=l},y.Pipeline=function(){this._stack=[]},y.Pipeline.registeredFunctions={},y.Pipeline.registerFunction=function(l,p){p in this.registeredFunctions&&y.utils.warn("Overwriting existing registered function: "+p),l.label=p,y.Pipeline.registeredFunctions[l.label]=l},y.Pipeline.warnIfFunctionNotRegistered=function(l){l.label&&l.label in this.registeredFunctions||y.utils.warn(`Function is not registered with pipeline. This may cause problems when serialising the index.
`,l)},y.Pipeline.load=function(l){var p=new y.Pipeline;return l.forEach(function(_){var E=y.Pipeline.registeredFunctions[_];if(!E)throw new Error("Cannot load un-registered function: "+_);p.add(E)}),p},y.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(l){y.Pipeline.warnIfFunctionNotRegistered(l),this._stack.push(l)},this)},y.Pipeline.prototype.after=function(l,p){y.Pipeline.warnIfFunctionNotRegistered(p);var _=this._stack.indexOf(l);if(_==-1)throw new Error("Cannot find existingFn");this._stack.splice(_+=1,0,p)},y.Pipeline.prototype.before=function(l,p){y.Pipeline.warnIfFunctionNotRegistered(p);var _=this._stack.indexOf(l);if(_==-1)throw new Error("Cannot find existingFn");this._stack.splice(_,0,p)},y.Pipeline.prototype.remove=function(l){var p=this._stack.indexOf(l);p!=-1&&this._stack.splice(p,1)},y.Pipeline.prototype.run=function(l){for(var p=[],_=l.length,E=this._stack.length,A=0;A<_;A++){for(var j=l[A],D=0;D<E&&(j=this._stack[D](j,A,l))!==void 0&&j!=="";D++);j!==void 0&&j!==""&&p.push(j)}return p},y.Pipeline.prototype.reset=function(){this._stack=[]},y.Pipeline.prototype.toJSON=function(){return this._stack.map(function(l){return y.Pipeline.warnIfFunctionNotRegistered(l),l.label})},y.Vector=function(){this._magnitude=null,this.list=void 0,this.length=0},y.Vector.Node=function(l,p,_){this.idx=l,this.val=p,this.next=_},y.Vector.prototype.insert=function(l,p){this._magnitude=void 0;var _=this.list;if(!_)return this.list=new y.Vector.Node(l,p,_),this.length++;if(l<_.idx)return this.list=new y.Vector.Node(l,p,_),this.length++;for(var E=_,A=_.next;A!=null;){if(l<A.idx)return E.next=new y.Vector.Node(l,p,A),this.length++;E=A,A=A.next}return E.next=new y.Vector.Node(l,p,A),this.length++},y.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var l,p=this.list,_=0;p;)_+=(l=p.val)*l,p=p.next;return this._magnitude=Math.sqrt(_)},y.Vector.prototype.dot=function(l){for(var p=this.list,_=l.list,E=0;p&&_;)p.idx<_.idx?p=p.next:(p.idx>_.idx||(E+=p.val*_.val,p=p.next),_=_.next);return E},y.Vector.prototype.similarity=function(l){return this.dot(l)/(this.magnitude()*l.magnitude())},y.SortedSet=function(){this.length=0,this.elements=[]},y.SortedSet.load=function(l){var p=new this;return p.elements=l,p.length=l.length,p},y.SortedSet.prototype.add=function(){var l,p;for(l=0;l<arguments.length;l++)~this.indexOf(p=arguments[l])||this.elements.splice(this.locationFor(p),0,p);this.length=this.elements.length},y.SortedSet.prototype.toArray=function(){return this.elements.slice()},y.SortedSet.prototype.map=function(l,p){return this.elements.map(l,p)},y.SortedSet.prototype.forEach=function(l,p){return this.elements.forEach(l,p)},y.SortedSet.prototype.indexOf=function(l){for(var p=0,_=this.elements.length,E=_-p,A=p+Math.floor(E/2),j=this.elements[A];E>1;){if(j===l)return A;j<l&&(p=A),j>l&&(_=A),E=_-p,A=p+Math.floor(E/2),j=this.elements[A]}return j===l?A:-1},y.SortedSet.prototype.locationFor=function(l){for(var p=0,_=this.elements.length,E=_-p,A=p+Math.floor(E/2),j=this.elements[A];E>1;)j<l&&(p=A),j>l&&(_=A),E=_-p,A=p+Math.floor(E/2),j=this.elements[A];return j>l?A:j<l?A+1:void 0},y.SortedSet.prototype.intersect=function(l){for(var p=new y.SortedSet,_=0,E=0,A=this.length,j=l.length,D=this.elements,Z=l.elements;!(_>A-1||E>j-1);)D[_]!==Z[E]?D[_]<Z[E]?_++:D[_]>Z[E]&&E++:(p.add(D[_]),_++,E++);return p},y.SortedSet.prototype.clone=function(){var l=new y.SortedSet;return l.elements=this.toArray(),l.length=l.elements.length,l},y.SortedSet.prototype.union=function(l){var p,_,E;this.length>=l.length?(p=this,_=l):(p=l,_=this),E=p.clone();for(var A=0,j=_.toArray();A<j.length;A++)E.add(j[A]);return E},y.SortedSet.prototype.toJSON=function(){return this.toArray()},y.Index=function(){this._fields=[],this._ref="id",this.pipeline=new y.Pipeline,this.documentStore=new y.Store,this.tokenStore=new y.TokenStore,this.corpusTokens=new y.SortedSet,this.eventEmitter=new y.EventEmitter,this.tokenizerFn=y.tokenizer,this._idfCache={},this.on("add","remove","update",(function(){this._idfCache={}}).bind(this))},y.Index.prototype.on=function(){var l=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,l)},y.Index.prototype.off=function(l,p){return this.eventEmitter.removeListener(l,p)},y.Index.load=function(l){l.version!==y.version&&y.utils.warn("version mismatch: current "+y.version+" importing "+l.version);var p=new this;return p._fields=l.fields,p._ref=l.ref,p.tokenizer(y.tokenizer.load(l.tokenizer)),p.documentStore=y.Store.load(l.documentStore),p.tokenStore=y.TokenStore.load(l.tokenStore),p.corpusTokens=y.SortedSet.load(l.corpusTokens),p.pipeline=y.Pipeline.load(l.pipeline),p},y.Index.prototype.field=function(l,p){return this._fields.push({name:l,boost:(p=p||{}).boost||1}),this},y.Index.prototype.ref=function(l){return this._ref=l,this},y.Index.prototype.tokenizer=function(l){return l.label&&l.label in y.tokenizer.registeredFunctions||y.utils.warn("Function is not a registered tokenizer. This may cause problems when serialising the index"),this.tokenizerFn=l,this},y.Index.prototype.add=function(l,p){var _={},E=new y.SortedSet,A=l[this._ref];p=p===void 0||p,this._fields.forEach(function(Be){var ke=this.pipeline.run(this.tokenizerFn(l[Be.name]));_[Be.name]=ke;for(var Ae=0;Ae<ke.length;Ae++){var je=ke[Ae];E.add(je),this.corpusTokens.add(je)}},this),this.documentStore.set(A,E);for(var j=0;j<E.length;j++){for(var D=E.elements[j],Z=0,B=0;B<this._fields.length;B++){var ye=this._fields[B],Fe=_[ye.name],he=Fe.length;if(he){for(var be=0,Se=0;Se<he;Se++)Fe[Se]===D&&be++;Z+=be/he*ye.boost}}this.tokenStore.add(D,{ref:A,tf:Z})}p&&this.eventEmitter.emit("add",l,this)},y.Index.prototype.remove=function(l,p){var _=l[this._ref];if(p=p===void 0||p,this.documentStore.has(_)){var E=this.documentStore.get(_);this.documentStore.remove(_),E.forEach(function(A){this.tokenStore.remove(A,_)},this),p&&this.eventEmitter.emit("remove",l,this)}},y.Index.prototype.update=function(l,p){p=p===void 0||p,this.remove(l,!1),this.add(l,!1),p&&this.eventEmitter.emit("update",l,this)},y.Index.prototype.idf=function(l){var p="@"+l;if(Object.prototype.hasOwnProperty.call(this._idfCache,p))return this._idfCache[p];var _=this.tokenStore.count(l),E=1;return _>0&&(E=1+Math.log(this.documentStore.length/_)),this._idfCache[p]=E},y.Index.prototype.search=function(l){var p=this.pipeline.run(this.tokenizerFn(l)),_=new y.Vector,E=[],A=this._fields.reduce(function(j,D){return j+D.boost},0);return p.some(function(j){return this.tokenStore.has(j)},this)?(p.forEach(function(j,D,Z){var B=1/Z.length*this._fields.length*A,ye=this,Fe=this.tokenStore.expand(j).reduce(function(he,be){var Se=ye.corpusTokens.indexOf(be),Be=ye.idf(be),ke=1,Ae=new y.SortedSet;if(be!==j){var je=Math.max(3,be.length-j.length);ke=1/Math.log(je)}Se>-1&&_.insert(Se,B*Be*ke);for(var Ue=ye.tokenStore.get(be),ot=Object.keys(Ue),At=ot.length,Qe=0;Qe<At;Qe++)Ae.add(Ue[ot[Qe]].ref);return he.union(Ae)},new y.SortedSet);E.push(Fe)},this),E.reduce(function(j,D){return j.intersect(D)}).map(function(j){return{ref:j,score:_.similarity(this.documentVector(j))}},this).sort(function(j,D){return D.score-j.score})):[]},y.Index.prototype.documentVector=function(l){for(var p=this.documentStore.get(l),_=p.length,E=new y.Vector,A=0;A<_;A++){var j=p.elements[A],D=this.tokenStore.get(j)[l].tf,Z=this.idf(j);E.insert(this.corpusTokens.indexOf(j),D*Z)}return E},y.Index.prototype.toJSON=function(){return{version:y.version,fields:this._fields,ref:this._ref,tokenizer:this.tokenizerFn.label,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},y.Index.prototype.use=function(l){var p=Array.prototype.slice.call(arguments,1);p.unshift(this),l.apply(this,p)},y.Store=function(){this.store={},this.length=0},y.Store.load=function(l){var p=new this;return p.length=l.length,p.store=Object.keys(l.store).reduce(function(_,E){return _[E]=y.SortedSet.load(l.store[E]),_},{}),p},y.Store.prototype.set=function(l,p){this.has(l)||this.length++,this.store[l]=p},y.Store.prototype.get=function(l){return this.store[l]},y.Store.prototype.has=function(l){return l in this.store},y.Store.prototype.remove=function(l){this.has(l)&&(delete this.store[l],this.length--)},y.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},y.stemmer=(i={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},s={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},d="^("+(a="[^aeiou][^aeiouy]*")+")?"+(c=(o="[aeiouy]")+"[aeiou]*")+a+"("+c+")?$",f="^("+a+")?"+c+a+c+a,v="^("+a+")?"+o,w=new RegExp("^("+a+")?"+c+a),h=new RegExp(f),b=new RegExp(d),x=new RegExp(v),C=/^(.+?)(ss|i)es$/,O=/^(.+?)([^s])s$/,N=/^(.+?)eed$/,$=/^(.+?)(ed|ing)$/,z=/.$/,G=/(at|bl|iz)$/,F=new RegExp("([^aeiouylsz])\\1$"),P=new RegExp("^"+a+o+"[^aeiouwxy]$"),X=/^(.+?[^aeiou])y$/,ce=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,we=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,te=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,le=/^(.+?)(s|t)(ion)$/,ue=/^(.+?)e$/,ge=/ll$/,de=new RegExp("^"+a+o+"[^aeiouwxy]$"),function(l){var p,_,E,A,j,D,Z;if(l.length<3)return l;if((E=l.substr(0,1))=="y"&&(l=E.toUpperCase()+l.substr(1)),j=O,(A=C).test(l)?l=l.replace(A,"$1$2"):j.test(l)&&(l=l.replace(j,"$1$2")),j=$,(A=N).test(l)){var B=A.exec(l);(A=w).test(B[1])&&(l=l.replace(A=z,""))}else j.test(l)&&(B=j.exec(l),(j=x).test(p=B[1])&&(D=F,Z=P,(j=G).test(l=p)?l+="e":D.test(l)?l=l.replace(A=z,""):Z.test(l)&&(l+="e")));return(A=X).test(l)&&(l=(p=(B=A.exec(l))[1])+"i"),(A=ce).test(l)&&(_=(B=A.exec(l))[2],(A=w).test(p=B[1])&&(l=p+i[_])),(A=we).test(l)&&(_=(B=A.exec(l))[2],(A=w).test(p=B[1])&&(l=p+s[_])),j=le,(A=te).test(l)?(B=A.exec(l),(A=h).test(p=B[1])&&(l=p)):j.test(l)&&(B=j.exec(l),(j=h).test(p=B[1]+B[2])&&(l=p)),(A=ue).test(l)&&(B=A.exec(l),j=b,D=de,((A=h).test(p=B[1])||j.test(p)&&!D.test(p))&&(l=p)),j=h,(A=ge).test(l)&&j.test(l)&&(l=l.replace(A=z,"")),E=="y"&&(l=E.toLowerCase()+l.substr(1)),l}),y.Pipeline.registerFunction(y.stemmer,"stemmer"),y.generateStopWordFilter=function(l){var p=l.reduce(function(_,E){return _[E]=E,_},{});return function(_){if(_&&p[_]!==_)return _}},y.stopWordFilter=y.generateStopWordFilter(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]),y.Pipeline.registerFunction(y.stopWordFilter,"stopWordFilter"),y.trimmer=function(l){return l.replace(/^\W+/,"").replace(/\W+$/,"")},y.Pipeline.registerFunction(y.trimmer,"trimmer"),y.TokenStore=function(){this.root={docs:{}},this.length=0},y.TokenStore.load=function(l){var p=new this;return p.root=l.root,p.length=l.length,p},y.TokenStore.prototype.add=function(l,p,_){_=_||this.root;var E=l.charAt(0),A=l.slice(1);return E in _||(_[E]={docs:{}}),A.length===0?(_[E].docs[p.ref]=p,void(this.length+=1)):this.add(A,p,_[E])},y.TokenStore.prototype.has=function(l){if(!l)return!1;for(var p=this.root,_=0;_<l.length;_++){if(!p[l.charAt(_)])return!1;p=p[l.charAt(_)]}return!0},y.TokenStore.prototype.getNode=function(l){if(!l)return{};for(var p=this.root,_=0;_<l.length;_++){if(!p[l.charAt(_)])return{};p=p[l.charAt(_)]}return p},y.TokenStore.prototype.get=function(l,p){return this.getNode(l,p).docs||{}},y.TokenStore.prototype.count=function(l,p){return Object.keys(this.get(l,p)).length},y.TokenStore.prototype.remove=function(l,p){if(l){for(var _=this.root,E=0;E<l.length;E++){if(!(l.charAt(E)in _))return;_=_[l.charAt(E)]}delete _.docs[p]}},y.TokenStore.prototype.expand=function(l,p){var _=this.getNode(l);return p=p||[],Object.keys(_.docs||{}).length&&p.push(l),Object.keys(_).forEach(function(E){E!=="docs"&&p.concat(this.expand(l+E,p))},this),p},y.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}},t.exports=y})()}(e),e.exports}();class un{constructor(e,t){this.store=new Map,this.idx=gt(function(){this.field("name",{boost:10}),((t==null?void 0:t.searchableFields)||[]).forEach(i=>this.field(i)),this.ref("_id"),t!=null&&t.isExactSearch&&(this.pipeline.remove(gt.stemmer),this.pipeline.remove(gt.stopWordFilter)),t!=null&&t.removeStopWordFilter&&this.pipeline.remove(gt.stopWordFilter)});let n=1;(e||[]).map(i=>{i._id=n,++n,this.idx.add(i),this.store.set(i._id,i)})}search_full(e,t){return this.search(e,t).map(n=>this.store.get(n))}search(e,t){return t instanceof Function?(e?this.idx.search(e).map(n=>this.store.get(n.ref)):[...this.store.values()]).filter(t).map(n=>n._id):e?this.idx.search(e).map(n=>n.ref):[...this.store.keys()]}}class dn{constructor(e,t){(t=t||Object.create(null)).aggregations=t.aggregations||Object.create(null),this._items=e,this.config=t.aggregations,this.facets=function(o,a){a=a||[];const c={data:Object.create(null),bits_data:Object.create(null),bits_data_temp:Object.create(null)};let d=1;return a.forEach(f=>{c.data[f]=Object.create(null)}),o&&o.map(f=>(f._id||(f._id=d,++d),f)),o&&o.map(f=>(a.forEach(v=>{if(f){if(Array.isArray(f[v]))f[v].forEach(w=>{f[v]&&(c.data[v][w]||(c.data[v][w]=[]),c.data[v][w].push(parseInt(f._id)))});else if(f[v]!==void 0){const w=f[v];c.data[v][w]||(c.data[v][w]=[]),c.data[v][w].push(parseInt(f._id))}}}),f)),c.data=T(c.data,function(f,v){return c.bits_data[v]||(c.bits_data[v]=Object.create(null),c.bits_data_temp[v]=Object.create(null)),T(f,function(w,h){const b=Co(w);return c.bits_data[v][h]=new ae(b),b})}),c}(e,st(t.aggregations)),this._items_map=Object.create(null),this._ids=[];let n=1;var i,s;s=o=>{this._ids.push(n),this._items_map[n]=o,o._id=n,++n},(se(i=e)?He:zn)(i,De(s)),this.ids_map=Object.create(null),e&&e.forEach(o=>{const a=t.custom_id_field||"id";o[a]&&o._id&&(this.ids_map[o[a]]=o._id)}),this._bits_ids=new ae(this._ids)}items(){return this._items}bits_ids(e){return e?new ae(e):this._bits_ids}internal_ids_from_ids_map(e){return e.map(t=>this.ids_map[t])}index(){return this.facets}get_item(e){return this._items_map[e]}search(e,t){const n=this.config;t=t||Object.create(null);const i=Ut(this.facets);let s;i.not_ids=ln(i.bits_data,e.not_filters);const o=function(a,c){const d=[];return T(a.filters,function(f,v){if(f&&f.length)if(c[v].conjunction!==!1)T(f,function(w){d.push([v,w])});else{const w=[];T(f,function(h){w.push([v,h])}),d.push(w)}}),T(a.not_filters,function(f,v){f&&f.length&&T(f,function(w){d.push([v,"-",w])})}),d}(e,n);return s=function(a,c){const d=Ut(a);let f;c=c||[],T(d.bits_data,function(w,h){T(d.bits_data[h],function(b,x){d.bits_data_temp[h][x]=d.bits_data[h][x]})}),d.is_temp_copied=!0;const v=function(w,h){const b=Object.create(null);return T(h,function(x){if(Array.isArray(x[0])){let C=new ae([]);T(x,function(O){const N=O[0];C=C.new_union(w.bits_data[N][O[1]]||new ae([])),b[N]=C})}}),b}(a,c);return T(c,function(w){if(!Array.isArray(w[0])){const h=w[0],b=w[1];f=f&&d.bits_data_temp[h][b]?d.bits_data_temp[h][b].new_intersection(f):f&&!d.bits_data_temp[h][b]?new ae([]):d.bits_data_temp[h][b]}}),f&&T(d.bits_data_temp,function(w,h){T(d.bits_data_temp[h],function(b,x){d.bits_data_temp[h][x]=d.bits_data_temp[h][x].new_intersection(f)})}),T(c,function(w){if(w.length===3&&w[1]==="-"){const h=d.bits_data_temp[w[0]][w[2]].clone();T(d.bits_data_temp,function(b,x){T(d.bits_data_temp[x],function(C,O){d.bits_data_temp[x][O]=d.bits_data_temp[x][O].new_difference(h)})})}}),T(d.bits_data_temp,function(w,h){T(d.bits_data_temp[h],function(b,x){T(v,function(C,O){O!==h&&(d.bits_data_temp[h][x]=d.bits_data_temp[h][x].new_intersection(C))})})}),d}(this.facets,o),e.filters_query&&(s=function(a,c){const d=Ut(a);d.is_temp_copied||T(d.bits_data,function(v,w){T(d.bits_data[w],function(h,b){d.bits_data_temp[w][b]=d.bits_data[w][b]})});let f=null;return T(c,function(v){let w=null;T(v,function(h){const b=h[0],x=h[1];if(!d.bits_data_temp[b])throw new Error("Panic. The key does not exist in facets lists.");w=w&&d.bits_data_temp[b][x]?d.bits_data_temp[b][x].new_intersection(w):w&&!d.bits_data_temp[b][x]?new ae([]):d.bits_data_temp[b][x]}),f=(f||new ae([])).new_union(w||new ae([]))}),f!==null&&T(d.bits_data_temp,function(v,w){T(d.bits_data_temp[w],function(h,b){d.bits_data_temp[w][b]=d.bits_data_temp[w][b].new_intersection(f)})}),d}(s,ko(e.filters_query).map(a=>Array.isArray(a)?a.map(c=>Array.isArray(c)?c.map(d=>d):c.split(":")):a.split(":")))),i.bits_data_temp=s.bits_data_temp,T(i.bits_data_temp,function(a,c){T(i.bits_data_temp[c],function(d,f){t.query_ids&&(i.bits_data_temp[c][f]=t.query_ids.new_intersection(i.bits_data_temp[c][f])),t.test&&(i.data[c][f]=i.bits_data_temp[c][f].array())})}),i.ids=e.filters_query?function(a){let c=new ae([]);return T(a,function(d,f){T(a[f],function(v,w){c=c.new_union(a[f][w])})}),c}(i.bits_data_temp):ln(i.bits_data_temp,e.filters),i}}function jo(r,e){let t;(e=e||Object.create(null)).native_search_enabled!==!1&&(t=new un(r,e));let n=new dn(r,e);return{search:function(i){return(i=i||Object.create(null)).aggregations=function(s,o){return T(an(s),(a,c)=>{a.field||(a.field=c);let d=[];o.filters&&o.filters[c]&&(d=o.filters[c]),a.filters=d;let f=[];return o.not_filters&&o.not_filters[c]&&(f=o.not_filters[c]),o.exclude_filters&&o.exclude_filters[c]&&(f=o.exclude_filters[c]),a.not_filters=f,a})}(e.aggregations,i),cn(0,i,e,t,n)},similar:function(i,s){return function(o,a,c){const d=c.per_page||10,f=c.minimum||0,v=c.page||1;let w;for(let x=0;x<o.length;++x)if(o[x].id==a){w=o[x];break}if(!c.field)throw new Error("Please define field in options");const h=c.field;let b=[];for(let x=0;x<o.length;++x)if(o[x].id!==a){const C=yo(w[h],o[x][h]);C.length>=f&&(b.push(o[x]),b[b.length-1].intersection_length=C.length)}return b=ur(b,["intersection_length"],["desc"]),{pagination:{per_page:d,page:v,total:b.length},data:{items:b.slice((v-1)*d,v*d)}}}(r,i,s)},aggregation:function(i){return function(s,o,a,c,d){const f=o.per_page||10,v=o.page||1;if(o.name&&(!a.aggregations||!a.aggregations[o.name]))throw new Error('Please define aggregation "'.concat(o.name,'" in config'));const w=an(o);if(w.page=1,w.per_page=0,!o.name)throw new Error("field name is required");a.aggregations[o.name].size=1e4;const h=cn(0,w,a,c,d).data.aggregations[o.name].buckets;return{pagination:{per_page:f,page:v,total:h.length},data:{buckets:h.slice((v-1)*f,v*f)}}}(0,i,e,t,n)},reindex:function(i){t=new un(r=i,e),n=new dn(r,e)}}}class Lo{constructor(e){this.config=e,this.state={query:"",filters:{},sort:"",bounds:null},this.state.sort=this.config.searchConfig.defaultSort,this.state.filters=this.createEmptyFilters()}createEmptyFilters(){const e={};for(const[t]of Object.entries(this.config.aggregations))e[t]=[];return e}hasActiveFilters(){if(!this.state.filters)return!1;for(const[e,t]of Object.entries(this.state.filters))if(Array.isArray(t)&&t.length>0||!Array.isArray(t)&&t)return!0;return!1}updateFilters(e,t,n){var i;console.log(`Updating filter: ${e}, value: ${t}, checked: ${n}`),n?(this.state.filters[e]||(this.state.filters[e]=[]),this.state.filters[e].includes(t)||this.state.filters[e].push(t)):this.state.filters[e]=((i=this.state.filters[e])==null?void 0:i.filter(s=>s!==t))||[]}async handleStateChange(e,t){console.log("handleStateChange called with action:",e);try{switch(e.type){case"FACET_CHANGE":this.updateFilters(e.facetType,e.value,e.checked);break;case"RANGE_CHANGE":this.state.filters[e.facetKey]=e.value;break;case"QUERY_CHANGE":this.state.query=e.query;break;case"SORT_CHANGE":this.state.sort=e.sort;break}console.log("State updated, triggering search. New state:",this.state),t&&t.onStateChange&&await t.onStateChange(this.state)}catch(n){console.error("Error in handleStateChange:",n)}}getState(){return this.state}setState(e){this.state={...this.state,...e}}}class Oo{static debounce(e,t){let n;return function(){clearTimeout(n),n=setTimeout(()=>e.apply(this,arguments),t)}}static parseCoordinates(e){if(!e||typeof e!="string")return{lat:null,lng:null};const t=e.split(",");return t.length===2?{lat:parseFloat(t[0].trim()),lng:parseFloat(t[1].trim())}:{lat:null,lng:null}}static encodeForAttribute(e){return encodeURIComponent(e||"")}static createUniqueId(e="element"){return`${e}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}static isEmpty(e){return e==null?!0:typeof e=="string"?e.trim()==="":Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1}}class Fo{constructor(e,t){this.searchHandler=e,this.config=t,this.isLoading=!1,this.debouncedSearch=Oo.debounce(async(n,i)=>{await this.performSearch(n,i)},300)}async performSearch(e,t){var n;try{const i=this.searchHandler.performSearch(e,{onMarkersUpdate:t.onMarkersUpdate,onResultsUpdate:t.onResultsUpdate,onAggregationsUpdate:t.onAggregationsUpdate}),s=this.calculateUniqueResultsCount(i.items);return t.onNavBarUpdate&&t.onNavBarUpdate(i.items||[]),console.log("Search completed:",((n=i.items)==null?void 0:n.length)||0,"items found"),i}catch(i){console.error("Search error:",i),t.onError&&t.onError("Search failed","error")}}calculateUniqueResultsCount(e){if(!e||!Array.isArray(e))return 0;const t=new Set;return e.forEach(n=>{var s,o,a,c,d,f;const i=n.pivot_ID||n.pivotID||n.pivot_id||((s=n._source)==null?void 0:s.pivot_ID)||((o=n._source)==null?void 0:o.pivotID)||((a=n._source)==null?void 0:a.pivot_id)||((c=n.source)==null?void 0:c.pivot_ID)||((d=n.source)==null?void 0:d.pivotID)||((f=n.source)==null?void 0:f.pivot_id);i!=null&&i!==""&&t.add(i)}),t.size}getLoadingStatus(){return{isLoading:this.isLoading}}}class Io{constructor(){this.fullScreenLoader=null}showFullScreenLoader(){this.fullScreenLoader||(this.fullScreenLoader=document.createElement("div"),this.fullScreenLoader.className="fixed inset-0 z-[9999] bg-white flex items-center justify-center",this.fullScreenLoader.innerHTML=`
        <div class="text-center">
          <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-primary-500 mx-auto mb-4"></div>
          <h2 class="text-xl font-semibold text-gray-700 mb-2">Loading LEDA Search</h2>
          <p class="text-gray-500">Initializing map, data, and components...</p>
        </div>
      `,document.body.appendChild(this.fullScreenLoader)),this.fullScreenLoader.style.display="flex"}hideFullScreenLoader(){this.fullScreenLoader&&(this.fullScreenLoader.style.opacity="0",this.fullScreenLoader.style.transition="opacity 0.3s ease-out",setTimeout(()=>{this.fullScreenLoader&&(this.fullScreenLoader.style.display="none")},300))}showNotification(e,t="info"){const n=document.createElement("div");n.className=`fixed top-4 right-4 z-50 p-3 rounded-lg shadow-lg max-w-sm text-white transition-all duration-300 ${t==="error"?"bg-red-500":t==="warning"?"bg-yellow-500":"bg-blue-500"}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>n.remove(),300)},3e3)}showFilterNotification(e,t){const n=document.createElement("div");n.className="fixed top-4 right-4 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300",n.style.transform="translateX(100%)",n.innerHTML=`
      <div class="flex items-center space-x-3">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
        </svg>
        <span>Filtro applicato: <strong>${e}</strong> = "${t}"</span>
        <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    `,document.body.appendChild(n),setTimeout(()=>{n.style.transform="translateX(0)"},100),setTimeout(()=>{n.style.transform="translateX(100%)",setTimeout(()=>{n.parentElement&&n.parentElement.removeChild(n)},300)},5e3)}}class Po{constructor(e,t){this.stateManager=e,this.config=t}applyUrlFilters(e){const t=new URLSearchParams(window.location.search),n=t.get("filter"),i=t.get("value");if(console.log("Checking URL parameters:",{filterKey:n,filterValue:i}),n&&i)if(console.log(`Applying URL filter: ${n} = ${i}`),this.config.aggregations&&this.config.aggregations[n]){const s=this.config.aggregations[n];let o=i;if(s.type==="range"){const c=i.includes("-")?i.split("-").map(d=>parseInt(d.trim(),10)):i.split(",").map(d=>parseInt(d.trim(),10));if(c.length===2&&!isNaN(c[0])&&!isNaN(c[1]))o=c;else{console.error(`Invalid range format: ${i}`);return}}const a=this.stateManager.getState();s.type==="range"?a.filters[n]=o:(a.filters[n]||(a.filters[n]=[]),a.filters[n].includes(o)||a.filters[n].push(o)),this.stateManager.setState(a),console.log("State filters after URL application:",a.filters),setTimeout(async()=>{e.onApplyFilters&&await e.onApplyFilters(),console.log(`Filter applied and search completed: ${n} = ${i}`),e.onShowNotification&&e.onShowNotification(n,i)},1500)}else console.warn(`Filter key '${n}' not found in configuration`),e.onError&&e.onError(`Filtro '${n}' non trovato`,"warning")}clearAllFilters(){const e=this.stateManager.getState();e.query="",e.filters=this.stateManager.createEmptyFilters(),this.stateManager.setState(e);const t=document.getElementById("search-input");t&&(t.value="")}removeFilter(e,t){const n=this.stateManager.getState();n.filters[e]&&(t?n.filters[e]=n.filters[e].filter(i=>i!==t):n.filters[e]=[],this.stateManager.setState(n))}clearSearchQuery(){const e=this.stateManager.getState();e.query="",this.stateManager.setState(e);const t=document.getElementById("search-input");t&&(t.value="")}}class No{constructor(e,t,n){this.stateManager=e,this.config=t,this.callbacks=n}bindEvents(){this.setupSearchInput(),this.setupSortSelect()}bindNavBarEvents(e){e.addEventListener("clearAllFilters",()=>{this.callbacks.onClearAllFilters&&this.callbacks.onClearAllFilters()}),e.addEventListener("removeFilter",t=>{const{facetKey:n,value:i}=t.detail;this.callbacks.onRemoveFilter&&this.callbacks.onRemoveFilter(n,i)}),e.addEventListener("clearSearchQuery",()=>{this.callbacks.onClearSearchQuery&&this.callbacks.onClearSearchQuery()})}setupSearchInput(){const e=document.getElementById("search-input");e&&e.addEventListener("input",()=>{const t=this.stateManager.getState();t.query=e.value,this.stateManager.setState(t),this.callbacks.onSearch&&this.callbacks.onSearch()})}setupSortSelect(){const e=document.getElementById("sort-select");e&&this.config.searchConfig.sortOptions&&(e.innerHTML=this.config.searchConfig.sortOptions.map(t=>`<option value="${t.value}">${t.label}</option>`).join(""),e.addEventListener("change",t=>{const n=this.stateManager.getState();n.sort=t.target.value,this.stateManager.setState(n),this.callbacks.onSortChange&&this.callbacks.onSortChange()}))}}class Ro{constructor(){this.activeFiltersCount=0,this.mentionsCount=0,this.resultsCount=0,this.uniqueResultsCount=0,this.isFiltersOpen=!0,this.isResultsOpen=!0,this.listeners=new Map}update(e){const t={};Object.entries(e).forEach(([n,i])=>{this[n]!==i&&(t[n]={old:this[n],new:i},this[n]=i)}),Object.keys(t).length>0&&this.notify(t)}subscribe(e){const t=Math.random().toString(36);return this.listeners.set(t,e),()=>this.listeners.delete(t)}notify(e){this.listeners.forEach(t=>t(e))}getSnapshot(){return{activeFiltersCount:this.activeFiltersCount,resultsCount:this.resultsCount,uniqueResultsCount:this.uniqueResultsCount,isFiltersOpen:this.isFiltersOpen,isResultsOpen:this.isResultsOpen}}reset(){this.update({activeFiltersCount:0,mentionsCount:0,resultsCount:0,uniqueResultsCount:0,isFiltersOpen:!0,isResultsOpen:!0})}get state(){return this.getSnapshot()}}const Ve={MOBILE_BREAKPOINT:768,DEBOUNCE_DELAY:150,HAMBURGER_ID:"hamburger-btn",MOBILE_MENU_ID:"bottom-nav-mobile-menu"},zo=["toggle-filters","active-filters-badge","clear-all-btn","map-layer-selector","map-markers-selector","toggle-legend-btn","results-counter","unique-results-counter","toggle-results"];class $o{constructor(e){this.elements=e,this.isOpen=!1,this.hamburgerBtn=null,this.mobileMenu=null,this.resizeHandler=null,this.clickHandler=null,this.init()}init(){this.createUI(),this.setupEventHandlers(),this.handleResize()}setupEventHandlers(){this.resizeHandler=this.debounce(()=>this.handleResize(),Ve.DEBOUNCE_DELAY),window.addEventListener("resize",this.resizeHandler)}createUI(){this.createHamburgerButton(),this.createMobileMenu()}createHamburgerButton(){const e=document.getElementById(Ve.HAMBURGER_ID);if(e){this.hamburgerBtn=e;return}this.hamburgerBtn=document.createElement("button"),this.hamburgerBtn.id=Ve.HAMBURGER_ID,this.hamburgerBtn.className="md:hidden p-2 z-60 text-gray-700 hover:text-gray-900",this.hamburgerBtn.setAttribute("aria-label","Apri menu"),this.hamburgerBtn.setAttribute("aria-expanded","false"),this.hamburgerBtn.innerHTML=`
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="5" y1="7" x2="19" y2="7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="5" y1="17" x2="19" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        `,this.clickHandler=()=>this.toggleMenu(),this.hamburgerBtn.addEventListener("click",this.clickHandler),(this.elements.bottomNav||document.querySelector("nav")||document.body).appendChild(this.hamburgerBtn)}createMobileMenu(){const e=document.getElementById(Ve.MOBILE_MENU_ID);if(e){this.mobileMenu=e;return}this.mobileMenu=document.createElement("div"),this.mobileMenu.id=Ve.MOBILE_MENU_ID,this.mobileMenu.className="md:hidden fixed bottom-14 left-4 right-4 bg-white shadow-lg p-3 rounded-lg flex-col gap-2 z-50",this.mobileMenu.setAttribute("data-open","false"),document.body.appendChild(this.mobileMenu)}toggleMenu(){this.isOpen=!this.isOpen,this.mobileMenu&&this.mobileMenu.setAttribute("data-open",this.isOpen?"true":"false"),this.hamburgerBtn&&this.hamburgerBtn.setAttribute("aria-expanded",this.isOpen?"true":"false")}handleResize(){window.innerWidth<Ve.MOBILE_BREAKPOINT?this.switchToMobile():this.switchToDesktop()}switchToMobile(){const e=this.elements.bottomNavContent;e&&(e.classList.remove("flex"),e.classList.add("hidden")),zo.forEach(t=>{const n=document.getElementById(t);n&&this.mobileMenu&&n.parentNode!==this.mobileMenu&&(n.classList.add("w-full","block"),this.mobileMenu.appendChild(n))}),this.closeMenu(),this.closePanels()}switchToDesktop(){const e=this.elements.bottomNavContent;e&&(e.classList.remove("hidden"),e.classList.add("flex")),this.mobileMenu&&Array.from(this.mobileMenu.childNodes).forEach(n=>{n instanceof HTMLElement&&e&&(n.classList.remove("w-full","block"),e.appendChild(n))}),this.closeMenu()}closeMenu(){this.isOpen=!1,this.mobileMenu&&this.mobileMenu.setAttribute("data-open","false"),this.hamburgerBtn&&this.hamburgerBtn.setAttribute("aria-expanded","false")}closePanels(){this.elements.filtersPanel&&this.elements.filtersPanel.setAttribute("data-open","false"),this.elements.resultsPanel&&this.elements.resultsPanel.setAttribute("data-open","false"),this.elements.toggleFilters&&this.elements.toggleFilters.setAttribute("data-active","false"),this.elements.toggleResults&&this.elements.toggleResults.setAttribute("data-active","false")}debounce(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e.apply(this,i),t)}}destroy(){this.resizeHandler&&window.removeEventListener("resize",this.resizeHandler),this.clickHandler&&this.hamburgerBtn&&this.hamburgerBtn.removeEventListener("click",this.clickHandler),this.hamburgerBtn&&this.hamburgerBtn.parentNode&&this.hamburgerBtn.remove(),this.mobileMenu&&this.mobileMenu.parentNode&&this.mobileMenu.remove(),this.hamburgerBtn=null,this.mobileMenu=null,this.resizeHandler=null,this.clickHandler=null}}const Re={zIndex:"9999",maxHeight:"max-h-96",contentMaxHeight:"max-h-64",defaultWidth:"w-72"},dr={close:`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
    </svg>`,check:`<svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
    </svg>`};class Mt{constructor(e,t){this.triggerId=e,this.popupId=t,this.trigger=null,this.isOpen=!1,this.cleanup=null}init(){return this.trigger=document.getElementById(this.triggerId),this.trigger?(this.trigger.style.cursor="pointer",this.trigger.onclick=e=>{e.stopPropagation(),this.toggle()},!0):(console.warn(`Trigger element ${this.triggerId} not found`),!1)}toggle(){this.isOpen?this.hide():this.show()}show(){if(this.isOpen)return;const e=this.createPopup();e&&(document.body.appendChild(e),this.isOpen=!0,this.bindEvents(e))}hide(){var t;const e=document.getElementById(this.popupId);e==null||e.remove(),(t=this.cleanup)==null||t.call(this),this.cleanup=null,this.isOpen=!1}bindEvents(e){const t=i=>{(i.key==="Escape"||i.type==="click"&&!e.contains(i.target)&&!this.trigger.contains(i.target))&&this.hide()};document.addEventListener("keydown",t),document.addEventListener("click",t);const n=e.querySelector(`#close-${this.popupId}`);n==null||n.addEventListener("click",()=>this.hide()),this.cleanup=()=>{document.removeEventListener("keydown",t),document.removeEventListener("click",t)}}createBasePopup(e){const t=document.createElement("div");t.id=this.popupId,t.className=`fixed p-2 ${Re.defaultWidth} max-w-sm bg-white rounded-lg shadow-2xl border border-gray-200 ${Re.maxHeight} overflow-hidden`,t.style.zIndex=Re.zIndex,hi.positionPopup(t,this.trigger);const n=document.createElement("div");return n.className="flex items-center justify-between mb-2",n.innerHTML=`
            <h3 class="p-2 text-sm font-semibold text-gray-800">${e}</h3>
            <button id="close-${this.popupId}" class="absolute top-2 right-2 p-1.5 bg-pink-100 hover:bg-pink-200 rounded-full text-red-500 shadow-md">
                ${dr.close}
            </button>
        `,t.appendChild(n),t}createPopup(){throw new Error("createPopup must be implemented by subclass")}destroy(){this.hide()}}class To extends Mt{constructor(e){super("active-filters-badge","active-filters-popup"),this.navBar=e}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per vedere i filtri attivi"),e}createPopup(){const e=this.createBasePopup("Filtri Attivi"),t=document.createElement("div");t.className=`space-y-1 ${Re.contentMaxHeight} overflow-y-auto overflow-x-hidden`;const n=this.getSearchState(),s=new di(this.navBar.config).render(n);return!s||s.trim()===""?t.innerHTML='<div class="p-3 text-sm text-gray-500 italic">Nessun filtro applicato</div>':t.innerHTML=s,e.appendChild(t),e}getSearchState(){var e;return(e=window.ledaSearch)!=null&&e.state?window.ledaSearch.state:{query:this.navBar.currentQuery||"",filters:this.navBar.currentFilters||{}}}}class Do extends Mt{constructor(e){super("toggle-legend-btn","map-legend-popup"),this.navBar=e}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per leggere la legenda"),e}createPopup(){const e=this.createBasePopup("Legenda"),t=document.createElement("div");return t.className=`space-y-4 ${Re.contentMaxHeight} overflow-y-auto overflow-x-visible mb-3 p-3`,t.appendChild(this.createIntroSection()),t.appendChild(this.createPinSection()),t.appendChild(this.createFiltersSection()),t.appendChild(this.createReferencesSection()),t.appendChild(this.createPopupSection()),e.appendChild(t),e}getElement(e,t=""){const n=document.querySelector(e);if(!n)return document.createTextNode(t);const i=n.cloneNode(!0);return i.querySelectorAll("[id]").forEach(s=>s.removeAttribute("id")),i.hasAttribute("id")&&i.removeAttribute("id"),i}tooltip(e,t,n="top"){const i=document.createElement("span");i.className="relative inline-block group cursor-help";const s=document.createElement("span");s.className="text-blue-600 underline decoration-dotted underline-offset-2 hover:text-blue-800 transition-colors",s.textContent=e,i.appendChild(s);const o={top:"bottom-full left-1/2 -translate-x-1/2 mb-2",bottom:"top-full left-1/2 -translate-x-1/2 mt-2",left:"right-full top-1/2 -translate-y-1/2 mr-2",right:"left-full top-1/2 -translate-y-1/2 ml-2"},a={top:"top-full left-1/2 -translate-x-1/2 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900",bottom:"bottom-full left-1/2 -translate-x-1/2 border-l-8 border-r-8 border-b-8 border-transparent border-b-gray-900",left:"left-full top-1/2 -translate-y-1/2 border-t-8 border-b-8 border-l-8 border-transparent border-l-gray-900",right:"right-full top-1/2 -translate-y-1/2 border-t-8 border-b-8 border-r-8 border-transparent border-r-gray-900"},c=document.createElement("div");c.className=`absolute ${o[n]} z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 delay-100`;const d=document.createElement("div");d.className="bg-gray-900 text-white text-sm rounded-lg py-2 px-3 max-w-xs shadow-xl whitespace-normal relative",d.appendChild(t.cloneNode(!0));const f=document.createElement("div");return f.className=`absolute w-0 h-0 ${a[n]}`,d.appendChild(f),c.appendChild(d),i.appendChild(c),i}createIntroSection(){const e=document.createElement("div");return e.className="space-y-2",e.innerHTML=`
            <p class="text-sm font-medium text-gray-800">Legenda della mappa</p>
            <p class="text-xs text-gray-600">Mostra i diversi elementi presenti sulla mappa.</p>
        `,e}createPinSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3 space-y-2";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.textContent="I ",t.appendChild(this.tooltip("pin della mappa",this.getElement(".leaflet-marker-icon svg"),"top")),t.appendChild(document.createTextNode(" indicano i luoghi presenti sulla mappa.")),e.appendChild(t),e}createFiltersSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3 space-y-2";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.appendChild(document.createTextNode("I ")),t.appendChild(this.tooltip("filtri",this.getElement("#toggle-filters"),"right")),t.appendChild(document.createTextNode(" intervengono sul filtraggio sia dei luoghi sulla mappa sia dei riferimenti ad essi associati. Il numero di occorrenze dei filtri rappresenta il numero di volte in cui ciascun luogo  stato menzionato. ")),e.appendChild(t),e}createReferencesSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3 space-y-2";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.appendChild(document.createTextNode("La sezione ")),t.appendChild(this.tooltip("riferimenti",this.getElement("#toggle-results"),"top")),t.appendChild(document.createTextNode(" mostra tutti i riferimenti ai luoghi presenti nella mappa.")),e.appendChild(t),e}createPopupSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.appendChild(document.createTextNode("Ogni pin sulla mappa apre un ")),t.appendChild(this.tooltip("popup informativo",this.getElement(".bg-gradient-to-r"),"top")),t.appendChild(document.createTextNode(" con dettagli specifici del luogo.")),e.appendChild(t),e}}class Bo extends Mt{constructor(e){super("map-layer-selector","layer-selection-popup"),this.layers=e,this.currentLayerName="Default",this.currentTileLayer=null}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per cambiare layer"),e}createPopup(){const e=this.createBasePopup("Seleziona uno strato cartografico"),t=document.createElement("div");return t.className=`space-y-1 ${Re.contentMaxHeight} overflow-y-auto overflow-x-hidden mb-3 p-3`,t.innerHTML=this.buildLayersHTML(),t.querySelectorAll(".layer-item").forEach(n=>{n.addEventListener("click",()=>{const{layerName:i,layerUrl:s,layerAttribution:o}=n.dataset;this.selectLayer(i,s,o),this.hide()})}),e.appendChild(t),e}buildLayersHTML(){return Object.entries(this.layers).map(([e,t])=>`
            <div class="layer-item flex items-center justify-between p-2 rounded hover:bg-gray-100 cursor-pointer" 
                data-layer-name="${e}" 
                data-layer-url="${t.tileLayer}"
                data-layer-attribution="${t.attribution}">
                <span class="text-sm text-gray-700">${e}</span>
                ${e===this.currentLayerName?dr.check:""}
            </div>
        `).join("")}selectLayer(e,t,n){this.currentTileLayer&&window.map&&window.map.removeLayer(this.currentTileLayer),window.L&&window.map&&(this.currentTileLayer=window.L.tileLayer(t,{attribution:n,maxZoom:18}),this.currentTileLayer.addTo(window.map)),this.currentLayerName=e,document.dispatchEvent(new CustomEvent("layerChanged",{detail:{layerName:e,layerUrl:t,attribution:n}}))}}class Uo extends Mt{constructor(e){super("map-markers-selector","markers-selection-popup"),this.mapInstance=e,this.currentMarkerType="clusters",this.markerTypes={clusters:{name:"Clusters geografici",description:"Raggruppamenti dinamici dei luoghi",icon:this.getClusterIcon()},pins:{name:"Pin con numeri",description:"Pin con numero dei riferimenti",icon:this.getPinIcon()},circles:{name:"Cerchi Proporzionali",description:"Cerchi con diametro basato sui riferimenti",icon:this.getCircleIcon()}}}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per cambiare tipo di marcatore"),e}createPopup(){const e=this.createBasePopup("Seleziona un tipo di marcatore"),t=document.createElement("div");return t.className=`space-y-1 ${Re.contentMaxHeight} overflow-y-auto overflow-x-hidden`,t.innerHTML=this.buildMarkersHTML(),t.querySelectorAll(".marker-item").forEach(n=>{n.addEventListener("click",()=>{this.selectMarkerType(n.dataset.markerType),this.hide()})}),e.appendChild(t),e}buildMarkersHTML(){return Object.entries(this.markerTypes).map(([e,t])=>`
            <div class="marker-item flex items-center justify-between p-2 rounded hover:bg-gray-50 hover:shadow-md cursor-pointer" 
                 data-marker-type="${e}">
                <div class="flex items-center space-x-3">
                    ${t.icon}
                    <div>
                        <span class="text-sm font-medium text-gray-700">${t.name}</span>
                        <p class="text-xs text-gray-500">${t.description}</p>
                    </div>
                </div>
                ${e===this.currentMarkerType?dr.check:""}
            </div>
        `).join("")}selectMarkerType(e){var n;this.currentMarkerType=e;const t=window.switchMarkerType||((n=this.mapInstance)==null?void 0:n.switchMarkerType);t&&(typeof t=="function"?t(e):t.call(this.mapInstance,e)),document.dispatchEvent(new CustomEvent("markerTypeChanged",{detail:{markerType:e,markerName:this.markerTypes[e].name}}))}getClusterIcon(){return`<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 32 32">
            <path d="M27 21.75c-0.795 0.004-1.538 0.229-2.169 0.616l0.018-0.010-2.694-2.449c0.724-1.105 1.154-2.459 1.154-3.913 0-1.572-0.503-3.027-1.358-4.212l0.015 0.021 3.062-3.062c0.57 0.316 1.249 0.503 1.971 0.508h0.002c2.347 0 4.25-1.903 4.25-4.25s-1.903-4.25-4.25-4.25c-2.347 0-4.25 1.903-4.25 4.25v0c0.005 0.724 0.193 1.403 0.519 1.995l-0.011-0.022-3.062 3.062c-1.147-0.84-2.587-1.344-4.144-1.344-0.868 0-1.699 0.157-2.467 0.443l0.049-0.016-0.644-1.17c0.726-0.757 1.173-1.787 1.173-2.921 0-2.332-1.891-4.223-4.223-4.223s-4.223 1.891-4.223 4.223c0 2.332 1.891 4.223 4.223 4.223 0.306 0 0.605-0.033 0.893-0.095l-0.028 0.005 0.642 1.166c-1.685 1.315-2.758 3.345-2.758 5.627 0 0.605 0.076 1.193 0.218 1.754l-0.011-0.049-0.667 0.283c-0.78-0.904-1.927-1.474-3.207-1.474-2.334 0-4.226 1.892-4.226 4.226s1.892 4.226 4.226 4.226c2.334 0 4.226-1.892 4.226-4.226 0-0.008-0-0.017-0-0.025v0.001c-0.008-0.159-0.023-0.307-0.046-0.451l0.003 0.024 0.667-0.283c1.303 2.026 3.547 3.349 6.1 3.349 1.703 0 3.268-0.589 4.503-1.574l-0.015 0.011 2.702 2.455c-0.258 0.526-0.41 1.144-0.414 1.797v0.001c0 2.347 1.903 4.25 4.25 4.25s4.25-1.903 4.25-4.25c0-2.347-1.903-4.25-4.25-4.25v0z"></path>
        </svg>`}getPinIcon(){return`<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
        </svg>`}getCircleIcon(){return`<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12z" clip-rule="evenodd"></path>
        </svg>`}}const Vo={filtersPanel:"filters-panel",resultsPanel:"results-panel",toggleFilters:"toggle-filters",toggleResults:"toggle-results",activeFiltersBadge:"active-filters-badge",activeFiltersCount:"active-filters-count",mentionsCounter:"mentions-counter",mentionsCount:"mentions-count",resultsCounter:"results-counter",resultsCount:"results-count",uniqueResultsCounter:"unique-results-counter",uniqueResultsCount:"unique-results-count",clearAllBtn:"clear-all-btn",layerButton:"map-layer-selector",markersButton:"map-markers-selector",bottomNav:"bottom-nav",bottomNavContent:"bottom-nav-content",toggleLegendBtn:"toggle-legend-btn"};class Ho{constructor(){this.state=new Ro,this.elements={},this.popups={},this.mobileMenu=null,this.cleanupFns=[],this.init()}get config(){var e;return(e=window.ledaSearch)==null?void 0:e.config}get mapInstance(){var e;return(e=window.ledaSearch)==null?void 0:e.mapInstance}get currentFilters(){var t,n,i,s,o;const e=((n=(t=window.ledaSearch)==null?void 0:t.stateManager)==null?void 0:n.state)||((o=(s=(i=window.ledaSearch)==null?void 0:i.filterManager)==null?void 0:s.stateManager)==null?void 0:o.state);return(e==null?void 0:e.filters)||{}}get currentQuery(){var t,n,i,s,o;const e=((n=(t=window.ledaSearch)==null?void 0:t.stateManager)==null?void 0:n.state)||((o=(s=(i=window.ledaSearch)==null?void 0:i.filterManager)==null?void 0:s.stateManager)==null?void 0:o.state);return(e==null?void 0:e.query)||""}init(){try{this.initElements(),this.initState(),this.bindEvents(),this.initPopups(),this.initMobileMenu(),this.initTooltip()}catch(e){console.error("NavBarRenderer: Initialization error",e)}}initElements(){this.elements=Object.fromEntries(Object.entries(Vo).map(([e,t])=>[e,document.getElementById(t)]))}initState(){var t,n,i,s,o,a;const e=this.state.subscribe(c=>this.onStateChange(c));this.cleanupFns.push(e),(t=this.elements.filtersPanel)==null||t.setAttribute("data-open","true"),(n=this.elements.resultsPanel)==null||n.setAttribute("data-open","true"),(i=this.elements.toggleFilters)==null||i.setAttribute("data-active","true"),(s=this.elements.toggleResults)==null||s.setAttribute("data-active","true"),this.state.activeFiltersCount===0&&((o=this.elements.activeFiltersBadge)==null||o.classList.add("hidden"),(a=this.elements.clearAllBtn)==null||a.classList.add("hidden"))}onStateChange(e){"activeFiltersCount"in e&&this.updateFiltersUI(e.activeFiltersCount.new),("resultsCount"in e||"uniqueResultsCount"in e||"mentionsCount"in e)&&this.updateResultsUI(this.state.mentionsCount||0,this.state.uniqueResultsCount||0,this.state.resultsCount||0),"isFiltersOpen"in e&&this.updatePanelUI("filters",e.isFiltersOpen.new),"isResultsOpen"in e&&this.updatePanelUI("results",e.isResultsOpen.new),this.emitStateChanges(e)}updateFiltersUI(e){var t,n,i,s,o,a;this.elements.activeFiltersCount&&(this.elements.activeFiltersCount.textContent=e),e>0?((t=this.elements.activeFiltersBadge)==null||t.classList.remove("hidden"),(n=this.elements.clearAllBtn)==null||n.classList.remove("hidden")):((i=this.elements.activeFiltersBadge)==null||i.classList.add("hidden"),(s=this.elements.clearAllBtn)==null||s.classList.add("hidden")),(o=this.elements.activeFiltersBadge)==null||o.setAttribute("data-visible",e>0),(a=this.elements.clearAllBtn)==null||a.setAttribute("data-visible",e>0)}updateResultsUI(e,t,n){this.elements.mentionsCount&&(this.elements.mentionsCount.textContent=e),this.elements.mentionsCounter&&(this.elements.mentionsCounter.style.display=e>0?"":"none"),this.elements.resultsCount&&(this.elements.resultsCount.textContent=n),this.elements.resultsCounter&&(this.elements.resultsCounter.style.display=n>0?"":"none"),this.elements.uniqueResultsCount&&(this.elements.uniqueResultsCount.textContent=t),this.elements.uniqueResultsCounter&&(this.elements.uniqueResultsCounter.style.display=t>0?"":"none")}updatePanelUI(e,t){var i,s;const n=this.getPanelConfig(e);n&&((i=n.panel)==null||i.setAttribute("data-open",t),(s=n.button)==null||s.setAttribute("data-active",t))}emitStateChanges(e){Object.entries(e).forEach(([t,n])=>{const s={activeFiltersCount:"activeFiltersChanged",resultsCount:"resultsCountChanged",isFiltersOpen:"panelToggled",isResultsOpen:"panelToggled"}[t];s&&document.dispatchEvent(new CustomEvent(`navbar:${s}`,{detail:{type:t.replace("is","").replace("Open","").toLowerCase(),...n}}))})}bindEvents(){this.bindElement(this.elements.toggleFilters,()=>this.togglePanel("filters")),this.bindElement(this.elements.toggleResults,()=>this.togglePanel("results")),this.bindElement(this.elements.clearAllBtn,()=>this.clearAllFilters())}bindElement(e,t){e&&(e.addEventListener("click",t),this.cleanupFns.push(()=>e.removeEventListener("click",t)))}initPopups(){fi.waitForGlobal("ledaSearch",()=>{var e,t;this.popups.activeFilters=new To(this),this.popups.activeFilters.init(),(t=(e=this.config)==null?void 0:e.map)!=null&&t.tileLayers&&(this.popups.layers=new Bo(this.config.map.tileLayers),this.popups.layers.init()),this.mapInstance&&(this.popups.markers=new Uo(this.mapInstance),this.popups.markers.init(),setTimeout(()=>{this.popups.legend=new Do(this),this.popups.legend.init()},5e3))})}initMobileMenu(){this.mobileMenu=new $o(this.elements),this.cleanupFns.push(()=>{var e;return(e=this.mobileMenu)==null?void 0:e.destroy()})}updateFromSearchState(e,t=[],n={}){var o;if(!e)return;let i=pi.calculateActiveFiltersCount(e.filters);(o=e.query)!=null&&o.trim()&&(i+=1);const s=this.calculateUniqueCounts(t);this.state.update({activeFiltersCount:i,mentionsCount:s.totalMentions,resultsCount:s.uniqueLocations,uniqueResultsCount:s.uniquePivotIds})}calculateUniqueCounts(e){if(!Array.isArray(e)||e.length===0)return{uniquePivotIds:0,uniqueLocations:0,totalMentions:0};const t=new Set,n=new Set;return e.forEach(i=>{i.pivot_ID&&t.add(i.pivot_ID),i.Location&&n.add(i.Location)}),console.log(" CONTEGGI:",{totalMentions:e.length,uniquePivotIds:t.size,uniqueLocations:n.size,pivot_IDs:Array.from(t),Locations:Array.from(n)}),{uniquePivotIds:t.size,uniqueLocations:n.size,totalMentions:e.length}}updateFilters(e){this.state.update({activeFiltersCount:e})}initTooltip(){const e=this.elements.resultsCounter;if(!e)return;const t=document.createElement("div");t.id="results-counter-tooltip",t.className="fixed px-4 py-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-200",t.style.zIndex="99999",t.innerHTML=`
            <div class="space-y-1">
                <div><strong class="text-yellow-300">Menzioni:</strong> Numero delle menzioni di luoghi nei riferimenti</div>
                <div><strong class="text-green-300">Luoghi:</strong> Numero di luoghi unici menzionati</div>
                <div><strong class="text-blue-300">Riferimenti:</strong> Numero di riferimenti che menzionano i luoghi</div>
            </div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                <div class="border-4 border-transparent border-t-gray-900"></div>
            </div>
        `,document.body.appendChild(t);const n=()=>{const i=e.getBoundingClientRect();t.style.left=`${i.left+i.width/2}px`,t.style.top=`${i.top-10}px`,t.style.transform="translate(-50%, -100%)"};e.addEventListener("mouseenter",()=>{n(),t.style.opacity="1"}),e.addEventListener("mouseleave",()=>{t.style.opacity="0"}),window.addEventListener("scroll",n),window.addEventListener("resize",n),this.cleanupFns.push(()=>{t.remove(),window.removeEventListener("scroll",n),window.removeEventListener("resize",n)})}updateResults(e,t=0){this.state.update({resultsCount:e,uniqueResultsCount:t})}togglePanel(e){const t=`is${e.charAt(0).toUpperCase()+e.slice(1)}Open`;this.state.update({[t]:!this.state[t]})}getPanelConfig(e){return{filters:{panel:this.elements.filtersPanel,button:this.elements.toggleFilters},results:{panel:this.elements.resultsPanel,button:this.elements.toggleResults}}[e]}closeAllPanels(){this.state.update({isFiltersOpen:!1,isResultsOpen:!1})}clearAllFilters(){Object.values(this.popups).forEach(e=>e==null?void 0:e.hide()),this.state.update({activeFiltersCount:0,resultsCount:0,uniqueResultsCount:0}),document.dispatchEvent(new CustomEvent("navbar:clearAllFilters",{detail:{resetInterface:!0,clearSearch:!0,clearFacets:!0,clearMap:!0}})),setTimeout(()=>{ut.resetFacetsInterface(),ut.clearSearchInput()},100),Sr.show("Tutti i filtri sono stati rimossi","success",2e3)}getState(){return{...this.state.getSnapshot(),currentFilters:this.currentFilters,currentQuery:this.currentQuery,config:this.config,mapInstance:this.mapInstance}}setState(e){const t={};Object.entries(e).forEach(([n,i])=>{this.state.hasOwnProperty(n)?t[n]=i:["currentFilters","currentQuery","config","mapInstance"].includes(n)&&console.warn(`NavBarRenderer: ${n}  read-only`)}),Object.keys(t).length>0&&this.state.update(t)}addEventListener(e,t){document.addEventListener(`navbar:${e}`,t)}removeEventListener(e,t){document.removeEventListener(`navbar:${e}`,t)}showNotification(e,t="info",n=3e3){Sr.show(e,t,n)}resetInterface(){this.state.reset(),Object.values(this.popups).forEach(e=>e==null?void 0:e.hide()),ut.resetFacetsInterface(),ut.clearSearchInput()}destroy(){this.cleanupFns.forEach(e=>e()),Object.values(this.popups).forEach(e=>e==null?void 0:e.destroy()),this.cleanupFns=[],this.elements={},this.popups={},this.mobileMenu=null}}const qo=new Ho;class Un{constructor(){this.originalFacetData=null}renderTaxonomy(e,t,n,i){const o=(i.filters||{})[n]||[];this.originalFacetData||(this.originalFacetData=JSON.parse(JSON.stringify(t)));const a=o.length>0?this.originalFacetData:t,c=this._buildHierarchy(a);this._calculateTotalCounts(c),e.className="taxonomy-container max-w-full overflow-x-auto max-h-80 overflow-y-auto",e.innerHTML=this._createTaxonomyHTML(c,[],0,n,o),this._setCheckboxStates(e,c,o),this._addEventListeners(e,c,n)}resetOriginalData(){this.originalFacetData=null}_buildHierarchy(e){const t={};return Array.isArray(e)&&e.forEach(n=>{const i=n.key.split(" > ");let s=t;i.forEach((o,a)=>{s[o]||(s[o]={children:{},docCount:0,selfCount:0}),a===i.length-1&&(s[o].selfCount=n.doc_count),s=s[o].children})}),t}_calculateTotalCounts(e){const t=n=>{let i=n.selfCount||0;return Object.values(n.children||{}).forEach(s=>{i+=t(s)}),n.docCount=i,i};Object.values(e).forEach(t)}_setCheckboxStates(e,t,n){const i=(s,o=[])=>{Object.entries(s).forEach(([a,c])=>{if(this._isMetadataKey(a))return;const d=[...o,a].join(" > "),f=e.querySelector(`input[value="${d}"]`);if(!f)return;f.checked=n.includes(d);const w=this._getAllChildPaths(c.children||{},[...o,a]).some(h=>n.includes(h));f.indeterminate=w&&!f.checked,i(c.children,[...o,a])})};i(t)}_createTaxonomyHTML(e,t=[],n=0,i,s){let o='<div class="space-y-1">';return Object.entries(e).forEach(([a,c])=>{if(this._isMetadataKey(a))return;const d=[...t,a],f=d.join(" > "),v=Object.keys(c.children).length>0,w=s.includes(f),h=v&&this._hasSelectedChild(c.children,s,d),b=w||h,x=c.docCount===0;o+=`
        <div class="taxonomy-item">
          <label class="block facet-option ${x?"text-gray-400 cursor-not-allowed opacity-50":"cursor-pointer"}" data-search-text="${a.toLowerCase()}">
            <div></div>
            ${this._createToggleButton(v,f,b)}
            <div class="flex items-center gap-2 min-w-0">
              <input type="checkbox" value="${f}" data-facet-type="${i}" class="form-checkbox flex-shrink-0" ${w?"checked":""} ${x?"disabled":""}>
              <span class="text-sm">${a}</span>
            </div>
            <span class="text-xs px-2 py-0.5 rounded-full flex-shrink-0 ${x?"text-gray-400 bg-gray-100":"text-secondary-500 bg-secondary-100"}">${c.docCount}</span>
          </label>
          ${this._createChildrenContainer(v,f,b,c.children,d,n+1,i,s)}
        </div>`}),o+"</div>"}_createToggleButton(e,t,n){return e?`<button class="toggle-btn flex-shrink-0 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-200 transition-colors" data-path="${t}">
        <svg class="w-3 h-3 text-gray-600 transform transition-transform duration-200 ${n?"rotate-90":""}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>`:'<div class="w-5 h-5 flex-shrink-0"></div>'}_createChildrenContainer(e,t,n,i,s,o,a,c){return e?`<div class="children ${n?"":"hidden"}" data-parent="${t}">
        ${this._createTaxonomyHTML(i,s,o,a,c)}
      </div>`:""}_isMetadataKey(e){return["children","docCount","selfCount"].includes(e)}_hasSelectedChild(e,t,n=[]){for(const[i,s]of Object.entries(e)){if(this._isMetadataKey(i))continue;const o=[...n,i].join(" > ");if(t.includes(o)||Object.keys(s.children).length>0&&this._hasSelectedChild(s.children,t,[...n,i]))return!0}return!1}_getParentPaths(e){const t=e.split(" > "),n=[];for(let i=1;i<t.length;i++)n.push(t.slice(0,i).join(" > "));return n}_getAllChildPaths(e,t=[]){const n=[];return Object.entries(e).forEach(([i,s])=>{if(this._isMetadataKey(i))return;const o=[...t,i].join(" > ");n.push(o),Object.keys(s.children).length>0&&n.push(...this._getAllChildPaths(s.children,[...t,i]))}),n}_getChildPathsForNode(e,t){const n=t.split(" > ");let i=e;for(const s of n)if(i[s])i=i[s];else return[];return this._getAllChildPaths(i.children,n)}_addEventListeners(e,t,n){e._hierarchy=t,this._addToggleListeners(e),this._addCheckboxListeners(e,t,n)}_addToggleListeners(e){e.addEventListener("click",t=>{const n=t.target.closest(".toggle-btn");if(!n)return;const i=n.dataset.path,s=e.querySelector(`[data-parent="${i}"]`),o=n.querySelector("svg");if(s&&o){const a=s.classList.contains("hidden");s.classList.toggle("hidden"),o.classList.toggle("rotate-90",a)}})}_addCheckboxListeners(e,t,n){e.addEventListener("change",i=>{if(i.target.type!=="checkbox")return;const s=i.target;if(s.disabled){i.preventDefault();return}const o=s.value,a=s.checked;i.stopPropagation();const c=this._getParentPaths(o),d=this._getChildPathsForNode(t,o);this._updateRelatedCheckboxes(e,t,o,a,c,d),e.dispatchEvent(new CustomEvent("taxonomyChange",{detail:{facetKey:n,path:o,checked:a,action:a?"add":"remove"}}))})}_updateRelatedCheckboxes(e,t,n,i,s,o){i?(this._updateCheckboxes(e,s,!0),this._updateCheckboxes(e,o,!0)):(this._updateCheckboxes(e,o,!1),this._updateParentCheckboxes(e,t,s)),this._updateCheckboxVisuals(e.querySelector(`input[value="${n}"]`),i)}_updateCheckboxes(e,t,n){t==null||t.forEach(i=>{const s=e.querySelector(`input[value="${i}"]`);s&&s.checked!==n&&!s.disabled&&(s.checked=n,this._updateCheckboxVisuals(s,n))})}_updateParentCheckboxes(e,t,n){n==null||n.forEach(i=>{const s=e.querySelector(`input[value="${i}"]`);if(!(s!=null&&s.checked)||s.disabled)return;this._getChildPathsForNode(t,i).some(c=>{const d=e.querySelector(`input[value="${c}"]`);return d==null?void 0:d.checked})||(s.checked=!1,this._updateCheckboxVisuals(s,!1))})}_updateCheckboxVisuals(e,t){var i;if(!e)return;const n=(i=e.closest("label"))==null?void 0:i.querySelector("span.text-sm");n&&(n.classList.toggle("font-medium",t),n.classList.toggle("text-primary-700",t))}_renderTaxonomyFacet(e,t,n,i,s,o,a){const c=document.createElement("div"),d=i[t]||[];this.renderTaxonomy(c,d,t,o),c.addEventListener("taxonomyChange",f=>{const{facetKey:v,path:w,checked:h}=f.detail;a({type:"FACET_CHANGE",facetType:v,value:w,checked:h})}),e.appendChild(c)}}var Oe;(function(r){r.Range="range",r.Steps="steps",r.Positions="positions",r.Count="count",r.Values="values"})(Oe||(Oe={}));var oe;(function(r){r[r.None=-1]="None",r[r.NoValue=0]="NoValue",r[r.LargeValue=1]="LargeValue",r[r.SmallValue=2]="SmallValue"})(oe||(oe={}));function Wo(r){return _t(r)&&typeof r.from=="function"}function _t(r){return typeof r=="object"&&typeof r.to=="function"}function hn(r){r.parentElement.removeChild(r)}function er(r){return r!=null}function fn(r){r.preventDefault()}function Go(r){return r.filter(function(e){return this[e]?!1:this[e]=!0},{})}function Jo(r,e){return Math.round(r/e)*e}function Qo(r,e){var t=r.getBoundingClientRect(),n=r.ownerDocument,i=n.documentElement,s=Vn(n);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?t.top+s.y-i.clientTop:t.left+s.x-i.clientLeft}function ve(r){return typeof r=="number"&&!isNaN(r)&&isFinite(r)}function pn(r,e,t){t>0&&(ie(r,e),setTimeout(function(){wt(r,e)},t))}function gn(r){return Math.max(Math.min(r,100),0)}function kt(r){return Array.isArray(r)?r:[r]}function Xo(r){r=String(r);var e=r.split(".");return e.length>1?e[1].length:0}function ie(r,e){r.classList&&!/\s/.test(e)?r.classList.add(e):r.className+=" "+e}function wt(r,e){r.classList&&!/\s/.test(e)?r.classList.remove(e):r.className=r.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function Yo(r,e){return r.classList?r.classList.contains(e):new RegExp("\\b"+e+"\\b").test(r.className)}function Vn(r){var e=window.pageXOffset!==void 0,t=(r.compatMode||"")==="CSS1Compat",n=e?window.pageXOffset:t?r.documentElement.scrollLeft:r.body.scrollLeft,i=e?window.pageYOffset:t?r.documentElement.scrollTop:r.body.scrollTop;return{x:n,y:i}}function Zo(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function Ko(){var r=!1;try{var e=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("test",null,e)}catch{}return r}function ea(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function hr(r,e){return 100/(e-r)}function tr(r,e,t){return e*100/(r[t+1]-r[t])}function ta(r,e){return tr(r,r[0]<0?e+Math.abs(r[0]):e-r[0],0)}function ra(r,e){return e*(r[1]-r[0])/100+r[0]}function it(r,e){for(var t=1;r>=e[t];)t+=1;return t}function na(r,e,t){if(t>=r.slice(-1)[0])return 100;var n=it(t,r),i=r[n-1],s=r[n],o=e[n-1],a=e[n];return o+ta([i,s],t)/hr(o,a)}function ia(r,e,t){if(t>=100)return r.slice(-1)[0];var n=it(t,e),i=r[n-1],s=r[n],o=e[n-1],a=e[n];return ra([i,s],(t-o)*hr(o,a))}function sa(r,e,t,n){if(n===100)return n;var i=it(n,r),s=r[i-1],o=r[i];return t?n-s>(o-s)/2?o:s:e[i-1]?r[i-1]+Jo(n-r[i-1],e[i-1]):n}var Hn=function(){function r(e,t,n){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[n||!1],this.xNumSteps=[!1],this.snap=t;var i,s=[];for(Object.keys(e).forEach(function(o){s.push([kt(e[o]),o])}),s.sort(function(o,a){return o[0][0]-a[0][0]}),i=0;i<s.length;i++)this.handleEntryPoint(s[i][1],s[i][0]);for(this.xNumSteps=this.xSteps.slice(0),i=0;i<this.xNumSteps.length;i++)this.handleStepPoint(i,this.xNumSteps[i])}return r.prototype.getDistance=function(e){for(var t=[],n=0;n<this.xNumSteps.length-1;n++)t[n]=tr(this.xVal,e,n);return t},r.prototype.getAbsoluteDistance=function(e,t,n){var i=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[i+1];)i++;else e===this.xPct[this.xPct.length-1]&&(i=this.xPct.length-2);!n&&e===this.xPct[i+1]&&i++,t===null&&(t=[]);var s,o=1,a=t[i],c=0,d=0,f=0,v=0;for(n?s=(e-this.xPct[i])/(this.xPct[i+1]-this.xPct[i]):s=(this.xPct[i+1]-e)/(this.xPct[i+1]-this.xPct[i]);a>0;)c=this.xPct[i+1+v]-this.xPct[i+v],t[i+v]*o+100-s*100>100?(d=c*s,o=(a-100*s)/t[i+v],s=1):(d=t[i+v]*c/100*o,o=0),n?(f=f-d,this.xPct.length+v>=1&&v--):(f=f+d,this.xPct.length-v>=1&&v++),a=t[i+v]*o;return e+f},r.prototype.toStepping=function(e){return e=na(this.xVal,this.xPct,e),e},r.prototype.fromStepping=function(e){return ia(this.xVal,this.xPct,e)},r.prototype.getStep=function(e){return e=sa(this.xPct,this.xSteps,this.snap,e),e},r.prototype.getDefaultStep=function(e,t,n){var i=it(e,this.xPct);return(e===100||t&&e===this.xPct[i-1])&&(i=Math.max(i-1,1)),(this.xVal[i]-this.xVal[i-1])/n},r.prototype.getNearbySteps=function(e){var t=it(e,this.xPct);return{stepBefore:{startValue:this.xVal[t-2],step:this.xNumSteps[t-2],highestStep:this.xHighestCompleteStep[t-2]},thisStep:{startValue:this.xVal[t-1],step:this.xNumSteps[t-1],highestStep:this.xHighestCompleteStep[t-1]},stepAfter:{startValue:this.xVal[t],step:this.xNumSteps[t],highestStep:this.xHighestCompleteStep[t]}}},r.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(Xo);return Math.max.apply(null,e)},r.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},r.prototype.convert=function(e){return this.getStep(this.toStepping(e))},r.prototype.handleEntryPoint=function(e,t){var n;if(e==="min"?n=0:e==="max"?n=100:n=parseFloat(e),!ve(n)||!ve(t[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(n),this.xVal.push(t[0]);var i=Number(t[1]);n?this.xSteps.push(isNaN(i)?!1:i):isNaN(i)||(this.xSteps[0]=i),this.xHighestCompleteStep.push(0)},r.prototype.handleStepPoint=function(e,t){if(t){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=tr([this.xVal[e],this.xVal[e+1]],t,0)/hr(this.xPct[e],this.xPct[e+1]);var n=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],i=Math.ceil(Number(n.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*i;this.xHighestCompleteStep[e]=s}},r}(),mn={to:function(r){return r===void 0?"":r.toFixed(2)},from:Number},qn={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},Le={tooltips:".__tooltips",aria:".__aria"};function oa(r,e){if(!ve(e))throw new Error("noUiSlider: 'step' is not numeric.");r.singleStep=e}function aa(r,e){if(!ve(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");r.keyboardPageMultiplier=e}function la(r,e){if(!ve(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");r.keyboardMultiplier=e}function ca(r,e){if(!ve(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");r.keyboardDefaultStep=e}function ua(r,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");r.spectrum=new Hn(e,r.snap||!1,r.singleStep)}function da(r,e){if(e=kt(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");r.handles=e.length,r.start=e}function ha(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");r.snap=e}function fa(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");r.animate=e}function pa(r,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");r.animationDuration=e}function Wn(r,e){var t=[!1],n;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(n=1;n<r.handles;n++)t.push(e);t.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==r.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");t=e}r.connect=t}function ga(r,e){switch(e){case"horizontal":r.ort=0;break;case"vertical":r.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function Gn(r,e){if(!ve(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(r.margin=r.spectrum.getDistance(e))}function ma(r,e){if(!ve(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(r.limit=r.spectrum.getDistance(e),!r.limit||r.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function va(r,e){var t;if(!ve(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||ve(e[0])||ve(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),r.padding=[r.spectrum.getDistance(e[0]),r.spectrum.getDistance(e[1])],t=0;t<r.spectrum.xNumSteps.length-1;t++)if(r.padding[0][t]<0||r.padding[1][t]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var n=e[0]+e[1],i=r.spectrum.xVal[0],s=r.spectrum.xVal[r.spectrum.xVal.length-1];if(n/(s-i)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function wa(r,e){switch(e){case"ltr":r.dir=0;break;case"rtl":r.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function ya(r,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var t=e.indexOf("tap")>=0,n=e.indexOf("drag")>=0,i=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,a=e.indexOf("unconstrained")>=0,c=e.indexOf("invert-connects")>=0,d=e.indexOf("drag-all")>=0,f=e.indexOf("smooth-steps")>=0;if(i){if(r.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");Gn(r,r.start[1]-r.start[0])}if(c&&r.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(a&&(r.margin||r.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");r.events={tap:t||s,drag:n,dragAll:d,smoothSteps:f,fixed:i,snap:s,hover:o,unconstrained:a,invertConnects:c}}function ba(r,e){if(e!==!1)if(e===!0||_t(e)){r.tooltips=[];for(var t=0;t<r.handles;t++)r.tooltips.push(e)}else{if(e=kt(e),e.length!==r.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(n){if(typeof n!="boolean"&&!_t(n))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),r.tooltips=e}}function xa(r,e){if(e.length!==r.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");r.handleAttributes=e}function _a(r,e){if(!_t(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");r.ariaFormat=e}function Sa(r,e){if(!Wo(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");r.format=e}function Ca(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");r.keyboardSupport=e}function Ea(r,e){r.documentElement=e}function Ma(r,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");r.cssPrefix=e}function ka(r,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof r.cssPrefix=="string"?(r.cssClasses={},Object.keys(e).forEach(function(t){r.cssClasses[t]=r.cssPrefix+e[t]})):r.cssClasses=e}function Jn(r){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:mn,format:mn},t={step:{r:!1,t:oa},keyboardPageMultiplier:{r:!1,t:aa},keyboardMultiplier:{r:!1,t:la},keyboardDefaultStep:{r:!1,t:ca},start:{r:!0,t:da},connect:{r:!0,t:Wn},direction:{r:!0,t:wa},snap:{r:!1,t:ha},animate:{r:!1,t:fa},animationDuration:{r:!1,t:pa},range:{r:!0,t:ua},orientation:{r:!1,t:ga},margin:{r:!1,t:Gn},limit:{r:!1,t:ma},padding:{r:!1,t:va},behaviour:{r:!0,t:ya},ariaFormat:{r:!1,t:_a},format:{r:!1,t:Sa},tooltips:{r:!1,t:ba},keyboardSupport:{r:!0,t:Ca},documentElement:{r:!1,t:Ea},cssPrefix:{r:!0,t:Ma},cssClasses:{r:!0,t:ka},handleAttributes:{r:!1,t:xa}},n={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:qn,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};r.format&&!r.ariaFormat&&(r.ariaFormat=r.format),Object.keys(t).forEach(function(c){if(!er(r[c])&&n[c]===void 0){if(t[c].r)throw new Error("noUiSlider: '"+c+"' is required.");return}t[c].t(e,er(r[c])?r[c]:n[c])}),e.pips=r.pips;var i=document.createElement("div"),s=i.style.msTransform!==void 0,o=i.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var a=[["left","top"],["right","bottom"]];return e.style=a[e.dir][e.ort],e}function Aa(r,e,t){var n=Zo(),i=ea(),s=i&&Ko(),o=r,a,c,d,f,v,w,h=e.spectrum,b=[],x=[],C=[],O=0,N={},$=!1,z=r.ownerDocument,G=e.documentElement||z.documentElement,F=z.body,P=z.dir==="rtl"||e.ort===1?0:100;function X(u,g){var m=z.createElement("div");return g&&ie(m,g),u.appendChild(m),m}function ce(u,g){var m=X(u,e.cssClasses.origin),S=X(m,e.cssClasses.handle);if(X(S,e.cssClasses.touchArea),S.setAttribute("data-handle",String(g)),e.keyboardSupport&&(S.setAttribute("tabindex","0"),S.addEventListener("keydown",function(k){return Qe(k,g)})),e.handleAttributes!==void 0){var M=e.handleAttributes[g];Object.keys(M).forEach(function(k){S.setAttribute(k,M[k])})}return S.setAttribute("role","slider"),S.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),g===0?ie(S,e.cssClasses.handleLower):g===e.handles-1&&ie(S,e.cssClasses.handleUpper),m.handle=S,m}function we(u,g){return g?X(u,e.cssClasses.connect):!1}function te(u,g){c=X(g,e.cssClasses.connects),d=[],f=[],f.push(we(c,u[0]));for(var m=0;m<e.handles;m++)d.push(ce(g,m)),C[m]=m,f.push(we(c,u[m+1]))}function le(u){ie(u,e.cssClasses.target),e.dir===0?ie(u,e.cssClasses.ltr):ie(u,e.cssClasses.rtl),e.ort===0?ie(u,e.cssClasses.horizontal):ie(u,e.cssClasses.vertical);var g=getComputedStyle(u).direction;return g==="rtl"?ie(u,e.cssClasses.textDirectionRtl):ie(u,e.cssClasses.textDirectionLtr),X(u,e.cssClasses.base)}function ue(u,g){return!e.tooltips||!e.tooltips[g]?!1:X(u.firstChild,e.cssClasses.tooltip)}function ge(){return o.hasAttribute("disabled")}function de(u){var g=d[u];return g.hasAttribute("disabled")}function y(u){u!=null?(d[u].setAttribute("disabled",""),d[u].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),d.forEach(function(g){g.handle.removeAttribute("tabindex")}))}function l(u){u!=null?(d[u].removeAttribute("disabled"),d[u].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),d.forEach(function(g){g.removeAttribute("disabled"),g.handle.setAttribute("tabindex","0")}))}function p(){w&&(Xe("update"+Le.tooltips),w.forEach(function(u){u&&hn(u)}),w=null)}function _(){p(),w=d.map(ue),jt("update"+Le.tooltips,function(u,g,m){if(!(!w||!e.tooltips)&&w[g]!==!1){var S=u[g];e.tooltips[g]!==!0&&(S=e.tooltips[g].to(m[g])),w[g].innerHTML=S}})}function E(){Xe("update"+Le.aria),jt("update"+Le.aria,function(u,g,m,S,M){C.forEach(function(k){var I=d[k],L=at(x,k,0,!0,!0,!0),V=at(x,k,100,!0,!0,!0),H=M[k],J=String(e.ariaFormat.to(m[k]));L=h.fromStepping(L).toFixed(1),V=h.fromStepping(V).toFixed(1),H=h.fromStepping(H).toFixed(1),I.children[0].setAttribute("aria-valuemin",L),I.children[0].setAttribute("aria-valuemax",V),I.children[0].setAttribute("aria-valuenow",H),I.children[0].setAttribute("aria-valuetext",J)})})}function A(u){if(u.mode===Oe.Range||u.mode===Oe.Steps)return h.xVal;if(u.mode===Oe.Count){if(u.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var g=u.values-1,m=100/g,S=[];g--;)S[g]=g*m;return S.push(100),j(S,u.stepped)}return u.mode===Oe.Positions?j(u.values,u.stepped):u.mode===Oe.Values?u.stepped?u.values.map(function(M){return h.fromStepping(h.getStep(h.toStepping(M)))}):u.values:[]}function j(u,g){return u.map(function(m){return h.fromStepping(g?h.getStep(m):m)})}function D(u){function g(H,J){return Number((H+J).toFixed(7))}var m=A(u),S={},M=h.xVal[0],k=h.xVal[h.xVal.length-1],I=!1,L=!1,V=0;return m=Go(m.slice().sort(function(H,J){return H-J})),m[0]!==M&&(m.unshift(M),I=!0),m[m.length-1]!==k&&(m.push(k),L=!0),m.forEach(function(H,J){var Q,U,K,ne=H,ee=m[J+1],re,Ft,It,Pt,br,Nt,xr,_r=u.mode===Oe.Steps;for(_r&&(Q=h.xNumSteps[J]),Q||(Q=ee-ne),ee===void 0&&(ee=ne),Q=Math.max(Q,1e-7),U=ne;U<=ee;U=g(U,Q)){for(re=h.toStepping(U),Ft=re-V,br=Ft/(u.density||1),Nt=Math.round(br),xr=Ft/Nt,K=1;K<=Nt;K+=1)It=V+K*xr,S[It.toFixed(5)]=[h.fromStepping(It),0];Pt=m.indexOf(U)>-1?oe.LargeValue:_r?oe.SmallValue:oe.NoValue,!J&&I&&U!==ee&&(Pt=0),U===ee&&L||(S[re.toFixed(5)]=[U,Pt]),V=re}}),S}function Z(u,g,m){var S,M,k=z.createElement("div"),I=(S={},S[oe.None]="",S[oe.NoValue]=e.cssClasses.valueNormal,S[oe.LargeValue]=e.cssClasses.valueLarge,S[oe.SmallValue]=e.cssClasses.valueSub,S),L=(M={},M[oe.None]="",M[oe.NoValue]=e.cssClasses.markerNormal,M[oe.LargeValue]=e.cssClasses.markerLarge,M[oe.SmallValue]=e.cssClasses.markerSub,M),V=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],H=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];ie(k,e.cssClasses.pips),ie(k,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function J(U,K){var ne=K===e.cssClasses.value,ee=ne?V:H,re=ne?I:L;return K+" "+ee[e.ort]+" "+re[U]}function Q(U,K,ne){if(ne=g?g(K,ne):ne,ne!==oe.None){var ee=X(k,!1);ee.className=J(ne,e.cssClasses.marker),ee.style[e.style]=U+"%",ne>oe.NoValue&&(ee=X(k,!1),ee.className=J(ne,e.cssClasses.value),ee.setAttribute("data-value",String(K)),ee.style[e.style]=U+"%",ee.innerHTML=String(m.to(K)))}}return Object.keys(u).forEach(function(U){Q(U,u[U][0],u[U][1])}),k}function B(){v&&(hn(v),v=null)}function ye(u){B();var g=D(u),m=u.filter,S=u.format||{to:function(M){return String(Math.round(M))}};return v=o.appendChild(Z(g,m,S)),v}function Fe(){var u=a.getBoundingClientRect(),g="offset"+["Width","Height"][e.ort];return e.ort===0?u.width||a[g]:u.height||a[g]}function he(u,g,m,S){var M=function(I){var L=be(I,S.pageOffset,S.target||g);if(!L||ge()&&!S.doNotReject||Yo(o,e.cssClasses.tap)&&!S.doNotReject||u===n.start&&L.buttons!==void 0&&L.buttons>1||S.hover&&L.buttons)return!1;s||L.preventDefault(),L.calcPoint=L.points[e.ort],m(L,S)},k=[];return u.split(" ").forEach(function(I){g.addEventListener(I,M,s?{passive:!0}:!1),k.push([I,M])}),k}function be(u,g,m){var S=u.type.indexOf("touch")===0,M=u.type.indexOf("mouse")===0,k=u.type.indexOf("pointer")===0,I=0,L=0;if(u.type.indexOf("MSPointer")===0&&(k=!0),u.type==="mousedown"&&!u.buttons&&!u.touches)return!1;if(S){var V=function(Q){var U=Q.target;return U===m||m.contains(U)||u.composed&&u.composedPath().shift()===m};if(u.type==="touchstart"){var H=Array.prototype.filter.call(u.touches,V);if(H.length>1)return!1;I=H[0].pageX,L=H[0].pageY}else{var J=Array.prototype.find.call(u.changedTouches,V);if(!J)return!1;I=J.pageX,L=J.pageY}}return g=g||Vn(z),(M||k)&&(I=u.clientX+g.x,L=u.clientY+g.y),u.pageOffset=g,u.points=[I,L],u.cursor=M||k,u}function Se(u){var g=u-Qo(a,e.ort),m=g*100/Fe();return m=gn(m),e.dir?100-m:m}function Be(u){var g=100,m=!1;return d.forEach(function(S,M){if(!de(M)){var k=x[M],I=Math.abs(k-u),L=I===100&&g===100,V=I<g,H=I<=g&&u>k;(V||H||L)&&(m=M,g=I)}}),m}function ke(u,g){u.type==="mouseout"&&u.target.nodeName==="HTML"&&u.relatedTarget===null&&je(u,g)}function Ae(u,g){if(navigator.appVersion.indexOf("MSIE 9")===-1&&u.buttons===0&&g.buttonsProperty!==0)return je(u,g);var m=(e.dir?-1:1)*(u.calcPoint-g.startCalcPoint),S=m*100/g.baseSize;pr(m>0,S,g.locations,g.handleNumbers,g.connect)}function je(u,g){g.handle&&(wt(g.handle,e.cssClasses.active),O-=1),g.listeners.forEach(function(m){G.removeEventListener(m[0],m[1])}),O===0&&(wt(o,e.cssClasses.drag),Ot(),u.cursor&&(F.style.cursor="",F.removeEventListener("selectstart",fn))),e.events.smoothSteps&&(g.handleNumbers.forEach(function(m){Ie(m,x[m],!0,!0,!1,!1)}),g.handleNumbers.forEach(function(m){Y("update",m)})),g.handleNumbers.forEach(function(m){Y("change",m),Y("set",m),Y("end",m)})}function Ue(u,g){if(!g.handleNumbers.some(de)){var m;if(g.handleNumbers.length===1){var S=d[g.handleNumbers[0]];m=S.children[0],O+=1,ie(m,e.cssClasses.active)}u.stopPropagation();var M=[],k=he(n.move,G,Ae,{target:u.target,handle:m,connect:g.connect,listeners:M,startCalcPoint:u.calcPoint,baseSize:Fe(),pageOffset:u.pageOffset,handleNumbers:g.handleNumbers,buttonsProperty:u.buttons,locations:x.slice()}),I=he(n.end,G,je,{target:u.target,handle:m,listeners:M,doNotReject:!0,handleNumbers:g.handleNumbers}),L=he("mouseout",G,ke,{target:u.target,handle:m,listeners:M,doNotReject:!0,handleNumbers:g.handleNumbers});M.push.apply(M,k.concat(I,L)),u.cursor&&(F.style.cursor=getComputedStyle(u.target).cursor,d.length>1&&ie(o,e.cssClasses.drag),F.addEventListener("selectstart",fn,!1)),g.handleNumbers.forEach(function(V){Y("start",V)})}}function ot(u){u.stopPropagation();var g=Se(u.calcPoint),m=Be(g);m!==!1&&(e.events.snap||pn(o,e.cssClasses.tap,e.animationDuration),Ie(m,g,!0,!0),Ot(),Y("slide",m,!0),Y("update",m,!0),e.events.snap?Ue(u,{handleNumbers:[m]}):(Y("change",m,!0),Y("set",m,!0)))}function At(u){var g=Se(u.calcPoint),m=h.getStep(g),S=h.fromStepping(m);Object.keys(N).forEach(function(M){M.split(".")[0]==="hover"&&N[M].forEach(function(k){k.call(ct,S)})})}function Qe(u,g){if(ge()||de(g))return!1;var m=["Left","Right"],S=["Down","Up"],M=["PageDown","PageUp"],k=["Home","End"];e.dir&&!e.ort?m.reverse():e.ort&&!e.dir&&(S.reverse(),M.reverse());var I=u.key.replace("Arrow",""),L=I===M[0],V=I===M[1],H=I===S[0]||I===m[0]||L,J=I===S[1]||I===m[1]||V,Q=I===k[0],U=I===k[1];if(!H&&!J&&!Q&&!U)return!0;u.preventDefault();var K;if(J||H){var ne=H?0:1,ee=wr(g),re=ee[ne];if(re===null)return!1;re===!1&&(re=h.getDefaultStep(x[g],H,e.keyboardDefaultStep)),V||L?re*=e.keyboardPageMultiplier:re*=e.keyboardMultiplier,re=Math.max(re,1e-7),re=(H?-1:1)*re,K=b[g]+re}else U?K=e.spectrum.xVal[e.spectrum.xVal.length-1]:K=e.spectrum.xVal[0];return Ie(g,h.toStepping(K),!0,!0),Y("slide",g),Y("update",g),Y("change",g),Y("set",g),!1}function fr(u){u.fixed||d.forEach(function(g,m){he(n.start,g.children[0],Ue,{handleNumbers:[m]})}),u.tap&&he(n.start,a,ot,{}),u.hover&&he(n.move,a,At,{hover:!0}),u.drag&&f.forEach(function(g,m){if(!(g===!1||m===0||m===f.length-1)){var S=d[m-1],M=d[m],k=[g],I=[S,M],L=[m-1,m];ie(g,e.cssClasses.draggable),u.fixed&&(k.push(S.children[0]),k.push(M.children[0])),u.dragAll&&(I=d,L=C),k.forEach(function(V){he(n.start,V,Ue,{handles:I,handleNumbers:L,connect:g})})}})}function jt(u,g){N[u]=N[u]||[],N[u].push(g),u.split(".")[0]==="update"&&d.forEach(function(m,S){Y("update",S)})}function Xn(u){return u===Le.aria||u===Le.tooltips}function Xe(u){var g=u&&u.split(".")[0],m=g?u.substring(g.length):u;Object.keys(N).forEach(function(S){var M=S.split(".")[0],k=S.substring(M.length);(!g||g===M)&&(!m||m===k)&&(!Xn(k)||m===k)&&delete N[S]})}function Y(u,g,m){Object.keys(N).forEach(function(S){var M=S.split(".")[0];u===M&&N[S].forEach(function(k){k.call(ct,b.map(e.format.to),g,b.slice(),m||!1,x.slice(),ct)})})}function at(u,g,m,S,M,k,I){var L;return d.length>1&&!e.events.unconstrained&&(S&&g>0&&(L=h.getAbsoluteDistance(u[g-1],e.margin,!1),m=Math.max(m,L)),M&&g<d.length-1&&(L=h.getAbsoluteDistance(u[g+1],e.margin,!0),m=Math.min(m,L))),d.length>1&&e.limit&&(S&&g>0&&(L=h.getAbsoluteDistance(u[g-1],e.limit,!1),m=Math.min(m,L)),M&&g<d.length-1&&(L=h.getAbsoluteDistance(u[g+1],e.limit,!0),m=Math.max(m,L))),e.padding&&(g===0&&(L=h.getAbsoluteDistance(0,e.padding[0],!1),m=Math.max(m,L)),g===d.length-1&&(L=h.getAbsoluteDistance(100,e.padding[1],!0),m=Math.min(m,L))),I||(m=h.getStep(m)),m=gn(m),m===u[g]&&!k?!1:m}function Lt(u,g){var m=e.ort;return(m?g:u)+", "+(m?u:g)}function pr(u,g,m,S,M){var k=m.slice(),I=S[0],L=e.events.smoothSteps,V=[!u,u],H=[u,!u];S=S.slice(),u&&S.reverse(),S.length>1?S.forEach(function(Q,U){var K=at(k,Q,k[Q]+g,V[U],H[U],!1,L);K===!1?g=0:(g=K-k[Q],k[Q]=K)}):V=H=[!0];var J=!1;S.forEach(function(Q,U){J=Ie(Q,m[Q]+g,V[U],H[U],!1,L)||J}),J&&(S.forEach(function(Q){Y("update",Q),Y("slide",Q)}),M!=null&&Y("drag",I))}function gr(u,g){return e.dir?100-u-g:u}function Yn(u,g){x[u]=g,b[u]=h.fromStepping(g);var m=gr(g,0)-P,S="translate("+Lt(m+"%","0")+")";if(d[u].style[e.transformRule]=S,e.events.invertConnects&&x.length>1){var M=x.every(function(k,I,L){return I===0||k>=L[I-1]});if($!==!M){ni();return}}Ye(u),Ye(u+1),$&&(Ye(u-1),Ye(u+2))}function Ot(){C.forEach(function(u){var g=x[u]>50?-1:1,m=3+(d.length+g*u);d[u].style.zIndex=String(m)})}function Ie(u,g,m,S,M,k){return M||(g=at(x,u,g,m,S,!1,k)),g===!1?!1:(Yn(u,g),!0)}function Ye(u){if(f[u]){var g=x.slice();$&&g.sort(function(L,V){return L-V});var m=0,S=100;u!==0&&(m=g[u-1]),u!==f.length-1&&(S=g[u]);var M=S-m,k="translate("+Lt(gr(m,M)+"%","0")+")",I="scale("+Lt(M/100,"1")+")";f[u].style[e.transformRule]=k+" "+I}}function mr(u,g){return u===null||u===!1||u===void 0||(typeof u=="number"&&(u=String(u)),u=e.format.from(u),u!==!1&&(u=h.toStepping(u)),u===!1||isNaN(u))?x[g]:u}function lt(u,g,m){var S=kt(u),M=x[0]===void 0;g=g===void 0?!0:g,e.animate&&!M&&pn(o,e.cssClasses.tap,e.animationDuration),C.forEach(function(L){Ie(L,mr(S[L],L),!0,!1,m)});var k=C.length===1?0:1;if(M&&h.hasNoSize()&&(m=!0,x[0]=0,C.length>1)){var I=100/(C.length-1);C.forEach(function(L){x[L]=L*I})}for(;k<C.length;++k)C.forEach(function(L){Ie(L,x[L],!0,!0,m)});Ot(),C.forEach(function(L){Y("update",L),S[L]!==null&&g&&Y("set",L)})}function Zn(u){lt(e.start,u)}function Kn(u,g,m,S){if(u=Number(u),!(u>=0&&u<C.length))throw new Error("noUiSlider: invalid handle number, got: "+u);Ie(u,mr(g,u),!0,!0,S),Y("update",u),m&&Y("set",u)}function vr(u){if(u===void 0&&(u=!1),u)return b.length===1?b[0]:b.slice(0);var g=b.map(e.format.to);return g.length===1?g[0]:g}function ei(){for(Xe(Le.aria),Xe(Le.tooltips),Object.keys(e.cssClasses).forEach(function(u){wt(o,e.cssClasses[u])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function wr(u){var g=x[u],m=h.getNearbySteps(g),S=b[u],M=m.thisStep.step,k=null;if(e.snap)return[S-m.stepBefore.startValue||null,m.stepAfter.startValue-S||null];M!==!1&&S+M>m.stepAfter.startValue&&(M=m.stepAfter.startValue-S),S>m.thisStep.startValue?k=m.thisStep.step:m.stepBefore.step===!1?k=!1:k=S-m.stepBefore.highestStep,g===100?M=null:g===0&&(k=null);var I=h.countStepDecimals();return M!==null&&M!==!1&&(M=Number(M.toFixed(I))),k!==null&&k!==!1&&(k=Number(k.toFixed(I))),[k,M]}function ti(){return C.map(wr)}function ri(u,g){var m=vr(),S=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];S.forEach(function(k){u[k]!==void 0&&(t[k]=u[k])});var M=Jn(t);S.forEach(function(k){u[k]!==void 0&&(e[k]=M[k])}),h=M.spectrum,e.margin=M.margin,e.limit=M.limit,e.padding=M.padding,e.pips?ye(e.pips):B(),e.tooltips?_():p(),x=[],lt(er(u.start)?u.start:m,g),u.connect&&yr()}function yr(){for(;c.firstChild;)c.removeChild(c.firstChild);for(var u=0;u<=e.handles;u++)f[u]=we(c,e.connect[u]),Ye(u);fr({drag:e.events.drag,fixed:!0})}function ni(){$=!$,Wn(e,e.connect.map(function(u){return!u})),yr()}function ii(){a=le(o),te(e.connect,a),fr(e.events),lt(e.start),e.pips&&ye(e.pips),e.tooltips&&_(),E()}ii();var ct={destroy:ei,steps:ti,on:jt,off:Xe,get:vr,set:lt,setHandle:Kn,reset:Zn,disable:y,enable:l,__moveHandles:function(u,g,m){pr(u,g,x,m)},options:t,updateOptions:ri,target:o,removePips:B,removeTooltips:p,getPositions:function(){return x.slice()},getTooltips:function(){return w},getOrigins:function(){return d},pips:ye};return ct}function ja(r,e){if(!r||!r.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+r);if(r.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var t=Jn(e),n=Aa(r,t,e);return r.noUiSlider=n,n}const La={__spectrum:Hn,cssClasses:qn,create:ja};class Qn{constructor(){this.playIntervals=new Map,this.playStates=new Map}_processRangeData(e,t,n){const i=e.map(h=>({value:parseInt(h.key,10),count:h.doc_count||0})).filter(h=>!isNaN(h.value)).sort((h,b)=>h.value-b.value),s=t.map(h=>({value:parseInt(h.key,10),count:h.doc_count||0})).filter(h=>!isNaN(h.value)).sort((h,b)=>h.value-b.value);if(i.length===0)throw new Error("No valid numeric values found in range data");const o=i.map(h=>h.value),a=s.map(h=>h.value),c=o[0],d=o[o.length-1],f=[...new Set(a)];let v,w;return n&&n.length===2?(v=Math.max(n[0],c),w=Math.min(n[1],d)):(v=f[0]||c,w=f[f.length-1]||d),{allBuckets:i,availableBuckets:s,sortedAvailableValues:f,minValue:c,maxValue:d,startValue:v,endValue:w}}_createRangeFacetDOM(e,t){const n=document.createElement("div");return n.className="facet-slider my-3",n.innerHTML=this._getRangeFacetHTML(e,t),n}_getRangeFacetHTML(e,{minValue:t,maxValue:n}){return`
      <div class="space-y-3">
        <!-- Play Controls -->
        <div class="play-controls flex items-center justify-center gap-2 pb-3 border-b border-gray-200">
          <button id="${e}-play-btn" class="group relative w-8 h-8 bg-gradient-to-r from-primary-400 to-primary-700 text-white text-xs rounded-full transition-colors duration-200 hover:from-primary-600 hover:to-primary-700 shadow-md hover:shadow-lg flex items-center justify-center" type="button">
            <div class="w-0 h-0 border-l-[5px] border-l-white border-y-[3px] border-y-transparent ml-0.5"></div>
            <span class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap">Play</span>
          </button>
          <button id="${e}-pause-btn" class="group relative w-8 h-8 bg-gradient-to-r from-secondary-400 to-secondary-700 text-white text-xs rounded-full transition-colors duration-200 hover:from-secondary-600 hover:to-secondary-700 shadow-md hover:shadow-lg flex items-center justify-center" type="button">
            <div class="flex gap-0.5">
              <div class="w-0.5 h-3 bg-white rounded-sm"></div>
              <div class="w-0.5 h-3 bg-white rounded-sm"></div>
            </div>
            <span class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap">Pause</span>
          </button>
        </div>

        <!-- Chart Container -->
        <div class="relative">
          <div id="${e}-chart" class="w-full h-16 mb-3 bg-gray-50 rounded-md p-2"></div>
        </div>
        
        <!-- Slider Container -->
        <div class="px-1">
          <div id="${e}-slider" class="slider-container"></div>
        </div>
        
        <!-- Value Display -->
        <div class="flex items-center justify-between text-xs text-gray-600 px-1">
          <span id="${e}-min-display" class="font-medium">${t}</span>
          <span id="${e}-max-display" class="font-medium">${n}</span>
        </div>
        
        <!-- Custom Range Inputs -->
        <div class="mt-4 pt-3 border-t border-gray-100">
          <div class="text-xs font-medium text-gray-700 mb-2">Custom range:</div>
          <div class="grid grid-cols-2 gap-2">
            <div class="min-w-0">
              <input id="${e}-min-input" type="number"
                    class="w-full px-2 py-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-primary-400 focus:border-primary-400 focus:outline-none"
                    value="${t}"
                    placeholder="Min">
            </div>
            <div class="min-w-0">
              <input id="${e}-max-input" type="number"
                    class="w-full px-2 py-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-primary-400 focus:border-primary-400 focus:outline-none"
                    value="${n}"
                    placeholder="Max">
            </div>
          </div>
        </div>
      </div>
    `}_getSliderElements(e,t){return{chartElement:e.querySelector(`#${t}-chart`),slider:e.querySelector(`#${t}-slider`),minInput:e.querySelector(`#${t}-min-input`),maxInput:e.querySelector(`#${t}-max-input`),minDisplay:e.querySelector(`#${t}-min-display`),maxDisplay:e.querySelector(`#${t}-max-display`),playBtn:e.querySelector(`#${t}-play-btn`),pauseBtn:e.querySelector(`#${t}-pause-btn`)}}_initializeSlider(e,t){La.create(e,{start:[t.startValue,t.endValue],connect:!0,step:1,range:{min:t.minValue,max:t.maxValue},format:{to:n=>Math.round(n),from:n=>parseInt(n,10)}}),e.classList.add("custom-slider")}_setupEventHandlers(e,t,n,i){t.slider.noUiSlider.on("update",s=>{const[o,a]=s.map(c=>Math.round(Number(c)));t.minDisplay.textContent=o.toString(),t.maxDisplay.textContent=a.toString(),document.activeElement!==t.minInput&&(t.minInput.value=o),document.activeElement!==t.maxInput&&(t.maxInput.value=a)}),t.slider.noUiSlider.on("change",s=>{const[o,a]=s.map(c=>Math.round(Number(c)));!isNaN(o)&&!isNaN(a)&&o>=n.minValue&&a<=n.maxValue&&this._updateRange(e,[o,a],i,t.chartElement,n.allBuckets,n)}),t.minInput.addEventListener("change",s=>{this._handleInputChange(s.target,!0,e,t,n,i)}),t.maxInput.addEventListener("change",s=>{this._handleInputChange(s.target,!1,e,t,n,i)}),[t.minInput,t.maxInput].forEach(s=>{s.addEventListener("keypress",o=>{o.key==="Enter"&&o.target.blur()})}),this.setupPlayControls(e,t.playBtn,t.pauseBtn,t.slider,n.sortedAvailableValues,i,t.chartElement,n.allBuckets)}_validateAndClampInput(e,t,n){const i=parseInt(e,10);return isNaN(i)?null:Math.max(t,Math.min(n,i))}_storeSliderReferences(e,t,n){e.slider=t.slider,e.sortedValues=n.sortedAvailableValues,Object.assign(e,t),e.cleanup=()=>{t.slider.noUiSlider&&t.slider.noUiSlider.destroy(),this.playStates.delete(e.facetKey)}}setupPlayControls(e,t,n,i,s,o,a,c){t.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.startPlay(e,t,n,i,s,o,a,c)}),n.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.pausePlay(e,t,n)})}startPlay(e,t,n,i,s,o,a,c){if(this.playIntervals.has(e))return;const[d,f]=i.noUiSlider.get().map(Number),v=this._findClosestDatasetValue(s,d),w=this._findClosestDatasetValue(s,f);let h=this.playStates.get(e);if(h)h.currentMaxIndex>=h.maxLimitIndex&&(h.currentMaxIndex=h.startMinIndex,this.playStates.set(e,h));else{const x=s.indexOf(v),C=s.indexOf(w);h={startMinIndex:x,currentMaxIndex:x,maxLimitIndex:C,originalMin:v,originalMax:w},this.playStates.set(e,h)}const b=setInterval(()=>{const x=this.playStates.get(e);if(!x){clearInterval(b),this.playIntervals.delete(e);return}let{startMinIndex:C,currentMaxIndex:O,maxLimitIndex:N}=x;if(O=Math.min(O+1,N),O>=N){const G=s[C],F=s[N];i.noUiSlider.set([G,F]);const P=i.closest(".facet-slider");P.minValue,P.maxValue,o({type:"RANGE_CHANGE",facetKey:e,value:[G,F]}),this.updateChartHighlight(a,c,G,F),this.playStates.delete(e),this.pausePlay(e,t,n);return}this.playStates.set(e,{...x,currentMaxIndex:O});const $=s[C],z=s[O];i.noUiSlider.set([$,z]),o({type:"RANGE_CHANGE",facetKey:e,value:[$,z]}),this.updateChartHighlight(a,c,$,z)},500);this.playIntervals.set(e,b)}pausePlay(e,t,n){const i=this.playIntervals.get(e);i&&(clearInterval(i),this.playIntervals.delete(e))}_updateRange(e,[t,n],i,s,o,a){this.playStates.delete(e);let c;t===a.minValue&&n===a.maxValue?c=null:c=[t,n],i({type:"RANGE_CHANGE",facetKey:e,value:c}),this.updateChartHighlight(s,o,t,n)}_handleInputChange(e,t,n,i,s,o){const a=this._validateAndClampInput(e.value,s.minValue,s.maxValue);if(a===null)return;const[c,d]=i.slider.noUiSlider.get().map(Number),f=t?[Math.max(s.minValue,Math.min(a,d)),d]:[c,Math.min(s.maxValue,Math.max(a,c))];this._updateRange(n,f,o,i.chartElement,s.allBuckets,s),i.slider.noUiSlider.set(f)}_findClosestDatasetValue(e,t){if(e.length===0)return t;if(t<=e[0])return e[0];if(t>=e[e.length-1])return e[e.length-1];let n=0,i=e.length-1;for(;n<=i;){const a=Math.floor((n+i)/2),c=e[a];if(c===t)return c;c<t?n=a+1:i=a-1}if(i<0)return e[0];if(n>=e.length)return e[e.length-1];const s=Math.abs(e[n]-t),o=Math.abs(e[i]-t);return s<=o?e[n]:e[i]}updateChartHighlight(e,t,n,i){const s=e.querySelector(".flex.items-end");if(!s){console.warn("Bars container not found");return}s.querySelectorAll("[data-value]").forEach(a=>{const c=parseInt(a.dataset.value),d=parseInt(a.dataset.count);c>=n&&c<=i?d>0?a.style.backgroundColor="#d1d5db":a.style.backgroundColor="#bfdbfe":a.style.backgroundColor="#d1d5db"})}renderBarChart(e,t,n,i,s,o=null){e.innerHTML="";const a=Math.max(...n.map(v=>v.count),1);this.sortedAllBuckets=[...t].sort((v,w)=>v.value-w.value);const c=document.createElement("div");c.className="w-full h-full flex flex-col",e.appendChild(c);const d=document.createElement("div");d.className="w-full flex-1 rounded px-1 overflow-hidden",d.style.height="150px",c.appendChild(d);const f=document.createElement("div");f.className="flex items-end w-full h-full",d.appendChild(f),this.sortedAllBuckets.forEach(v=>{const w=v.count>0?v.count/a*90:2,h=document.createElement("div");h.className="flex-1 mx-px transition-colors duration-200",h.style.height=`${Math.max(w,1)}%`,h.dataset.value=v.value,h.dataset.count=v.count,v.count>0?(h.title=`Value: ${v.value}, Count: ${v.count}`,h.style.backgroundColor="#3b82f6"):(h.title=`Value: ${v.value}, No data available`,h.style.backgroundColor="#d1d5db"),f.appendChild(h)})}_renderEmptyRangeFacet(e,t){const n=document.createElement("div");return n.className="facet-slider my-3 text-center text-gray-500 py-4",n.innerHTML='<p class="text-sm">No data available for this range</p>',e.appendChild(n),n}_renderRangeFacet(e,t,n,i,s,o,a){var x;const c=i[t]||[];console.log(`=== RangeRenderer for ${t} ===`),console.log("Received state:",o),console.log("state.filters:",o==null?void 0:o.filters),console.log("state.filters[facetKey]:",(x=o==null?void 0:o.filters)==null?void 0:x[t]),console.log("=====================================");const d=c.filter(C=>C.doc_count>0);if(!c||c.length===0)return this._renderEmptyRangeFacet(e,t);const f=this._processRangeData(c,d,o.filters[t]);if(f.sortedAvailableValues.length===0){const C=document.createElement("div");return C.className="facet-slider my-3 text-center text-gray-500 py-4",C.innerHTML=`
        <p class="text-sm">No values available with current filters</p>
        <p class="text-xs text-gray-400">Range: ${f.minValue} - ${f.maxValue}</p>
      `,e.appendChild(C),C}const v=f.sortedAvailableValues[0],w=f.sortedAvailableValues[f.sortedAvailableValues.length-1];if(v===w){const C=v+1;f.sliderMax=C,f.endValue=v}const h=this._createRangeFacetDOM(t,{minValue:f.minValue,maxValue:f.maxValue});e.appendChild(h);const b=this._getSliderElements(h,t);return this.renderBarChart(b.chartElement,f.allBuckets,f.availableBuckets,f.minValue,f.maxValue),this._initializeSlider(b.slider,f),this._setupEventHandlers(t,b,f,a),this.updateChartHighlight(b.chartElement,f.allBuckets,f.startValue,f.endValue),this._storeSliderReferences(h,b,f),h}}class Oa{constructor(e){this.config=e,this.taxonomyRenderer=new Un,this.rangeRenderer=new Qn,this.searchTerms={}}renderFacets(e,t,n){if(!e||!this.config.aggregations){console.error("No aggregations data or configuration available.");return}const i=document.getElementById("facets-container"),s=this._getCheckedState();i.innerHTML="";const o={};Object.entries(this.config.aggregations).forEach(([a,c])=>{const d=c.category||"Other";o[d]||(o[d]=[]),o[d].push({facetKey:a,facetConfig:c})}),Object.entries(o).forEach(([a,c])=>{const d=document.createElement("div");d.className="facet-category",d.setAttribute("data-category",a);const f=document.createElement("h3");f.className="facet-category-title",f.textContent=a,d.appendChild(f);const v=document.createElement("div");v.className="facet-category-content",c.forEach(({facetKey:w,facetConfig:h})=>{const b=this._createFacetGroup(w,h);h.type==="range"?this.rangeRenderer._renderRangeFacet(b,w,h,e,s,t,n):h.type==="taxonomy"?this.taxonomyRenderer._renderTaxonomyFacet(b,w,h,e,s,t,n):h.type==="simple"&&this._renderStandardFacet(b,w,h,e,s,t,n),v.appendChild(b)}),d.appendChild(v),i.appendChild(d)}),this._addFacetEventListeners(n)}_filterFacetOptions(e,t){const n=e.querySelectorAll("label");let i=0;n.forEach(s=>{const o=s.textContent.toLowerCase(),a=t===""||o.includes(t);s.classList.toggle("facet-hidden",!a),a&&i++}),this._showNoResultsMessage(e,i===0&&t!=="")}_showNoResultsMessage(e,t){let n=e.querySelector(".no-results-disclaimer");t?(n||(n=document.createElement("div"),n.className="no-results-disclaimer",n.textContent="Nessun risultato per questa ricerca",n.style.cssText="padding: 10px; color: #666; font-style: italic;",e.appendChild(n)),n.style.display="block"):n&&(n.style.display="none"),e.style.display="block"}_updateCategoryVisibility(){document.querySelectorAll(".facet-category").forEach(t=>{const n=t.querySelectorAll('.facet-group[style*="display: block"], .facet-group:not([style*="display: none"])'),i=Array.from(n).some(s=>s.style.display!=="none");t.style.display=i?"block":"none"})}_getCheckedState(){const e={};return Object.keys(this.config.aggregations).forEach(t=>{const n=document.getElementById(`${t}-facet`);n&&(e[t]=Array.from(n.querySelectorAll("input:checked")).map(i=>i.value))}),e}_createFacetGroup(e,t){const n=document.createElement("div");n.className="facet-group mb-4 p-4 bg-white rounded-lg shadow",n.id=`${e}-facet`;const i=document.createElement("div");i.className="facet-header mb-3";const s=document.createElement("h3");if(s.className="text-lg font-semibold mb-2",s.textContent=t.title||e,i.appendChild(s),t.type=="simple"){const o=document.createElement("div");o.className="facet-search mb-2";const a=document.createElement("input");a.type="text",a.className="facet-search-input w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-primary-500",a.placeholder="Cerca...",a.id=`search-${e}`;const c=this._debounce(d=>{this._searchWithinFacet(e,d)},300);a.addEventListener("input",d=>{c(d.target.value)}),o.appendChild(a),i.appendChild(o)}return n.appendChild(i),n}_searchWithinFacet(e,t){const n=document.getElementById(`${e}-facet`);n&&(this.searchTerms[e]=t.toLowerCase().trim(),this._filterFacetOptions(n,this.searchTerms[e]))}_renderStandardFacet(e,t,n,i,s,o,a){const c=document.createElement("div");c.className="facet-options space-y-2";const d=i[t]||[],f=o.filters||{};d.forEach(v=>{var $;const w=($=f[t])==null?void 0:$.includes(v.key),h=v.doc_count===0,b=document.createElement("label");b.className="block facet-option flex items-center justify-between",b.style.display="flex",b.setAttribute("data-search-text",v.key.toLowerCase()),h?b.classList.add("text-gray-400","cursor-not-allowed","opacity-50"):b.classList.add("cursor-pointer");const x=document.createElement("div");x.className="flex items-center";const C=document.createElement("input");C.type="checkbox",C.value=v.key,C.dataset.facetType=t,C.checked=w,C.disabled=h,C.className="form-checkbox mr-2",x.appendChild(C);const O=document.createElement("span");O.textContent=v.key,O.className="text-sm";const N=document.createElement("span");N.textContent=v.doc_count,N.className=`text-xs px-2 py-0.5 rounded-full flex-shrink-0 ml-auto ${h?"text-gray-400 bg-gray-100":"text-secondary-500 bg-secondary-100"}`,x.appendChild(O),b.appendChild(x),b.appendChild(N),c.appendChild(b)}),e.appendChild(c)}_addFacetEventListeners(e){if(!this.config.aggregations){console.error("Aggregations configuration not found");return}Object.keys(this.config.aggregations).forEach(t=>{const n=document.getElementById(`${t}-facet`);n&&n.querySelectorAll('input[type="checkbox"]').forEach(i=>{i.addEventListener("change",s=>{this._onFacetChange(s,e)})})})}_onFacetChange(e,t){const{value:n,checked:i}=e.target,s=e.target.dataset.facetType;t({type:"FACET_CHANGE",facetType:s,value:n,checked:i})}clearAllSearches(){this.searchTerms={},Object.keys(this.config.aggregations).forEach(i=>{const s=document.getElementById(`search-${i}`);s&&(s.value="")}),document.querySelectorAll(".facet-option, label").forEach(i=>{i.style.display="block"}),document.querySelectorAll(".facet-group").forEach(i=>{i.style.display="block"}),document.querySelectorAll(".facet-category").forEach(i=>{i.style.display="block"})}_debounce(e,t){let n;return function(){clearTimeout(n),n=setTimeout(()=>e.apply(this,arguments),t)}}}class Fa{constructor(e,t){this.searchEngine=e,this.config=t}performSearch(e,t={}){if(!this.searchEngine){console.error("Search engine not initialized");return}const{filters:n}=e,{regularFilters:i,dateFilters:s,taxonomyFilters:o}=this._separateFilters(n),a=this.searchEngine.search({query:e.query||"",filters:i,sort:e.sort||"title_asc",per_page:1e3,filter:d=>this._customFilter(d,s,o)}),c=this._extractCoordinates(a.data.items);if(t.onMarkersUpdate&&t.onMarkersUpdate(a.data.items),t.onResultsUpdate&&t.onResultsUpdate(a.data.items),t.onAggregationsUpdate){const d=this._formatAggregations(a.data.aggregations);t.onAggregationsUpdate(d)}return{items:a.data.items,coordinates:c,aggregations:this._formatAggregations(a.data.aggregations)}}_separateFilters(e){const t={},n={},i={};return Object.entries(e).forEach(([s,o])=>{if(!o||o.length===0)return;const a=this.config.aggregations[s];if(a)switch(a.type){case"range":n[s]=o;break;case"taxonomy":i[s]=o;break;default:t[s]=o}}),{regularFilters:t,dateFilters:n,taxonomyFilters:i}}_customFilter(e,t,n){for(const[i,s]of Object.entries(t))if(s.length===2){const[o,a]=s,c=new Date(e[i]).getTime();if(!(c>=o&&c<=a))return!1}for(const[i,s]of Object.entries(n)){if(!e[i])return!1;const o=e[i];let a;if(Array.isArray(o)?a=o.length>0?String(o[0]):"":typeof o=="string"?a=o:a=String(o||""),!s.some(d=>a===d||a.startsWith(d+" > ")))return!1}return!0}_extractCoordinates(e){return e.filter(t=>t.lat_long&&t.lat_long.length>0).map(t=>{const n=t.lat_long[0],[i,s]=n.split(",");return[parseFloat(i),parseFloat(s)]})}_formatAggregations(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n].buckets);return t}}class Ia{constructor(e){this.mapFocusCallback=e,this.allWorks=[],this.modalRenderer=new gi(e)}updateResultsList(e,t,n={}){const i=document.getElementById("results");if(!i){console.error("Results container not found");return}this.items=e,this.searchState=n;const s=this._groupByIdOpera(e);this.allWorks=Object.values(s);const o=e.map(a=>a.pivot_ID);this.allWorks.sort((a,c)=>o.indexOf(a.pivot_ID)-o.indexOf(c.pivot_ID)),this.modalRenderer.setData(this.allWorks,this.items),this.modalRenderer.setConfig(t),this.modalRenderer.setSearchState(n),i.innerHTML=this.allWorks.map((a,c)=>this._renderResultItem(a,c)).join(""),this._addMapFocusListeners(),this._addModalListeners()}focusOnResult(e){const t=document.querySelector(`[data-result-id="${e}"]`);return t?(this._openFiltersPanel(),t.scrollIntoView({behavior:"smooth",block:"center"}),this._highlightResult(t),console.log(`Focused on result with pivot_ID: ${e}`),!0):(console.warn(`Result with pivot_ID ${e} not found in current results`),!1)}_openFiltersPanel(){const e=document.getElementById("results-panel");e?(e.classList.remove("panel-closed-right"),console.log("Filters panel opened")):console.warn('Filters panel with ID "results-panel" not found')}_highlightResult(e){const t=document.querySelector(".result-highlighted");t&&t.classList.remove("result-highlighted"),e.classList.add("result-highlighted"),e.style.transition="all 0.3s ease",e.style.transform="scale(1.02)",setTimeout(()=>{e.style.transform=""},1e3),setTimeout(()=>{e.classList.remove("result-highlighted")},3e3)}_groupByIdOpera(e){const t={};return e.forEach(n=>{const i=n.pivot_ID;t[i]||(t[i]={pivot_ID:i,Title:n[window.ledaSearch.config.result_cards.card_title],Subtitle:n[window.ledaSearch.config.result_cards.card_subtitle]||"",Subtitle2:n[window.ledaSearch.config.result_cards.card_subtitle_2]||"",Description:n[window.ledaSearch.config.result_cards.card_description]||"",Location:[],coordinates:[]}),n.Location&&(Array.isArray(n.Location)?n.Location:[n.Location]).forEach((o,a)=>{if(!t[i].Location.includes(o)){t[i].Location.push(o);const c=this._extractCoordinatesFromItem(n,a);t[i].coordinates.push(c)}})}),t}_renderResultItem(e,t){const n=e.Location.map((i,s)=>{const o=e.coordinates[s],a=o&&o.lat&&o.lng;return`
        <button class="focus-map-btn inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-200 hover:shadow-sm hover:scale-105 active:scale-95 cursor-pointer transform 
                       ${a?"bg-secondary-100 hover:bg-secondary-200 text-secondary-700 border border-secondary-200":"bg-gray-100 text-gray-500 border border-gray-200"}" 
                data-space="${encodeURIComponent(i)}" 
                ${a?`data-lat="${o.lat}" data-lng="${o.lng}"`:""}
                title="${a?"Clicca per visualizzare sulla mappa":"Coordinate non disponibili"}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4 mr-1 ${a?"":"opacity-50"}">
            <path fill-rule="evenodd" d="m7.539 14.841.003.003.002.002a.755.755 0 0 0 .912 0l.002-.002.003-.003.012-.009a5.57 5.57 0 0 0 .19-.153 15.588 15.588 0 0 0 2.046-2.082c1.101-1.362 2.291-3.342 2.291-5.597A5 5 0 0 0 3 7c0 2.255 1.19 4.235 2.292 5.597a15.591 15.591 0 0 0 2.046 2.082 8.916 8.916 0 0 0 .189.153l.012.01ZM8 8.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" clip-rule="evenodd" />
          </svg>
          ${i}
        </button>
      `}).join("");return`
  <div class="result-card bg-white rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition-all duration-300 p-6" 
       data-result-id="${e.pivot_ID}">
    <!-- Header with Title, Subtitles and Button -->
    <div class="flex items-start justify-between gap-4 mb-4">
      <div class="min-w-0 flex-1">
        <h1 class="text-xl font-bold text-gray-900 leading-tight">${e.Title}</h1>
        <div class="flex items-center gap-4 mt-2">
          ${e.Subtitle?`<p class="text-lg text-gray-700 font-medium truncate">${e.Subtitle}</p>`:""}
          ${e.Subtitle&&e.Subtitle2?'<span class="w-1.5 h-1.5 bg-gray-400 rounded-full flex-shrink-0"></span>':""}
          ${e.Subtitle2?`<p class="text-lg text-gray-600 font-mono flex-shrink-0">${e.Subtitle2}</p>`:""}
        </div>
      </div>
      
      <!-- More button -->
      <button class="modal-toggle-btn inline-flex items-center px-4 py-2 rounded-full shadow-md hover:shadow-lg transition-all duration-200 flex-shrink-0 bg-primary-500 hover:bg-primary-600 text-white"
              data-work-index="${t}"
              title="Visualizza tutte le opere">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
        </svg>
      </button>
    </div>
    
    <!-- Description with vertical bar -->
    ${e.Description?`
      <div class="flex items-stretch gap-2">
        <div class="w-1 bg-gradient-to-b from-primary-500 to-primary-600 rounded-full shadow-sm flex-shrink-0"></div>
        <p class="text-xs text-gray-600 flex-1">${e.Description}</p>
      </div>
    `:""}
    
    <!-- Locations -->
    ${n?`
      <div class="pt-4 border-t border-gray-200 mt-4">
        <div class="flex flex-wrap gap-2">
          ${n}
        </div>
      </div>
    `:""}
  </div>
`}_addModalListeners(){document.querySelectorAll(".modal-toggle-btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=parseInt(e.getAttribute("data-work-index"));this.modalRenderer.toggleModal(n)})})}_extractCoordinatesFromItem(e,t){let n={lat:null,lng:null};if(Array.isArray(e.lat_long)&&e.lat_long.length>t){const i=e.lat_long[t];if(i&&typeof i=="string"){const s=i.split(",");if(s.length===2){const o=parseFloat(s[0].trim()),a=parseFloat(s[1].trim());!isNaN(o)&&!isNaN(a)&&(n.lat=o,n.lng=a)}}}else if(e.lat_long&&typeof e.lat_long=="string"){const i=e.lat_long.split(",");if(i.length===2){const s=parseFloat(i[0].trim()),o=parseFloat(i[1].trim());!isNaN(s)&&!isNaN(o)&&(n.lat=s,n.lng=o)}}return n}_addMapFocusListeners(){document.querySelectorAll(".focus-map-btn").forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("data-lat"),i=e.getAttribute("data-lng"),s=decodeURIComponent(e.getAttribute("data-space"));n&&i&&this.mapFocusCallback?this.mapFocusCallback(parseFloat(n),parseFloat(i),s):console.warn("Coordinate non disponibili per questo luogo:",s)})})}}class Pa{constructor(e,t){this.config=e,this.searchEngine=t,this.components={}}async initializeComponents(e){const t=ui(this.config);return this.components.map=t.map,this.components.markers=t.markers,this.components.renderMarkers=t.renderMarkers,this.components.setFocusResultCallback=t.setFocusResultCallback,this.components.mapInstance=t,window.ledaSearch||(window.ledaSearch={}),window.ledaSearch.config=this.config,window.ledaSearch.mapInstance=this.components.mapInstance,window.switchMarkerType=n=>{this.components.mapInstance&&this.components.mapInstance.switchMarkerType&&this.components.mapInstance.switchMarkerType(n)},this.components.facetRenderer=new Oa(this.config),this.components.rangeRenderer=new Qn,this.components.taxonomyRenderer=new Un,this.components.searchHandler=new Fa(this.searchEngine,this.config),this.components.resultsRenderer=new Ia((n,i,s)=>{this.components.mapInstance&&this.components.mapInstance.focusOnLocation&&this.components.mapInstance.focusOnLocation(n,i,s)}),this.components.navBar=qo,this.components}connectMapToResults(e,t,n){t&&t(i=>{const s=e.focusOnResult(i);return!s&&n&&n("Item not found in current results","warning"),s})}getComponents(){return this.components}}class Na{constructor(){this.config=null,this.searchEngine=null,this.universalNav=null,this.universalFooter=null,this.stateManager=null,this.searchCoordinator=null,this.uiManager=null,this.filterManager=null,this.eventCoordinator=null,this.componentsInitializer=null,this.components={},this.isInitialLoad=!0,this.isFullyLoaded=!1,this.initialize()}async initialize(){try{this.uiManager=new Io,this.uiManager.showFullScreenLoader(),this.config=await oi();const e=await ci();this.config.searchConfig.per_page=e.length,new ai(this.config).render(),new li(this.config).render(),this.searchEngine=jo(e,this.config),this.initializeManagers(),await this.initializeComponents(),this.setupEvents(),await this.performSearch(),this.applyUrlFilters(),this.isInitialLoad=!1,this.isFullyLoaded=!0,this.uiManager.hideFullScreenLoader()}catch(e){console.error("Initialization error:",e),this.uiManager.showNotification("Error loading application","error"),this.uiManager.hideFullScreenLoader()}}initializeManagers(){this.stateManager=new Lo(this.config),this.searchCoordinator=new Fo(null,this.config),this.filterManager=new Po(this.stateManager,this.config),this.eventCoordinator=new No(this.stateManager,this.config,{onSearch:()=>this.searchCoordinator.debouncedSearch(this.stateManager.getState(),this.getSearchCallbacks()),onSortChange:()=>this.performSearch(),onClearAllFilters:()=>this.clearAllFilters(),onRemoveFilter:(e,t)=>this.removeFilter(e,t),onClearSearchQuery:()=>this.clearSearchQuery()})}async initializeComponents(){this.componentsInitializer=new Pa(this.config,this.searchEngine),this.components=await this.componentsInitializer.initializeComponents((e,t,n)=>this.focusOnMap(e,t,n)),this.searchCoordinator.searchHandler=this.components.searchHandler,this.componentsInitializer.connectMapToResults(this.components.resultsRenderer,this.components.setFocusResultCallback,(e,t)=>this.uiManager.showNotification(e,t))}setupEvents(){this.eventCoordinator.bindEvents(),this.eventCoordinator.bindNavBarEvents(this.components.navBar)}getSearchCallbacks(){return{onMarkersUpdate:e=>this.components.renderMarkers(e),onResultsUpdate:e=>{this.components.resultsRenderer.updateResultsList(e,this.config,{filters:this.stateManager.getState().filters,query:this.stateManager.getState().query,sort:this.stateManager.getState().sort})},onAggregationsUpdate:e=>this.renderFacets(e),onNavBarUpdate:e=>this.updateNavBar(e),onError:(e,t)=>this.uiManager.showNotification(e,t)}}async performSearch(){const e=this.stateManager.getState();return await this.searchCoordinator.performSearch(e,this.getSearchCallbacks())}async handleStateChange(e){await this.stateManager.handleStateChange(e,{onStateChange:async t=>{var i;window.ledaSearch.state=t;const n=await this.searchCoordinator.performSearch(t,this.getSearchCallbacks());console.log("Filter search completed:",((i=n.items)==null?void 0:i.length)||0,"items found")}})}renderFacets(e){this.components.facetRenderer.renderFacets(e,this.stateManager.getState(),t=>this.handleStateChange(t))}updateNavBar(e=[]){this.components.navBar.updateFromSearchState(this.stateManager.getState(),e)}focusOnMap(e,t,n){this.components.mapInstance&&this.components.mapInstance.focusOnLocation&&this.components.mapInstance.focusOnLocation(e,t,n)}applyUrlFilters(){this.filterManager.applyUrlFilters({onApplyFilters:async()=>await this.performSearch(),onShowNotification:(e,t)=>this.uiManager.showFilterNotification(e,t),onError:(e,t)=>this.uiManager.showNotification(e,t)})}clearAllFilters(){this.filterManager.clearAllFilters(),this.performSearch()}removeFilter(e,t){this.filterManager.removeFilter(e,t),this.performSearch()}clearSearchQuery(){this.filterManager.clearSearchQuery(),this.performSearch()}getLoadingStatus(){return{isLoading:this.searchCoordinator.getLoadingStatus().isLoading,isFullyLoaded:this.isFullyLoaded,searchEngineReady:!!this.searchEngine,mapReady:!!this.components.map,configLoaded:!!this.config}}}document.addEventListener("DOMContentLoaded",()=>{window.ledaSearch=new Na})});export default Ra();
