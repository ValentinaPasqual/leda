var si=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);import{l as oi,U as ai,a as li}from"./universalFooter-ebKbAGuz.js";import{p as ci}from"./dataParser-B7kIDYMB.js";import{i as ui}from"./initMap-4WHGSbyL.js";import{F as di,P as hi,D as fi,a as pi,R as ut,N as Sr,M as gi}from"./modalRenderer-Cg3dEo6B.js";import"./_commonjsHelpers-BosuxZz1.js";var Ta=si((fe,pe)=>{var vn=typeof global=="object"&&global&&global.Object===Object&&global,mi=typeof self=="object"&&self&&self.Object===Object&&self,_e=vn||mi||Function("return this")(),me=_e.Symbol,wn=Object.prototype,vi=wn.hasOwnProperty,wi=wn.toString,Ze=me?me.toStringTag:void 0,yi=Object.prototype.toString,bi="[object Null]",xi="[object Undefined]",Cr=me?me.toStringTag:void 0;function Ge(r){return r==null?r===void 0?xi:bi:Cr&&Cr in Object(r)?function(e){var t=vi.call(e,Ze),n=e[Ze];try{e[Ze]=void 0;var i=!0}catch{}var s=wi.call(e);return i&&(t?e[Ze]=n:delete e[Ze]),s}(r):function(e){return yi.call(e)}(r)}function Me(r){return r!=null&&typeof r=="object"}var _i="[object Symbol]";function qe(r){return typeof r=="symbol"||Me(r)&&Ge(r)==_i}function He(r,e){for(var t=-1,n=r==null?0:r.length,i=Array(n);++t<n;)i[t]=e(r[t],t,r);return i}var se=Array.isArray,Si=1/0,Er=me?me.prototype:void 0,Mr=Er?Er.toString:void 0;function yn(r){if(typeof r=="string")return r;if(se(r))return He(r,yn)+"";if(qe(r))return Mr?Mr.call(r):"";var e=r+"";return e=="0"&&1/r==-Si?"-0":e}function ze(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function St(r){return r}var Ci="[object AsyncFunction]",Ei="[object Function]",Mi="[object GeneratorFunction]",ki="[object Proxy]";function bn(r){if(!ze(r))return!1;var e=Ge(r);return e==Ei||e==Mi||e==Ci||e==ki}var kr,Rt=_e["__core-js_shared__"],Ar=(kr=/[^.]+$/.exec(Rt&&Rt.keys&&Rt.keys.IE_PROTO||""))?"Symbol(src)_1."+kr:"",Ai=Function.prototype.toString;function $e(r){if(r!=null){try{return Ai.call(r)}catch{}try{return r+""}catch{}}return""}var ji=/^\[object .+?Constructor\]$/,Li=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Te(r,e){var t=function(n,i){return n==null?void 0:n[i]}(r,e);return function(n){return!(!ze(n)||(i=n,Ar&&Ar in i))&&(bn(n)?Li:ji).test($e(n));var i}(t)?t:void 0}var jr,zt,$t,Ht=Te(_e,"WeakMap"),Lr=Object.create,Oi=function(){function r(){}return function(e){if(!ze(e))return{};if(Lr)return Lr(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),Fi=Date.now,Ii=function(){try{var r=Te(Object,"defineProperty");return r({},"",{}),r}catch{}}(),yt=Ii,Pi=yt?function(r,e){return yt(r,"toString",{configurable:!0,enumerable:!1,value:(t=e,function(){return t}),writable:!0});var t}:St,Ni=(jr=Pi,zt=0,$t=0,function(){var r=Fi(),e=16-(r-$t);if($t=r,e>0){if(++zt>=800)return arguments[0]}else zt=0;return jr.apply(void 0,arguments)});function Ri(r){return r!=r}function zi(r,e){return!(r==null||!r.length)&&function(t,n,i){return n==n?function(s,o,a){for(var c=-1,d=s.length;++c<d;)if(s[c]===o)return c;return-1}(t,n):function(s,o,a,c){for(var d=s.length,h=-1;++h<d;)if(o(s[h],h,s))return h;return-1}(t,Ri)}(r,e)>-1}var $i=9007199254740991,Ti=/^(?:0|[1-9]\d*)$/;function rr(r,e){var t=typeof r;return!!(e=e??$i)&&(t=="number"||t!="symbol"&&Ti.test(r))&&r>-1&&r%1==0&&r<e}function nr(r,e,t){e=="__proto__"&&yt?yt(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}function Ct(r,e){return r===e||r!=r&&e!=e}var Di=Object.prototype.hasOwnProperty;function xn(r,e,t){var n=r[e];Di.call(r,e)&&Ct(n,t)&&(t!==void 0||e in r)||nr(r,e,t)}function dt(r,e,t,n){var i=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=void 0;c===void 0&&(c=r[a]),i?nr(t,a,c):xn(t,a,c)}return t}var Or=Math.max;function _n(r,e){return Ni(function(t,n,i){return n=Or(n===void 0?t.length-1:n,0),function(){for(var s=arguments,o=-1,a=Or(s.length-n,0),c=Array(a);++o<a;)c[o]=s[n+o];o=-1;for(var d=Array(n+1);++o<n;)d[o]=s[o];return d[n]=i(c),function(h,w,y){switch(y.length){case 0:return h.call(w);case 1:return h.call(w,y[0]);case 2:return h.call(w,y[0],y[1]);case 3:return h.call(w,y[0],y[1],y[2])}return h.apply(w,y)}(t,this,d)}}(r,e,St),r+"")}var Bi=9007199254740991;function ir(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Bi}function Je(r){return r!=null&&ir(r.length)&&!bn(r)}function Fr(r,e,t){if(!ze(t))return!1;var n=typeof e;return!!(n=="number"?Je(t)&&rr(e,t.length):n=="string"&&e in t)&&Ct(t[e],r)}var Ui=Object.prototype;function sr(r){var e=r&&r.constructor;return r===(typeof e=="function"&&e.prototype||Ui)}function Ir(r){return Me(r)&&Ge(r)=="[object Arguments]"}var Sn=Object.prototype,Vi=Sn.hasOwnProperty,Hi=Sn.propertyIsEnumerable,or=Ir(function(){return arguments}())?Ir:function(r){return Me(r)&&Vi.call(r,"callee")&&!Hi.call(r,"callee")},Cn=typeof fe=="object"&&fe&&!fe.nodeType&&fe,Pr=Cn&&typeof pe=="object"&&pe&&!pe.nodeType&&pe,Nr=Pr&&Pr.exports===Cn?_e.Buffer:void 0,bt=(Nr?Nr.isBuffer:void 0)||function(){return!1},W={};function Et(r){return function(e){return r(e)}}W["[object Float32Array]"]=W["[object Float64Array]"]=W["[object Int8Array]"]=W["[object Int16Array]"]=W["[object Int32Array]"]=W["[object Uint8Array]"]=W["[object Uint8ClampedArray]"]=W["[object Uint16Array]"]=W["[object Uint32Array]"]=!0,W["[object Arguments]"]=W["[object Array]"]=W["[object ArrayBuffer]"]=W["[object Boolean]"]=W["[object DataView]"]=W["[object Date]"]=W["[object Error]"]=W["[object Function]"]=W["[object Map]"]=W["[object Number]"]=W["[object Object]"]=W["[object RegExp]"]=W["[object Set]"]=W["[object String]"]=W["[object WeakMap]"]=!1;var En=typeof fe=="object"&&fe&&!fe.nodeType&&fe,et=En&&typeof pe=="object"&&pe&&!pe.nodeType&&pe,Tt=et&&et.exports===En&&vn.process,We=function(){try{return et&&et.require&&et.require("util").types||Tt&&Tt.binding&&Tt.binding("util")}catch{}}(),Rr=We&&We.isTypedArray,Mn=Rr?Et(Rr):function(r){return Me(r)&&ir(r.length)&&!!W[Ge(r)]},qi=Object.prototype.hasOwnProperty;function kn(r,e){var t=se(r),n=!t&&or(r),i=!t&&!n&&bt(r),s=!t&&!n&&!i&&Mn(r),o=t||n||i||s,a=o?function(h,w){for(var y=-1,g=Array(h);++y<h;)g[y]=w(y);return g}(r.length,String):[],c=a.length;for(var d in r)!e&&!qi.call(r,d)||o&&(d=="length"||i&&(d=="offset"||d=="parent")||s&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||rr(d,c))||a.push(d);return a}function An(r,e){return function(t){return r(e(t))}}var Wi=An(Object.keys,Object),Gi=Object.prototype.hasOwnProperty;function st(r){return Je(r)?kn(r):function(e){if(!sr(e))return Wi(e);var t=[];for(var n in Object(e))Gi.call(e,n)&&n!="constructor"&&t.push(n);return t}(r)}var Ji=Object.prototype.hasOwnProperty;function Qi(r){return Je(r)?kn(r,!0):function(e){if(!ze(e))return function(s){var o=[];if(s!=null)for(var a in Object(s))o.push(a);return o}(e);var t=sr(e),n=[];for(var i in e)(i!="constructor"||!t&&Ji.call(e,i))&&n.push(i);return n}(r)}var Xi=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Yi=/^\w*$/;function qt(r,e){if(se(r))return!1;var t=typeof r;return!(t!="number"&&t!="symbol"&&t!="boolean"&&r!=null&&!qe(r))||Yi.test(r)||!Xi.test(r)||e!=null&&r in Object(e)}var Ke=Te(Object,"create"),Zi=Object.prototype.hasOwnProperty,Ki=Object.prototype.hasOwnProperty;function Ne(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function ht(r,e){for(var t=r.length;t--;)if(Ct(r[t][0],e))return t;return-1}Ne.prototype.clear=function(){this.__data__=Ke?Ke(null):{},this.size=0},Ne.prototype.delete=function(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e},Ne.prototype.get=function(r){var e=this.__data__;if(Ke){var t=e[r];return t==="__lodash_hash_undefined__"?void 0:t}return Zi.call(e,r)?e[r]:void 0},Ne.prototype.has=function(r){var e=this.__data__;return Ke?e[r]!==void 0:Ki.call(e,r)},Ne.prototype.set=function(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Ke&&e===void 0?"__lodash_hash_undefined__":e,this};var es=Array.prototype.splice;function Ee(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Ee.prototype.clear=function(){this.__data__=[],this.size=0},Ee.prototype.delete=function(r){var e=this.__data__,t=ht(e,r);return!(t<0||(t==e.length-1?e.pop():es.call(e,t,1),--this.size,0))},Ee.prototype.get=function(r){var e=this.__data__,t=ht(e,r);return t<0?void 0:e[t][1]},Ee.prototype.has=function(r){return ht(this.__data__,r)>-1},Ee.prototype.set=function(r,e){var t=this.__data__,n=ht(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this};var rt=Te(_e,"Map");function ft(r,e){var t,n,i=r.__data__;return((n=typeof(t=e))=="string"||n=="number"||n=="symbol"||n=="boolean"?t!=="__proto__":t===null)?i[typeof e=="string"?"string":"hash"]:i.map}function Ce(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function ar(r,e){if(typeof r!="function"||e!=null&&typeof e!="function")throw new TypeError("Expected a function");var t=function(){var n=arguments,i=e?e.apply(this,n):n[0],s=t.cache;if(s.has(i))return s.get(i);var o=r.apply(this,n);return t.cache=s.set(i,o)||s,o};return t.cache=new(ar.Cache||Ce),t}Ce.prototype.clear=function(){this.size=0,this.__data__={hash:new Ne,map:new(rt||Ee),string:new Ne}},Ce.prototype.delete=function(r){var e=ft(this,r).delete(r);return this.size-=e?1:0,e},Ce.prototype.get=function(r){return ft(this,r).get(r)},Ce.prototype.has=function(r){return ft(this,r).has(r)},Ce.prototype.set=function(r,e){var t=ft(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this},ar.Cache=Ce;var Dt,Bt,ts=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rs=/\\(\\)?/g,ns=(Dt=ar(function(r){var e=[];return r.charCodeAt(0)===46&&e.push(""),r.replace(ts,function(t,n,i,s){e.push(i?s.replace(rs,"$1"):n||t)}),e},function(r){return Bt.size===500&&Bt.clear(),r}),Bt=Dt.cache,Dt);function jn(r,e){return se(r)?r:qt(r,e)?[r]:ns(function(t){return t==null?"":yn(t)}(r))}var is=1/0;function mt(r){if(typeof r=="string"||qe(r))return r;var e=r+"";return e=="0"&&1/r==-is?"-0":e}function Wt(r,e){for(var t=0,n=(e=jn(e,r)).length;r!=null&&t<n;)r=r[mt(e[t++])];return t&&t==n?r:void 0}function lr(r,e){for(var t=-1,n=e.length,i=r.length;++t<n;)r[i+t]=e[t];return r}var zr=me?me.isConcatSpreadable:void 0;function ss(r){return se(r)||or(r)||!!(zr&&r&&r[zr])}function os(r,e,t,n,i){var s=-1,o=r.length;for(t||(t=ss),i||(i=[]);++s<o;){var a=r[s];t(a)?lr(i,a):i[i.length]=a}return i}var Ln=An(Object.getPrototypeOf,Object);function xe(r){var e=this.__data__=new Ee(r);this.size=e.size}xe.prototype.clear=function(){this.__data__=new Ee,this.size=0},xe.prototype.delete=function(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t},xe.prototype.get=function(r){return this.__data__.get(r)},xe.prototype.has=function(r){return this.__data__.has(r)},xe.prototype.set=function(r,e){var t=this.__data__;if(t instanceof Ee){var n=t.__data__;if(!rt||n.length<199)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new Ce(n)}return t.set(r,e),this.size=t.size,this};var On=typeof fe=="object"&&fe&&!fe.nodeType&&fe,$r=On&&typeof pe=="object"&&pe&&!pe.nodeType&&pe,Tr=$r&&$r.exports===On?_e.Buffer:void 0,Dr=Tr?Tr.allocUnsafe:void 0;function Fn(){return[]}var as=Object.prototype.propertyIsEnumerable,Br=Object.getOwnPropertySymbols,ls=Br?function(r){return r==null?[]:(r=Object(r),function(e,t){for(var n=-1,i=e==null?0:e.length,s=0,o=[];++n<i;){var a=e[n];as.call(r,a)&&(o[s++]=a)}return o}(Br(r)))}:Fn,cr=ls,cs=Object.getOwnPropertySymbols?function(r){for(var e=[];r;)lr(e,cr(r)),r=Ln(r);return e}:Fn;function us(r,e,t){var n=e(r);return se(r)?n:lr(n,t(r))}function Gt(r){return us(r,st,cr)}var Jt=Te(_e,"DataView"),Qt=Te(_e,"Promise"),Xt=Te(_e,"Set"),Ur="[object Map]",Vr="[object Promise]",Hr="[object Set]",qr="[object WeakMap]",Wr="[object DataView]",ds=$e(Jt),hs=$e(rt),fs=$e(Qt),ps=$e(Xt),gs=$e(Ht),Pe=Ge;(Jt&&Pe(new Jt(new ArrayBuffer(1)))!=Wr||rt&&Pe(new rt)!=Ur||Qt&&Pe(Qt.resolve())!=Vr||Xt&&Pe(new Xt)!=Hr||Ht&&Pe(new Ht)!=qr)&&(Pe=function(r){var e=Ge(r),t=e=="[object Object]"?r.constructor:void 0,n=t?$e(t):"";if(n)switch(n){case ds:return Wr;case hs:return Ur;case fs:return Vr;case ps:return Hr;case gs:return qr}return e});var nt=Pe,ms=Object.prototype.hasOwnProperty,xt=_e.Uint8Array;function vs(r){var e=new r.constructor(r.byteLength);return new xt(e).set(new xt(r)),e}var ws=/\w*$/,Gr=me?me.prototype:void 0,Jr=Gr?Gr.valueOf:void 0,ys="[object Boolean]",bs="[object Date]",xs="[object Map]",_s="[object Number]",Ss="[object RegExp]",Cs="[object Set]",Es="[object String]",Ms="[object Symbol]",ks="[object ArrayBuffer]",As="[object DataView]",js="[object Float32Array]",Ls="[object Float64Array]",Os="[object Int8Array]",Fs="[object Int16Array]",Is="[object Int32Array]",Ps="[object Uint8Array]",Ns="[object Uint8ClampedArray]",Rs="[object Uint16Array]",zs="[object Uint32Array]",Qr=We&&We.isMap,$s=Qr?Et(Qr):function(r){return Me(r)&&nt(r)=="[object Map]"},Xr=We&&We.isSet,Ts=Xr?Et(Xr):function(r){return Me(r)&&nt(r)=="[object Set]"},Ds=1,Bs=2,In="[object Arguments]",Pn="[object Function]",Us="[object GeneratorFunction]",Nn="[object Object]",q={};function vt(r,e,t,n,i,s){var o,a=e&Ds,c=e&Bs;if(o!==void 0)return o;if(!ze(r))return r;var d=se(r);if(d){if(o=function(m){var b=m.length,C=new m.constructor(b);return b&&typeof m[0]=="string"&&ms.call(m,"index")&&(C.index=m.index,C.input=m.input),C}(r),!a)return function(m,b){var C=-1,L=m.length;for(b||(b=Array(L));++C<L;)b[C]=m[C];return b}(r,o)}else{var h=nt(r),w=h==Pn||h==Us;if(bt(r))return function(m,b){var C=m.length,L=Dr?Dr(C):new m.constructor(C);return m.copy(L),L}(r);if(h==Nn||h==In||w&&!i){if(o=w?{}:function(m){return typeof m.constructor!="function"||sr(m)?{}:Oi(Ln(m))}(r),!a)return c?function(m,b){return dt(m,cs(m),b)}(r,function(m,b){return m&&dt(b,Qi(b),m)}(o,r)):function(m,b){return dt(m,cr(m),b)}(r,function(m,b){return m&&dt(b,st(b),m)}(o,r))}else{if(!q[h])return i?r:{};o=function(m,b,C){var L,R,U=m.constructor;switch(b){case ks:return vs(m);case ys:case bs:return new U(+m);case As:return function(N,Q){var F=N.buffer;return new N.constructor(F,N.byteOffset,N.byteLength)}(m);case js:case Ls:case Os:case Fs:case Is:case Ps:case Ns:case Rs:case zs:return function(N,Q){var F=N.buffer;return new N.constructor(F,N.byteOffset,N.length)}(m);case xs:return new U;case _s:case Es:return new U(m);case Ss:return(R=new(L=m).constructor(L.source,ws.exec(L))).lastIndex=L.lastIndex,R;case Cs:return new U;case Ms:return Jr?Object(Jr.call(m)):{}}}(r,h)}}s||(s=new xe);var y=s.get(r);if(y)return y;s.set(r,o),Ts(r)?r.forEach(function(m){o.add(vt(m,e,t,m,r,s))}):$s(r)&&r.forEach(function(m,b){o.set(b,vt(m,e,t,b,r,s))});var g=d?void 0:Gt(r);return function(m,b){for(var C=-1,L=m==null?0:m.length;++C<L&&b(m[C],C)!==!1;);}(g||r,function(m,b){g&&(m=r[b=m]),xn(o,b,vt(m,e,t,b,r,s))}),o}function Ut(r){return vt(r,4)}function tt(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new Ce;++e<t;)this.add(r[e])}function Vs(r,e){for(var t=-1,n=r==null?0:r.length;++t<n;)if(e(r[t],t,r))return!0;return!1}function Yt(r,e){return r.has(e)}q[In]=q["[object Array]"]=q["[object ArrayBuffer]"]=q["[object DataView]"]=q["[object Boolean]"]=q["[object Date]"]=q["[object Float32Array]"]=q["[object Float64Array]"]=q["[object Int8Array]"]=q["[object Int16Array]"]=q["[object Int32Array]"]=q["[object Map]"]=q["[object Number]"]=q[Nn]=q["[object RegExp]"]=q["[object Set]"]=q["[object String]"]=q["[object Symbol]"]=q["[object Uint8Array]"]=q["[object Uint8ClampedArray]"]=q["[object Uint16Array]"]=q["[object Uint32Array]"]=!0,q["[object Error]"]=q[Pn]=q["[object WeakMap]"]=!1,tt.prototype.add=tt.prototype.push=function(r){return this.__data__.set(r,"__lodash_hash_undefined__"),this},tt.prototype.has=function(r){return this.__data__.has(r)};var Hs=1,qs=2;function Yr(r,e,t,n,i,s){var o=t&Hs,a=r.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;var d=s.get(r),h=s.get(e);if(d&&h)return d==e&&h==r;var w=-1,y=!0,g=t&qs?new tt:void 0;for(s.set(r,e),s.set(e,r);++w<a;){var m=r[w],b=e[w];if(n)var C=o?n(b,m,w,e,r,s):n(m,b,w,r,e,s);if(C!==void 0){if(C)continue;y=!1;break}if(g){if(!Vs(e,function(L,R){if(!Yt(g,R)&&(m===L||i(m,L,t,n,s)))return g.push(R)})){y=!1;break}}else if(m!==b&&!i(m,b,t,n,s)){y=!1;break}}return s.delete(r),s.delete(e),y}function Ws(r){var e=-1,t=Array(r.size);return r.forEach(function(n,i){t[++e]=[i,n]}),t}function Gs(r){var e=-1,t=Array(r.size);return r.forEach(function(n){t[++e]=n}),t}var Js=1,Qs=2,Xs="[object Boolean]",Ys="[object Date]",Zs="[object Error]",Ks="[object Map]",eo="[object Number]",to="[object RegExp]",ro="[object Set]",no="[object String]",io="[object Symbol]",so="[object ArrayBuffer]",oo="[object DataView]",Zr=me?me.prototype:void 0,Vt=Zr?Zr.valueOf:void 0,ao=1,lo=Object.prototype.hasOwnProperty,co=1,Kr="[object Arguments]",en="[object Array]",pt="[object Object]",tn=Object.prototype.hasOwnProperty;function Zt(r,e,t,n,i){return r===e||(r==null||e==null||!Me(r)&&!Me(e)?r!=r&&e!=e:function(s,o,a,c,d,h){var w=se(s),y=se(o),g=w?en:nt(s),m=y?en:nt(o),b=(g=g==Kr?pt:g)==pt,C=(m=m==Kr?pt:m)==pt,L=g==m;if(L&&bt(s)){if(!bt(o))return!1;w=!0,b=!1}if(L&&!b)return h||(h=new xe),w||Mn(s)?Yr(s,o,a,c,d,h):function(F,P,X,ce,we,te,le){switch(X){case oo:if(F.byteLength!=P.byteLength||F.byteOffset!=P.byteOffset)return!1;F=F.buffer,P=P.buffer;case so:return!(F.byteLength!=P.byteLength||!te(new xt(F),new xt(P)));case Xs:case Ys:case eo:return Ct(+F,+P);case Zs:return F.name==P.name&&F.message==P.message;case to:case no:return F==P+"";case Ks:var ue=Ws;case ro:if(ue||(ue=Gs),F.size!=P.size&&!(ce&Js))return!1;var ge=le.get(F);if(ge)return ge==P;ce|=Qs,le.set(F,P);var de=Yr(ue(F),ue(P),ce,we,te,le);return le.delete(F),de;case io:if(Vt)return Vt.call(F)==Vt.call(P)}return!1}(s,o,g,a,c,d,h);if(!(a&co)){var R=b&&tn.call(s,"__wrapped__"),U=C&&tn.call(o,"__wrapped__");if(R||U){var N=R?s.value():s,Q=U?o.value():o;return h||(h=new xe),d(N,Q,a,c,h)}}return!!L&&(h||(h=new xe),function(F,P,X,ce,we,te){var le=X&ao,ue=Gt(F),ge=ue.length;if(ge!=Gt(P).length&&!le)return!1;for(var de=ge;de--;){var x=ue[de];if(!(le?x in P:lo.call(P,x)))return!1}var l=te.get(F),f=te.get(P);if(l&&f)return l==P&&f==F;var _=!0;te.set(F,P),te.set(P,F);for(var E=le;++de<ge;){var A=F[x=ue[de]],j=P[x];if(ce)var T=le?ce(j,A,x,P,F,te):ce(A,j,x,F,P,te);if(!(T===void 0?A===j||we(A,j,X,ce,te):T)){_=!1;break}E||(E=x=="constructor")}if(_&&!E){var Z=F.constructor,D=P.constructor;Z==D||!("constructor"in F)||!("constructor"in P)||typeof Z=="function"&&Z instanceof Z&&typeof D=="function"&&D instanceof D||(_=!1)}return te.delete(F),te.delete(P),_}(s,o,a,c,d,h))}(r,e,t,n,Zt,i))}var uo=1,ho=2;function rn(r){return r==r&&!ze(r)}function nn(r,e){return function(t){return t!=null&&t[r]===e&&(e!==void 0||r in Object(t))}}function fo(r,e){return r!=null&&e in Object(r)}var po=1,go=2;function De(r){return typeof r=="function"?r:r==null?St:typeof r=="object"?se(r)?function(s,o){return qt(s)&&rn(o)?nn(mt(s),o):function(a){var c=function(d,h,w){var y=d==null?void 0:Wt(d,h);return y===void 0?void 0:y}(a,s);return c===void 0&&c===o?function(d,h){return d!=null&&function(w,y,g){for(var m=-1,b=(y=jn(y,w)).length,C=!1;++m<b;){var L=mt(y[m]);if(!(C=w!=null&&g(w,L)))break;w=w[L]}return C||++m!=b?C:!!(b=w==null?0:w.length)&&ir(b)&&rr(L,b)&&(se(w)||or(w))}(d,h,fo)}(a,s):Zt(o,c,po|go)}}(r[0],r[1]):(i=function(s){for(var o=st(s),a=o.length;a--;){var c=o[a],d=s[c];o[a]=[c,d,rn(d)]}return o}(n=r),i.length==1&&i[0][2]?nn(i[0][0],i[0][1]):function(s){return s===n||function(o,a,c,d){var h=c.length,w=h;if(o==null)return!w;for(o=Object(o);h--;){var y=c[h];if(y[2]?y[1]!==o[y[0]]:!(y[0]in o))return!1}for(;++h<w;){var g=(y=c[h])[0],m=o[g],b=y[1];if(y[2]){if(m===void 0&&!(g in o))return!1}else{var C=new xe;if(!Zt(b,m,uo|ho,void 0,C))return!1}}return!0}(s,0,i)}):qt(e=r)?(t=mt(e),function(s){return s==null?void 0:s[t]}):function(s){return function(o){return Wt(o,s)}}(e);var e,t,n,i}var mo=function(r,e,t){for(var n=-1,i=Object(r),s=t(r),o=s.length;o--;){var a=s[++n];if(e(i[a],a,i)===!1)break}return r};function Rn(r,e){return r&&mo(r,e,st)}var sn,vo=(sn=Rn,function(r,e){if(r==null)return r;if(!Je(r))return sn(r,e);for(var t=r.length,n=-1,i=Object(r);++n<t&&e(i[n],n,i)!==!1;);return r});function zn(r,e){var t=-1,n=Je(r)?Array(r.length):[];return vo(r,function(i,s,o){n[++t]=e(i,s,o)}),n}function wo(r,e){return r>e}var yo=Math.min;function bo(r){return function(e){return Me(e)&&Je(e)}(r)?r:[]}var xo=_n(function(r){var e=He(r,bo);return e.length&&e[0]===r[0]?function(t,n,i){for(var s=zi,o=t[0].length,a=t.length,c=a,d=Array(a),h=1/0,w=[];c--;){var y=t[c];h=yo(y.length,h),d[c]=o>=120&&y.length>=120?new tt(c&&y):void 0}y=t[0];var g=-1,m=d[0];e:for(;++g<o&&w.length<h;){var b=y[g],C=b;if(b=b!==0?b:0,!(m?Yt(m,C):s(w,C,i))){for(c=a;--c;){var L=d[c];if(!(L?Yt(L,C):s(t[c],C,i)))continue e}m&&m.push(C),w.push(b)}}return w}(e):[]}),_o=xo;function So(r,e){return r<e}function $(r,e){var t={};return e=De(e),Rn(r,function(n,i,s){nr(t,i,e(n,i,s))}),t}function $n(r,e,t){for(var n=-1,i=r.length;++n<i;){var s=r[n],o=e(s);if(o!=null&&(a===void 0?o==o&&!qe(o):t(o,a)))var a=o,c=s}return c}function Co(r,e){return r&&r.length?$n(r,De(e),wo):void 0}function Tn(r,e){for(var t,n=-1,i=r.length;++n<i;){var s=e(r[n]);s!==void 0&&(t=t===void 0?s:t+s)}return t}function Eo(r,e){return function(t,n){var i=t==null?0:t.length;return i?Tn(t,n)/i:NaN}(r,De(e))}function Mo(r,e){if(r!==e){var t=r!==void 0,n=r===null,i=r==r,s=qe(r),o=e!==void 0,a=e===null,c=e==e,d=qe(e);if(!a&&!d&&!s&&r>e||s&&o&&c&&!a&&!d||n&&o&&c||!t&&c||!i)return 1;if(!n&&!s&&!d&&r<e||d&&t&&i&&!n&&!s||a&&t&&i||!o&&i||!c)return-1}return 0}function Dn(r,e,t){e=e.length?He(e,function(i){return se(i)?function(s){return Wt(s,i.length===1?i[0]:i)}:i}):[St];var n=-1;return e=He(e,Et(De)),function(i,s){var o=i.length;for(i.sort(function(a,c){return function(d,h,w){for(var y=-1,g=d.criteria,m=h.criteria,b=g.length,C=w.length;++y<b;){var L=Mo(g[y],m[y]);if(L)return y>=C?L:L*(w[y]=="desc"?-1:1)}return d.index-h.index}(a,c,t)});o--;)i[o]=i[o].value;return i}(zn(r,function(i,s,o){return{criteria:He(e,function(a){return a(i)}),index:++n,value:i}}))}function ur(r,e,t,n){return r==null?[]:(se(e)||(e=e==null?[]:[e]),se(t=t)||(t=t==null?[]:[t]),Dn(r,e,t))}var ko=_n(function(r,e){if(r==null)return[];var t=e.length;return t>1&&Fr(r,e[0],e[1])?e=[]:t>2&&Fr(e[0],e[1],e[2])&&(e=[e[0]]),Dn(r,os(e),[])});function Ao(r,e){return r&&r.length?Tn(r,De(e)):0}function z(r){if(this.words=[],r)if(Symbol&&Symbol.iterator&&r[Symbol.iterator]!==void 0){const e=r[Symbol.iterator]();let t=e.next();for(;!t.done;)this.add(t.value),t=e.next()}else for(let e=0;e<r.length;e++)this.add(r[e])}z.fromWords=function(r){const e=Object.create(z.prototype);return e.words=r,e},z.prototype.add=function(r){this.resize(r),this.words[r>>>5]|=1<<r},z.prototype.flip=function(r){this.resize(r),this.words[r>>>5]^=1<<r},z.prototype.clear=function(){this.words.length=0},z.prototype.remove=function(r){this.resize(r),this.words[r>>>5]&=~(1<<r)},z.prototype.isEmpty=function(r){const e=this.words.length;for(let t=0;t<e;t++)if(this.words[t]!==0)return!1;return!0},z.prototype.has=function(r){return(this.words[r>>>5]&1<<r)!=0},z.prototype.checkedAdd=function(r){this.resize(r);const e=this.words[r>>>5],t=e|1<<r;return this.words[r>>>5]=t,(t^e)>>>r},z.prototype.trim=function(r){let e=this.words.length;for(;e>0&&this.words[e-1]===0;)e--;this.words.length=e},z.prototype.resize=function(r){const e=r+32>>>5;for(let t=this.words.length;t<e;t++)this.words[t]=0},z.prototype.hammingWeight=function(r){return 16843009*((r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)>>>24},z.prototype.hammingWeight4=function(r,e,t,n){return 16843009*((r=(r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)+(e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)+(t=(t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)+(n=(n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135))>>>24},z.prototype.size=function(){let r=0;const e=this.words.length,t=this.words;for(let n=0;n<e;n++)r+=this.hammingWeight(t[n]);return r},z.prototype.array=function(){const r=new Array(this.size());let e=0;const t=this.words.length;for(let n=0;n<t;++n){let i=this.words[n];for(;i!=0;){const s=i&-i;r[e++]=(n<<5)+this.hammingWeight(s-1|0),i^=s}}return r},z.prototype.forEach=function(r){const e=this.words.length;for(let t=0;t<e;++t){let n=this.words[t];for(;n!=0;){const i=n&-n;r((t<<5)+this.hammingWeight(i-1|0)),n^=i}}},z.prototype[Symbol.iterator]=function(){const r=this.words.length;let e=0,t=this.words[e],n=this.hammingWeight,i=this.words;return{[Symbol.iterator](){return this},next(){for(;e<r;){if(t!==0){const s=t&-t,o=(e<<5)+n(s-1|0);return t^=s,{done:!1,value:o}}e++,e<r&&(t=i[e])}return{done:!0,value:void 0}}}},z.prototype.clone=function(){const r=Object.create(z.prototype);return r.words=this.words.slice(),r},z.prototype.intersects=function(r){const e=Math.min(this.words.length,r.words.length);for(let t=0;t<e;++t)if(this.words[t]&r.words[t])return!0;return!1},z.prototype.intersection=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]&=r.words[t],this.words[t+1]&=r.words[t+1],this.words[t+2]&=r.words[t+2],this.words[t+3]&=r.words[t+3],this.words[t+4]&=r.words[t+4],this.words[t+5]&=r.words[t+5],this.words[t+6]&=r.words[t+6],this.words[t+7]&=r.words[t+7];for(;t<e;++t)this.words[t]&=r.words[t];const n=this.words.length;for(t=e;t<n;++t)this.words[t]=0;return this},z.prototype.intersection_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(let n=0;n<e;++n)t+=this.hammingWeight(this.words[n]&r.words[n]);return t},z.prototype.new_intersection=function(r){const e=Object.create(z.prototype),t=Math.min(this.words.length,r.words.length);e.words=new Array(t);let n=0;for(;n+7<t;n+=8)e.words[n]=this.words[n]&r.words[n],e.words[n+1]=this.words[n+1]&r.words[n+1],e.words[n+2]=this.words[n+2]&r.words[n+2],e.words[n+3]=this.words[n+3]&r.words[n+3],e.words[n+4]=this.words[n+4]&r.words[n+4],e.words[n+5]=this.words[n+5]&r.words[n+5],e.words[n+6]=this.words[n+6]&r.words[n+6],e.words[n+7]=this.words[n+7]&r.words[n+7];for(;n<t;++n)e.words[n]=this.words[n]&r.words[n];return e},z.prototype.equals=function(r){const e=Math.min(this.words.length,r.words.length);for(let t=0;t<e;++t)if(this.words[t]!=r.words[t])return!1;if(this.words.length<r.words.length){const t=r.words.length;for(let n=this.words.length;n<t;++n)if(r.words[n]!=0)return!1}else if(r.words.length<this.words.length){const t=this.words.length;for(let n=r.words.length;n<t;++n)if(this.words[n]!=0)return!1}return!0},z.prototype.difference=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]&=~r.words[t],this.words[t+1]&=~r.words[t+1],this.words[t+2]&=~r.words[t+2],this.words[t+3]&=~r.words[t+3],this.words[t+4]&=~r.words[t+4],this.words[t+5]&=~r.words[t+5],this.words[t+6]&=~r.words[t+6],this.words[t+7]&=~r.words[t+7];for(;t<e;++t)this.words[t]&=~r.words[t];return this},z.prototype.new_difference=function(r){return this.clone().difference(r)},z.prototype.difference2=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)r.words[t]=this.words[t]&~r.words[t],r.words[t+1]=this.words[t+1]&~r.words[t+1],r.words[t+2]=this.words[t+2]&~r.words[t+2],r.words[t+3]=this.words[t+3]&~r.words[t+3],r.words[t+4]=this.words[t+4]&~r.words[t+4],r.words[t+5]=this.words[t+5]&~r.words[t+5],r.words[t+6]=this.words[t+6]&~r.words[t+6],r.words[t+7]=this.words[t+7]&~r.words[t+7];for(;t<e;++t)r.words[t]=this.words[t]&~r.words[t];for(t=this.words.length-1;t>=e;--t)r.words[t]=this.words[t];return r.words.length=this.words.length,r},z.prototype.difference_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0,n=0;for(;n<e;++n)t+=this.hammingWeight(this.words[n]&~r.words[n]);const i=this.words.length;for(;n<i;++n)t+=this.hammingWeight(this.words[n]);return t},z.prototype.change=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]^=r.words[t],this.words[t+1]^=r.words[t+1],this.words[t+2]^=r.words[t+2],this.words[t+3]^=r.words[t+3],this.words[t+4]^=r.words[t+4],this.words[t+5]^=r.words[t+5],this.words[t+6]^=r.words[t+6],this.words[t+7]^=r.words[t+7];for(;t<e;++t)this.words[t]^=r.words[t];for(t=r.words.length-1;t>=e;--t)this.words[t]=r.words[t];return this},z.prototype.new_change=function(r){const e=Object.create(z.prototype),t=Math.max(this.words.length,r.words.length);e.words=new Array(t);const n=Math.min(this.words.length,r.words.length);let i=0;for(;i+7<n;i+=8)e.words[i]=this.words[i]^r.words[i],e.words[i+1]=this.words[i+1]^r.words[i+1],e.words[i+2]=this.words[i+2]^r.words[i+2],e.words[i+3]=this.words[i+3]^r.words[i+3],e.words[i+4]=this.words[i+4]^r.words[i+4],e.words[i+5]=this.words[i+5]^r.words[i+5],e.words[i+6]=this.words[i+6]^r.words[i+6],e.words[i+7]=this.words[i+7]^r.words[i+7];for(;i<n;++i)e.words[i]=this.words[i]^r.words[i];const s=this.words.length;for(i=n;i<s;++i)e.words[i]=this.words[i];const o=r.words.length;for(i=n;i<o;++i)e.words[i]=r.words[i];return e},z.prototype.change_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0,n=0;for(;n<e;++n)t+=this.hammingWeight(this.words[n]^r.words[n]);const i=this.words.length>r.words.length?this:r,s=i.words.length;for(;n<s;++n)t+=this.hammingWeight(i.words[n]);return t},z.prototype.toString=function(){return"{"+this.array().join(",")+"}"},z.prototype.union=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(;t+7<e;t+=8)this.words[t]|=r.words[t],this.words[t+1]|=r.words[t+1],this.words[t+2]|=r.words[t+2],this.words[t+3]|=r.words[t+3],this.words[t+4]|=r.words[t+4],this.words[t+5]|=r.words[t+5],this.words[t+6]|=r.words[t+6],this.words[t+7]|=r.words[t+7];for(;t<e;++t)this.words[t]|=r.words[t];if(this.words.length<r.words.length){this.resize((r.words.length<<5)-1);const n=r.words.length;for(let i=e;i<n;++i)this.words[i]=r.words[i]}return this},z.prototype.new_union=function(r){const e=Object.create(z.prototype),t=Math.max(this.words.length,r.words.length);e.words=new Array(t);const n=Math.min(this.words.length,r.words.length);let i=0;for(;i+7<n;i+=8)e.words[i]=this.words[i]|r.words[i],e.words[i+1]=this.words[i+1]|r.words[i+1],e.words[i+2]=this.words[i+2]|r.words[i+2],e.words[i+3]=this.words[i+3]|r.words[i+3],e.words[i+4]=this.words[i+4]|r.words[i+4],e.words[i+5]=this.words[i+5]|r.words[i+5],e.words[i+6]=this.words[i+6]|r.words[i+6],e.words[i+7]=this.words[i+7]|r.words[i+7];for(;i<n;++i)e.words[i]=this.words[i]|r.words[i];const s=this.words.length;for(i=n;i<s;++i)e.words[i]=this.words[i];const o=r.words.length;for(i=n;i<o;++i)e.words[i]=r.words[i];return e},z.prototype.union_size=function(r){const e=Math.min(this.words.length,r.words.length);let t=0;for(let n=0;n<e;++n)t+=this.hammingWeight(this.words[n]|r.words[n]);if(this.words.length<r.words.length){const n=r.words.length;for(let i=this.words.length;i<n;++i)t+=this.hammingWeight(0|r.words[i])}else{const n=this.words.length;for(let i=r.words.length;i<n;++i)t+=this.hammingWeight(0|this.words[i])}return t};var ae=z;function Kt(){return Kt=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Kt.apply(this,arguments)}function jo(r,e){var t=[];return r.forEach(function(n){e.forEach(function(i){t.push(n.concat(i))})}),t}function Bn(r){return!!~r.search(/\(|\)/)}function on(r,e){for(var t=e.split(" "+r+" "),n=[],i=[],s=0;s<t.length;s++)if(Bn(t[s])||i.length>0){i.push(t[s]);var o=""+i;(o.match(/\(/g)||[]).length===(o.match(/\)/g)||[]).length&&(n.push(i.join(" "+r+" ")),i=[])}else n.push(t[s]);return n}var Lo=function r(e){return function(n){for(var i=n[0],s=1;s<n.length;s++)i=i.concat(n[s]);return i}(on("OR",(t=e=function(n){if(n.charAt(0)==="("){for(var i=0,s=0;s<n.length;s++)if(n.charAt(s)==="("?i++:n.charAt(s)===")"&&i--,i===0)return s!==n.length-1?n:n.substring(1,n.length-1)}return n}(e),e=t.replace(/[\s]+/g," "))).map(function(n){for(var i=on("AND",n),s=[],o=[],a=0;a<i.length;a++)Bn(i[a])?s.push(r(i[a])):o.push(i[a]);return s.push([o]),function(c){for(var d=[[]],h=0;h<c.length;h++)d=jo(d,c[h]);return d}(s)}));var t};const an=function(r){try{return structuredClone(r)}catch{try{return JSON.parse(JSON.stringify(r))}catch{return r}}},ln=function(r,e){let t=new ae([]),n=0;return $(e,function(i,s){i.forEach(o=>{++n,t=t.new_union(r[s][o]||new ae([]))})}),n===0?null:t},Oo=function(r,e,t){let n=1;return $(r.bits_data_temp,(i,s)=>{let o,a,c,d,h,w,y;t[s]&&(o=t[s].order,a=t[s].sort,c=t[s].size,d=t[s].title,h=t[s].show_facet_stats||!1,w=t[s].chosen_filters_on_top!==!1,y=t[s].hide_zero_doc_count||!1);let g,m,b,C,L=Object.entries(i).map(N=>{let Q=[];e&&e.filters&&e.filters[s]&&(Q=e.filters[s]);const F=N[1].array().length;if(!y||F!==0||Q.indexOf(N[0])!==-1)return{key:N[0],doc_count:F,selected:Q.indexOf(N[0])!==-1}}).filter(Boolean);var R,U;return se(a)?(g=a||["key"],m=o||["asc"]):(a==="term"||a==="key"?(g=["key"],m=[o||"asc"]):(g=["doc_count","key"],m=[o||"desc","asc"]),w&&(g.unshift("selected"),m.unshift("desc"))),L=ur(L,g,m),L=L.slice(0,c||10),h&&(b=[],Object.entries(i).forEach(N=>{if(isNaN(N[0]))throw new Error("You cant use chars to calculate the facet_stats.");N[1].array().length>0&&N[1].forEach(()=>{b.push(parseInt(N[0]))})}),C={min:(R=b,R&&R.length?$n(R,De(void 0),So):void 0),max:Co(b),avg:Eo(b),sum:Ao(b)}),Kt({name:s,title:d||(U=s,U.replace(/^[\s_]+|[\s_]+$/g,"").replace(/[_\s]+/g," ").replace(/^[a-z]/,function(N){return N.toUpperCase()})),position:n++,buckets:L},h&&{facet_stats:C})})};function cn(r,e,t,n,i){e=e||Object.create(null);const s=parseInt(e.per_page||12),o=parseInt(e.page||1),a=e.is_all_filtered_items||!1;if(t.native_search_enabled===!1&&(e.query||e.filter))throw new Error('"query" and "filter" options are not working once native search is disabled');let c=0;const d=new Date().getTime();let h,w,y,g=i.bits_ids();if(e._ids)h=new ae(e._ids),w=e._ids;else if(e.ids)w=i.internal_ids_from_ids_map(e.ids),h=new ae(w);else if(n&&(e.query||e.filter)){const F=new Date().getTime();w=n.search(e.query,e.filter),c=new Date().getTime()-F,h=new ae(w)}let m=new Date().getTime();const b=i.search(e,{query_ids:h});m=new Date().getTime()-m,h&&(g=h),b.ids&&(g=g.new_intersection(b.ids)),b.not_ids&&(g=g.new_difference(b.not_ids));let C=g.array(),L=C.map(F=>i.get_item(F)),R=!1;const U=new Date().getTime();let N=0;e.sort?L=function(F,P,X){return X&&X[P]&&(P=X[P]),P.field?ur(F,P.field,P.order||"asc"):F}(L,e.sort,t.sortings):w&&(C=w.filter(F=>g.has(F)),L=C.slice((o-1)*s,o*s).map(F=>i.get_item(F)),R=!0),R||(y=a?L:null,L=L.slice((o-1)*s,o*s)),N=new Date().getTime()-U;const Q=new Date().getTime()-d;return{pagination:{per_page:s,page:o,total:C.length},timings:{total:Q,facets:m,search:c,sorting:N},data:{items:L,allFilteredItems:y,aggregations:Oo(b,e,t.aggregations)}}}var gt=function(r){var e={exports:{}};return function(t,n){(function(){var i,s,o,a,c,d,h,w,y,g,m,b,C,L,R,U,N,Q,F,P,X,ce,we,te,le,ue,ge,de,x=function(l){var f=new x.Index;return f.pipeline.add(x.trimmer,x.stopWordFilter,x.stemmer),l&&l.call(f,f),f};x.version="1.0.0",x.utils={},x.utils.warn=function(l){return function(f){l.console&&console.warn&&console.warn(f)}}(this),x.utils.asString=function(l){return l==null?"":l.toString()},x.EventEmitter=function(){this.events={}},x.EventEmitter.prototype.addListener=function(){var l=Array.prototype.slice.call(arguments),f=l.pop(),_=l;if(typeof f!="function")throw new TypeError("last argument must be a function");_.forEach(function(E){this.hasHandler(E)||(this.events[E]=[]),this.events[E].push(f)},this)},x.EventEmitter.prototype.removeListener=function(l,f){if(this.hasHandler(l)){var _=this.events[l].indexOf(f);this.events[l].splice(_,1),this.events[l].length||delete this.events[l]}},x.EventEmitter.prototype.emit=function(l){if(this.hasHandler(l)){var f=Array.prototype.slice.call(arguments,1);this.events[l].forEach(function(_){_.apply(void 0,f)})}},x.EventEmitter.prototype.hasHandler=function(l){return l in this.events},x.tokenizer=function(l){return arguments.length&&l!=null&&l!=null?Array.isArray(l)?l.map(function(f){return x.utils.asString(f).toLowerCase()}):l.toString().trim().toLowerCase().split(x.tokenizer.separator):[]},x.tokenizer.separator=/[\s\-]+/,x.tokenizer.load=function(l){var f=this.registeredFunctions[l];if(!f)throw new Error("Cannot load un-registered function: "+l);return f},x.tokenizer.label="default",x.tokenizer.registeredFunctions={default:x.tokenizer},x.tokenizer.registerFunction=function(l,f){f in this.registeredFunctions&&x.utils.warn("Overwriting existing tokenizer: "+f),l.label=f,this.registeredFunctions[f]=l},x.Pipeline=function(){this._stack=[]},x.Pipeline.registeredFunctions={},x.Pipeline.registerFunction=function(l,f){f in this.registeredFunctions&&x.utils.warn("Overwriting existing registered function: "+f),l.label=f,x.Pipeline.registeredFunctions[l.label]=l},x.Pipeline.warnIfFunctionNotRegistered=function(l){l.label&&l.label in this.registeredFunctions||x.utils.warn(`Function is not registered with pipeline. This may cause problems when serialising the index.
`,l)},x.Pipeline.load=function(l){var f=new x.Pipeline;return l.forEach(function(_){var E=x.Pipeline.registeredFunctions[_];if(!E)throw new Error("Cannot load un-registered function: "+_);f.add(E)}),f},x.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(l){x.Pipeline.warnIfFunctionNotRegistered(l),this._stack.push(l)},this)},x.Pipeline.prototype.after=function(l,f){x.Pipeline.warnIfFunctionNotRegistered(f);var _=this._stack.indexOf(l);if(_==-1)throw new Error("Cannot find existingFn");this._stack.splice(_+=1,0,f)},x.Pipeline.prototype.before=function(l,f){x.Pipeline.warnIfFunctionNotRegistered(f);var _=this._stack.indexOf(l);if(_==-1)throw new Error("Cannot find existingFn");this._stack.splice(_,0,f)},x.Pipeline.prototype.remove=function(l){var f=this._stack.indexOf(l);f!=-1&&this._stack.splice(f,1)},x.Pipeline.prototype.run=function(l){for(var f=[],_=l.length,E=this._stack.length,A=0;A<_;A++){for(var j=l[A],T=0;T<E&&(j=this._stack[T](j,A,l))!==void 0&&j!=="";T++);j!==void 0&&j!==""&&f.push(j)}return f},x.Pipeline.prototype.reset=function(){this._stack=[]},x.Pipeline.prototype.toJSON=function(){return this._stack.map(function(l){return x.Pipeline.warnIfFunctionNotRegistered(l),l.label})},x.Vector=function(){this._magnitude=null,this.list=void 0,this.length=0},x.Vector.Node=function(l,f,_){this.idx=l,this.val=f,this.next=_},x.Vector.prototype.insert=function(l,f){this._magnitude=void 0;var _=this.list;if(!_)return this.list=new x.Vector.Node(l,f,_),this.length++;if(l<_.idx)return this.list=new x.Vector.Node(l,f,_),this.length++;for(var E=_,A=_.next;A!=null;){if(l<A.idx)return E.next=new x.Vector.Node(l,f,A),this.length++;E=A,A=A.next}return E.next=new x.Vector.Node(l,f,A),this.length++},x.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var l,f=this.list,_=0;f;)_+=(l=f.val)*l,f=f.next;return this._magnitude=Math.sqrt(_)},x.Vector.prototype.dot=function(l){for(var f=this.list,_=l.list,E=0;f&&_;)f.idx<_.idx?f=f.next:(f.idx>_.idx||(E+=f.val*_.val,f=f.next),_=_.next);return E},x.Vector.prototype.similarity=function(l){return this.dot(l)/(this.magnitude()*l.magnitude())},x.SortedSet=function(){this.length=0,this.elements=[]},x.SortedSet.load=function(l){var f=new this;return f.elements=l,f.length=l.length,f},x.SortedSet.prototype.add=function(){var l,f;for(l=0;l<arguments.length;l++)~this.indexOf(f=arguments[l])||this.elements.splice(this.locationFor(f),0,f);this.length=this.elements.length},x.SortedSet.prototype.toArray=function(){return this.elements.slice()},x.SortedSet.prototype.map=function(l,f){return this.elements.map(l,f)},x.SortedSet.prototype.forEach=function(l,f){return this.elements.forEach(l,f)},x.SortedSet.prototype.indexOf=function(l){for(var f=0,_=this.elements.length,E=_-f,A=f+Math.floor(E/2),j=this.elements[A];E>1;){if(j===l)return A;j<l&&(f=A),j>l&&(_=A),E=_-f,A=f+Math.floor(E/2),j=this.elements[A]}return j===l?A:-1},x.SortedSet.prototype.locationFor=function(l){for(var f=0,_=this.elements.length,E=_-f,A=f+Math.floor(E/2),j=this.elements[A];E>1;)j<l&&(f=A),j>l&&(_=A),E=_-f,A=f+Math.floor(E/2),j=this.elements[A];return j>l?A:j<l?A+1:void 0},x.SortedSet.prototype.intersect=function(l){for(var f=new x.SortedSet,_=0,E=0,A=this.length,j=l.length,T=this.elements,Z=l.elements;!(_>A-1||E>j-1);)T[_]!==Z[E]?T[_]<Z[E]?_++:T[_]>Z[E]&&E++:(f.add(T[_]),_++,E++);return f},x.SortedSet.prototype.clone=function(){var l=new x.SortedSet;return l.elements=this.toArray(),l.length=l.elements.length,l},x.SortedSet.prototype.union=function(l){var f,_,E;this.length>=l.length?(f=this,_=l):(f=l,_=this),E=f.clone();for(var A=0,j=_.toArray();A<j.length;A++)E.add(j[A]);return E},x.SortedSet.prototype.toJSON=function(){return this.toArray()},x.Index=function(){this._fields=[],this._ref="id",this.pipeline=new x.Pipeline,this.documentStore=new x.Store,this.tokenStore=new x.TokenStore,this.corpusTokens=new x.SortedSet,this.eventEmitter=new x.EventEmitter,this.tokenizerFn=x.tokenizer,this._idfCache={},this.on("add","remove","update",(function(){this._idfCache={}}).bind(this))},x.Index.prototype.on=function(){var l=Array.prototype.slice.call(arguments);return this.eventEmitter.addListener.apply(this.eventEmitter,l)},x.Index.prototype.off=function(l,f){return this.eventEmitter.removeListener(l,f)},x.Index.load=function(l){l.version!==x.version&&x.utils.warn("version mismatch: current "+x.version+" importing "+l.version);var f=new this;return f._fields=l.fields,f._ref=l.ref,f.tokenizer(x.tokenizer.load(l.tokenizer)),f.documentStore=x.Store.load(l.documentStore),f.tokenStore=x.TokenStore.load(l.tokenStore),f.corpusTokens=x.SortedSet.load(l.corpusTokens),f.pipeline=x.Pipeline.load(l.pipeline),f},x.Index.prototype.field=function(l,f){return this._fields.push({name:l,boost:(f=f||{}).boost||1}),this},x.Index.prototype.ref=function(l){return this._ref=l,this},x.Index.prototype.tokenizer=function(l){return l.label&&l.label in x.tokenizer.registeredFunctions||x.utils.warn("Function is not a registered tokenizer. This may cause problems when serialising the index"),this.tokenizerFn=l,this},x.Index.prototype.add=function(l,f){var _={},E=new x.SortedSet,A=l[this._ref];f=f===void 0||f,this._fields.forEach(function(Be){var ke=this.pipeline.run(this.tokenizerFn(l[Be.name]));_[Be.name]=ke;for(var Ae=0;Ae<ke.length;Ae++){var je=ke[Ae];E.add(je),this.corpusTokens.add(je)}},this),this.documentStore.set(A,E);for(var j=0;j<E.length;j++){for(var T=E.elements[j],Z=0,D=0;D<this._fields.length;D++){var ye=this._fields[D],Fe=_[ye.name],he=Fe.length;if(he){for(var be=0,Se=0;Se<he;Se++)Fe[Se]===T&&be++;Z+=be/he*ye.boost}}this.tokenStore.add(T,{ref:A,tf:Z})}f&&this.eventEmitter.emit("add",l,this)},x.Index.prototype.remove=function(l,f){var _=l[this._ref];if(f=f===void 0||f,this.documentStore.has(_)){var E=this.documentStore.get(_);this.documentStore.remove(_),E.forEach(function(A){this.tokenStore.remove(A,_)},this),f&&this.eventEmitter.emit("remove",l,this)}},x.Index.prototype.update=function(l,f){f=f===void 0||f,this.remove(l,!1),this.add(l,!1),f&&this.eventEmitter.emit("update",l,this)},x.Index.prototype.idf=function(l){var f="@"+l;if(Object.prototype.hasOwnProperty.call(this._idfCache,f))return this._idfCache[f];var _=this.tokenStore.count(l),E=1;return _>0&&(E=1+Math.log(this.documentStore.length/_)),this._idfCache[f]=E},x.Index.prototype.search=function(l){var f=this.pipeline.run(this.tokenizerFn(l)),_=new x.Vector,E=[],A=this._fields.reduce(function(j,T){return j+T.boost},0);return f.some(function(j){return this.tokenStore.has(j)},this)?(f.forEach(function(j,T,Z){var D=1/Z.length*this._fields.length*A,ye=this,Fe=this.tokenStore.expand(j).reduce(function(he,be){var Se=ye.corpusTokens.indexOf(be),Be=ye.idf(be),ke=1,Ae=new x.SortedSet;if(be!==j){var je=Math.max(3,be.length-j.length);ke=1/Math.log(je)}Se>-1&&_.insert(Se,D*Be*ke);for(var Ue=ye.tokenStore.get(be),ot=Object.keys(Ue),At=ot.length,Qe=0;Qe<At;Qe++)Ae.add(Ue[ot[Qe]].ref);return he.union(Ae)},new x.SortedSet);E.push(Fe)},this),E.reduce(function(j,T){return j.intersect(T)}).map(function(j){return{ref:j,score:_.similarity(this.documentVector(j))}},this).sort(function(j,T){return T.score-j.score})):[]},x.Index.prototype.documentVector=function(l){for(var f=this.documentStore.get(l),_=f.length,E=new x.Vector,A=0;A<_;A++){var j=f.elements[A],T=this.tokenStore.get(j)[l].tf,Z=this.idf(j);E.insert(this.corpusTokens.indexOf(j),T*Z)}return E},x.Index.prototype.toJSON=function(){return{version:x.version,fields:this._fields,ref:this._ref,tokenizer:this.tokenizerFn.label,documentStore:this.documentStore.toJSON(),tokenStore:this.tokenStore.toJSON(),corpusTokens:this.corpusTokens.toJSON(),pipeline:this.pipeline.toJSON()}},x.Index.prototype.use=function(l){var f=Array.prototype.slice.call(arguments,1);f.unshift(this),l.apply(this,f)},x.Store=function(){this.store={},this.length=0},x.Store.load=function(l){var f=new this;return f.length=l.length,f.store=Object.keys(l.store).reduce(function(_,E){return _[E]=x.SortedSet.load(l.store[E]),_},{}),f},x.Store.prototype.set=function(l,f){this.has(l)||this.length++,this.store[l]=f},x.Store.prototype.get=function(l){return this.store[l]},x.Store.prototype.has=function(l){return l in this.store},x.Store.prototype.remove=function(l){this.has(l)&&(delete this.store[l],this.length--)},x.Store.prototype.toJSON=function(){return{store:this.store,length:this.length}},x.stemmer=(i={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},s={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},d="^("+(a="[^aeiou][^aeiouy]*")+")?"+(c=(o="[aeiouy]")+"[aeiou]*")+a+"("+c+")?$",h="^("+a+")?"+c+a+c+a,w="^("+a+")?"+o,y=new RegExp("^("+a+")?"+c+a),g=new RegExp(h),m=new RegExp(d),b=new RegExp(w),C=/^(.+?)(ss|i)es$/,L=/^(.+?)([^s])s$/,R=/^(.+?)eed$/,U=/^(.+?)(ed|ing)$/,N=/.$/,Q=/(at|bl|iz)$/,F=new RegExp("([^aeiouylsz])\\1$"),P=new RegExp("^"+a+o+"[^aeiouwxy]$"),X=/^(.+?[^aeiou])y$/,ce=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,we=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,te=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,le=/^(.+?)(s|t)(ion)$/,ue=/^(.+?)e$/,ge=/ll$/,de=new RegExp("^"+a+o+"[^aeiouwxy]$"),function(l){var f,_,E,A,j,T,Z;if(l.length<3)return l;if((E=l.substr(0,1))=="y"&&(l=E.toUpperCase()+l.substr(1)),j=L,(A=C).test(l)?l=l.replace(A,"$1$2"):j.test(l)&&(l=l.replace(j,"$1$2")),j=U,(A=R).test(l)){var D=A.exec(l);(A=y).test(D[1])&&(l=l.replace(A=N,""))}else j.test(l)&&(D=j.exec(l),(j=b).test(f=D[1])&&(T=F,Z=P,(j=Q).test(l=f)?l+="e":T.test(l)?l=l.replace(A=N,""):Z.test(l)&&(l+="e")));return(A=X).test(l)&&(l=(f=(D=A.exec(l))[1])+"i"),(A=ce).test(l)&&(_=(D=A.exec(l))[2],(A=y).test(f=D[1])&&(l=f+i[_])),(A=we).test(l)&&(_=(D=A.exec(l))[2],(A=y).test(f=D[1])&&(l=f+s[_])),j=le,(A=te).test(l)?(D=A.exec(l),(A=g).test(f=D[1])&&(l=f)):j.test(l)&&(D=j.exec(l),(j=g).test(f=D[1]+D[2])&&(l=f)),(A=ue).test(l)&&(D=A.exec(l),j=m,T=de,((A=g).test(f=D[1])||j.test(f)&&!T.test(f))&&(l=f)),j=g,(A=ge).test(l)&&j.test(l)&&(l=l.replace(A=N,"")),E=="y"&&(l=E.toLowerCase()+l.substr(1)),l}),x.Pipeline.registerFunction(x.stemmer,"stemmer"),x.generateStopWordFilter=function(l){var f=l.reduce(function(_,E){return _[E]=E,_},{});return function(_){if(_&&f[_]!==_)return _}},x.stopWordFilter=x.generateStopWordFilter(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]),x.Pipeline.registerFunction(x.stopWordFilter,"stopWordFilter"),x.trimmer=function(l){return l.replace(/^\W+/,"").replace(/\W+$/,"")},x.Pipeline.registerFunction(x.trimmer,"trimmer"),x.TokenStore=function(){this.root={docs:{}},this.length=0},x.TokenStore.load=function(l){var f=new this;return f.root=l.root,f.length=l.length,f},x.TokenStore.prototype.add=function(l,f,_){_=_||this.root;var E=l.charAt(0),A=l.slice(1);return E in _||(_[E]={docs:{}}),A.length===0?(_[E].docs[f.ref]=f,void(this.length+=1)):this.add(A,f,_[E])},x.TokenStore.prototype.has=function(l){if(!l)return!1;for(var f=this.root,_=0;_<l.length;_++){if(!f[l.charAt(_)])return!1;f=f[l.charAt(_)]}return!0},x.TokenStore.prototype.getNode=function(l){if(!l)return{};for(var f=this.root,_=0;_<l.length;_++){if(!f[l.charAt(_)])return{};f=f[l.charAt(_)]}return f},x.TokenStore.prototype.get=function(l,f){return this.getNode(l,f).docs||{}},x.TokenStore.prototype.count=function(l,f){return Object.keys(this.get(l,f)).length},x.TokenStore.prototype.remove=function(l,f){if(l){for(var _=this.root,E=0;E<l.length;E++){if(!(l.charAt(E)in _))return;_=_[l.charAt(E)]}delete _.docs[f]}},x.TokenStore.prototype.expand=function(l,f){var _=this.getNode(l);return f=f||[],Object.keys(_.docs||{}).length&&f.push(l),Object.keys(_).forEach(function(E){E!=="docs"&&f.concat(this.expand(l+E,f))},this),f},x.TokenStore.prototype.toJSON=function(){return{root:this.root,length:this.length}},t.exports=x})()}(e),e.exports}();class un{constructor(e,t){this.store=new Map,this.idx=gt(function(){this.field("name",{boost:10}),((t==null?void 0:t.searchableFields)||[]).forEach(i=>this.field(i)),this.ref("_id"),t!=null&&t.isExactSearch&&(this.pipeline.remove(gt.stemmer),this.pipeline.remove(gt.stopWordFilter)),t!=null&&t.removeStopWordFilter&&this.pipeline.remove(gt.stopWordFilter)});let n=1;(e||[]).map(i=>{i._id=n,++n,this.idx.add(i),this.store.set(i._id,i)})}search_full(e,t){return this.search(e,t).map(n=>this.store.get(n))}search(e,t){return t instanceof Function?(e?this.idx.search(e).map(n=>this.store.get(n.ref)):[...this.store.values()]).filter(t).map(n=>n._id):e?this.idx.search(e).map(n=>n.ref):[...this.store.keys()]}}class dn{constructor(e,t){(t=t||Object.create(null)).aggregations=t.aggregations||Object.create(null),this._items=e,this.config=t.aggregations,this.facets=function(o,a){a=a||[];const c={data:Object.create(null),bits_data:Object.create(null),bits_data_temp:Object.create(null)};let d=1;return a.forEach(h=>{c.data[h]=Object.create(null)}),o&&o.map(h=>(h._id||(h._id=d,++d),h)),o&&o.map(h=>(a.forEach(w=>{if(h){if(Array.isArray(h[w]))h[w].forEach(y=>{h[w]&&(c.data[w][y]||(c.data[w][y]=[]),c.data[w][y].push(parseInt(h._id)))});else if(h[w]!==void 0){const y=h[w];c.data[w][y]||(c.data[w][y]=[]),c.data[w][y].push(parseInt(h._id))}}}),h)),c.data=$(c.data,function(h,w){return c.bits_data[w]||(c.bits_data[w]=Object.create(null),c.bits_data_temp[w]=Object.create(null)),$(h,function(y,g){const m=ko(y);return c.bits_data[w][g]=new ae(m),m})}),c}(e,st(t.aggregations)),this._items_map=Object.create(null),this._ids=[];let n=1;var i,s;s=o=>{this._ids.push(n),this._items_map[n]=o,o._id=n,++n},(se(i=e)?He:zn)(i,De(s)),this.ids_map=Object.create(null),e&&e.forEach(o=>{const a=t.custom_id_field||"id";o[a]&&o._id&&(this.ids_map[o[a]]=o._id)}),this._bits_ids=new ae(this._ids)}items(){return this._items}bits_ids(e){return e?new ae(e):this._bits_ids}internal_ids_from_ids_map(e){return e.map(t=>this.ids_map[t])}index(){return this.facets}get_item(e){return this._items_map[e]}search(e,t){const n=this.config;t=t||Object.create(null);const i=Ut(this.facets);let s;i.not_ids=ln(i.bits_data,e.not_filters);const o=function(a,c){const d=[];return $(a.filters,function(h,w){if(h&&h.length)if(c[w].conjunction!==!1)$(h,function(y){d.push([w,y])});else{const y=[];$(h,function(g){y.push([w,g])}),d.push(y)}}),$(a.not_filters,function(h,w){h&&h.length&&$(h,function(y){d.push([w,"-",y])})}),d}(e,n);return s=function(a,c){const d=Ut(a);let h;c=c||[],$(d.bits_data,function(y,g){$(d.bits_data[g],function(m,b){d.bits_data_temp[g][b]=d.bits_data[g][b]})}),d.is_temp_copied=!0;const w=function(y,g){const m=Object.create(null);return $(g,function(b){if(Array.isArray(b[0])){let C=new ae([]);$(b,function(L){const R=L[0];C=C.new_union(y.bits_data[R][L[1]]||new ae([])),m[R]=C})}}),m}(a,c);return $(c,function(y){if(!Array.isArray(y[0])){const g=y[0],m=y[1];h=h&&d.bits_data_temp[g][m]?d.bits_data_temp[g][m].new_intersection(h):h&&!d.bits_data_temp[g][m]?new ae([]):d.bits_data_temp[g][m]}}),h&&$(d.bits_data_temp,function(y,g){$(d.bits_data_temp[g],function(m,b){d.bits_data_temp[g][b]=d.bits_data_temp[g][b].new_intersection(h)})}),$(c,function(y){if(y.length===3&&y[1]==="-"){const g=d.bits_data_temp[y[0]][y[2]].clone();$(d.bits_data_temp,function(m,b){$(d.bits_data_temp[b],function(C,L){d.bits_data_temp[b][L]=d.bits_data_temp[b][L].new_difference(g)})})}}),$(d.bits_data_temp,function(y,g){$(d.bits_data_temp[g],function(m,b){$(w,function(C,L){L!==g&&(d.bits_data_temp[g][b]=d.bits_data_temp[g][b].new_intersection(C))})})}),d}(this.facets,o),e.filters_query&&(s=function(a,c){const d=Ut(a);d.is_temp_copied||$(d.bits_data,function(w,y){$(d.bits_data[y],function(g,m){d.bits_data_temp[y][m]=d.bits_data[y][m]})});let h=null;return $(c,function(w){let y=null;$(w,function(g){const m=g[0],b=g[1];if(!d.bits_data_temp[m])throw new Error("Panic. The key does not exist in facets lists.");y=y&&d.bits_data_temp[m][b]?d.bits_data_temp[m][b].new_intersection(y):y&&!d.bits_data_temp[m][b]?new ae([]):d.bits_data_temp[m][b]}),h=(h||new ae([])).new_union(y||new ae([]))}),h!==null&&$(d.bits_data_temp,function(w,y){$(d.bits_data_temp[y],function(g,m){d.bits_data_temp[y][m]=d.bits_data_temp[y][m].new_intersection(h)})}),d}(s,Lo(e.filters_query).map(a=>Array.isArray(a)?a.map(c=>Array.isArray(c)?c.map(d=>d):c.split(":")):a.split(":")))),i.bits_data_temp=s.bits_data_temp,$(i.bits_data_temp,function(a,c){$(i.bits_data_temp[c],function(d,h){t.query_ids&&(i.bits_data_temp[c][h]=t.query_ids.new_intersection(i.bits_data_temp[c][h])),t.test&&(i.data[c][h]=i.bits_data_temp[c][h].array())})}),i.ids=e.filters_query?function(a){let c=new ae([]);return $(a,function(d,h){$(a[h],function(w,y){c=c.new_union(a[h][y])})}),c}(i.bits_data_temp):ln(i.bits_data_temp,e.filters),i}}function Fo(r,e){let t;(e=e||Object.create(null)).native_search_enabled!==!1&&(t=new un(r,e));let n=new dn(r,e);return{search:function(i){return(i=i||Object.create(null)).aggregations=function(s,o){return $(an(s),(a,c)=>{a.field||(a.field=c);let d=[];o.filters&&o.filters[c]&&(d=o.filters[c]),a.filters=d;let h=[];return o.not_filters&&o.not_filters[c]&&(h=o.not_filters[c]),o.exclude_filters&&o.exclude_filters[c]&&(h=o.exclude_filters[c]),a.not_filters=h,a})}(e.aggregations,i),cn(0,i,e,t,n)},similar:function(i,s){return function(o,a,c){const d=c.per_page||10,h=c.minimum||0,w=c.page||1;let y;for(let b=0;b<o.length;++b)if(o[b].id==a){y=o[b];break}if(!c.field)throw new Error("Please define field in options");const g=c.field;let m=[];for(let b=0;b<o.length;++b)if(o[b].id!==a){const C=_o(y[g],o[b][g]);C.length>=h&&(m.push(o[b]),m[m.length-1].intersection_length=C.length)}return m=ur(m,["intersection_length"],["desc"]),{pagination:{per_page:d,page:w,total:m.length},data:{items:m.slice((w-1)*d,w*d)}}}(r,i,s)},aggregation:function(i){return function(s,o,a,c,d){const h=o.per_page||10,w=o.page||1;if(o.name&&(!a.aggregations||!a.aggregations[o.name]))throw new Error('Please define aggregation "'.concat(o.name,'" in config'));const y=an(o);if(y.page=1,y.per_page=0,!o.name)throw new Error("field name is required");a.aggregations[o.name].size=1e4;const g=cn(0,y,a,c,d).data.aggregations[o.name].buckets;return{pagination:{per_page:h,page:w,total:g.length},data:{buckets:g.slice((w-1)*h,w*h)}}}(0,i,e,t,n)},reindex:function(i){t=new un(r=i,e),n=new dn(r,e)}}}class Io{constructor(e){this.config=e,this.state={query:"",filters:{},sort:"",bounds:null},this.state.sort=this.config.searchConfig.defaultSort,this.state.filters=this.createEmptyFilters()}createEmptyFilters(){const e={};for(const[t]of Object.entries(this.config.aggregations))e[t]=[];return e}hasActiveFilters(){if(!this.state.filters)return!1;for(const[e,t]of Object.entries(this.state.filters))if(Array.isArray(t)&&t.length>0||!Array.isArray(t)&&t)return!0;return!1}updateFilters(e,t,n){var i;console.log(`Updating filter: ${e}, value: ${t}, checked: ${n}`),n?(this.state.filters[e]||(this.state.filters[e]=[]),this.state.filters[e].includes(t)||this.state.filters[e].push(t)):this.state.filters[e]=((i=this.state.filters[e])==null?void 0:i.filter(s=>s!==t))||[]}async handleStateChange(e,t){console.log("handleStateChange called with action:",e);try{switch(e.type){case"FACET_CHANGE":this.updateFilters(e.facetType,e.value,e.checked);break;case"RANGE_CHANGE":this.state.filters[e.facetKey]=e.value;break;case"QUERY_CHANGE":this.state.query=e.query;break;case"SORT_CHANGE":this.state.sort=e.sort;break}console.log("State updated, triggering search. New state:",this.state),t&&t.onStateChange&&await t.onStateChange(this.state)}catch(n){console.error("Error in handleStateChange:",n)}}getState(){return this.state}setState(e){this.state={...this.state,...e}}}class Po{static debounce(e,t){let n;return function(){clearTimeout(n),n=setTimeout(()=>e.apply(this,arguments),t)}}static parseCoordinates(e){if(!e||typeof e!="string")return{lat:null,lng:null};const t=e.split(",");return t.length===2?{lat:parseFloat(t[0].trim()),lng:parseFloat(t[1].trim())}:{lat:null,lng:null}}static encodeForAttribute(e){return encodeURIComponent(e||"")}static createUniqueId(e="element"){return`${e}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}static isEmpty(e){return e==null?!0:typeof e=="string"?e.trim()==="":Array.isArray(e)?e.length===0:typeof e=="object"?Object.keys(e).length===0:!1}}class No{constructor(e,t){this.searchHandler=e,this.config=t,this.isLoading=!1,this.debouncedSearch=Po.debounce(async(n,i)=>{await this.performSearch(n,i)},300)}async performSearch(e,t){var n;try{const i=this.searchHandler.performSearch(e,{onMarkersUpdate:t.onMarkersUpdate,onResultsUpdate:t.onResultsUpdate,onAggregationsUpdate:t.onAggregationsUpdate}),s=this.calculateUniqueResultsCount(i.items);return t.onNavBarUpdate&&t.onNavBarUpdate(i.items||[]),console.log("Search completed:",((n=i.items)==null?void 0:n.length)||0,"items found"),i}catch(i){console.error("Search error:",i),t.onError&&t.onError("Search failed","error")}}calculateUniqueResultsCount(e){if(!e||!Array.isArray(e))return 0;const t=new Set;return e.forEach(n=>{var s,o,a,c,d,h;const i=n.pivot_ID||n.pivotID||n.pivot_id||((s=n._source)==null?void 0:s.pivot_ID)||((o=n._source)==null?void 0:o.pivotID)||((a=n._source)==null?void 0:a.pivot_id)||((c=n.source)==null?void 0:c.pivot_ID)||((d=n.source)==null?void 0:d.pivotID)||((h=n.source)==null?void 0:h.pivot_id);i!=null&&i!==""&&t.add(i)}),t.size}getLoadingStatus(){return{isLoading:this.isLoading}}}class Ro{constructor(){this.fullScreenLoader=null}showFullScreenLoader(){this.fullScreenLoader||(this.fullScreenLoader=document.createElement("div"),this.fullScreenLoader.className="fixed inset-0 z-[9999] bg-white flex items-center justify-center",this.fullScreenLoader.innerHTML=`
        <div class="text-center">
          <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-primary-500 mx-auto mb-4"></div>
          <h2 class="text-xl font-semibold text-gray-700 mb-2">Loading LEDA Search</h2>
          <p class="text-gray-500">Initializing map, data, and components...</p>
        </div>
      `,document.body.appendChild(this.fullScreenLoader)),this.fullScreenLoader.style.display="flex"}hideFullScreenLoader(){this.fullScreenLoader&&(this.fullScreenLoader.style.opacity="0",this.fullScreenLoader.style.transition="opacity 0.3s ease-out",setTimeout(()=>{this.fullScreenLoader&&(this.fullScreenLoader.style.display="none")},300))}showNotification(e,t="info"){const n=document.createElement("div");n.className=`fixed top-4 right-4 z-50 p-3 rounded-lg shadow-lg max-w-sm text-white transition-all duration-300 ${t==="error"?"bg-red-500":t==="warning"?"bg-yellow-500":"bg-blue-500"}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>n.remove(),300)},3e3)}showFilterNotification(e,t){const n=document.createElement("div");n.className="fixed top-4 right-4 bg-blue-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all duration-300",n.style.transform="translateX(100%)",n.innerHTML=`
      <div class="flex items-center space-x-3">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
        </svg>
        <span>Filtro applicato: <strong>${e}</strong> = "${t}"</span>
        <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    `,document.body.appendChild(n),setTimeout(()=>{n.style.transform="translateX(0)"},100),setTimeout(()=>{n.style.transform="translateX(100%)",setTimeout(()=>{n.parentElement&&n.parentElement.removeChild(n)},300)},5e3)}}class zo{constructor(e,t){this.stateManager=e,this.config=t}applyUrlFilters(e){const t=new URLSearchParams(window.location.search),n=t.get("filter"),i=t.get("value");if(console.log("Checking URL parameters:",{filterKey:n,filterValue:i}),n&&i)if(console.log(`Applying URL filter: ${n} = ${i}`),this.config.aggregations&&this.config.aggregations[n]){const s=this.config.aggregations[n];let o=i;if(s.type==="range"){const c=i.includes("-")?i.split("-").map(d=>parseInt(d.trim(),10)):i.split(",").map(d=>parseInt(d.trim(),10));if(c.length===2&&!isNaN(c[0])&&!isNaN(c[1]))o=c;else{console.error(`Invalid range format: ${i}`);return}}const a=this.stateManager.getState();s.type==="range"?a.filters[n]=o:(a.filters[n]||(a.filters[n]=[]),a.filters[n].includes(o)||a.filters[n].push(o)),this.stateManager.setState(a),console.log("State filters after URL application:",a.filters),setTimeout(async()=>{e.onApplyFilters&&await e.onApplyFilters(),console.log(`Filter applied and search completed: ${n} = ${i}`),e.onShowNotification&&e.onShowNotification(n,i)},1500)}else console.warn(`Filter key '${n}' not found in configuration`),e.onError&&e.onError(`Filtro '${n}' non trovato`,"warning")}clearAllFilters(){const e=this.stateManager.getState();e.query="",e.filters=this.stateManager.createEmptyFilters(),this.stateManager.setState(e);const t=document.getElementById("search-input");t&&(t.value="")}removeFilter(e,t){const n=this.stateManager.getState();n.filters[e]&&(t?n.filters[e]=n.filters[e].filter(i=>i!==t):n.filters[e]=[],this.stateManager.setState(n))}clearSearchQuery(){const e=this.stateManager.getState();e.query="",this.stateManager.setState(e);const t=document.getElementById("search-input");t&&(t.value="")}}class $o{constructor(e,t,n){this.stateManager=e,this.config=t,this.callbacks=n}bindEvents(){this.setupSearchInput(),this.setupSortSelect()}bindNavBarEvents(e){e.addEventListener("clearAllFilters",()=>{this.callbacks.onClearAllFilters&&this.callbacks.onClearAllFilters()}),e.addEventListener("removeFilter",t=>{const{facetKey:n,value:i}=t.detail;this.callbacks.onRemoveFilter&&this.callbacks.onRemoveFilter(n,i)}),e.addEventListener("clearSearchQuery",()=>{this.callbacks.onClearSearchQuery&&this.callbacks.onClearSearchQuery()})}setupSearchInput(){const e=document.getElementById("search-input");e&&e.addEventListener("input",()=>{const t=this.stateManager.getState();t.query=e.value,this.stateManager.setState(t),this.callbacks.onSearch&&this.callbacks.onSearch()})}setupSortSelect(){const e=document.getElementById("sort-select");e&&this.config.searchConfig.sortOptions&&(e.innerHTML=this.config.searchConfig.sortOptions.map(t=>`<option value="${t.value}">${t.label}</option>`).join(""),e.addEventListener("change",t=>{const n=this.stateManager.getState();n.sort=t.target.value,this.stateManager.setState(n),this.callbacks.onSortChange&&this.callbacks.onSortChange()}))}}class To{constructor(){this.activeFiltersCount=0,this.mentionsCount=0,this.resultsCount=0,this.uniqueResultsCount=0,this.isFiltersOpen=!0,this.isResultsOpen=!0,this.listeners=new Map}update(e){const t={};Object.entries(e).forEach(([n,i])=>{this[n]!==i&&(t[n]={old:this[n],new:i},this[n]=i)}),Object.keys(t).length>0&&this.notify(t)}subscribe(e){const t=Math.random().toString(36);return this.listeners.set(t,e),()=>this.listeners.delete(t)}notify(e){this.listeners.forEach(t=>t(e))}getSnapshot(){return{activeFiltersCount:this.activeFiltersCount,resultsCount:this.resultsCount,uniqueResultsCount:this.uniqueResultsCount,isFiltersOpen:this.isFiltersOpen,isResultsOpen:this.isResultsOpen}}reset(){this.update({activeFiltersCount:0,mentionsCount:0,resultsCount:0,uniqueResultsCount:0,isFiltersOpen:!0,isResultsOpen:!0})}get state(){return this.getSnapshot()}}const Ve={MOBILE_BREAKPOINT:768,DEBOUNCE_DELAY:150,HAMBURGER_ID:"hamburger-btn",MOBILE_MENU_ID:"bottom-nav-mobile-menu"},Do=["toggle-filters","active-filters-badge","clear-all-btn","map-layer-selector","map-markers-selector","toggle-legend-btn","results-counter","unique-results-counter","toggle-results"];class Bo{constructor(e){this.elements=e,this.isOpen=!1,this.hamburgerBtn=null,this.mobileMenu=null,this.resizeHandler=null,this.clickHandler=null,this.init()}init(){this.createUI(),this.setupEventHandlers(),this.handleResize()}setupEventHandlers(){this.resizeHandler=this.debounce(()=>this.handleResize(),Ve.DEBOUNCE_DELAY),window.addEventListener("resize",this.resizeHandler)}createUI(){this.createHamburgerButton(),this.createMobileMenu()}createHamburgerButton(){const e=document.getElementById(Ve.HAMBURGER_ID);if(e){this.hamburgerBtn=e;return}this.hamburgerBtn=document.createElement("button"),this.hamburgerBtn.id=Ve.HAMBURGER_ID,this.hamburgerBtn.className="md:hidden p-2 z-60 text-gray-700 hover:text-gray-900",this.hamburgerBtn.setAttribute("aria-label","Apri menu"),this.hamburgerBtn.setAttribute("aria-expanded","false"),this.hamburgerBtn.innerHTML=`
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <line x1="5" y1="7" x2="19" y2="7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <line x1="5" y1="17" x2="19" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        `,this.clickHandler=()=>this.toggleMenu(),this.hamburgerBtn.addEventListener("click",this.clickHandler),(this.elements.bottomNav||document.querySelector("nav")||document.body).appendChild(this.hamburgerBtn)}createMobileMenu(){const e=document.getElementById(Ve.MOBILE_MENU_ID);if(e){this.mobileMenu=e;return}this.mobileMenu=document.createElement("div"),this.mobileMenu.id=Ve.MOBILE_MENU_ID,this.mobileMenu.className="md:hidden fixed bottom-14 left-4 right-4 bg-white shadow-lg p-3 rounded-lg flex-col gap-2 z-50",this.mobileMenu.setAttribute("data-open","false"),document.body.appendChild(this.mobileMenu)}toggleMenu(){this.isOpen=!this.isOpen,this.mobileMenu&&this.mobileMenu.setAttribute("data-open",this.isOpen?"true":"false"),this.hamburgerBtn&&this.hamburgerBtn.setAttribute("aria-expanded",this.isOpen?"true":"false")}handleResize(){window.innerWidth<Ve.MOBILE_BREAKPOINT?this.switchToMobile():this.switchToDesktop()}switchToMobile(){const e=this.elements.bottomNavContent;e&&(e.classList.remove("flex"),e.classList.add("hidden")),Do.forEach(t=>{const n=document.getElementById(t);n&&this.mobileMenu&&n.parentNode!==this.mobileMenu&&(n.classList.add("w-full","block"),this.mobileMenu.appendChild(n))}),this.closeMenu(),this.closePanels()}switchToDesktop(){const e=this.elements.bottomNavContent;e&&(e.classList.remove("hidden"),e.classList.add("flex")),this.mobileMenu&&Array.from(this.mobileMenu.childNodes).forEach(n=>{n instanceof HTMLElement&&e&&(n.classList.remove("w-full","block"),e.appendChild(n))}),this.closeMenu()}closeMenu(){this.isOpen=!1,this.mobileMenu&&this.mobileMenu.setAttribute("data-open","false"),this.hamburgerBtn&&this.hamburgerBtn.setAttribute("aria-expanded","false")}closePanels(){this.elements.filtersPanel&&this.elements.filtersPanel.setAttribute("data-open","false"),this.elements.resultsPanel&&this.elements.resultsPanel.setAttribute("data-open","false"),this.elements.toggleFilters&&this.elements.toggleFilters.setAttribute("data-active","false"),this.elements.toggleResults&&this.elements.toggleResults.setAttribute("data-active","false")}debounce(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e.apply(this,i),t)}}destroy(){this.resizeHandler&&window.removeEventListener("resize",this.resizeHandler),this.clickHandler&&this.hamburgerBtn&&this.hamburgerBtn.removeEventListener("click",this.clickHandler),this.hamburgerBtn&&this.hamburgerBtn.parentNode&&this.hamburgerBtn.remove(),this.mobileMenu&&this.mobileMenu.parentNode&&this.mobileMenu.remove(),this.hamburgerBtn=null,this.mobileMenu=null,this.resizeHandler=null,this.clickHandler=null}}const Re={zIndex:"9999",maxHeight:"max-h-96",contentMaxHeight:"max-h-64",defaultWidth:"w-72"},dr={close:`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
    </svg>`,check:`<svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
    </svg>`};class Mt{constructor(e,t){this.triggerId=e,this.popupId=t,this.trigger=null,this.isOpen=!1,this.cleanup=null}init(){return this.trigger=document.getElementById(this.triggerId),this.trigger?(this.trigger.style.cursor="pointer",this.trigger.onclick=e=>{e.stopPropagation(),this.toggle()},!0):(console.warn(`Trigger element ${this.triggerId} not found`),!1)}toggle(){this.isOpen?this.hide():this.show()}show(){if(this.isOpen)return;const e=this.createPopup();e&&(document.body.appendChild(e),this.isOpen=!0,this.bindEvents(e))}hide(){var t;const e=document.getElementById(this.popupId);e==null||e.remove(),(t=this.cleanup)==null||t.call(this),this.cleanup=null,this.isOpen=!1}bindEvents(e){const t=i=>{(i.key==="Escape"||i.type==="click"&&!e.contains(i.target)&&!this.trigger.contains(i.target))&&this.hide()};document.addEventListener("keydown",t),document.addEventListener("click",t);const n=e.querySelector(`#close-${this.popupId}`);n==null||n.addEventListener("click",()=>this.hide()),this.cleanup=()=>{document.removeEventListener("keydown",t),document.removeEventListener("click",t)}}createBasePopup(e){const t=document.createElement("div");t.id=this.popupId,t.className=`fixed p-2 ${Re.defaultWidth} max-w-sm bg-white rounded-lg shadow-2xl border border-gray-200 ${Re.maxHeight} overflow-hidden`,t.style.zIndex=Re.zIndex,hi.positionPopup(t,this.trigger);const n=document.createElement("div");return n.className="flex items-center justify-between mb-2",n.innerHTML=`
            <h3 class="p-2 text-sm font-semibold text-gray-800">${e}</h3>
            <button id="close-${this.popupId}" class="absolute top-2 right-2 p-1.5 bg-pink-100 hover:bg-pink-200 rounded-full text-red-500 shadow-md">
                ${dr.close}
            </button>
        `,t.appendChild(n),t}createPopup(){throw new Error("createPopup must be implemented by subclass")}destroy(){this.hide()}}class Uo extends Mt{constructor(e){super("active-filters-badge","active-filters-popup"),this.navBar=e}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per vedere i filtri attivi"),e}createPopup(){const e=this.createBasePopup("Filtri Attivi"),t=document.createElement("div");t.className=`space-y-1 ${Re.contentMaxHeight} overflow-y-auto overflow-x-hidden`;const n=this.getSearchState(),s=new di(this.navBar.config).render(n);return!s||s.trim()===""?t.innerHTML='<div class="p-3 text-sm text-gray-500 italic">Nessun filtro applicato</div>':t.innerHTML=s,e.appendChild(t),e}getSearchState(){var e;return(e=window.ledaSearch)!=null&&e.state?window.ledaSearch.state:{query:this.navBar.currentQuery||"",filters:this.navBar.currentFilters||{}}}}class Vo extends Mt{constructor(e){super("toggle-legend-btn","map-legend-popup"),this.navBar=e}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per leggere la legenda"),e}createPopup(){const e=this.createBasePopup("Legenda"),t=document.createElement("div");return t.className=`space-y-4 ${Re.contentMaxHeight} overflow-y-auto overflow-x-visible mb-3 p-3`,t.appendChild(this.createIntroSection()),t.appendChild(this.createPinSection()),t.appendChild(this.createFiltersSection()),t.appendChild(this.createReferencesSection()),t.appendChild(this.createPopupSection()),e.appendChild(t),e}getElement(e,t=""){const n=document.querySelector(e);if(!n)return document.createTextNode(t);const i=n.cloneNode(!0);return i.querySelectorAll("[id]").forEach(s=>s.removeAttribute("id")),i.hasAttribute("id")&&i.removeAttribute("id"),i}tooltip(e,t,n="top"){const i=document.createElement("span");i.className="relative inline-block group cursor-help";const s=document.createElement("span");s.className="text-blue-600 underline decoration-dotted underline-offset-2 hover:text-blue-800 transition-colors",s.textContent=e,i.appendChild(s);const o={top:"bottom-full left-1/2 -translate-x-1/2 mb-2",bottom:"top-full left-1/2 -translate-x-1/2 mt-2",left:"right-full top-1/2 -translate-y-1/2 mr-2",right:"left-full top-1/2 -translate-y-1/2 ml-2"},a={top:"top-full left-1/2 -translate-x-1/2 border-l-8 border-r-8 border-t-8 border-transparent border-t-gray-900",bottom:"bottom-full left-1/2 -translate-x-1/2 border-l-8 border-r-8 border-b-8 border-transparent border-b-gray-900",left:"left-full top-1/2 -translate-y-1/2 border-t-8 border-b-8 border-l-8 border-transparent border-l-gray-900",right:"right-full top-1/2 -translate-y-1/2 border-t-8 border-b-8 border-r-8 border-transparent border-r-gray-900"},c=document.createElement("div");c.className=`absolute ${o[n]} z-50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 delay-100`;const d=document.createElement("div");d.className="bg-gray-900 text-white text-sm rounded-lg py-2 px-3 max-w-xs shadow-xl whitespace-normal relative",d.appendChild(t.cloneNode(!0));const h=document.createElement("div");return h.className=`absolute w-0 h-0 ${a[n]}`,d.appendChild(h),c.appendChild(d),i.appendChild(c),i}createIntroSection(){const e=document.createElement("div");return e.className="space-y-2",e.innerHTML=`
            <p class="text-sm font-medium text-gray-800">Legenda della mappa</p>
            <p class="text-xs text-gray-600">Mostra i diversi elementi presenti sulla mappa.</p>
        `,e}createPinSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3 space-y-2";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.textContent="I ",t.appendChild(this.tooltip("pin della mappa",this.getElement(".leaflet-marker-icon svg"),"top")),t.appendChild(document.createTextNode(" indicano i luoghi presenti sulla mappa.")),e.appendChild(t),e}createFiltersSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3 space-y-2";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.appendChild(document.createTextNode("I ")),t.appendChild(this.tooltip("filtri",this.getElement("#toggle-filters"),"right")),t.appendChild(document.createTextNode(" intervengono sul filtraggio sia dei luoghi sulla mappa sia dei riferimenti ad essi associati. Il numero di occorrenze dei filtri rappresenta il numero di volte in cui ciascun luogo  stato menzionato. ")),e.appendChild(t),e}createReferencesSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3 space-y-2";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.appendChild(document.createTextNode("La sezione ")),t.appendChild(this.tooltip("riferimenti",this.getElement("#toggle-results"),"top")),t.appendChild(document.createTextNode(" mostra tutti i riferimenti ai luoghi presenti nella mappa.")),e.appendChild(t),e}createPopupSection(){const e=document.createElement("div");e.className="border-t border-gray-200 pt-3";const t=document.createElement("p");return t.className="text-sm text-gray-700 leading-relaxed",t.appendChild(document.createTextNode("Ogni pin sulla mappa apre un ")),t.appendChild(this.tooltip("popup informativo",this.getElement(".bg-gradient-to-r"),"top")),t.appendChild(document.createTextNode(" con dettagli specifici del luogo.")),e.appendChild(t),e}}class Ho extends Mt{constructor(e){super("map-layer-selector","layer-selection-popup"),this.layers=e,this.currentLayerName="Default",this.currentTileLayer=null}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per cambiare layer"),e}createPopup(){const e=this.createBasePopup("Seleziona uno strato cartografico"),t=document.createElement("div");return t.className=`space-y-1 ${Re.contentMaxHeight} overflow-y-auto overflow-x-hidden mb-3 p-3`,t.innerHTML=this.buildLayersHTML(),t.querySelectorAll(".layer-item").forEach(n=>{n.addEventListener("click",()=>{const{layerName:i,layerUrl:s,layerAttribution:o}=n.dataset;this.selectLayer(i,s,o),this.hide()})}),e.appendChild(t),e}buildLayersHTML(){return Object.entries(this.layers).map(([e,t])=>`
            <div class="layer-item flex items-center justify-between p-2 rounded hover:bg-gray-100 cursor-pointer" 
                data-layer-name="${e}" 
                data-layer-url="${t.tileLayer}"
                data-layer-attribution="${t.attribution}">
                <span class="text-sm text-gray-700">${e}</span>
                ${e===this.currentLayerName?dr.check:""}
            </div>
        `).join("")}selectLayer(e,t,n){this.currentTileLayer&&window.map&&window.map.removeLayer(this.currentTileLayer),window.L&&window.map&&(this.currentTileLayer=window.L.tileLayer(t,{attribution:n,maxZoom:18}),this.currentTileLayer.addTo(window.map)),this.currentLayerName=e,document.dispatchEvent(new CustomEvent("layerChanged",{detail:{layerName:e,layerUrl:t,attribution:n}}))}}class qo extends Mt{constructor(e){super("map-markers-selector","markers-selection-popup"),this.mapInstance=e,this.currentMarkerType="clusters",this.markerTypes={clusters:{name:"Clusters geografici",description:"Raggruppamenti dinamici dei luoghi",icon:this.getClusterIcon()},pins:{name:"Pin con numeri",description:"Pin con numero dei riferimenti",icon:this.getPinIcon()},circles:{name:"Cerchi Proporzionali",description:"Cerchi con diametro basato sui riferimenti",icon:this.getCircleIcon()}}}init(){const e=super.init();return e&&this.trigger&&(this.trigger.title="Clicca per cambiare tipo di marcatore"),e}createPopup(){const e=this.createBasePopup("Seleziona un tipo di marcatore"),t=document.createElement("div");return t.className=`space-y-1 ${Re.contentMaxHeight} overflow-y-auto overflow-x-hidden`,t.innerHTML=this.buildMarkersHTML(),t.querySelectorAll(".marker-item").forEach(n=>{n.addEventListener("click",()=>{this.selectMarkerType(n.dataset.markerType),this.hide()})}),e.appendChild(t),e}buildMarkersHTML(){return Object.entries(this.markerTypes).map(([e,t])=>`
            <div class="marker-item flex items-center justify-between p-2 rounded hover:bg-gray-50 hover:shadow-md cursor-pointer" 
                 data-marker-type="${e}">
                <div class="flex items-center space-x-3">
                    ${t.icon}
                    <div>
                        <span class="text-sm font-medium text-gray-700">${t.name}</span>
                        <p class="text-xs text-gray-500">${t.description}</p>
                    </div>
                </div>
                ${e===this.currentMarkerType?dr.check:""}
            </div>
        `).join("")}selectMarkerType(e){var n;this.currentMarkerType=e;const t=window.switchMarkerType||((n=this.mapInstance)==null?void 0:n.switchMarkerType);t&&(typeof t=="function"?t(e):t.call(this.mapInstance,e)),document.dispatchEvent(new CustomEvent("markerTypeChanged",{detail:{markerType:e,markerName:this.markerTypes[e].name}}))}getClusterIcon(){return`<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 32 32">
            <path d="M27 21.75c-0.795 0.004-1.538 0.229-2.169 0.616l0.018-0.010-2.694-2.449c0.724-1.105 1.154-2.459 1.154-3.913 0-1.572-0.503-3.027-1.358-4.212l0.015 0.021 3.062-3.062c0.57 0.316 1.249 0.503 1.971 0.508h0.002c2.347 0 4.25-1.903 4.25-4.25s-1.903-4.25-4.25-4.25c-2.347 0-4.25 1.903-4.25 4.25v0c0.005 0.724 0.193 1.403 0.519 1.995l-0.011-0.022-3.062 3.062c-1.147-0.84-2.587-1.344-4.144-1.344-0.868 0-1.699 0.157-2.467 0.443l0.049-0.016-0.644-1.17c0.726-0.757 1.173-1.787 1.173-2.921 0-2.332-1.891-4.223-4.223-4.223s-4.223 1.891-4.223 4.223c0 2.332 1.891 4.223 4.223 4.223 0.306 0 0.605-0.033 0.893-0.095l-0.028 0.005 0.642 1.166c-1.685 1.315-2.758 3.345-2.758 5.627 0 0.605 0.076 1.193 0.218 1.754l-0.011-0.049-0.667 0.283c-0.78-0.904-1.927-1.474-3.207-1.474-2.334 0-4.226 1.892-4.226 4.226s1.892 4.226 4.226 4.226c2.334 0 4.226-1.892 4.226-4.226 0-0.008-0-0.017-0-0.025v0.001c-0.008-0.159-0.023-0.307-0.046-0.451l0.003 0.024 0.667-0.283c1.303 2.026 3.547 3.349 6.1 3.349 1.703 0 3.268-0.589 4.503-1.574l-0.015 0.011 2.702 2.455c-0.258 0.526-0.41 1.144-0.414 1.797v0.001c0 2.347 1.903 4.25 4.25 4.25s4.25-1.903 4.25-4.25c0-2.347-1.903-4.25-4.25-4.25v0z"></path>
        </svg>`}getPinIcon(){return`<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"></path>
        </svg>`}getCircleIcon(){return`<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12z" clip-rule="evenodd"></path>
        </svg>`}}const Wo={filtersPanel:"filters-panel",resultsPanel:"results-panel",toggleFilters:"toggle-filters",toggleResults:"toggle-results",activeFiltersBadge:"active-filters-badge",activeFiltersCount:"active-filters-count",mentionsCounter:"mentions-counter",mentionsCount:"mentions-count",resultsCounter:"results-counter",resultsCount:"results-count",uniqueResultsCounter:"unique-results-counter",uniqueResultsCount:"unique-results-count",clearAllBtn:"clear-all-btn",layerButton:"map-layer-selector",markersButton:"map-markers-selector",bottomNav:"bottom-nav",bottomNavContent:"bottom-nav-content",toggleLegendBtn:"toggle-legend-btn"};class Go{constructor(){this.state=new To,this.elements={},this.popups={},this.mobileMenu=null,this.cleanupFns=[],this.init()}get config(){var e;return(e=window.ledaSearch)==null?void 0:e.config}get mapInstance(){var e;return(e=window.ledaSearch)==null?void 0:e.mapInstance}get currentFilters(){var t,n,i,s,o;const e=((n=(t=window.ledaSearch)==null?void 0:t.stateManager)==null?void 0:n.state)||((o=(s=(i=window.ledaSearch)==null?void 0:i.filterManager)==null?void 0:s.stateManager)==null?void 0:o.state);return(e==null?void 0:e.filters)||{}}get currentQuery(){var t,n,i,s,o;const e=((n=(t=window.ledaSearch)==null?void 0:t.stateManager)==null?void 0:n.state)||((o=(s=(i=window.ledaSearch)==null?void 0:i.filterManager)==null?void 0:s.stateManager)==null?void 0:o.state);return(e==null?void 0:e.query)||""}init(){try{this.initElements(),this.initState(),this.bindEvents(),this.initPopups(),this.initMobileMenu(),this.initTooltip()}catch(e){console.error("NavBarRenderer: Initialization error",e)}}initElements(){this.elements=Object.fromEntries(Object.entries(Wo).map(([e,t])=>[e,document.getElementById(t)]))}initState(){var t,n,i,s,o,a;const e=this.state.subscribe(c=>this.onStateChange(c));this.cleanupFns.push(e),(t=this.elements.filtersPanel)==null||t.setAttribute("data-open","true"),(n=this.elements.resultsPanel)==null||n.setAttribute("data-open","true"),(i=this.elements.toggleFilters)==null||i.setAttribute("data-active","true"),(s=this.elements.toggleResults)==null||s.setAttribute("data-active","true"),this.state.activeFiltersCount===0&&((o=this.elements.activeFiltersBadge)==null||o.classList.add("hidden"),(a=this.elements.clearAllBtn)==null||a.classList.add("hidden"))}onStateChange(e){"activeFiltersCount"in e&&this.updateFiltersUI(e.activeFiltersCount.new),("resultsCount"in e||"uniqueResultsCount"in e||"mentionsCount"in e)&&this.updateResultsUI(this.state.mentionsCount||0,this.state.uniqueResultsCount||0,this.state.resultsCount||0),"isFiltersOpen"in e&&this.updatePanelUI("filters",e.isFiltersOpen.new),"isResultsOpen"in e&&this.updatePanelUI("results",e.isResultsOpen.new),this.emitStateChanges(e)}updateFiltersUI(e){var t,n,i,s,o,a;this.elements.activeFiltersCount&&(this.elements.activeFiltersCount.textContent=e),e>0?((t=this.elements.activeFiltersBadge)==null||t.classList.remove("hidden"),(n=this.elements.clearAllBtn)==null||n.classList.remove("hidden")):((i=this.elements.activeFiltersBadge)==null||i.classList.add("hidden"),(s=this.elements.clearAllBtn)==null||s.classList.add("hidden")),(o=this.elements.activeFiltersBadge)==null||o.setAttribute("data-visible",e>0),(a=this.elements.clearAllBtn)==null||a.setAttribute("data-visible",e>0)}updateResultsUI(e,t,n){this.elements.mentionsCount&&(this.elements.mentionsCount.textContent=e),this.elements.mentionsCounter&&(this.elements.mentionsCounter.style.display=e>0?"":"none"),this.elements.resultsCount&&(this.elements.resultsCount.textContent=n),this.elements.resultsCounter&&(this.elements.resultsCounter.style.display=n>0?"":"none"),this.elements.uniqueResultsCount&&(this.elements.uniqueResultsCount.textContent=t),this.elements.uniqueResultsCounter&&(this.elements.uniqueResultsCounter.style.display=t>0?"":"none")}updatePanelUI(e,t){var i,s;const n=this.getPanelConfig(e);n&&((i=n.panel)==null||i.setAttribute("data-open",t),(s=n.button)==null||s.setAttribute("data-active",t))}emitStateChanges(e){Object.entries(e).forEach(([t,n])=>{const s={activeFiltersCount:"activeFiltersChanged",resultsCount:"resultsCountChanged",isFiltersOpen:"panelToggled",isResultsOpen:"panelToggled"}[t];s&&document.dispatchEvent(new CustomEvent(`navbar:${s}`,{detail:{type:t.replace("is","").replace("Open","").toLowerCase(),...n}}))})}bindEvents(){this.bindElement(this.elements.toggleFilters,()=>this.togglePanel("filters")),this.bindElement(this.elements.toggleResults,()=>this.togglePanel("results")),this.bindElement(this.elements.clearAllBtn,()=>this.clearAllFilters())}bindElement(e,t){e&&(e.addEventListener("click",t),this.cleanupFns.push(()=>e.removeEventListener("click",t)))}initPopups(){fi.waitForGlobal("ledaSearch",()=>{var e,t;this.popups.activeFilters=new Uo(this),this.popups.activeFilters.init(),(t=(e=this.config)==null?void 0:e.map)!=null&&t.tileLayers&&(this.popups.layers=new Ho(this.config.map.tileLayers),this.popups.layers.init()),this.mapInstance&&(this.popups.markers=new qo(this.mapInstance),this.popups.markers.init(),setTimeout(()=>{this.popups.legend=new Vo(this),this.popups.legend.init()},5e3))})}initMobileMenu(){this.mobileMenu=new Bo(this.elements),this.cleanupFns.push(()=>{var e;return(e=this.mobileMenu)==null?void 0:e.destroy()})}updateFromSearchState(e,t=[],n={}){var o;if(!e)return;let i=pi.calculateActiveFiltersCount(e.filters);(o=e.query)!=null&&o.trim()&&(i+=1);const s=this.calculateUniqueCounts(t);this.state.update({activeFiltersCount:i,mentionsCount:s.totalMentions,resultsCount:s.uniqueLocations,uniqueResultsCount:s.uniquePivotIds})}calculateUniqueCounts(e){if(!Array.isArray(e)||e.length===0)return{uniquePivotIds:0,uniqueLocations:0,totalMentions:0};const t=new Set,n=new Set;return e.forEach(i=>{i.pivot_ID&&t.add(i.pivot_ID),i.Location&&n.add(i.Location)}),console.log(" CONTEGGI:",{totalMentions:e.length,uniquePivotIds:t.size,uniqueLocations:n.size,pivot_IDs:Array.from(t),Locations:Array.from(n)}),{uniquePivotIds:t.size,uniqueLocations:n.size,totalMentions:e.length}}updateFilters(e){this.state.update({activeFiltersCount:e})}initTooltip(){const e=this.elements.resultsCounter;if(!e)return;const t=document.createElement("div");t.id="results-counter-tooltip",t.className="fixed px-4 py-3 bg-gray-900 text-white text-xs rounded-lg shadow-xl whitespace-nowrap opacity-0 pointer-events-none transition-opacity duration-200",t.style.zIndex="99999",t.innerHTML=`
            <div class="space-y-1">
                <div><strong class="text-yellow-300">Menzioni:</strong> Numero delle menzioni di luoghi nei riferimenti</div>
                <div><strong class="text-green-300">Luoghi:</strong> Numero di luoghi unici menzionati</div>
                <div><strong class="text-blue-300">Riferimenti:</strong> Numero di riferimenti che menzionano i luoghi</div>
            </div>
            <div class="absolute top-full left-1/2 transform -translate-x-1/2 -mt-1">
                <div class="border-4 border-transparent border-t-gray-900"></div>
            </div>
        `,document.body.appendChild(t);const n=()=>{const i=e.getBoundingClientRect();t.style.left=`${i.left+i.width/2}px`,t.style.top=`${i.top-10}px`,t.style.transform="translate(-50%, -100%)"};e.addEventListener("mouseenter",()=>{n(),t.style.opacity="1"}),e.addEventListener("mouseleave",()=>{t.style.opacity="0"}),window.addEventListener("scroll",n),window.addEventListener("resize",n),this.cleanupFns.push(()=>{t.remove(),window.removeEventListener("scroll",n),window.removeEventListener("resize",n)})}updateResults(e,t=0){this.state.update({resultsCount:e,uniqueResultsCount:t})}togglePanel(e){const t=`is${e.charAt(0).toUpperCase()+e.slice(1)}Open`;this.state.update({[t]:!this.state[t]})}getPanelConfig(e){return{filters:{panel:this.elements.filtersPanel,button:this.elements.toggleFilters},results:{panel:this.elements.resultsPanel,button:this.elements.toggleResults}}[e]}closeAllPanels(){this.state.update({isFiltersOpen:!1,isResultsOpen:!1})}clearAllFilters(){Object.values(this.popups).forEach(e=>e==null?void 0:e.hide()),this.state.update({activeFiltersCount:0,resultsCount:0,uniqueResultsCount:0}),document.dispatchEvent(new CustomEvent("navbar:clearAllFilters",{detail:{resetInterface:!0,clearSearch:!0,clearFacets:!0,clearMap:!0}})),setTimeout(()=>{ut.resetFacetsInterface(),ut.clearSearchInput()},100),Sr.show("Tutti i filtri sono stati rimossi","success",2e3)}getState(){return{...this.state.getSnapshot(),currentFilters:this.currentFilters,currentQuery:this.currentQuery,config:this.config,mapInstance:this.mapInstance}}setState(e){const t={};Object.entries(e).forEach(([n,i])=>{this.state.hasOwnProperty(n)?t[n]=i:["currentFilters","currentQuery","config","mapInstance"].includes(n)&&console.warn(`NavBarRenderer: ${n}  read-only`)}),Object.keys(t).length>0&&this.state.update(t)}addEventListener(e,t){document.addEventListener(`navbar:${e}`,t)}removeEventListener(e,t){document.removeEventListener(`navbar:${e}`,t)}showNotification(e,t="info",n=3e3){Sr.show(e,t,n)}resetInterface(){this.state.reset(),Object.values(this.popups).forEach(e=>e==null?void 0:e.hide()),ut.resetFacetsInterface(),ut.clearSearchInput()}destroy(){this.cleanupFns.forEach(e=>e()),Object.values(this.popups).forEach(e=>e==null?void 0:e.destroy()),this.cleanupFns=[],this.elements={},this.popups={},this.mobileMenu=null}}const Jo=new Go;class Un{constructor(){this.originalFacetData=null}renderTaxonomy(e,t,n,i){const o=(i.filters||{})[n]||[];this.originalFacetData||(this.originalFacetData=JSON.parse(JSON.stringify(t)));const a=o.length>0?this.originalFacetData:t,c=this._buildHierarchy(a);this._calculateTotalCounts(c),e.className="taxonomy-container max-w-full overflow-x-auto max-h-80 overflow-y-auto",e.innerHTML=this._createTaxonomyHTML(c,[],0,n,o),this._setCheckboxStates(e,c,o),this._addEventListeners(e,c,n)}resetOriginalData(){this.originalFacetData=null}_buildHierarchy(e){const t={};return Array.isArray(e)&&e.forEach(n=>{const i=n.key.split(" > ");let s=t;i.forEach((o,a)=>{s[o]||(s[o]={children:{},docCount:0,selfCount:0}),a===i.length-1&&(s[o].selfCount=n.doc_count),s=s[o].children})}),t}_calculateTotalCounts(e){const t=n=>{let i=n.selfCount||0;return Object.values(n.children||{}).forEach(s=>{i+=t(s)}),n.docCount=i,i};Object.values(e).forEach(t)}_setCheckboxStates(e,t,n){const i=(s,o=[])=>{Object.entries(s).forEach(([a,c])=>{if(this._isMetadataKey(a))return;const d=[...o,a].join(" > "),h=e.querySelector(`input[value="${d}"]`);if(!h)return;h.checked=n.includes(d);const y=this._getAllChildPaths(c.children||{},[...o,a]).some(g=>n.includes(g));h.indeterminate=y&&!h.checked,i(c.children,[...o,a])})};i(t)}_createTaxonomyHTML(e,t=[],n=0,i,s){let o='<div class="space-y-1">';return Object.entries(e).forEach(([a,c])=>{if(this._isMetadataKey(a))return;const d=[...t,a],h=d.join(" > "),w=Object.keys(c.children).length>0,y=s.includes(h),g=w&&this._hasSelectedChild(c.children,s,d),m=y||g,b=c.docCount===0;o+=`
        <div class="taxonomy-item">
          <label class="block facet-option ${b?"text-gray-400 cursor-not-allowed opacity-50":"cursor-pointer"}" data-search-text="${a.toLowerCase()}">
            <div></div>
            ${this._createToggleButton(w,h,m)}
            <div class="flex items-center gap-2 min-w-0">
              <input type="checkbox" value="${h}" data-facet-type="${i}" class="form-checkbox flex-shrink-0" ${y?"checked":""} ${b?"disabled":""}>
              <span class="text-sm">${a}</span>
            </div>
            <span class="text-xs px-2 py-0.5 rounded-full flex-shrink-0 ${b?"text-gray-400 bg-gray-100":"text-secondary-500 bg-secondary-100"}">${c.docCount}</span>
          </label>
          ${this._createChildrenContainer(w,h,m,c.children,d,n+1,i,s)}
        </div>`}),o+"</div>"}_createToggleButton(e,t,n){return e?`<button class="toggle-btn flex-shrink-0 w-5 h-5 flex items-center justify-center rounded hover:bg-gray-200 transition-colors" data-path="${t}">
        <svg class="w-3 h-3 text-gray-600 transform transition-transform duration-200 ${n?"rotate-90":""}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>`:'<div class="w-5 h-5 flex-shrink-0"></div>'}_createChildrenContainer(e,t,n,i,s,o,a,c){return e?`<div class="children ${n?"":"hidden"}" data-parent="${t}">
        ${this._createTaxonomyHTML(i,s,o,a,c)}
      </div>`:""}_isMetadataKey(e){return["children","docCount","selfCount"].includes(e)}_hasSelectedChild(e,t,n=[]){for(const[i,s]of Object.entries(e)){if(this._isMetadataKey(i))continue;const o=[...n,i].join(" > ");if(t.includes(o)||Object.keys(s.children).length>0&&this._hasSelectedChild(s.children,t,[...n,i]))return!0}return!1}_getParentPaths(e){const t=e.split(" > "),n=[];for(let i=1;i<t.length;i++)n.push(t.slice(0,i).join(" > "));return n}_getAllChildPaths(e,t=[]){const n=[];return Object.entries(e).forEach(([i,s])=>{if(this._isMetadataKey(i))return;const o=[...t,i].join(" > ");n.push(o),Object.keys(s.children).length>0&&n.push(...this._getAllChildPaths(s.children,[...t,i]))}),n}_getChildPathsForNode(e,t){const n=t.split(" > ");let i=e;for(const s of n)if(i[s])i=i[s];else return[];return this._getAllChildPaths(i.children,n)}_addEventListeners(e,t,n){e._hierarchy=t,this._addToggleListeners(e),this._addCheckboxListeners(e,t,n)}_addToggleListeners(e){e.addEventListener("click",t=>{const n=t.target.closest(".toggle-btn");if(!n)return;const i=n.dataset.path,s=e.querySelector(`[data-parent="${i}"]`),o=n.querySelector("svg");if(s&&o){const a=s.classList.contains("hidden");s.classList.toggle("hidden"),o.classList.toggle("rotate-90",a)}})}_addCheckboxListeners(e,t,n){e.addEventListener("change",i=>{if(i.target.type!=="checkbox")return;const s=i.target;if(s.disabled){i.preventDefault();return}const o=s.value,a=s.checked;i.stopPropagation();const c=this._getParentPaths(o),d=this._getChildPathsForNode(t,o);this._updateRelatedCheckboxes(e,t,o,a,c,d),e.dispatchEvent(new CustomEvent("taxonomyChange",{detail:{facetKey:n,path:o,checked:a,action:a?"add":"remove"}}))})}_updateRelatedCheckboxes(e,t,n,i,s,o){i?(this._updateCheckboxes(e,s,!0),this._updateCheckboxes(e,o,!0)):(this._updateCheckboxes(e,o,!1),this._updateParentCheckboxes(e,t,s)),this._updateCheckboxVisuals(e.querySelector(`input[value="${n}"]`),i)}_updateCheckboxes(e,t,n){t==null||t.forEach(i=>{const s=e.querySelector(`input[value="${i}"]`);s&&s.checked!==n&&!s.disabled&&(s.checked=n,this._updateCheckboxVisuals(s,n))})}_updateParentCheckboxes(e,t,n){n==null||n.forEach(i=>{const s=e.querySelector(`input[value="${i}"]`);if(!(s!=null&&s.checked)||s.disabled)return;this._getChildPathsForNode(t,i).some(c=>{const d=e.querySelector(`input[value="${c}"]`);return d==null?void 0:d.checked})||(s.checked=!1,this._updateCheckboxVisuals(s,!1))})}_updateCheckboxVisuals(e,t){var i;if(!e)return;const n=(i=e.closest("label"))==null?void 0:i.querySelector("span.text-sm");n&&(n.classList.toggle("font-medium",t),n.classList.toggle("text-primary-700",t))}_renderTaxonomyFacet(e,t,n,i,s,o,a){const c=document.createElement("div"),d=i[t]||[];this.renderTaxonomy(c,d,t,o),c.addEventListener("taxonomyChange",h=>{const{facetKey:w,path:y,checked:g}=h.detail;a({type:"FACET_CHANGE",facetType:w,value:y,checked:g})}),e.appendChild(c)}}var Oe;(function(r){r.Range="range",r.Steps="steps",r.Positions="positions",r.Count="count",r.Values="values"})(Oe||(Oe={}));var oe;(function(r){r[r.None=-1]="None",r[r.NoValue=0]="NoValue",r[r.LargeValue=1]="LargeValue",r[r.SmallValue=2]="SmallValue"})(oe||(oe={}));function Qo(r){return _t(r)&&typeof r.from=="function"}function _t(r){return typeof r=="object"&&typeof r.to=="function"}function hn(r){r.parentElement.removeChild(r)}function er(r){return r!=null}function fn(r){r.preventDefault()}function Xo(r){return r.filter(function(e){return this[e]?!1:this[e]=!0},{})}function Yo(r,e){return Math.round(r/e)*e}function Zo(r,e){var t=r.getBoundingClientRect(),n=r.ownerDocument,i=n.documentElement,s=Vn(n);return/webkit.*Chrome.*Mobile/i.test(navigator.userAgent)&&(s.x=0),e?t.top+s.y-i.clientTop:t.left+s.x-i.clientLeft}function ve(r){return typeof r=="number"&&!isNaN(r)&&isFinite(r)}function pn(r,e,t){t>0&&(ie(r,e),setTimeout(function(){wt(r,e)},t))}function gn(r){return Math.max(Math.min(r,100),0)}function kt(r){return Array.isArray(r)?r:[r]}function Ko(r){r=String(r);var e=r.split(".");return e.length>1?e[1].length:0}function ie(r,e){r.classList&&!/\s/.test(e)?r.classList.add(e):r.className+=" "+e}function wt(r,e){r.classList&&!/\s/.test(e)?r.classList.remove(e):r.className=r.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")}function ea(r,e){return r.classList?r.classList.contains(e):new RegExp("\\b"+e+"\\b").test(r.className)}function Vn(r){var e=window.pageXOffset!==void 0,t=(r.compatMode||"")==="CSS1Compat",n=e?window.pageXOffset:t?r.documentElement.scrollLeft:r.body.scrollLeft,i=e?window.pageYOffset:t?r.documentElement.scrollTop:r.body.scrollTop;return{x:n,y:i}}function ta(){return window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"}}function ra(){var r=!1;try{var e=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("test",null,e)}catch{}return r}function na(){return window.CSS&&CSS.supports&&CSS.supports("touch-action","none")}function hr(r,e){return 100/(e-r)}function tr(r,e,t){return e*100/(r[t+1]-r[t])}function ia(r,e){return tr(r,r[0]<0?e+Math.abs(r[0]):e-r[0],0)}function sa(r,e){return e*(r[1]-r[0])/100+r[0]}function it(r,e){for(var t=1;r>=e[t];)t+=1;return t}function oa(r,e,t){if(t>=r.slice(-1)[0])return 100;var n=it(t,r),i=r[n-1],s=r[n],o=e[n-1],a=e[n];return o+ia([i,s],t)/hr(o,a)}function aa(r,e,t){if(t>=100)return r.slice(-1)[0];var n=it(t,e),i=r[n-1],s=r[n],o=e[n-1],a=e[n];return sa([i,s],(t-o)*hr(o,a))}function la(r,e,t,n){if(n===100)return n;var i=it(n,r),s=r[i-1],o=r[i];return t?n-s>(o-s)/2?o:s:e[i-1]?r[i-1]+Yo(n-r[i-1],e[i-1]):n}var Hn=function(){function r(e,t,n){this.xPct=[],this.xVal=[],this.xSteps=[],this.xNumSteps=[],this.xHighestCompleteStep=[],this.xSteps=[n||!1],this.xNumSteps=[!1],this.snap=t;var i,s=[];for(Object.keys(e).forEach(function(o){s.push([kt(e[o]),o])}),s.sort(function(o,a){return o[0][0]-a[0][0]}),i=0;i<s.length;i++)this.handleEntryPoint(s[i][1],s[i][0]);for(this.xNumSteps=this.xSteps.slice(0),i=0;i<this.xNumSteps.length;i++)this.handleStepPoint(i,this.xNumSteps[i])}return r.prototype.getDistance=function(e){for(var t=[],n=0;n<this.xNumSteps.length-1;n++)t[n]=tr(this.xVal,e,n);return t},r.prototype.getAbsoluteDistance=function(e,t,n){var i=0;if(e<this.xPct[this.xPct.length-1])for(;e>this.xPct[i+1];)i++;else e===this.xPct[this.xPct.length-1]&&(i=this.xPct.length-2);!n&&e===this.xPct[i+1]&&i++,t===null&&(t=[]);var s,o=1,a=t[i],c=0,d=0,h=0,w=0;for(n?s=(e-this.xPct[i])/(this.xPct[i+1]-this.xPct[i]):s=(this.xPct[i+1]-e)/(this.xPct[i+1]-this.xPct[i]);a>0;)c=this.xPct[i+1+w]-this.xPct[i+w],t[i+w]*o+100-s*100>100?(d=c*s,o=(a-100*s)/t[i+w],s=1):(d=t[i+w]*c/100*o,o=0),n?(h=h-d,this.xPct.length+w>=1&&w--):(h=h+d,this.xPct.length-w>=1&&w++),a=t[i+w]*o;return e+h},r.prototype.toStepping=function(e){return e=oa(this.xVal,this.xPct,e),e},r.prototype.fromStepping=function(e){return aa(this.xVal,this.xPct,e)},r.prototype.getStep=function(e){return e=la(this.xPct,this.xSteps,this.snap,e),e},r.prototype.getDefaultStep=function(e,t,n){var i=it(e,this.xPct);return(e===100||t&&e===this.xPct[i-1])&&(i=Math.max(i-1,1)),(this.xVal[i]-this.xVal[i-1])/n},r.prototype.getNearbySteps=function(e){var t=it(e,this.xPct);return{stepBefore:{startValue:this.xVal[t-2],step:this.xNumSteps[t-2],highestStep:this.xHighestCompleteStep[t-2]},thisStep:{startValue:this.xVal[t-1],step:this.xNumSteps[t-1],highestStep:this.xHighestCompleteStep[t-1]},stepAfter:{startValue:this.xVal[t],step:this.xNumSteps[t],highestStep:this.xHighestCompleteStep[t]}}},r.prototype.countStepDecimals=function(){var e=this.xNumSteps.map(Ko);return Math.max.apply(null,e)},r.prototype.hasNoSize=function(){return this.xVal[0]===this.xVal[this.xVal.length-1]},r.prototype.convert=function(e){return this.getStep(this.toStepping(e))},r.prototype.handleEntryPoint=function(e,t){var n;if(e==="min"?n=0:e==="max"?n=100:n=parseFloat(e),!ve(n)||!ve(t[0]))throw new Error("noUiSlider: 'range' value isn't numeric.");this.xPct.push(n),this.xVal.push(t[0]);var i=Number(t[1]);n?this.xSteps.push(isNaN(i)?!1:i):isNaN(i)||(this.xSteps[0]=i),this.xHighestCompleteStep.push(0)},r.prototype.handleStepPoint=function(e,t){if(t){if(this.xVal[e]===this.xVal[e+1]){this.xSteps[e]=this.xHighestCompleteStep[e]=this.xVal[e];return}this.xSteps[e]=tr([this.xVal[e],this.xVal[e+1]],t,0)/hr(this.xPct[e],this.xPct[e+1]);var n=(this.xVal[e+1]-this.xVal[e])/this.xNumSteps[e],i=Math.ceil(Number(n.toFixed(3))-1),s=this.xVal[e]+this.xNumSteps[e]*i;this.xHighestCompleteStep[e]=s}},r}(),mn={to:function(r){return r===void 0?"":r.toFixed(2)},from:Number},qn={target:"target",base:"base",origin:"origin",handle:"handle",handleLower:"handle-lower",handleUpper:"handle-upper",touchArea:"touch-area",horizontal:"horizontal",vertical:"vertical",background:"background",connect:"connect",connects:"connects",ltr:"ltr",rtl:"rtl",textDirectionLtr:"txt-dir-ltr",textDirectionRtl:"txt-dir-rtl",draggable:"draggable",drag:"state-drag",tap:"state-tap",active:"active",tooltip:"tooltip",pips:"pips",pipsHorizontal:"pips-horizontal",pipsVertical:"pips-vertical",marker:"marker",markerHorizontal:"marker-horizontal",markerVertical:"marker-vertical",markerNormal:"marker-normal",markerLarge:"marker-large",markerSub:"marker-sub",value:"value",valueHorizontal:"value-horizontal",valueVertical:"value-vertical",valueNormal:"value-normal",valueLarge:"value-large",valueSub:"value-sub"},Le={tooltips:".__tooltips",aria:".__aria"};function ca(r,e){if(!ve(e))throw new Error("noUiSlider: 'step' is not numeric.");r.singleStep=e}function ua(r,e){if(!ve(e))throw new Error("noUiSlider: 'keyboardPageMultiplier' is not numeric.");r.keyboardPageMultiplier=e}function da(r,e){if(!ve(e))throw new Error("noUiSlider: 'keyboardMultiplier' is not numeric.");r.keyboardMultiplier=e}function ha(r,e){if(!ve(e))throw new Error("noUiSlider: 'keyboardDefaultStep' is not numeric.");r.keyboardDefaultStep=e}function fa(r,e){if(typeof e!="object"||Array.isArray(e))throw new Error("noUiSlider: 'range' is not an object.");if(e.min===void 0||e.max===void 0)throw new Error("noUiSlider: Missing 'min' or 'max' in 'range'.");r.spectrum=new Hn(e,r.snap||!1,r.singleStep)}function pa(r,e){if(e=kt(e),!Array.isArray(e)||!e.length)throw new Error("noUiSlider: 'start' option is incorrect.");r.handles=e.length,r.start=e}function ga(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'snap' option must be a boolean.");r.snap=e}function ma(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'animate' option must be a boolean.");r.animate=e}function va(r,e){if(typeof e!="number")throw new Error("noUiSlider: 'animationDuration' option must be a number.");r.animationDuration=e}function Wn(r,e){var t=[!1],n;if(e==="lower"?e=[!0,!1]:e==="upper"&&(e=[!1,!0]),e===!0||e===!1){for(n=1;n<r.handles;n++)t.push(e);t.push(!1)}else{if(!Array.isArray(e)||!e.length||e.length!==r.handles+1)throw new Error("noUiSlider: 'connect' option doesn't match handle count.");t=e}r.connect=t}function wa(r,e){switch(e){case"horizontal":r.ort=0;break;case"vertical":r.ort=1;break;default:throw new Error("noUiSlider: 'orientation' option is invalid.")}}function Gn(r,e){if(!ve(e))throw new Error("noUiSlider: 'margin' option must be numeric.");e!==0&&(r.margin=r.spectrum.getDistance(e))}function ya(r,e){if(!ve(e))throw new Error("noUiSlider: 'limit' option must be numeric.");if(r.limit=r.spectrum.getDistance(e),!r.limit||r.handles<2)throw new Error("noUiSlider: 'limit' option is only supported on linear sliders with 2 or more handles.")}function ba(r,e){var t;if(!ve(e)&&!Array.isArray(e))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(Array.isArray(e)&&!(e.length===2||ve(e[0])||ve(e[1])))throw new Error("noUiSlider: 'padding' option must be numeric or array of exactly 2 numbers.");if(e!==0){for(Array.isArray(e)||(e=[e,e]),r.padding=[r.spectrum.getDistance(e[0]),r.spectrum.getDistance(e[1])],t=0;t<r.spectrum.xNumSteps.length-1;t++)if(r.padding[0][t]<0||r.padding[1][t]<0)throw new Error("noUiSlider: 'padding' option must be a positive number(s).");var n=e[0]+e[1],i=r.spectrum.xVal[0],s=r.spectrum.xVal[r.spectrum.xVal.length-1];if(n/(s-i)>1)throw new Error("noUiSlider: 'padding' option must not exceed 100% of the range.")}}function xa(r,e){switch(e){case"ltr":r.dir=0;break;case"rtl":r.dir=1;break;default:throw new Error("noUiSlider: 'direction' option was not recognized.")}}function _a(r,e){if(typeof e!="string")throw new Error("noUiSlider: 'behaviour' must be a string containing options.");var t=e.indexOf("tap")>=0,n=e.indexOf("drag")>=0,i=e.indexOf("fixed")>=0,s=e.indexOf("snap")>=0,o=e.indexOf("hover")>=0,a=e.indexOf("unconstrained")>=0,c=e.indexOf("invert-connects")>=0,d=e.indexOf("drag-all")>=0,h=e.indexOf("smooth-steps")>=0;if(i){if(r.handles!==2)throw new Error("noUiSlider: 'fixed' behaviour must be used with 2 handles");Gn(r,r.start[1]-r.start[0])}if(c&&r.handles!==2)throw new Error("noUiSlider: 'invert-connects' behaviour must be used with 2 handles");if(a&&(r.margin||r.limit))throw new Error("noUiSlider: 'unconstrained' behaviour cannot be used with margin or limit");r.events={tap:t||s,drag:n,dragAll:d,smoothSteps:h,fixed:i,snap:s,hover:o,unconstrained:a,invertConnects:c}}function Sa(r,e){if(e!==!1)if(e===!0||_t(e)){r.tooltips=[];for(var t=0;t<r.handles;t++)r.tooltips.push(e)}else{if(e=kt(e),e.length!==r.handles)throw new Error("noUiSlider: must pass a formatter for all handles.");e.forEach(function(n){if(typeof n!="boolean"&&!_t(n))throw new Error("noUiSlider: 'tooltips' must be passed a formatter or 'false'.")}),r.tooltips=e}}function Ca(r,e){if(e.length!==r.handles)throw new Error("noUiSlider: must pass a attributes for all handles.");r.handleAttributes=e}function Ea(r,e){if(!_t(e))throw new Error("noUiSlider: 'ariaFormat' requires 'to' method.");r.ariaFormat=e}function Ma(r,e){if(!Qo(e))throw new Error("noUiSlider: 'format' requires 'to' and 'from' methods.");r.format=e}function ka(r,e){if(typeof e!="boolean")throw new Error("noUiSlider: 'keyboardSupport' option must be a boolean.");r.keyboardSupport=e}function Aa(r,e){r.documentElement=e}function ja(r,e){if(typeof e!="string"&&e!==!1)throw new Error("noUiSlider: 'cssPrefix' must be a string or `false`.");r.cssPrefix=e}function La(r,e){if(typeof e!="object")throw new Error("noUiSlider: 'cssClasses' must be an object.");typeof r.cssPrefix=="string"?(r.cssClasses={},Object.keys(e).forEach(function(t){r.cssClasses[t]=r.cssPrefix+e[t]})):r.cssClasses=e}function Jn(r){var e={margin:null,limit:null,padding:null,animate:!0,animationDuration:300,ariaFormat:mn,format:mn},t={step:{r:!1,t:ca},keyboardPageMultiplier:{r:!1,t:ua},keyboardMultiplier:{r:!1,t:da},keyboardDefaultStep:{r:!1,t:ha},start:{r:!0,t:pa},connect:{r:!0,t:Wn},direction:{r:!0,t:xa},snap:{r:!1,t:ga},animate:{r:!1,t:ma},animationDuration:{r:!1,t:va},range:{r:!0,t:fa},orientation:{r:!1,t:wa},margin:{r:!1,t:Gn},limit:{r:!1,t:ya},padding:{r:!1,t:ba},behaviour:{r:!0,t:_a},ariaFormat:{r:!1,t:Ea},format:{r:!1,t:Ma},tooltips:{r:!1,t:Sa},keyboardSupport:{r:!0,t:ka},documentElement:{r:!1,t:Aa},cssPrefix:{r:!0,t:ja},cssClasses:{r:!0,t:La},handleAttributes:{r:!1,t:Ca}},n={connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal",keyboardSupport:!0,cssPrefix:"noUi-",cssClasses:qn,keyboardPageMultiplier:5,keyboardMultiplier:1,keyboardDefaultStep:10};r.format&&!r.ariaFormat&&(r.ariaFormat=r.format),Object.keys(t).forEach(function(c){if(!er(r[c])&&n[c]===void 0){if(t[c].r)throw new Error("noUiSlider: '"+c+"' is required.");return}t[c].t(e,er(r[c])?r[c]:n[c])}),e.pips=r.pips;var i=document.createElement("div"),s=i.style.msTransform!==void 0,o=i.style.transform!==void 0;e.transformRule=o?"transform":s?"msTransform":"webkitTransform";var a=[["left","top"],["right","bottom"]];return e.style=a[e.dir][e.ort],e}function Oa(r,e,t){var n=ta(),i=na(),s=i&&ra(),o=r,a,c,d,h,w,y,g=e.spectrum,m=[],b=[],C=[],L=0,R={},U=!1,N=r.ownerDocument,Q=e.documentElement||N.documentElement,F=N.body,P=N.dir==="rtl"||e.ort===1?0:100;function X(u,p){var v=N.createElement("div");return p&&ie(v,p),u.appendChild(v),v}function ce(u,p){var v=X(u,e.cssClasses.origin),S=X(v,e.cssClasses.handle);if(X(S,e.cssClasses.touchArea),S.setAttribute("data-handle",String(p)),e.keyboardSupport&&(S.setAttribute("tabindex","0"),S.addEventListener("keydown",function(k){return Qe(k,p)})),e.handleAttributes!==void 0){var M=e.handleAttributes[p];Object.keys(M).forEach(function(k){S.setAttribute(k,M[k])})}return S.setAttribute("role","slider"),S.setAttribute("aria-orientation",e.ort?"vertical":"horizontal"),p===0?ie(S,e.cssClasses.handleLower):p===e.handles-1&&ie(S,e.cssClasses.handleUpper),v.handle=S,v}function we(u,p){return p?X(u,e.cssClasses.connect):!1}function te(u,p){c=X(p,e.cssClasses.connects),d=[],h=[],h.push(we(c,u[0]));for(var v=0;v<e.handles;v++)d.push(ce(p,v)),C[v]=v,h.push(we(c,u[v+1]))}function le(u){ie(u,e.cssClasses.target),e.dir===0?ie(u,e.cssClasses.ltr):ie(u,e.cssClasses.rtl),e.ort===0?ie(u,e.cssClasses.horizontal):ie(u,e.cssClasses.vertical);var p=getComputedStyle(u).direction;return p==="rtl"?ie(u,e.cssClasses.textDirectionRtl):ie(u,e.cssClasses.textDirectionLtr),X(u,e.cssClasses.base)}function ue(u,p){return!e.tooltips||!e.tooltips[p]?!1:X(u.firstChild,e.cssClasses.tooltip)}function ge(){return o.hasAttribute("disabled")}function de(u){var p=d[u];return p.hasAttribute("disabled")}function x(u){u!=null?(d[u].setAttribute("disabled",""),d[u].handle.removeAttribute("tabindex")):(o.setAttribute("disabled",""),d.forEach(function(p){p.handle.removeAttribute("tabindex")}))}function l(u){u!=null?(d[u].removeAttribute("disabled"),d[u].handle.setAttribute("tabindex","0")):(o.removeAttribute("disabled"),d.forEach(function(p){p.removeAttribute("disabled"),p.handle.setAttribute("tabindex","0")}))}function f(){y&&(Xe("update"+Le.tooltips),y.forEach(function(u){u&&hn(u)}),y=null)}function _(){f(),y=d.map(ue),jt("update"+Le.tooltips,function(u,p,v){if(!(!y||!e.tooltips)&&y[p]!==!1){var S=u[p];e.tooltips[p]!==!0&&(S=e.tooltips[p].to(v[p])),y[p].innerHTML=S}})}function E(){Xe("update"+Le.aria),jt("update"+Le.aria,function(u,p,v,S,M){C.forEach(function(k){var I=d[k],O=at(b,k,0,!0,!0,!0),V=at(b,k,100,!0,!0,!0),H=M[k],G=String(e.ariaFormat.to(v[k]));O=g.fromStepping(O).toFixed(1),V=g.fromStepping(V).toFixed(1),H=g.fromStepping(H).toFixed(1),I.children[0].setAttribute("aria-valuemin",O),I.children[0].setAttribute("aria-valuemax",V),I.children[0].setAttribute("aria-valuenow",H),I.children[0].setAttribute("aria-valuetext",G)})})}function A(u){if(u.mode===Oe.Range||u.mode===Oe.Steps)return g.xVal;if(u.mode===Oe.Count){if(u.values<2)throw new Error("noUiSlider: 'values' (>= 2) required for mode 'count'.");for(var p=u.values-1,v=100/p,S=[];p--;)S[p]=p*v;return S.push(100),j(S,u.stepped)}return u.mode===Oe.Positions?j(u.values,u.stepped):u.mode===Oe.Values?u.stepped?u.values.map(function(M){return g.fromStepping(g.getStep(g.toStepping(M)))}):u.values:[]}function j(u,p){return u.map(function(v){return g.fromStepping(p?g.getStep(v):v)})}function T(u){function p(H,G){return Number((H+G).toFixed(7))}var v=A(u),S={},M=g.xVal[0],k=g.xVal[g.xVal.length-1],I=!1,O=!1,V=0;return v=Xo(v.slice().sort(function(H,G){return H-G})),v[0]!==M&&(v.unshift(M),I=!0),v[v.length-1]!==k&&(v.push(k),O=!0),v.forEach(function(H,G){var J,B,K,ne=H,ee=v[G+1],re,Ft,It,Pt,br,Nt,xr,_r=u.mode===Oe.Steps;for(_r&&(J=g.xNumSteps[G]),J||(J=ee-ne),ee===void 0&&(ee=ne),J=Math.max(J,1e-7),B=ne;B<=ee;B=p(B,J)){for(re=g.toStepping(B),Ft=re-V,br=Ft/(u.density||1),Nt=Math.round(br),xr=Ft/Nt,K=1;K<=Nt;K+=1)It=V+K*xr,S[It.toFixed(5)]=[g.fromStepping(It),0];Pt=v.indexOf(B)>-1?oe.LargeValue:_r?oe.SmallValue:oe.NoValue,!G&&I&&B!==ee&&(Pt=0),B===ee&&O||(S[re.toFixed(5)]=[B,Pt]),V=re}}),S}function Z(u,p,v){var S,M,k=N.createElement("div"),I=(S={},S[oe.None]="",S[oe.NoValue]=e.cssClasses.valueNormal,S[oe.LargeValue]=e.cssClasses.valueLarge,S[oe.SmallValue]=e.cssClasses.valueSub,S),O=(M={},M[oe.None]="",M[oe.NoValue]=e.cssClasses.markerNormal,M[oe.LargeValue]=e.cssClasses.markerLarge,M[oe.SmallValue]=e.cssClasses.markerSub,M),V=[e.cssClasses.valueHorizontal,e.cssClasses.valueVertical],H=[e.cssClasses.markerHorizontal,e.cssClasses.markerVertical];ie(k,e.cssClasses.pips),ie(k,e.ort===0?e.cssClasses.pipsHorizontal:e.cssClasses.pipsVertical);function G(B,K){var ne=K===e.cssClasses.value,ee=ne?V:H,re=ne?I:O;return K+" "+ee[e.ort]+" "+re[B]}function J(B,K,ne){if(ne=p?p(K,ne):ne,ne!==oe.None){var ee=X(k,!1);ee.className=G(ne,e.cssClasses.marker),ee.style[e.style]=B+"%",ne>oe.NoValue&&(ee=X(k,!1),ee.className=G(ne,e.cssClasses.value),ee.setAttribute("data-value",String(K)),ee.style[e.style]=B+"%",ee.innerHTML=String(v.to(K)))}}return Object.keys(u).forEach(function(B){J(B,u[B][0],u[B][1])}),k}function D(){w&&(hn(w),w=null)}function ye(u){D();var p=T(u),v=u.filter,S=u.format||{to:function(M){return String(Math.round(M))}};return w=o.appendChild(Z(p,v,S)),w}function Fe(){var u=a.getBoundingClientRect(),p="offset"+["Width","Height"][e.ort];return e.ort===0?u.width||a[p]:u.height||a[p]}function he(u,p,v,S){var M=function(I){var O=be(I,S.pageOffset,S.target||p);if(!O||ge()&&!S.doNotReject||ea(o,e.cssClasses.tap)&&!S.doNotReject||u===n.start&&O.buttons!==void 0&&O.buttons>1||S.hover&&O.buttons)return!1;s||O.preventDefault(),O.calcPoint=O.points[e.ort],v(O,S)},k=[];return u.split(" ").forEach(function(I){p.addEventListener(I,M,s?{passive:!0}:!1),k.push([I,M])}),k}function be(u,p,v){var S=u.type.indexOf("touch")===0,M=u.type.indexOf("mouse")===0,k=u.type.indexOf("pointer")===0,I=0,O=0;if(u.type.indexOf("MSPointer")===0&&(k=!0),u.type==="mousedown"&&!u.buttons&&!u.touches)return!1;if(S){var V=function(J){var B=J.target;return B===v||v.contains(B)||u.composed&&u.composedPath().shift()===v};if(u.type==="touchstart"){var H=Array.prototype.filter.call(u.touches,V);if(H.length>1)return!1;I=H[0].pageX,O=H[0].pageY}else{var G=Array.prototype.find.call(u.changedTouches,V);if(!G)return!1;I=G.pageX,O=G.pageY}}return p=p||Vn(N),(M||k)&&(I=u.clientX+p.x,O=u.clientY+p.y),u.pageOffset=p,u.points=[I,O],u.cursor=M||k,u}function Se(u){var p=u-Zo(a,e.ort),v=p*100/Fe();return v=gn(v),e.dir?100-v:v}function Be(u){var p=100,v=!1;return d.forEach(function(S,M){if(!de(M)){var k=b[M],I=Math.abs(k-u),O=I===100&&p===100,V=I<p,H=I<=p&&u>k;(V||H||O)&&(v=M,p=I)}}),v}function ke(u,p){u.type==="mouseout"&&u.target.nodeName==="HTML"&&u.relatedTarget===null&&je(u,p)}function Ae(u,p){if(navigator.appVersion.indexOf("MSIE 9")===-1&&u.buttons===0&&p.buttonsProperty!==0)return je(u,p);var v=(e.dir?-1:1)*(u.calcPoint-p.startCalcPoint),S=v*100/p.baseSize;pr(v>0,S,p.locations,p.handleNumbers,p.connect)}function je(u,p){p.handle&&(wt(p.handle,e.cssClasses.active),L-=1),p.listeners.forEach(function(v){Q.removeEventListener(v[0],v[1])}),L===0&&(wt(o,e.cssClasses.drag),Ot(),u.cursor&&(F.style.cursor="",F.removeEventListener("selectstart",fn))),e.events.smoothSteps&&(p.handleNumbers.forEach(function(v){Ie(v,b[v],!0,!0,!1,!1)}),p.handleNumbers.forEach(function(v){Y("update",v)})),p.handleNumbers.forEach(function(v){Y("change",v),Y("set",v),Y("end",v)})}function Ue(u,p){if(!p.handleNumbers.some(de)){var v;if(p.handleNumbers.length===1){var S=d[p.handleNumbers[0]];v=S.children[0],L+=1,ie(v,e.cssClasses.active)}u.stopPropagation();var M=[],k=he(n.move,Q,Ae,{target:u.target,handle:v,connect:p.connect,listeners:M,startCalcPoint:u.calcPoint,baseSize:Fe(),pageOffset:u.pageOffset,handleNumbers:p.handleNumbers,buttonsProperty:u.buttons,locations:b.slice()}),I=he(n.end,Q,je,{target:u.target,handle:v,listeners:M,doNotReject:!0,handleNumbers:p.handleNumbers}),O=he("mouseout",Q,ke,{target:u.target,handle:v,listeners:M,doNotReject:!0,handleNumbers:p.handleNumbers});M.push.apply(M,k.concat(I,O)),u.cursor&&(F.style.cursor=getComputedStyle(u.target).cursor,d.length>1&&ie(o,e.cssClasses.drag),F.addEventListener("selectstart",fn,!1)),p.handleNumbers.forEach(function(V){Y("start",V)})}}function ot(u){u.stopPropagation();var p=Se(u.calcPoint),v=Be(p);v!==!1&&(e.events.snap||pn(o,e.cssClasses.tap,e.animationDuration),Ie(v,p,!0,!0),Ot(),Y("slide",v,!0),Y("update",v,!0),e.events.snap?Ue(u,{handleNumbers:[v]}):(Y("change",v,!0),Y("set",v,!0)))}function At(u){var p=Se(u.calcPoint),v=g.getStep(p),S=g.fromStepping(v);Object.keys(R).forEach(function(M){M.split(".")[0]==="hover"&&R[M].forEach(function(k){k.call(ct,S)})})}function Qe(u,p){if(ge()||de(p))return!1;var v=["Left","Right"],S=["Down","Up"],M=["PageDown","PageUp"],k=["Home","End"];e.dir&&!e.ort?v.reverse():e.ort&&!e.dir&&(S.reverse(),M.reverse());var I=u.key.replace("Arrow",""),O=I===M[0],V=I===M[1],H=I===S[0]||I===v[0]||O,G=I===S[1]||I===v[1]||V,J=I===k[0],B=I===k[1];if(!H&&!G&&!J&&!B)return!0;u.preventDefault();var K;if(G||H){var ne=H?0:1,ee=wr(p),re=ee[ne];if(re===null)return!1;re===!1&&(re=g.getDefaultStep(b[p],H,e.keyboardDefaultStep)),V||O?re*=e.keyboardPageMultiplier:re*=e.keyboardMultiplier,re=Math.max(re,1e-7),re=(H?-1:1)*re,K=m[p]+re}else B?K=e.spectrum.xVal[e.spectrum.xVal.length-1]:K=e.spectrum.xVal[0];return Ie(p,g.toStepping(K),!0,!0),Y("slide",p),Y("update",p),Y("change",p),Y("set",p),!1}function fr(u){u.fixed||d.forEach(function(p,v){he(n.start,p.children[0],Ue,{handleNumbers:[v]})}),u.tap&&he(n.start,a,ot,{}),u.hover&&he(n.move,a,At,{hover:!0}),u.drag&&h.forEach(function(p,v){if(!(p===!1||v===0||v===h.length-1)){var S=d[v-1],M=d[v],k=[p],I=[S,M],O=[v-1,v];ie(p,e.cssClasses.draggable),u.fixed&&(k.push(S.children[0]),k.push(M.children[0])),u.dragAll&&(I=d,O=C),k.forEach(function(V){he(n.start,V,Ue,{handles:I,handleNumbers:O,connect:p})})}})}function jt(u,p){R[u]=R[u]||[],R[u].push(p),u.split(".")[0]==="update"&&d.forEach(function(v,S){Y("update",S)})}function Xn(u){return u===Le.aria||u===Le.tooltips}function Xe(u){var p=u&&u.split(".")[0],v=p?u.substring(p.length):u;Object.keys(R).forEach(function(S){var M=S.split(".")[0],k=S.substring(M.length);(!p||p===M)&&(!v||v===k)&&(!Xn(k)||v===k)&&delete R[S]})}function Y(u,p,v){Object.keys(R).forEach(function(S){var M=S.split(".")[0];u===M&&R[S].forEach(function(k){k.call(ct,m.map(e.format.to),p,m.slice(),v||!1,b.slice(),ct)})})}function at(u,p,v,S,M,k,I){var O;return d.length>1&&!e.events.unconstrained&&(S&&p>0&&(O=g.getAbsoluteDistance(u[p-1],e.margin,!1),v=Math.max(v,O)),M&&p<d.length-1&&(O=g.getAbsoluteDistance(u[p+1],e.margin,!0),v=Math.min(v,O))),d.length>1&&e.limit&&(S&&p>0&&(O=g.getAbsoluteDistance(u[p-1],e.limit,!1),v=Math.min(v,O)),M&&p<d.length-1&&(O=g.getAbsoluteDistance(u[p+1],e.limit,!0),v=Math.max(v,O))),e.padding&&(p===0&&(O=g.getAbsoluteDistance(0,e.padding[0],!1),v=Math.max(v,O)),p===d.length-1&&(O=g.getAbsoluteDistance(100,e.padding[1],!0),v=Math.min(v,O))),I||(v=g.getStep(v)),v=gn(v),v===u[p]&&!k?!1:v}function Lt(u,p){var v=e.ort;return(v?p:u)+", "+(v?u:p)}function pr(u,p,v,S,M){var k=v.slice(),I=S[0],O=e.events.smoothSteps,V=[!u,u],H=[u,!u];S=S.slice(),u&&S.reverse(),S.length>1?S.forEach(function(J,B){var K=at(k,J,k[J]+p,V[B],H[B],!1,O);K===!1?p=0:(p=K-k[J],k[J]=K)}):V=H=[!0];var G=!1;S.forEach(function(J,B){G=Ie(J,v[J]+p,V[B],H[B],!1,O)||G}),G&&(S.forEach(function(J){Y("update",J),Y("slide",J)}),M!=null&&Y("drag",I))}function gr(u,p){return e.dir?100-u-p:u}function Yn(u,p){b[u]=p,m[u]=g.fromStepping(p);var v=gr(p,0)-P,S="translate("+Lt(v+"%","0")+")";if(d[u].style[e.transformRule]=S,e.events.invertConnects&&b.length>1){var M=b.every(function(k,I,O){return I===0||k>=O[I-1]});if(U!==!M){ni();return}}Ye(u),Ye(u+1),U&&(Ye(u-1),Ye(u+2))}function Ot(){C.forEach(function(u){var p=b[u]>50?-1:1,v=3+(d.length+p*u);d[u].style.zIndex=String(v)})}function Ie(u,p,v,S,M,k){return M||(p=at(b,u,p,v,S,!1,k)),p===!1?!1:(Yn(u,p),!0)}function Ye(u){if(h[u]){var p=b.slice();U&&p.sort(function(O,V){return O-V});var v=0,S=100;u!==0&&(v=p[u-1]),u!==h.length-1&&(S=p[u]);var M=S-v,k="translate("+Lt(gr(v,M)+"%","0")+")",I="scale("+Lt(M/100,"1")+")";h[u].style[e.transformRule]=k+" "+I}}function mr(u,p){return u===null||u===!1||u===void 0||(typeof u=="number"&&(u=String(u)),u=e.format.from(u),u!==!1&&(u=g.toStepping(u)),u===!1||isNaN(u))?b[p]:u}function lt(u,p,v){var S=kt(u),M=b[0]===void 0;p=p===void 0?!0:p,e.animate&&!M&&pn(o,e.cssClasses.tap,e.animationDuration),C.forEach(function(O){Ie(O,mr(S[O],O),!0,!1,v)});var k=C.length===1?0:1;if(M&&g.hasNoSize()&&(v=!0,b[0]=0,C.length>1)){var I=100/(C.length-1);C.forEach(function(O){b[O]=O*I})}for(;k<C.length;++k)C.forEach(function(O){Ie(O,b[O],!0,!0,v)});Ot(),C.forEach(function(O){Y("update",O),S[O]!==null&&p&&Y("set",O)})}function Zn(u){lt(e.start,u)}function Kn(u,p,v,S){if(u=Number(u),!(u>=0&&u<C.length))throw new Error("noUiSlider: invalid handle number, got: "+u);Ie(u,mr(p,u),!0,!0,S),Y("update",u),v&&Y("set",u)}function vr(u){if(u===void 0&&(u=!1),u)return m.length===1?m[0]:m.slice(0);var p=m.map(e.format.to);return p.length===1?p[0]:p}function ei(){for(Xe(Le.aria),Xe(Le.tooltips),Object.keys(e.cssClasses).forEach(function(u){wt(o,e.cssClasses[u])});o.firstChild;)o.removeChild(o.firstChild);delete o.noUiSlider}function wr(u){var p=b[u],v=g.getNearbySteps(p),S=m[u],M=v.thisStep.step,k=null;if(e.snap)return[S-v.stepBefore.startValue||null,v.stepAfter.startValue-S||null];M!==!1&&S+M>v.stepAfter.startValue&&(M=v.stepAfter.startValue-S),S>v.thisStep.startValue?k=v.thisStep.step:v.stepBefore.step===!1?k=!1:k=S-v.stepBefore.highestStep,p===100?M=null:p===0&&(k=null);var I=g.countStepDecimals();return M!==null&&M!==!1&&(M=Number(M.toFixed(I))),k!==null&&k!==!1&&(k=Number(k.toFixed(I))),[k,M]}function ti(){return C.map(wr)}function ri(u,p){var v=vr(),S=["margin","limit","padding","range","animate","snap","step","format","pips","tooltips","connect"];S.forEach(function(k){u[k]!==void 0&&(t[k]=u[k])});var M=Jn(t);S.forEach(function(k){u[k]!==void 0&&(e[k]=M[k])}),g=M.spectrum,e.margin=M.margin,e.limit=M.limit,e.padding=M.padding,e.pips?ye(e.pips):D(),e.tooltips?_():f(),b=[],lt(er(u.start)?u.start:v,p),u.connect&&yr()}function yr(){for(;c.firstChild;)c.removeChild(c.firstChild);for(var u=0;u<=e.handles;u++)h[u]=we(c,e.connect[u]),Ye(u);fr({drag:e.events.drag,fixed:!0})}function ni(){U=!U,Wn(e,e.connect.map(function(u){return!u})),yr()}function ii(){a=le(o),te(e.connect,a),fr(e.events),lt(e.start),e.pips&&ye(e.pips),e.tooltips&&_(),E()}ii();var ct={destroy:ei,steps:ti,on:jt,off:Xe,get:vr,set:lt,setHandle:Kn,reset:Zn,disable:x,enable:l,__moveHandles:function(u,p,v){pr(u,p,b,v)},options:t,updateOptions:ri,target:o,removePips:D,removeTooltips:f,getPositions:function(){return b.slice()},getTooltips:function(){return y},getOrigins:function(){return d},pips:ye};return ct}function Fa(r,e){if(!r||!r.nodeName)throw new Error("noUiSlider: create requires a single element, got: "+r);if(r.noUiSlider)throw new Error("noUiSlider: Slider was already initialized.");var t=Jn(e),n=Oa(r,t,e);return r.noUiSlider=n,n}const Ia={__spectrum:Hn,cssClasses:qn,create:Fa};class Qn{constructor(){this.playIntervals=new Map,this.playStates=new Map}_processRangeData(e,t,n){const i=e.map(g=>({value:parseInt(g.key,10),count:g.doc_count||0})).filter(g=>!isNaN(g.value)).sort((g,m)=>g.value-m.value),s=t.map(g=>({value:parseInt(g.key,10),count:g.doc_count||0})).filter(g=>!isNaN(g.value)).sort((g,m)=>g.value-m.value);if(i.length===0)throw new Error("No valid numeric values found in range data");const o=i.map(g=>g.value),a=s.map(g=>g.value),c=o[0],d=o[o.length-1],h=[...new Set(a)];let w,y;return n&&n.length===2?(w=Math.max(n[0],c),y=Math.min(n[1],d)):(w=h[0]||c,y=h[h.length-1]||d),{allBuckets:i,availableBuckets:s,sortedAvailableValues:h,minValue:c,maxValue:d,startValue:w,endValue:y}}_createRangeFacetDOM(e,t){const n=document.createElement("div");return n.className="facet-slider my-3",n.innerHTML=this._getRangeFacetHTML(e,t),n}_getRangeFacetHTML(e,{minValue:t,maxValue:n}){return`
      <div class="space-y-3">
        <!-- Play Controls -->
        <div class="play-controls flex items-center justify-center gap-2 pb-3 border-b border-gray-200">
          <button id="${e}-play-btn" class="group relative w-8 h-8 bg-gradient-to-r from-primary-400 to-primary-700 text-white text-xs rounded-full transition-colors duration-200 hover:from-primary-600 hover:to-primary-700 shadow-md hover:shadow-lg flex items-center justify-center" type="button">
            <div class="w-0 h-0 border-l-[5px] border-l-white border-y-[3px] border-y-transparent ml-0.5"></div>
            <span class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap">Play</span>
          </button>
          <button id="${e}-pause-btn" class="group relative w-8 h-8 bg-gradient-to-r from-secondary-400 to-secondary-700 text-white text-xs rounded-full transition-colors duration-200 hover:from-secondary-600 hover:to-secondary-700 shadow-md hover:shadow-lg flex items-center justify-center" type="button">
            <div class="flex gap-0.5">
              <div class="w-0.5 h-3 bg-white rounded-sm"></div>
              <div class="w-0.5 h-3 bg-white rounded-sm"></div>
            </div>
            <span class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap">Pause</span>
          </button>
        </div>

        <!-- Chart Container -->
        <div class="relative">
          <div id="${e}-chart" class="w-full h-16 mb-3 bg-gray-50 rounded-md p-2"></div>
        </div>
        
        <!-- Slider Container -->
        <div class="px-1">
          <div id="${e}-slider" class="slider-container"></div>
        </div>
        
        <!-- Value Display -->
        <div class="flex items-center justify-between text-xs text-gray-600 px-1">
          <span id="${e}-min-display" class="font-medium">${t}</span>
          <span id="${e}-max-display" class="font-medium">${n}</span>
        </div>
        
        <!-- Custom Range Inputs -->
        <div class="mt-4 pt-3 border-t border-gray-100">
          <div class="text-xs font-medium text-gray-700 mb-2">Custom range:</div>
          <div class="grid grid-cols-2 gap-2">
            <div class="min-w-0">
              <input id="${e}-min-input" type="number"
                    class="w-full px-2 py-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-primary-400 focus:border-primary-400 focus:outline-none"
                    value="${t}"
                    placeholder="Min">
            </div>
            <div class="min-w-0">
              <input id="${e}-max-input" type="number"
                    class="w-full px-2 py-1 text-xs border border-gray-200 rounded focus:ring-1 focus:ring-primary-400 focus:border-primary-400 focus:outline-none"
                    value="${n}"
                    placeholder="Max">
            </div>
          </div>
        </div>
      </div>
    `}_getSliderElements(e,t){return{chartElement:e.querySelector(`#${t}-chart`),slider:e.querySelector(`#${t}-slider`),minInput:e.querySelector(`#${t}-min-input`),maxInput:e.querySelector(`#${t}-max-input`),minDisplay:e.querySelector(`#${t}-min-display`),maxDisplay:e.querySelector(`#${t}-max-display`),playBtn:e.querySelector(`#${t}-play-btn`),pauseBtn:e.querySelector(`#${t}-pause-btn`)}}_initializeSlider(e,t){Ia.create(e,{start:[t.startValue,t.endValue],connect:!0,step:1,range:{min:t.minValue,max:t.maxValue},format:{to:n=>Math.round(n),from:n=>parseInt(n,10)}}),e.classList.add("custom-slider")}_setupEventHandlers(e,t,n,i){t.slider.noUiSlider.on("update",s=>{const[o,a]=s.map(c=>Math.round(Number(c)));t.minDisplay.textContent=o.toString(),t.maxDisplay.textContent=a.toString(),document.activeElement!==t.minInput&&(t.minInput.value=o),document.activeElement!==t.maxInput&&(t.maxInput.value=a)}),t.slider.noUiSlider.on("change",s=>{const[o,a]=s.map(c=>Math.round(Number(c)));!isNaN(o)&&!isNaN(a)&&o>=n.minValue&&a<=n.maxValue&&this._updateRange(e,[o,a],i,t.chartElement,n.allBuckets,n)}),t.minInput.addEventListener("change",s=>{this._handleInputChange(s.target,!0,e,t,n,i)}),t.maxInput.addEventListener("change",s=>{this._handleInputChange(s.target,!1,e,t,n,i)}),[t.minInput,t.maxInput].forEach(s=>{s.addEventListener("keypress",o=>{o.key==="Enter"&&o.target.blur()})}),this.setupPlayControls(e,t.playBtn,t.pauseBtn,t.slider,n.sortedAvailableValues,i,t.chartElement,n.allBuckets)}_validateAndClampInput(e,t,n){const i=parseInt(e,10);return isNaN(i)?null:Math.max(t,Math.min(n,i))}_storeSliderReferences(e,t,n){e.slider=t.slider,e.sortedValues=n.sortedAvailableValues,Object.assign(e,t),e.cleanup=()=>{t.slider.noUiSlider&&t.slider.noUiSlider.destroy(),this.playStates.delete(e.facetKey)}}setupPlayControls(e,t,n,i,s,o,a,c){t.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.startPlay(e,t,n,i,s,o,a,c)}),n.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.pausePlay(e,t,n)})}startPlay(e,t,n,i,s,o,a,c){if(this.playIntervals.has(e))return;const[d,h]=i.noUiSlider.get().map(Number),w=this._findClosestDatasetValue(s,d),y=this._findClosestDatasetValue(s,h);let g=this.playStates.get(e);if(g)g.currentMaxIndex>=g.maxLimitIndex&&(g.currentMaxIndex=g.startMinIndex,this.playStates.set(e,g));else{const b=s.indexOf(w),C=s.indexOf(y);g={startMinIndex:b,currentMaxIndex:b,maxLimitIndex:C,originalMin:w,originalMax:y},this.playStates.set(e,g)}const m=setInterval(()=>{const b=this.playStates.get(e);if(!b){clearInterval(m),this.playIntervals.delete(e);return}let{startMinIndex:C,currentMaxIndex:L,maxLimitIndex:R}=b;if(L=Math.min(L+1,R),L>=R){const Q=s[C],F=s[R];i.noUiSlider.set([Q,F]);const P=i.closest(".facet-slider");P.minValue,P.maxValue,o({type:"RANGE_CHANGE",facetKey:e,value:[Q,F]}),this.updateChartHighlight(a,c,Q,F),this.playStates.delete(e),this.pausePlay(e,t,n);return}this.playStates.set(e,{...b,currentMaxIndex:L});const U=s[C],N=s[L];i.noUiSlider.set([U,N]),o({type:"RANGE_CHANGE",facetKey:e,value:[U,N]}),this.updateChartHighlight(a,c,U,N)},500);this.playIntervals.set(e,m)}pausePlay(e,t,n){const i=this.playIntervals.get(e);i&&(clearInterval(i),this.playIntervals.delete(e))}_updateRange(e,[t,n],i,s,o,a){this.playStates.delete(e);let c;t===a.minValue&&n===a.maxValue?c=null:c=[t,n],i({type:"RANGE_CHANGE",facetKey:e,value:c}),this.updateChartHighlight(s,o,t,n)}_handleInputChange(e,t,n,i,s,o){const a=this._validateAndClampInput(e.value,s.minValue,s.maxValue);if(a===null)return;const[c,d]=i.slider.noUiSlider.get().map(Number),h=t?[Math.max(s.minValue,Math.min(a,d)),d]:[c,Math.min(s.maxValue,Math.max(a,c))];this._updateRange(n,h,o,i.chartElement,s.allBuckets,s),i.slider.noUiSlider.set(h)}_findClosestDatasetValue(e,t){if(e.length===0)return t;if(t<=e[0])return e[0];if(t>=e[e.length-1])return e[e.length-1];let n=0,i=e.length-1;for(;n<=i;){const a=Math.floor((n+i)/2),c=e[a];if(c===t)return c;c<t?n=a+1:i=a-1}if(i<0)return e[0];if(n>=e.length)return e[e.length-1];const s=Math.abs(e[n]-t),o=Math.abs(e[i]-t);return s<=o?e[n]:e[i]}updateChartHighlight(e,t,n,i){const s=e.querySelector(".flex.items-end");if(!s){console.warn("Bars container not found");return}s.querySelectorAll("[data-value]").forEach(a=>{const c=parseInt(a.dataset.value),d=parseInt(a.dataset.count);c>=n&&c<=i?d>0?a.style.backgroundColor="#d1d5db":a.style.backgroundColor="#bfdbfe":a.style.backgroundColor="#d1d5db"})}renderBarChart(e,t,n,i,s,o=null){e.innerHTML="";const a=Math.max(...n.map(w=>w.count),1);this.sortedAllBuckets=[...t].sort((w,y)=>w.value-y.value);const c=document.createElement("div");c.className="w-full h-full flex flex-col",e.appendChild(c);const d=document.createElement("div");d.className="w-full flex-1 rounded px-1 overflow-hidden",d.style.height="150px",c.appendChild(d);const h=document.createElement("div");h.className="flex items-end w-full h-full",d.appendChild(h),this.sortedAllBuckets.forEach(w=>{const y=w.count>0?w.count/a*90:2,g=document.createElement("div");g.className="flex-1 mx-px transition-colors duration-200",g.style.height=`${Math.max(y,1)}%`,g.dataset.value=w.value,g.dataset.count=w.count,w.count>0?(g.title=`Value: ${w.value}, Count: ${w.count}`,g.style.backgroundColor="#3b82f6"):(g.title=`Value: ${w.value}, No data available`,g.style.backgroundColor="#d1d5db"),h.appendChild(g)})}_renderEmptyRangeFacet(e,t){const n=document.createElement("div");return n.className="facet-slider my-3 text-center text-gray-500 py-4",n.innerHTML='<p class="text-sm">No data available for this range</p>',e.appendChild(n),n}_renderRangeFacet(e,t,n,i,s,o,a){var b;const c=i[t]||[];console.log(`=== RangeRenderer for ${t} ===`),console.log("Received state:",o),console.log("state.filters:",o==null?void 0:o.filters),console.log("state.filters[facetKey]:",(b=o==null?void 0:o.filters)==null?void 0:b[t]),console.log("=====================================");const d=c.filter(C=>C.doc_count>0);if(!c||c.length===0)return this._renderEmptyRangeFacet(e,t);const h=this._processRangeData(c,d,o.filters[t]);if(h.sortedAvailableValues.length===0){const C=document.createElement("div");return C.className="facet-slider my-3 text-center text-gray-500 py-4",C.innerHTML=`
        <p class="text-sm">No values available with current filters</p>
        <p class="text-xs text-gray-400">Range: ${h.minValue} - ${h.maxValue}</p>
      `,e.appendChild(C),C}const w=h.sortedAvailableValues[0],y=h.sortedAvailableValues[h.sortedAvailableValues.length-1];if(w===y){const C=w+1;h.sliderMax=C,h.endValue=w}const g=this._createRangeFacetDOM(t,{minValue:h.minValue,maxValue:h.maxValue});e.appendChild(g);const m=this._getSliderElements(g,t);return this.renderBarChart(m.chartElement,h.allBuckets,h.availableBuckets,h.minValue,h.maxValue),this._initializeSlider(m.slider,h),this._setupEventHandlers(t,m,h,a),this.updateChartHighlight(m.chartElement,h.allBuckets,h.startValue,h.endValue),this._storeSliderReferences(g,m,h),g}}class Pa{constructor(e){this.config=e,this.taxonomyRenderer=new Un,this.rangeRenderer=new Qn,this.searchTerms={}}renderFacets(e,t,n){if(!e||!this.config.aggregations){console.error("No aggregations data or configuration available.");return}const i=document.getElementById("facets-container"),s=this._getCheckedState();i.innerHTML="";const o={};Object.entries(this.config.aggregations).forEach(([a,c])=>{const d=c.category||"Other";o[d]||(o[d]=[]),o[d].push({facetKey:a,facetConfig:c})}),Object.entries(o).forEach(([a,c])=>{const d=document.createElement("div");d.className="facet-category",d.setAttribute("data-category",a);const h=document.createElement("h3");h.className="facet-category-title",h.textContent=a,d.appendChild(h);const w=document.createElement("div");w.className="facet-category-content",c.forEach(({facetKey:y,facetConfig:g})=>{const m=this._createFacetGroup(y,g);g.type==="range"?this.rangeRenderer._renderRangeFacet(m,y,g,e,s,t,n):g.type==="taxonomy"?this.taxonomyRenderer._renderTaxonomyFacet(m,y,g,e,s,t,n):g.type==="simple"&&this._renderStandardFacet(m,y,g,e,s,t,n),w.appendChild(m)}),d.appendChild(w),i.appendChild(d)}),this._addFacetEventListeners(n)}_filterFacetOptions(e,t){const n=e.querySelectorAll("label");let i=0;n.forEach(s=>{const o=s.textContent.toLowerCase(),a=t===""||o.includes(t);s.classList.toggle("facet-hidden",!a),a&&i++}),this._showNoResultsMessage(e,i===0&&t!=="")}_showNoResultsMessage(e,t){let n=e.querySelector(".no-results-disclaimer");t?(n||(n=document.createElement("div"),n.className="no-results-disclaimer",n.textContent="Nessun risultato per questa ricerca",n.style.cssText="padding: 10px; color: #666; font-style: italic;",e.appendChild(n)),n.style.display="block"):n&&(n.style.display="none"),e.style.display="block"}_updateCategoryVisibility(){document.querySelectorAll(".facet-category").forEach(t=>{const n=t.querySelectorAll('.facet-group[style*="display: block"], .facet-group:not([style*="display: none"])'),i=Array.from(n).some(s=>s.style.display!=="none");t.style.display=i?"block":"none"})}_getCheckedState(){const e={};return Object.keys(this.config.aggregations).forEach(t=>{const n=document.getElementById(`${t}-facet`);n&&(e[t]=Array.from(n.querySelectorAll("input:checked")).map(i=>i.value))}),e}_createFacetGroup(e,t){const n=document.createElement("div");n.className="facet-group mb-4 p-4 bg-white rounded-lg shadow",n.id=`${e}-facet`;const i=document.createElement("div");i.className="facet-header mb-3";const s=document.createElement("h3");if(s.className="text-lg font-semibold mb-2",s.textContent=t.title||e,i.appendChild(s),t.type=="simple"){const o=document.createElement("div");o.className="facet-search mb-2";const a=document.createElement("input");a.type="text",a.className="facet-search-input w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-primary-500",a.placeholder="Cerca...",a.id=`search-${e}`;const c=this._debounce(d=>{this._searchWithinFacet(e,d)},300);a.addEventListener("input",d=>{c(d.target.value)}),o.appendChild(a),i.appendChild(o)}return n.appendChild(i),n}_searchWithinFacet(e,t){const n=document.getElementById(`${e}-facet`);n&&(this.searchTerms[e]=t.toLowerCase().trim(),this._filterFacetOptions(n,this.searchTerms[e]))}_renderStandardFacet(e,t,n,i,s,o,a){const c=document.createElement("div");c.className="facet-options space-y-2";const d=i[t]||[],h=o.filters||{};d.forEach(w=>{var U;const y=(U=h[t])==null?void 0:U.includes(w.key),g=w.doc_count===0,m=document.createElement("label");m.className="block facet-option flex items-center justify-between",m.style.display="flex",m.setAttribute("data-search-text",w.key.toLowerCase()),g?m.classList.add("text-gray-400","cursor-not-allowed","opacity-50"):m.classList.add("cursor-pointer");const b=document.createElement("div");b.className="flex items-center";const C=document.createElement("input");C.type="checkbox",C.value=w.key,C.dataset.facetType=t,C.checked=y,C.disabled=g,C.className="form-checkbox mr-2",b.appendChild(C);const L=document.createElement("span");L.textContent=w.key,L.className="text-sm";const R=document.createElement("span");R.textContent=w.doc_count,R.className=`text-xs px-2 py-0.5 rounded-full flex-shrink-0 ml-auto ${g?"text-gray-400 bg-gray-100":"text-secondary-500 bg-secondary-100"}`,b.appendChild(L),m.appendChild(b),m.appendChild(R),c.appendChild(m)}),e.appendChild(c)}_addFacetEventListeners(e){if(!this.config.aggregations){console.error("Aggregations configuration not found");return}Object.keys(this.config.aggregations).forEach(t=>{const n=document.getElementById(`${t}-facet`);n&&n.querySelectorAll('input[type="checkbox"]').forEach(i=>{i.addEventListener("change",s=>{this._onFacetChange(s,e)})})})}_onFacetChange(e,t){const{value:n,checked:i}=e.target,s=e.target.dataset.facetType;t({type:"FACET_CHANGE",facetType:s,value:n,checked:i})}clearAllSearches(){this.searchTerms={},Object.keys(this.config.aggregations).forEach(i=>{const s=document.getElementById(`search-${i}`);s&&(s.value="")}),document.querySelectorAll(".facet-option, label").forEach(i=>{i.style.display="block"}),document.querySelectorAll(".facet-group").forEach(i=>{i.style.display="block"}),document.querySelectorAll(".facet-category").forEach(i=>{i.style.display="block"})}_debounce(e,t){let n;return function(){clearTimeout(n),n=setTimeout(()=>e.apply(this,arguments),t)}}}class Na{constructor(e,t){this.searchEngine=e,this.config=t}performSearch(e,t={}){if(!this.searchEngine){console.error("Search engine not initialized");return}const{filters:n}=e,{regularFilters:i,dateFilters:s,taxonomyFilters:o}=this._separateFilters(n),a=this.searchEngine.search({query:e.query||"",filters:i,sort:e.sort||"title_asc",per_page:1e3,filter:d=>this._customFilter(d,s,o)}),c=this._extractCoordinates(a.data.items);if(t.onMarkersUpdate&&t.onMarkersUpdate(a.data.items),t.onResultsUpdate&&t.onResultsUpdate(a.data.items),t.onAggregationsUpdate){const d=this._formatAggregations(a.data.aggregations);t.onAggregationsUpdate(d)}return{items:a.data.items,coordinates:c,aggregations:this._formatAggregations(a.data.aggregations)}}_separateFilters(e){const t={},n={},i={};return Object.entries(e).forEach(([s,o])=>{if(!o||o.length===0)return;const a=this.config.aggregations[s];if(a)switch(a.type){case"range":n[s]=o;break;case"taxonomy":i[s]=o;break;default:t[s]=o}}),{regularFilters:t,dateFilters:n,taxonomyFilters:i}}_customFilter(e,t,n){for(const[i,s]of Object.entries(t))if(s.length===2){const[o,a]=s,c=new Date(e[i]).getTime();if(!(c>=o&&c<=a))return!1}for(const[i,s]of Object.entries(n)){if(!e[i])return!1;const o=e[i];let a;if(Array.isArray(o)?a=o.length>0?String(o[0]):"":typeof o=="string"?a=o:a=String(o||""),!s.some(d=>a===d||a.startsWith(d+" > ")))return!1}return!0}_extractCoordinates(e){return e.filter(t=>t.lat_long&&t.lat_long.length>0).map(t=>{const n=t.lat_long[0],[i,s]=n.split(",");return[parseFloat(i),parseFloat(s)]})}_formatAggregations(e){const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=e[n].buckets);return t}}class Ra{constructor(e){this.mapFocusCallback=e,this.allWorks=[],this.modalRenderer=new gi(e)}updateResultsList(e,t,n={}){const i=document.getElementById("results");if(!i){console.error("Results container not found");return}this.items=e,this.searchState=n;const s=this._groupByIdOpera(e);this.allWorks=Object.values(s);const o=e.map(a=>a.pivot_ID);this.allWorks.sort((a,c)=>o.indexOf(a.pivot_ID)-o.indexOf(c.pivot_ID)),this.modalRenderer.setData(this.allWorks,this.items),this.modalRenderer.setConfig(t),this.modalRenderer.setSearchState(n),i.innerHTML=this.allWorks.map((a,c)=>this._renderResultItem(a,c)).join(""),this._addMapFocusListeners(),this._addModalListeners()}focusOnResult(e){const t=document.querySelector(`[data-result-id="${e}"]`);return t?(this._openFiltersPanel(),t.scrollIntoView({behavior:"smooth",block:"center"}),this._highlightResult(t),console.log(`Focused on result with pivot_ID: ${e}`),!0):(console.warn(`Result with pivot_ID ${e} not found in current results`),!1)}_openFiltersPanel(){const e=document.getElementById("results-panel");e?(e.classList.remove("panel-closed-right"),console.log("Filters panel opened")):console.warn('Filters panel with ID "results-panel" not found')}_highlightResult(e){const t=document.querySelector(".result-highlighted");t&&t.classList.remove("result-highlighted"),e.classList.add("result-highlighted"),e.style.transition="all 0.3s ease",e.style.transform="scale(1.02)",setTimeout(()=>{e.style.transform=""},1e3),setTimeout(()=>{e.classList.remove("result-highlighted")},3e3)}_groupByIdOpera(e){const t={};return e.forEach(n=>{const i=n.pivot_ID;t[i]||(t[i]={pivot_ID:i,Title:n[window.ledaSearch.config.result_cards.card_title],Subtitle:n[window.ledaSearch.config.result_cards.card_subtitle]||"",Subtitle2:n[window.ledaSearch.config.result_cards.card_subtitle_2]||"",Description:n[window.ledaSearch.config.result_cards.card_description]||"",Location:[],coordinates:[]}),n.Location&&(Array.isArray(n.Location)?n.Location:[n.Location]).forEach((o,a)=>{if(!t[i].Location.includes(o)){t[i].Location.push(o);const c=this._extractCoordinatesFromItem(n,a);t[i].coordinates.push(c)}})}),t}_renderResultItem(e,t){const n=e.Location.map((i,s)=>{const o=e.coordinates[s],a=o&&o.lat&&o.lng;return`
        <button class="focus-map-btn inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium transition-all duration-200 hover:shadow-sm hover:scale-105 active:scale-95 cursor-pointer transform 
                       ${a?"bg-secondary-100 hover:bg-secondary-200 text-secondary-700 border border-secondary-200":"bg-gray-100 text-gray-500 border border-gray-200"}" 
                data-space="${encodeURIComponent(i)}" 
                ${a?`data-lat="${o.lat}" data-lng="${o.lng}"`:""}
                title="${a?"Clicca per visualizzare sulla mappa":"Coordinate non disponibili"}">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-4 h-4 mr-1 ${a?"":"opacity-50"}">
            <path fill-rule="evenodd" d="m7.539 14.841.003.003.002.002a.755.755 0 0 0 .912 0l.002-.002.003-.003.012-.009a5.57 5.57 0 0 0 .19-.153 15.588 15.588 0 0 0 2.046-2.082c1.101-1.362 2.291-3.342 2.291-5.597A5 5 0 0 0 3 7c0 2.255 1.19 4.235 2.292 5.597a15.591 15.591 0 0 0 2.046 2.082 8.916 8.916 0 0 0 .189.153l.012.01ZM8 8.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" clip-rule="evenodd" />
          </svg>
          ${i}
        </button>
      `}).join("");return`
  <div class="result-card bg-white rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition-all duration-300 p-6" 
       data-result-id="${e.pivot_ID}">
    <!-- Header with Title, Subtitles and Button -->
    <div class="flex items-start justify-between gap-4 mb-4">
      <div class="min-w-0 flex-1">
        <h1 class="text-xl font-bold text-gray-900 leading-tight">${e.Title}</h1>
        <div class="flex items-center gap-4 mt-2">
          ${e.Subtitle?`<p class="text-lg text-gray-700 font-medium truncate">${e.Subtitle}</p>`:""}
          ${e.Subtitle&&e.Subtitle2?'<span class="w-1.5 h-1.5 bg-gray-400 rounded-full flex-shrink-0"></span>':""}
          ${e.Subtitle2?`<p class="text-lg text-gray-600 font-mono flex-shrink-0">${e.Subtitle2}</p>`:""}
        </div>
      </div>
      
      <!-- More button -->
      <button class="modal-toggle-btn inline-flex items-center px-4 py-2 rounded-full shadow-md hover:shadow-lg transition-all duration-200 flex-shrink-0 bg-primary-500 hover:bg-primary-600 text-white"
              data-work-index="${t}"
              title="Visualizza tutte le opere">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM12.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0ZM18.75 12a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
        </svg>
      </button>
    </div>
    
    <!-- Description with vertical bar -->
    ${e.Description?`
      <div class="flex items-stretch gap-2">
        <div class="w-1 bg-gradient-to-b from-primary-500 to-primary-600 rounded-full shadow-sm flex-shrink-0"></div>
        <p class="text-xs text-gray-600 flex-1">${e.Description}</p>
      </div>
    `:""}
    
    <!-- Locations -->
    ${n?`
      <div class="pt-4 border-t border-gray-200 mt-4">
        <div class="flex flex-wrap gap-2">
          ${n}
        </div>
      </div>
    `:""}
  </div>
`}_addModalListeners(){document.querySelectorAll(".modal-toggle-btn").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=parseInt(e.getAttribute("data-work-index"));this.modalRenderer.toggleModal(n)})})}_extractCoordinatesFromItem(e,t){let n={lat:null,lng:null};if(Array.isArray(e.lat_long)&&e.lat_long.length>t){const i=e.lat_long[t];if(i&&typeof i=="string"){const s=i.split(",");if(s.length===2){const o=parseFloat(s[0].trim()),a=parseFloat(s[1].trim());!isNaN(o)&&!isNaN(a)&&(n.lat=o,n.lng=a)}}}else if(e.lat_long&&typeof e.lat_long=="string"){const i=e.lat_long.split(",");if(i.length===2){const s=parseFloat(i[0].trim()),o=parseFloat(i[1].trim());!isNaN(s)&&!isNaN(o)&&(n.lat=s,n.lng=o)}}return n}_addMapFocusListeners(){document.querySelectorAll(".focus-map-btn").forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("data-lat"),i=e.getAttribute("data-lng"),s=decodeURIComponent(e.getAttribute("data-space"));n&&i&&this.mapFocusCallback?this.mapFocusCallback(parseFloat(n),parseFloat(i),s):console.warn("Coordinate non disponibili per questo luogo:",s)})})}}class za{constructor(e,t){this.config=e,this.searchEngine=t,this.components={}}async initializeComponents(e){const t=ui(this.config);return this.components.map=t.map,this.components.markers=t.markers,this.components.renderMarkers=t.renderMarkers,this.components.setFocusResultCallback=t.setFocusResultCallback,this.components.mapInstance=t,window.ledaSearch||(window.ledaSearch={}),window.ledaSearch.config=this.config,window.ledaSearch.mapInstance=this.components.mapInstance,window.switchMarkerType=n=>{this.components.mapInstance&&this.components.mapInstance.switchMarkerType&&this.components.mapInstance.switchMarkerType(n)},this.components.facetRenderer=new Pa(this.config),this.components.rangeRenderer=new Qn,this.components.taxonomyRenderer=new Un,this.components.searchHandler=new Na(this.searchEngine,this.config),this.components.resultsRenderer=new Ra((n,i,s)=>{this.components.mapInstance&&this.components.mapInstance.focusOnLocation&&this.components.mapInstance.focusOnLocation(n,i,s)}),this.components.navBar=Jo,this.components}connectMapToResults(e,t,n){t&&t(i=>{const s=e.focusOnResult(i);return!s&&n&&n("Item not found in current results","warning"),s})}getComponents(){return this.components}}class $a{constructor(){this.config=null,this.searchEngine=null,this.universalNav=null,this.universalFooter=null,this.stateManager=null,this.searchCoordinator=null,this.uiManager=null,this.filterManager=null,this.eventCoordinator=null,this.componentsInitializer=null,this.components={},this.isInitialLoad=!0,this.isFullyLoaded=!1,this.initialize()}async initialize(){try{this.uiManager=new Ro,this.uiManager.showFullScreenLoader(),this.config=await oi();const e=await ci();this.config.searchConfig.per_page=e.length,new ai(this.config).render(),new li(this.config).render(),this.searchEngine=Fo(e,this.config),this.initializeManagers(),await this.initializeComponents(),this.setupEvents(),await this.performSearch(),this.applyUrlFilters(),this.isInitialLoad=!1,this.isFullyLoaded=!0,this.uiManager.hideFullScreenLoader()}catch(e){console.error("Initialization error:",e),this.uiManager.showNotification("Error loading application","error"),this.uiManager.hideFullScreenLoader()}}initializeManagers(){this.stateManager=new Io(this.config),this.searchCoordinator=new No(null,this.config),this.filterManager=new zo(this.stateManager,this.config),this.eventCoordinator=new $o(this.stateManager,this.config,{onSearch:()=>this.searchCoordinator.debouncedSearch(this.stateManager.getState(),this.getSearchCallbacks()),onSortChange:()=>this.performSearch(),onClearAllFilters:()=>this.clearAllFilters(),onRemoveFilter:(e,t)=>this.removeFilter(e,t),onClearSearchQuery:()=>this.clearSearchQuery()})}async initializeComponents(){this.componentsInitializer=new za(this.config,this.searchEngine),this.components=await this.componentsInitializer.initializeComponents((e,t,n)=>this.focusOnMap(e,t,n)),this.searchCoordinator.searchHandler=this.components.searchHandler,this.componentsInitializer.connectMapToResults(this.components.resultsRenderer,this.components.setFocusResultCallback,(e,t)=>this.uiManager.showNotification(e,t))}setupEvents(){this.eventCoordinator.bindEvents(),this.eventCoordinator.bindNavBarEvents(this.components.navBar)}getSearchCallbacks(){return{onMarkersUpdate:e=>this.components.renderMarkers(e),onResultsUpdate:e=>{this.components.resultsRenderer.updateResultsList(e,this.config,{filters:this.stateManager.getState().filters,query:this.stateManager.getState().query,sort:this.stateManager.getState().sort})},onAggregationsUpdate:e=>this.renderFacets(e),onNavBarUpdate:e=>this.updateNavBar(e),onError:(e,t)=>this.uiManager.showNotification(e,t)}}async performSearch(){const e=this.stateManager.getState();return await this.searchCoordinator.performSearch(e,this.getSearchCallbacks())}async handleStateChange(e){await this.stateManager.handleStateChange(e,{onStateChange:async t=>{var i;window.ledaSearch.state=t;const n=await this.searchCoordinator.performSearch(t,this.getSearchCallbacks());console.log("Filter search completed:",((i=n.items)==null?void 0:i.length)||0,"items found")}})}renderFacets(e){this.components.facetRenderer.renderFacets(e,this.stateManager.getState(),t=>this.handleStateChange(t))}updateNavBar(e=[]){this.components.navBar.updateFromSearchState(this.stateManager.getState(),e)}focusOnMap(e,t,n){this.components.mapInstance&&this.components.mapInstance.focusOnLocation&&this.components.mapInstance.focusOnLocation(e,t,n)}applyUrlFilters(){this.filterManager.applyUrlFilters({onApplyFilters:async()=>await this.performSearch(),onShowNotification:(e,t)=>this.uiManager.showFilterNotification(e,t),onError:(e,t)=>this.uiManager.showNotification(e,t)})}clearAllFilters(){this.filterManager.clearAllFilters(),this.performSearch()}removeFilter(e,t){this.filterManager.removeFilter(e,t),this.performSearch()}clearSearchQuery(){this.filterManager.clearSearchQuery(),this.performSearch()}getLoadingStatus(){return{isLoading:this.searchCoordinator.getLoadingStatus().isLoading,isFullyLoaded:this.isFullyLoaded,searchEngineReady:!!this.searchEngine,mapReady:!!this.components.map,configLoaded:!!this.config}}}document.addEventListener("DOMContentLoaded",()=>{window.ledaSearch=new $a})});export default Ta();
